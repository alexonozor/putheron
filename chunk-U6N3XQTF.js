import{a as X,b as Z,c as ee,d as te,e as ie,g as ae,h as de,k as ce,l as pe,m as ue,n as L}from"./chunk-GXF7FYCU.js";import{a as Q,b as W}from"./chunk-EAY5JATJ.js";import"./chunk-IEFGRZDU.js";import"./chunk-7YGFLBJ2.js";import{a as oe,b as se,c as me,e as le}from"./chunk-RTVUWSKV.js";import"./chunk-LPGP55NA.js";import{d as K}from"./chunk-OVLPSQNG.js";import{h as re}from"./chunk-7UZH7J7I.js";import"./chunk-667ILHIJ.js";import"./chunk-ZLE5IO2O.js";import"./chunk-WUPIU6OB.js";import"./chunk-3JRZMC5D.js";import"./chunk-RNGT6N3O.js";import"./chunk-UUQHZO7R.js";import"./chunk-VMMII3BR.js";import{a as P}from"./chunk-DVEYH5MF.js";import{a as g}from"./chunk-C3KG2QNL.js";import"./chunk-2WQD2DAV.js";import{a as k,t as J,u as y}from"./chunk-IZGM5G4Z.js";import{a as ne}from"./chunk-OXNSH2WS.js";import"./chunk-QD7SSFII.js";import{a as G,b as M}from"./chunk-EPCK2AMG.js";import{d as w}from"./chunk-WF7V7INI.js";import{f as q,g as A,h as H,i as Y,l as F}from"./chunk-HNHRL3LT.js";import"./chunk-S4SH23H7.js";import{w as x}from"./chunk-5TL7AFVW.js";import{Bc as $,Ob as l,Pb as i,Qb as n,Rb as f,Vc as C,X as R,Yb as _,ab as m,ac as c,cc as h,f as I,ga as d,ib as B,la as p,ma as u,mc as z,nb as N,qc as o,rb as S,rc as T,sc as j,tb as U,va as b,xb as v}from"./chunk-VCYZZ2B3.js";import{e as D}from"./chunk-JKOY2XUY.js";var O=class r{authorizationService=d(g);templateRef=d(B);viewContainer=d(N);destroy$=new I;_permission=null;_requireAll=!1;_allowSuperAdmin=!0;_allowAdmin=!1;set hasPermission(e){this._permission=e,this.updateView()}set hasPermissionRequireAll(e){this._requireAll=e,this.updateView()}set hasPermissionAllowSuperAdmin(e){this._allowSuperAdmin=e,this.updateView()}set hasPermissionAllowAdmin(e){this._allowAdmin=e,this.updateView()}ngOnInit(){this.authorizationService.userPermissions$.pipe(R(this.destroy$)).subscribe(()=>{this.updateView()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}updateView(){this.hasRequiredPermissions()?this.showElement():this.hideElement()}hasRequiredPermissions(){if(this._allowSuperAdmin&&this.authorizationService.hasRole(g.ROLES.SUPER_ADMIN)||this._allowAdmin&&this.authorizationService.hasRole(g.ROLES.ADMIN))return!0;if(!this._permission)return!1;if(typeof this._permission=="string")return this.authorizationService.hasPermission(this._permission);if(Array.isArray(this._permission))return this._requireAll?this._permission.every(e=>this.authorizationService.hasPermission(e)):this._permission.some(e=>this.authorizationService.hasPermission(e));if(typeof this._permission=="object"&&this._permission.module&&this._permission.action){let e=`${this._permission.module}.${this._permission.action}`;return this.authorizationService.hasPermission(e)}return!1}showElement(){this.viewContainer.length===0&&this.viewContainer.createEmbeddedView(this.templateRef)}hideElement(){this.viewContainer.clear()}static \u0275fac=function(t){return new(t||r)};static \u0275dir=U({type:r,selectors:[["","hasPermission",""]],inputs:{hasPermission:"hasPermission",hasPermissionRequireAll:"hasPermissionRequireAll",hasPermissionAllowSuperAdmin:"hasPermissionAllowSuperAdmin",hasPermissionAllowAdmin:"hasPermissionAllowAdmin"}})};var fe=()=>({exact:!0});function ge(r,e){if(r&1){let t=_();i(0,"mat-list-item",28),c("click",function(){p(t);let a=h();return u(a.navigateAndClose("/admin/dashboard/users"))}),i(1,"mat-icon",13),o(2,"people"),n(),i(3,"span",14),o(4,"Users"),n()()}}function be(r,e){if(r&1){let t=_();i(0,"mat-list-item",29),c("click",function(){p(t);let a=h();return u(a.navigateAndClose("/admin/dashboard/services"))}),i(1,"mat-icon",13),o(2,"miscellaneous_services"),n(),i(3,"span",14),o(4,"Services"),n()()}}function ke(r,e){if(r&1){let t=_();i(0,"mat-list-item",30),c("click",function(){p(t);let a=h();return u(a.navigateAndClose("/admin/dashboard/categories"))}),i(1,"mat-icon",13),o(2,"category"),n(),i(3,"span",14),o(4,"Categories"),n()()}}function Se(r,e){if(r&1){let t=_();i(0,"mat-list-item",31),c("click",function(){p(t);let a=h();return u(a.navigateAndClose("/admin/dashboard/projects"))}),i(1,"mat-icon",13),o(2,"work_outline"),n(),i(3,"span",14),o(4,"Projects"),n()()}}function Ce(r,e){if(r&1){let t=_();i(0,"mat-list-item",32),c("click",function(){p(t);let a=h();return u(a.navigateAndClose("/admin/dashboard/reviews"))}),i(1,"mat-icon",13),o(2,"star_outline"),n(),i(3,"span",14),o(4,"Reviews"),n()()}}function xe(r,e){if(r&1){let t=_();i(0,"mat-list-item",33),c("click",function(){p(t);let a=h();return u(a.navigateAndClose("/admin/dashboard/transactions"))}),i(1,"mat-icon",13),o(2,"payments"),n(),i(3,"span",14),o(4,"Transactions"),n()()}}function Ae(r,e){if(r&1){let t=_();i(0,"mat-list-item",34),c("click",function(){p(t);let a=h();return u(a.navigateAndClose("/admin/dashboard/reports"))}),i(1,"mat-icon",13),o(2,"analytics"),n(),i(3,"span",14),o(4,"Reports & Analytics"),n()()}}function we(r,e){if(r&1){let t=_();i(0,"mat-list-item",39),c("click",function(){p(t);let a=h(2);return u(a.navigateAndClose("/admin/dashboard/roles-and-permissions"))}),i(1,"mat-icon",13),o(2,"shield"),n(),i(3,"span",14),o(4,"Roles & Permissions"),n()()}}function Me(r,e){r&1&&(i(0,"div",35)(1,"p",36),o(2,"Security"),n(),i(3,"mat-nav-list",37),v(4,we,5,0,"mat-list-item",38),n()()),r&2&&(m(4),l("hasPermission","roles.read"))}function ye(r,e){if(r&1){let t=_();i(0,"mat-list-item",42),c("click",function(){p(t);let a=h(2);return u(a.navigateAndClose("/admin/dashboard/settings"))}),i(1,"mat-icon",13),o(2,"settings"),n(),i(3,"span",14),o(4,"System Settings"),n()()}}function Pe(r,e){if(r&1){let t=_();i(0,"mat-list-item",43),c("click",function(){p(t);let a=h(2);return u(a.navigateAndClose("/admin/dashboard/audit-logs"))}),i(1,"mat-icon",13),o(2,"description"),n(),i(3,"span",14),o(4,"Audit Logs"),n()()}}function Le(r,e){r&1&&(i(0,"div",35)(1,"p",36),o(2,"System"),n(),i(3,"mat-nav-list",37),v(4,ye,5,0,"mat-list-item",40)(5,Pe,5,0,"mat-list-item",41),n()()),r&2&&(m(4),l("hasPermission","settings.read"),m(),l("hasPermission","audit.read"))}var E=class r{drawer;router=d(A);authService=d(P);breakpointObserver=d(w);user=C(()=>this.authService.currentUser);isMobile=b(!1);constructor(){this.breakpointObserver.observe([k.Handset]).subscribe(e=>{this.isMobile.set(e.matches)})}getUserInitials(){let e=this.user();if(!e)return"?";let t=e.first_name||"",s=e.last_name||"";return t&&s?`${t.charAt(0)}${s.charAt(0)}`.toUpperCase():t?t.charAt(0).toUpperCase():e.email?e.email.charAt(0).toUpperCase():"?"}navigateAndClose(e){this.router.navigate([e]),this.isMobile()&&this.drawer&&this.drawer.toggle()}onNavigationClick(){this.isMobile()&&this.drawer&&this.drawer.toggle()}navigateTo(e){this.router.navigate([`/admin/dashboard/${e}`]),this.isMobile()&&this.drawer&&this.drawer.toggle()}logout(){this.authService.logout(),this.router.navigate(["/auth/sign-in"])}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=S({type:r,selectors:[["app-admin-sidenav"]],inputs:{drawer:"drawer"},decls:44,vars:14,consts:[[1,"sidebar-content","bg-white","h-full","flex","flex-col"],[1,"p-4","border-b","border-gray-200","flex-shrink-0"],[1,"flex","items-center","space-x-3","pr-12"],[1,"w-10","h-10","bg-red-500","rounded-full","flex","items-center","justify-center","text-white","font-semibold"],[1,"flex-1"],[1,"font-semibold","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","mt-1"],[1,"admin-chip"],["matChipAvatar",""],[1,"bg-white","flex-1","overflow-y-auto"],[1,"px-4!"],["routerLink","/admin/dashboard/overview","routerLinkActive","active-link",3,"click","routerLinkActiveOptions"],["matListItemIcon",""],["matListItemTitle",""],["routerLink","/admin/dashboard/users","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/businesses","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/services","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/categories","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/projects","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/reviews","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/transactions","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/reports","routerLinkActive","active-link",3,"click",4,"hasPermission"],[1,"my-4"],["class","space-y-3 mb-6 p-4",4,"hasPermission"],[1,"p-4","border-t","border-gray-200","bg-white","flex-shrink-0"],["mat-button","",1,"w-full","text-red-600","hover:bg-red-50",3,"click"],[1,"mr-2"],["routerLink","/admin/dashboard/users","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/services","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/categories","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/projects","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/reviews","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/transactions","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/reports","routerLinkActive","active-link",3,"click"],[1,"space-y-3","mb-6","p-4"],[1,"text-xs","font-semibold","text-gray-500","uppercase","tracking-wider"],[1,"!py-0"],["routerLink","/admin/dashboard/roles-and-permissions","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/roles-and-permissions","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/settings","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/audit-logs","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/settings","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/audit-logs","routerLinkActive","active-link",3,"click"]],template:function(t,s){if(t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),o(4),n(),i(5,"div",4)(6,"h3",5),o(7),n(),i(8,"p",6),o(9),n(),i(10,"div",7)(11,"mat-chip-set")(12,"mat-chip",8)(13,"mat-icon",9),o(14,"admin_panel_settings"),n(),o(15," Administrator "),n()()()()()(),i(16,"nav",10)(17,"mat-nav-list",11)(18,"mat-list-item",12),c("click",function(){return s.navigateAndClose("/admin/dashboard/overview")}),i(19,"mat-icon",13),o(20,"dashboard"),n(),i(21,"span",14),o(22,"Overview"),n()(),v(23,ge,5,0,"mat-list-item",15),i(24,"mat-list-item",16),c("click",function(){return s.navigateAndClose("/admin/dashboard/businesses")}),i(25,"mat-icon",13),o(26,"business"),n(),i(27,"span",14),o(28,"Businesses"),n()(),v(29,be,5,0,"mat-list-item",17)(30,ke,5,0,"mat-list-item",18)(31,Se,5,0,"mat-list-item",19)(32,Ce,5,0,"mat-list-item",20)(33,xe,5,0,"mat-list-item",21)(34,Ae,5,0,"mat-list-item",22),n(),f(35,"mat-divider",23),v(36,Me,5,1,"div",24),f(37,"mat-divider",23),v(38,Le,6,2,"div",24),n(),i(39,"div",25)(40,"button",26),c("click",function(){return s.logout()}),i(41,"mat-icon",27),o(42,"logout"),n(),o(43," Sign Out "),n()()()),t&2){let a,V;m(4),j(" ",s.getUserInitials()," "),m(3),T((((a=s.user())==null?null:a.first_name)+" "+(((a=s.user())==null?null:a.last_name)||"")).trim()||((a=s.user())==null?null:a.email)),m(2),T((V=s.user())==null?null:V.email),m(9),l("routerLinkActiveOptions",$(13,fe)),m(5),l("hasPermission","users.read"),m(6),l("hasPermission","services.read"),m(),l("hasPermission","categories.read"),m(),l("hasPermission","projects.read"),m(),l("hasPermission","reviews.read"),m(),l("hasPermission","transactions.read"),m(),l("hasPermission","reports.read"),m(2),l("hasPermission","roles.read"),m(2),l("hasPermission","settings.read")}},dependencies:[x,H,Y,M,G,y,J,L,ue,pe,ce,Q,de,W,le,se,oe,me,O],styles:[".sidebar-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.badge[_ngcontent-%COMP%]{background-color:#e5e7eb;color:#374151;padding:2px 8px;border-radius:12px;font-size:12px;font-weight:500}  .mat-mdc-list-item.active-link{background-color:var(--mdc-theme-primary, #20AA62)!important;color:#fff!important;border-radius:8px!important}  .mat-mdc-list-item.active-link .mat-icon{color:#fff!important}  .mat-mdc-list-item.active-link .mdc-list-item__primary-text{color:#fff!important}"]})};var he=class r{authService=d(P);authorizationService=d(g);breakpointObserver=d(w);router=d(A);config=d(ne);user=this.authService.user;isMobile=b(!1);sidenavOpened=b(!0);isBootstrapping=b(!1);isHandset=C(()=>this.breakpointObserver.isMatched(k.Handset));constructor(){if(this.breakpointObserver.observe([k.Handset,k.Tablet]).subscribe(e=>{let t=e.matches;this.isMobile.set(t),t?this.sidenavOpened.set(!1):this.sidenavOpened.set(!0)}),!this.hasPermissionsLoaded()){let e=this.authService.user();e?._id&&this.authorizationService.refreshPermissions(e._id).catch(t=>{console.warn("Failed to load user permissions:",t)})}}logout(){this.authService.logout(),this.router.navigate(["/auth"])}navigateTo(e){this.router.navigate(["/admin",e])}toggleSidenav(){this.sidenavOpened.set(!this.sidenavOpened())}onMenuToggle(){this.toggleSidenav()}onNavigationClick(){this.isMobile()&&this.sidenavOpened.set(!1)}getUserInitials(){let e=this.user();if(!e)return"A";if(e.first_name||e.last_name){let t=e.first_name?.charAt(0).toUpperCase()||"",s=e.last_name?.charAt(0).toUpperCase()||"";return t+s}return e.email.charAt(0).toUpperCase()}bootstrapAdminRoles(){return D(this,null,function*(){try{this.isBootstrapping.set(!0);let e=localStorage.getItem("access_token")||sessionStorage.getItem("access_token");if(!e){alert("No authentication token found. Please log in again."),this.router.navigate(["/auth"]);return}console.log("\u{1F680} Starting admin roles bootstrap...");let t=yield fetch(this.config.getApiUrl("/admin/roles/bootstrap"),{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},credentials:"include"});if(!t.ok){let a=yield t.text();throw new Error(`Bootstrap failed: ${t.status} - ${a}`)}let s=yield t.json();console.log("\u2705 Bootstrap completed:",s),alert(`\u{1F389} Success! You are now a Super Admin!

${s.message}

You can now access all role management features. This button will be removed in production.`),window.location.reload()}catch(e){console.error("\u274C Bootstrap failed:",e);let t="Bootstrap failed. ";if(e.message.includes("403"))t+="You may not have permission to bootstrap roles. Contact your system administrator.";else if(e.message.includes("401")){t+="Authentication failed. Please log in again.",this.router.navigate(["/auth"]);return}else t+=e.message||"Unknown error occurred.";alert(t)}finally{this.isBootstrapping.set(!1)}})}isSuperAdmin(){return this.authorizationService.hasRole(g.ROLES.SUPER_ADMIN)}hasPermissionsLoaded(){let e=this.authorizationService.userPermissions();return e!=null&&e.allPermissions.length>0}shouldShowBootstrap(){return this.isSuperAdmin()||!this.hasPermissionsLoaded()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=S({type:r,selectors:[["app-admin-dashboard"]],decls:7,vars:6,consts:[["drawer",""],[3,"drawer"],["autosize","",1,"content-body",3,"hasBackdrop"],["position","start",1,"drawer",3,"opened","disableClose","mode"]],template:function(t,s){if(t&1&&(f(0,"app-header",1),i(1,"mat-drawer-container",2)(2,"mat-drawer",3,0),f(4,"app-admin-sidenav",1),n(),i(5,"mat-drawer-content"),f(6,"router-outlet"),n()()),t&2){let a=z(3);l("drawer",a),m(),l("hasBackdrop",s.isMobile()),m(),l("opened",s.sidenavOpened())("disableClose",!s.isMobile())("mode",s.isMobile()?"over":"side"),m(2),l("drawer",a)}},dependencies:[x,q,ie,ee,te,Z,L,M,y,X,re,K,ae,E,F],styles:[".drawer[_ngcontent-%COMP%]{height:calc(100vh - 64px);border-radius:0}.content-body[_ngcontent-%COMP%]{height:calc(100vh - 64px);overflow-y:scroll}.dashboard-loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:3rem 0}.dashboard-loading[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite;border-radius:50%;height:3rem;width:3rem;border:2px solid #e5e7eb;border-top:2px solid #2563eb}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.business-item[_ngcontent-%COMP%]:hover{background-color:#f9fafb;transition:background-color .15s ease-in-out}.status-approved[_ngcontent-%COMP%]{background-color:#dcfce7;color:#166534}.status-pending[_ngcontent-%COMP%]{background-color:#fef3c7;color:#92400e}.status-rejected[_ngcontent-%COMP%]{background-color:#fee2e2;color:#991b1b}.status-suspended[_ngcontent-%COMP%]{background-color:#f3f4f6;color:#374151}.create-business-btn[_ngcontent-%COMP%]:hover{background-color:#1d4ed8;transform:translateY(-1px);transition:all .2s ease-in-out}.action-btn[_ngcontent-%COMP%]:hover{background-color:#f9fafb;transform:translateY(-1px);transition:all .15s ease-in-out}.action-btn-danger[_ngcontent-%COMP%]:hover{background-color:#fef2f2;transform:translateY(-1px);transition:all .15s ease-in-out}.stat-card[_ngcontent-%COMP%]:hover{box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -2px #0000000d;transition:box-shadow .2s ease-in-out}.empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:.6}@media (max-width: 640px){.business-content[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.75rem}.action-buttons[_ngcontent-%COMP%]{margin-left:0;width:100%;justify-content:flex-end}.stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.create-business-btn[_ngcontent-%COMP%]:focus, .action-btn[_ngcontent-%COMP%]:focus, .action-btn-danger[_ngcontent-%COMP%]:focus{outline:2px solid transparent;outline-offset:2px;box-shadow:0 0 0 2px #2563eb}@media print{.action-buttons[_ngcontent-%COMP%], .create-business-btn[_ngcontent-%COMP%]{display:none}}"]})};export{he as AdminDashboardComponent};
