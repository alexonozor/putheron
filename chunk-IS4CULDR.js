import{a as K,b as Q,c as ee}from"./chunk-AK5JDXGC.js";import{a as Z}from"./chunk-QCETNKUN.js";import{a as X,b as Y}from"./chunk-JCYJ3IK2.js";import{a as z,b as G,c as q,d as W}from"./chunk-F7EJEAX7.js";import{b as L,c as $,e as J}from"./chunk-XNH753K3.js";import{a as U}from"./chunk-FI6EVXVM.js";import{G as F,H as j}from"./chunk-T77N2UQ2.js";import{Ba as y,Ga as _,Ka as w,Ma as D,Na as O,Pa as p,S as h,Sa as B,Sb as C,Ta as R,Tb as S,Ua as i,Va as o,Wa as x,X as d,Y as m,Z as V,_ as I,_a as g,ab as u,bb as c,gc as k,ha as A,mb as H,nb as a,ob as P,pb as v,rc as N,sa as l,sc as T,vc as M}from"./chunk-YOTEMOQK.js";import{d as f}from"./chunk-QEZ3K4DX.js";var re=(r,e)=>e._id;function ae(r,e){if(r&1&&(i(0,"span",4),a(1),o()),r&2){let t=c();l(),v(" ",t.unreadCount()>99?"99+":t.unreadCount()," ")}}function se(r,e){if(r&1){let t=g();i(0,"button",16),u("click",function(){d(t);let s=c(2);return m(s.markAllAsRead())}),a(1),o()}if(r&2){let t=c(2);w("disabled",t.isMarkingAllRead),l(),v(" ",t.isMarkingAllRead?"Marking...":"Mark all read"," ")}}function le(r,e){r&1&&(i(0,"div",14),x(1,"div",17),o())}function ce(r,e){r&1&&(i(0,"div",15),V(),i(1,"svg",18),x(2,"path",3),o(),I(),i(3,"p",19),a(4,"No notifications yet"),o()())}function de(r,e){r&1&&x(0,"div",31)}function me(r,e){if(r&1){let t=g();i(0,"div",21),u("click",function(){let s=d(t).$implicit,b=c(3);return m(b.handleNotificationClick(s))})("keydown.enter",function(){let s=d(t).$implicit,b=c(3);return m(b.handleNotificationClick(s))})("keydown.space",function(){let s=d(t).$implicit,b=c(3);return m(b.handleNotificationClick(s))}),i(1,"div",22)(2,"div",23)(3,"span",24),a(4),o()(),i(5,"div",25)(6,"div",26)(7,"div",27)(8,"p",28),a(9),o(),i(10,"p",29),a(11),o(),i(12,"p",30),a(13),o()(),_(14,de,1,0,"div",31),o()()()()}if(r&2){let t=e.$implicit,n=c(3);O(n.getNotificationStyles(t)),l(4),P(n.getNotificationIcon(t.type)),l(5),v(" ",t.title," "),l(2),v(" ",t.message," "),l(2),v(" ",n.formatTimeAgo(t.createdAt)," "),l(),p(t.is_read?-1:14)}}function ue(r,e){if(r&1&&B(0,me,15,7,"div",20,re),r&2){let t=c(2);R(t.recentNotifications())}}function pe(r,e){if(r&1){let t=g();i(0,"div",5)(1,"div",7)(2,"div",8)(3,"h3",9),a(4,"Notifications"),o(),i(5,"div",10),_(6,se,2,2,"button",11),i(7,"a",12),u("click",function(){d(t);let s=c();return m(s.closeDropdown())}),a(8," View all "),o()()()(),i(9,"div",13),_(10,le,2,0,"div",14)(11,ce,5,0,"div",15)(12,ue,2,0),o()()}if(r&2){let t=c();l(6),p(t.unreadCount()>0?6:-1),l(4),p(t.isLoading()?10:t.recentNotifications().length===0?11:12)}}function fe(r,e){if(r&1){let t=g();i(0,"div",32),u("click",function(){d(t);let s=c();return m(s.closeDropdown())}),o()}}var E=class r{notificationService=h(Z);socketService=h(ee);router=h(N);isDropdownOpen=!1;isMarkingAllRead=!1;notifications=this.notificationService.notifications;unreadCount=this.notificationService.unreadCount;isLoading=this.notificationService.isLoading;hasUnreadNotifications=C(()=>this.unreadCount()>0);recentNotifications=C(()=>this.notifications().slice(0,5));constructor(){S(()=>{this.updatePageTitle()})}ngOnInit(){this.loadNotifications(),this.notificationService.requestNotificationPermission()}loadNotifications(){return f(this,null,function*(){try{yield this.notificationService.getNotifications({limit:20,page:1})}catch(e){console.error("Error loading notifications:",e)}})}toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen,this.isDropdownOpen&&this.markUnseenAsSeen()}closeDropdown(){this.isDropdownOpen=!1}markUnseenAsSeen(){return f(this,null,function*(){try{yield this.notificationService.markAllAsSeen()}catch(e){console.error("Error marking notifications as seen:",e)}})}markAllAsRead(){return f(this,null,function*(){this.isMarkingAllRead=!0;try{yield this.notificationService.markAllAsRead()}catch(e){console.error("Error marking all as read:",e)}finally{this.isMarkingAllRead=!1}})}handleNotificationClick(e){return f(this,null,function*(){if(!e.is_read)try{yield this.notificationService.markAsRead(e._id)}catch(t){console.error("Error marking notification as read:",t)}this.navigateFromNotification(e),this.closeDropdown()})}navigateFromNotification(e){switch(e.type){case"project_created":case"project_accepted":case"project_rejected":case"project_started":case"project_completed":e.project_id&&this.router.navigate(["/dashboard/projects",e.project_id._id]);break;case"message_received":e.metadata?.chatId&&this.router.navigate(["/dashboard/messages"],{queryParams:{chat:e.metadata.chatId}});break;default:this.router.navigate(["/dashboard/notifications"]);break}}getNotificationIcon(e){return this.notificationService.getNotificationIcon(e)}getNotificationStyles(e){let t="";return e.priority==="urgent"?t+="bg-red-50 border-l-4 border-red-400 ":e.priority==="high"?t+="bg-orange-50 border-l-4 border-orange-400 ":e.is_read||(t+="bg-blue-50 "),t}formatTimeAgo(e){return this.notificationService.formatTimeAgo(e)}updatePageTitle(){let e=this.unreadCount(),t=document.title.replace(/^\(\d+\)\s/,"");e>0?document.title=`(${e}) ${t}`:document.title=t}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=y({type:r,selectors:[["app-notification-nav"]],decls:7,vars:7,consts:[[1,"relative"],[1,"relative","p-2","text-gray-600","hover:text-gray-900","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","rounded-lg","transition-colors","duration-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 17h5l-5.5-7V7a5 5 0 00-4.5-4.5A5 5 0 005.5 7v3L0 17h5m5 0v1a3 3 0 01-6 0v-1m6 0v1a3 3 0 006 0v-1"],[1,"absolute","-top-1","-right-1","inline-flex","items-center","justify-center","px-2","py-1","text-xs","font-bold","leading-none","text-white","transform","translate-x-1/2","-translate-y-1/2","bg-red-500","rounded-full","min-w-[1.25rem]","h-5"],[1,"absolute","right-0","z-50","mt-2","w-80","bg-white","rounded-lg","shadow-lg","border","border-gray-200","max-h-96","overflow-hidden"],[1,"fixed","inset-0","z-40"],[1,"px-4","py-3","border-b","border-gray-200","bg-gray-50"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-semibold","text-gray-900"],[1,"flex","items-center","space-x-2"],[1,"text-xs","text-blue-600","hover:text-blue-800","font-medium",3,"disabled"],["routerLink","/dashboard/notifications",1,"text-xs","text-gray-600","hover:text-gray-800","font-medium",3,"click"],[1,"max-h-64","overflow-y-auto"],[1,"flex","items-center","justify-center","py-8"],[1,"text-center","py-8","text-gray-500"],[1,"text-xs","text-blue-600","hover:text-blue-800","font-medium",3,"click","disabled"],[1,"animate-spin","rounded-full","h-6","w-6","border-b-2","border-blue-600"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-2","text-gray-300"],[1,"text-sm"],["role","button","tabindex","0",1,"px-4","py-3","border-b","border-gray-100","hover:bg-gray-50","cursor-pointer","transition-colors","duration-200",3,"class"],["role","button","tabindex","0",1,"px-4","py-3","border-b","border-gray-100","hover:bg-gray-50","cursor-pointer","transition-colors","duration-200",3,"click","keydown.enter","keydown.space"],[1,"flex","items-start","space-x-3"],[1,"flex-shrink-0","mt-1"],[1,"text-lg"],[1,"flex-1","min-w-0"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"text-sm","font-medium","text-gray-900","truncate","hover:text-blue-600","transition-colors"],[1,"text-xs","text-gray-600","mt-1","line-clamp-2"],[1,"text-xs","text-gray-400","mt-1"],[1,"w-2","h-2","bg-blue-500","rounded-full","ml-2","mt-1","flex-shrink-0"],[1,"fixed","inset-0","z-40",3,"click"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"button",1),u("click",function(){return n.toggleDropdown()}),V(),i(2,"svg",2),x(3,"path",3),o(),_(4,ae,2,1,"span",4),o(),_(5,pe,13,2,"div",5)(6,fe,1,0,"div",6),o()),t&2&&(l(),D("text-blue-600",n.hasUnreadNotifications()),l(),D("animate-pulse",n.hasUnreadNotifications()),l(2),p(n.unreadCount()>0?4:-1),l(),p(n.isDropdownOpen?5:-1),l(),p(n.isDropdownOpen?6:-1))},dependencies:[k,M,T],styles:[".line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}"]})};function _e(r,e){if(r&1){let t=g();i(0,"button",15),u("click",function(){d(t);let s=c(2);return m(s.switchToBusinessMode())}),i(1,"mat-icon"),a(2,"business"),o(),i(3,"span"),a(4,"Switch to Business Owner"),o()()}}function xe(r,e){if(r&1){let t=g();i(0,"button",15),u("click",function(){d(t);let s=c(2);return m(s.switchToClientMode())}),i(1,"mat-icon"),a(2,"person_outline"),o(),i(3,"span"),a(4,"Switch to Client Mode"),o()()}}function ge(r,e){if(r&1){let t=g();i(0,"div",8)(1,"button",9),u("click",function(){d(t);let s=c();return m(s.navigateToMessages())}),i(2,"mat-icon",10),a(3," mail "),o()(),x(4,"app-notification-nav"),i(5,"div",11)(6,"button",12)(7,"div",13),a(8),o(),i(9,"mat-icon"),a(10,"expand_more"),o()(),i(11,"mat-menu",null,0)(13,"div",14),a(14),o(),i(15,"button",15),u("click",function(){d(t);let s=c();return m(s.navigateToDashboard())}),i(16,"mat-icon"),a(17,"dashboard"),o(),i(18,"span"),a(19,"Dashboard"),o()(),i(20,"button",15),u("click",function(){d(t);let s=c();return m(s.navigateToProfile())}),i(21,"mat-icon"),a(22,"person"),o(),i(23,"span"),a(24,"Profile"),o()(),_(25,_e,5,0,"button",16)(26,xe,5,0,"button",16),x(27,"mat-divider"),i(28,"button",15),u("click",function(){d(t);let s=c();return m(s.navigateToSettings())}),i(29,"mat-icon"),a(30,"settings"),o(),i(31,"span"),a(32,"Settings"),o()(),x(33,"mat-divider"),i(34,"button",17),u("click",function(){d(t);let s=c();return m(s.signOut())}),i(35,"mat-icon"),a(36,"logout"),o(),i(37,"span"),a(38,"Sign Out"),o()()()()()}if(r&2){let t=H(12),n=c();l(2),w("matBadge",n.messageCount())("matBadgeHidden",n.messageCount()===0),l(4),w("matMenuTriggerFor",t),l(2),v(" ",n.getUserInitials()," "),l(6),v(" Mode: ",n.isBusinessOwner()?"Business Owner":"Client"," "),l(11),p(n.isBusinessOwner()?26:25)}}function ve(r,e){r&1&&(i(0,"a",18),a(1," Sign In "),o(),i(2,"a",19),a(3," Join "),o())}var te=class r{authService=h(U);router=h(N);user=this.authService.user;isAuthenticated=this.authService.isAuthenticated;showMobileMenu=A(!1);messageCount=A(3);userMode=C(()=>this.user()?.user_mode||"client");isBusinessOwner=C(()=>this.userMode()==="business_owner");constructor(){S(()=>{let e=this.user(),t=this.userMode(),n=this.isBusinessOwner();console.log("Header signals updated:",{user:e?.email,mode:t,isBusiness:n})})}getUserInitials(){let e=this.user();if(!e)return"";let t=e.first_name||"",n=e.last_name||"";return t&&n?t.charAt(0).toUpperCase()+n.charAt(0).toUpperCase():t?t.charAt(0).toUpperCase()+(e.email.charAt(0).toUpperCase()||""):n?e.email.charAt(0).toUpperCase()+n.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase()}getUserFullName(){let e=this.user();if(!e)return"";let t=e.first_name||"",n=e.last_name||"";return t&&n?`${t} ${n}`:t||n||e.email}navigateToDashboard(){this.router.navigate(["/dashboard"])}navigateToProfile(){this.router.navigate(["/dashboard/profile"])}navigateToSettings(){this.router.navigate(["/dashboard/settings"])}navigateToMessages(){this.router.navigate(["/dashboard/messages"])}navigateToCreateBusiness(){this.router.navigate(["/dashboard/businesses/create-business"])}navigateToOwnBusiness(){this.router.navigate(["/own-business"])}navigateToBecomeBusiness(){this.router.navigate(["/auth"],{queryParams:{mode:"business"}})}switchToBusinessMode(){return f(this,null,function*(){try{let e=yield this.authService.switchMode("business_owner");e.data?(console.log("Switched to business owner mode successfully"),console.log("Updated user mode:",this.userMode()),this.navigateToDashboard()):console.error("Failed to switch to business mode:",e.error)}catch(e){console.error("Error switching to business mode:",e)}})}switchToClientMode(){return f(this,null,function*(){try{let e=yield this.authService.switchMode("client");e.data?(console.log("Switched to client mode successfully"),console.log("Updated user mode:",this.userMode()),this.router.navigate(["/search"])):console.error("Failed to switch to client mode:",e.error)}catch(e){console.error("Error switching to client mode:",e)}})}toggleMobileMenu(){this.showMobileMenu.update(e=>!e)}signOut(){return f(this,null,function*(){yield this.authService.signOut()})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=y({type:r,selectors:[["app-header"]],decls:16,vars:1,consts:[["userMenu","matMenu"],[1,"relative","z-50","bg-white","shadow-sm"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","justify-between","items-center","py-4"],[1,"flex","items-center"],["routerLink","/",1,"text-2xl","font-bold","text-blue-600","hover:text-blue-700","transition-colors"],[1,"hidden","md:flex","items-center","space-x-8"],["href","#",1,"text-gray-700","hover:text-blue-600","transition-colors"],[1,"flex","items-center","space-x-4"],["mat-icon-button","",1,"relative","text-gray-700","hover:text-blue-600","transition-colors",3,"click"],["matBadgeColor","warn","matBadgeSize","small",3,"matBadge","matBadgeHidden"],[1,"relative"],["mat-button","",1,"flex","items-center","space-x-2","text-gray-700","hover:text-blue-600","transition-colors",3,"matMenuTriggerFor"],[1,"w-8","h-8","bg-blue-600","text-white","rounded-full","flex","items-center","justify-center","text-sm","font-medium"],[1,"px-4","py-2","text-sm","text-gray-500","border-b"],["mat-menu-item","",3,"click"],["mat-menu-item",""],["mat-menu-item","",1,"text-red-600",3,"click"],["routerLink","/auth",1,"text-gray-700","hover:text-blue-600","transition-colors"],["routerLink","/auth",1,"bg-blue-600","text-white","px-4","py-2","rounded-lg","hover:bg-blue-700","transition-colors"]],template:function(t,n){if(t&1&&(i(0,"header",1)(1,"nav",2)(2,"div",3)(3,"div",4)(4,"a",5),a(5," VouchHer "),o()(),i(6,"div",6)(7,"a",7),a(8,"Browse Categories"),o(),i(9,"a",7),a(10,"How It Works"),o(),i(11,"a",7),a(12,"Success Stories"),o()(),i(13,"div",8),_(14,ge,39,6,"div",8)(15,ve,4,0),o()()()()),t&2){let s;l(14),p((s=n.isAuthenticated())?14:15,s)}},dependencies:[k,M,T,j,F,J,$,L,W,G,z,q,Q,K,Y,X,E],encapsulation:2})};export{E as a,te as b};
