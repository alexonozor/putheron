import{a as Ge}from"./chunk-MVGII3AK.js";import{a as $e,b as Ve,c as Ue}from"./chunk-7PGJYD7D.js";import{a as L,b as H,e as K,f as Y,g as Z,h as B}from"./chunk-UGVZ2NZX.js";import{d as oe,h as U,i as ae,j as se,l as X,m as G}from"./chunk-HUQJ3NC3.js";import{d as $,e as J,f as Ne,k as V}from"./chunk-SQHEFKI2.js";import{A as N,c as Q,e as y,h as O,i as q,l as j,m as Te,p as T,q as A,v as Ae,w as ke,y as k}from"./chunk-IOQBSONU.js";import{a as le,b as me}from"./chunk-ZH2LY4H3.js";import{c as I,e as D}from"./chunk-SUTJIGUH.js";import{p as R,q as F}from"./chunk-A72LFUZP.js";import{a as je}from"./chunk-IZ7UM5CL.js";import{a as qe}from"./chunk-YYV7O7JP.js";import{B as Oe,l as W,t as E}from"./chunk-REOVWAHI.js";import{$ as ie,Bb as c,Ca as Pe,Db as Se,Ea as S,Gb as x,Ib as we,Ic as De,Jb as ge,Kb as fe,Lb as o,Mb as i,Nb as h,Rb as z,Vb as v,Wb as f,ac as Ee,bc as Re,cb as l,cc as Fe,fa as u,gc as s,hb as re,hc as ye,ic as b,na as M,o as g,oa as P,ob as w,qc as Ie,ub as _,ya as Me}from"./chunk-BEPULU6C.js";import{e as m}from"./chunk-JKOY2XUY.js";var ce=class r{http=u(Oe);configService=u(je);get apiUrl(){return this.configService.getApiUrl("/chat")}createOrGetChat(e){return this.http.post(this.apiUrl,e)}createOrGetChatAsync(e){return m(this,null,function*(){return(yield g(this.createOrGetChat(e))).data})}getUserChats(){return this.http.get(this.apiUrl)}getUserChatsAsync(){return m(this,null,function*(){return(yield g(this.getUserChats())).data})}getChatById(e){return this.http.get(`${this.apiUrl}/${e}`)}getChatByIdAsync(e){return m(this,null,function*(){return(yield g(this.getChatById(e))).data})}getChatMessages(e,t=1,n=50){return this.http.get(`${this.apiUrl}/${e}/messages?page=${t}&limit=${n}`)}getChatMessagesAsync(e,t=1,n=50){return m(this,null,function*(){return(yield g(this.getChatMessages(e,t,n))).data})}sendMessage(e,t){return this.http.post(`${this.apiUrl}/${e}/messages`,t)}sendMessageAsync(e,t){return m(this,null,function*(){return(yield g(this.sendMessage(e,t))).data})}updateMessage(e,t,n){return this.http.patch(`${this.apiUrl}/${e}/messages/${t}`,n)}updateMessageAsync(e,t,n){return m(this,null,function*(){return(yield g(this.updateMessage(e,t,n))).data})}deleteMessage(e,t){return this.http.delete(`${this.apiUrl}/${e}/messages/${t}`)}deleteMessageAsync(e,t){return m(this,null,function*(){yield g(this.deleteMessage(e,t))})}markMessagesAsRead(e){return this.http.post(`${this.apiUrl}/${e}/mark-read`,{})}markMessagesAsReadAsync(e){return m(this,null,function*(){yield g(this.markMessagesAsRead(e))})}getUnreadMessageCount(){return this.http.get(`${this.apiUrl}/unread-count`)}getUnreadMessageCountAsync(){return m(this,null,function*(){return(yield g(this.getUnreadMessageCount())).data.count})}getChatByProjectId(e){return this.http.get(`${this.apiUrl}/project/${e}`)}getChatByProjectIdAsync(e){return m(this,null,function*(){return(yield g(this.getChatByProjectId(e))).data})}getChatUnreadCount(e){return this.http.get(`${this.apiUrl}/${e}/unread-count`)}getChatUnreadCountAsync(e){return m(this,null,function*(){return(yield g(this.getChatUnreadCount(e))).data.count})}uploadChatFiles(e,t,n){let a=new FormData;return t.forEach(p=>{a.append("files",p)}),n&&a.append("content",n),this.http.post(`${this.apiUrl}/${e}/upload-files`,a)}uploadChatFilesAsync(e,t,n){return m(this,null,function*(){return(yield g(this.uploadChatFiles(e,t,n))).data})}requestAdditionalPayment(e,t){return this.http.post(`${this.apiUrl}/${e}/request-payment`,t)}requestAdditionalPaymentAsync(e,t){return m(this,null,function*(){return(yield g(this.requestAdditionalPayment(e,t))).data})}respondToPaymentRequest(e,t,n){return this.http.post(`${this.apiUrl}/${e}/respond-payment/${t}`,n)}respondToPaymentRequestAsync(e,t,n){return m(this,null,function*(){return(yield g(this.respondToPaymentRequest(e,t,n))).data})}createAdditionalPaymentIntent(e,t){return this.http.post(`${this.apiUrl}/${e}/payment-intent/${t}`,{})}createAdditionalPaymentIntentAsync(e,t){return m(this,null,function*(){return(yield g(this.createAdditionalPaymentIntent(e,t))).data})}confirmAdditionalPayment(e,t,n){return this.http.post(`${this.apiUrl}/${e}/confirm-additional-payment/${t}`,{paymentIntentId:n})}confirmAdditionalPaymentAsync(e,t,n){return m(this,null,function*(){return(yield g(this.confirmAdditionalPayment(e,t,n))).data})}requestCompletion(e,t){return this.http.post(`${this.apiUrl}/${e}/request-completion`,t)}requestCompletionAsync(e,t){return m(this,null,function*(){return(yield g(this.requestCompletion(e,t))).data})}respondToCompletionRequest(e,t,n){return this.http.post(`${this.apiUrl}/${e}/respond-completion/${t}`,n)}respondToCompletionRequestAsync(e,t,n){return m(this,null,function*(){return(yield g(this.respondToCompletionRequest(e,t,n))).data})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=ie({token:r,factory:r.\u0275fac,providedIn:"root"})};var ze="basil",it=function(e){return e===3?"v3":e},We="https://js.stripe.com",rt="".concat(We,"/").concat(ze,"/stripe.js"),ot=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,at=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,Le="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",st=function(e){return ot.test(e)||at.test(e)},lt=function(){for(var e=document.querySelectorAll('script[src^="'.concat(We,'"]')),t=0;t<e.length;t++){var n=e[t];if(st(n.src))return n}return null},Be=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(rt).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(n),n},mt=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"7.7.0",startTime:t})},te=null,pe=null,de=null,ct=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}},pt=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},dt=function(e){return te!==null?te:(te=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(Le),window.Stripe){t(window.Stripe);return}try{var a=lt();if(a&&e)console.warn(Le);else if(!a)a=Be(e);else if(a&&de!==null&&pe!==null){var p;a.removeEventListener("load",de),a.removeEventListener("error",pe),(p=a.parentNode)===null||p===void 0||p.removeChild(a),a=Be(e)}de=pt(t,n),pe=ct(n),a.addEventListener("load",de),a.addEventListener("error",pe)}catch(C){n(C);return}}),te.catch(function(t){return te=null,Promise.reject(t)}))},ut=function(e,t,n){if(e===null)return null;var a=t[0],p=a.match(/^pk_test/),C=it(e.version),d=ze;p&&C!==d&&console.warn("Stripe.js@".concat(C," was loaded on the page, but @stripe/stripe-js@").concat("7.7.0"," expected Stripe.js@").concat(d,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var xe=e.apply(void 0,t);return mt(xe,n),xe},ne,Qe=!1,Je=function(){return ne||(ne=dt(null).catch(function(e){return ne=null,Promise.reject(e)}),ne)};Promise.resolve().then(function(){return Je()}).catch(function(r){Qe||console.warn(r)});var Xe=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Qe=!0;var a=Date.now();return Je().then(function(p){return ut(p,t,a)})};var ue=class r{stripePromise;stripe=null;constructor(){this.stripePromise=Xe(qe.stripe.publishableKey)}getStripe(){return m(this,null,function*(){return this.stripe||(this.stripe=yield this.stripePromise),this.stripe})}createElement(e){return m(this,null,function*(){let t=yield this.getStripe();if(!t)throw new Error("Stripe failed to load");let n=t.elements({clientSecret:e,appearance:{theme:"stripe",variables:{colorPrimary:"#3b82f6",colorBackground:"#ffffff",colorText:"#1f2937",colorDanger:"#ef4444",fontFamily:'"Inter", "Segoe UI", sans-serif',spacingUnit:"4px",borderRadius:"8px"},rules:{".Tab":{border:"1px solid #e5e7eb",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},".Tab:hover":{color:"#1f2937",backgroundColor:"#f9fafb"},".Tab--selected":{backgroundColor:"#3b82f6",color:"#ffffff"}}}}),a=n.create("payment",{layout:"tabs"});return{elements:n,paymentElement:a}})}confirmPayment(e,t,n){return m(this,null,function*(){let a=yield this.getStripe();if(!a)throw new Error("Stripe failed to load");return yield a.confirmPayment({elements:t,confirmParams:{return_url:n}})})}confirmPaymentWithoutRedirect(e,t){return m(this,null,function*(){let n=yield this.getStripe();if(!n)throw new Error("Stripe failed to load");let{error:a}=yield t.submit();if(a)throw a;return yield n.confirmPayment({elements:t,confirmParams:{},redirect:"if_required"})})}retrievePaymentIntent(e){return m(this,null,function*(){let t=yield this.getStripe();if(!t)throw new Error("Stripe failed to load");return yield t.retrievePaymentIntent(e)})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=ie({token:r,factory:r.\u0275fac,providedIn:"root"})};var ft=["stripeElements"];function yt(r,e){r&1&&(o(0,"mat-error"),s(1," Please select a payment method "),i())}function ht(r,e){if(r&1&&(o(0,"form",9)(1,"mat-form-field",15)(2,"mat-label"),s(3,"Payment Method"),i(),o(4,"mat-select",16)(5,"mat-option",17),s(6,"Credit/Debit Card"),i()(),_(7,yt,2,0,"mat-error",18),i(),o(8,"div",19)(9,"mat-icon"),s(10,"info"),i(),o(11,"p"),s(12,"This payment will be processed securely via Stripe."),i()()()),r&2){let t,n=f();c("formGroup",n.paymentForm),l(7),c("ngIf",(t=n.paymentForm.get("paymentMethod"))==null?null:t.hasError("required"))}}function _t(r,e){if(r&1&&(o(0,"div",21)(1,"mat-icon"),s(2,"error"),i(),o(3,"span"),s(4),i()()),r&2){let t=f(2);l(4),ye(t.stripeError())}}function vt(r,e){if(r&1&&(o(0,"div",10),h(1,"div",20,0),_(3,_t,5,1,"div",21),i()),r&2){let t=f();l(3),x(t.stripeError()?3:-1)}}function bt(r,e){r&1&&(o(0,"div",11),h(1,"mat-spinner",22),o(2,"p"),s(3,"Processing payment..."),i()())}function Ct(r,e){if(r&1){let t=z();o(0,"button",23),v("click",function(){M(t);let a=f();return P(a.setupStripePayment())}),o(1,"mat-icon"),s(2,"credit_card"),i(),s(3," Proceed to Payment "),i()}if(r&2){let t=f();c("disabled",t.paymentForm.invalid||t.processing())}}function xt(r,e){if(r&1){let t=z();o(0,"button",23),v("click",function(){M(t);let a=f();return P(a.processPayment())}),o(1,"mat-icon"),s(2,"lock"),i(),s(3," Complete Payment "),i()}if(r&2){let t=f();c("disabled",t.processing())}}var He=class r{constructor(e){this.data=e;this.paymentForm=this.formBuilder.group({paymentMethod:["card",[y.required]]})}stripeElementsRef;dialogRef=u(L);formBuilder=u(k);stripeService=u(ue);chatService=u(ce);cdr=u(De);paymentForm;showStripeForm=S(!1);processing=S(!1);stripeError=S(null);elements=null;paymentElement=null;clientSecret=null;ngOnInit(){}ngAfterViewInit(){}setupStripePayment(){return m(this,null,function*(){if(!this.paymentForm.invalid){this.processing.set(!0),this.stripeError.set(null);try{let e=yield this.chatService.createAdditionalPaymentIntentAsync(this.data.chatId,this.data.messageId);this.clientSecret=e.clientSecret;let{elements:t,paymentElement:n}=yield this.stripeService.createElement(this.clientSecret);this.elements=t,this.paymentElement=n,this.showStripeForm.set(!0),this.cdr.detectChanges(),setTimeout(()=>{this.stripeElementsRef?.nativeElement?this.paymentElement.mount(this.stripeElementsRef.nativeElement):this.stripeError.set("Unable to initialize payment form")},100)}catch(e){console.error("Error setting up payment:",e),this.stripeError.set(e.message||"Failed to setup payment")}finally{this.processing.set(!1)}}})}processPayment(){return m(this,null,function*(){if(!this.elements||!this.clientSecret){this.stripeError.set("Payment not properly initialized");return}this.processing.set(!0),this.stripeError.set(null);try{let{error:e,paymentIntent:t}=yield this.stripeService.confirmPaymentWithoutRedirect(this.clientSecret,this.elements);if(e){this.stripeError.set(e.message||"Payment failed");return}if(t?.status==="succeeded"){yield this.chatService.confirmAdditionalPaymentAsync(this.data.chatId,this.data.messageId,t.id);let n={amount:this.data.amount,description:this.data.description,paymentMethod:this.paymentForm.value.paymentMethod,paymentIntentId:t.id};this.dialogRef.close(n)}else this.stripeError.set("Payment was not completed successfully")}catch(e){console.error("Error processing payment:",e),this.stripeError.set(e.message||"Payment processing failed")}finally{this.processing.set(!1)}})}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||r)(re(H))};static \u0275cmp=w({type:r,selectors:[["app-payment-modal"]],viewQuery:function(t,n){if(t&1&&Ee(ft,5,Pe),t&2){let a;Re(a=Fe())&&(n.stripeElementsRef=a.first)}},decls:26,vars:7,consts:[["stripeElements",""],["mat-dialog-title","",1,"dialog-title"],[1,"title-icon"],["mat-dialog-content","",1,"dialog-content"],[1,"payment-details"],[1,"amount-section"],[1,"amount-display"],[1,"description-section"],[1,"business-name"],[1,"payment-form",3,"formGroup"],[1,"stripe-form"],[1,"loading-overlay"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"disabled"],["appearance","outline",1,"full-width"],["formControlName","paymentMethod"],["value","card"],[4,"ngIf"],[1,"payment-note"],[1,"stripe-elements"],[1,"error-message"],["diameter","40"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(t,n){t&1&&(o(0,"h1",1)(1,"mat-icon",2),s(2,"payment"),i(),s(3," Make Payment "),i(),o(4,"div",3)(5,"div",4)(6,"div",5)(7,"h3"),s(8,"Payment Amount"),i(),o(9,"div",6),s(10),i()(),o(11,"div",7)(12,"h3"),s(13,"Payment For"),i(),o(14,"p"),s(15),i(),o(16,"p",8),s(17),i()()(),_(18,ht,13,2,"form",9)(19,vt,4,1,"div",10)(20,bt,4,0,"div",11),i(),o(21,"div",12)(22,"button",13),v("click",function(){return n.onCancel()}),s(23," Cancel "),i(),_(24,Ct,4,1,"button",14)(25,xt,4,1,"button",14),i()),t&2&&(l(10),b(" $",n.data.amount," "),l(5),ye(n.data.description),l(2),b("To: ",n.data.businessName,""),l(),x(n.showStripeForm()?19:18),l(2),x(n.processing()?20:-1),l(2),c("disabled",n.processing()),l(2),x(n.showStripeForm()?25:24))},dependencies:[E,W,N,j,O,q,T,A,B,K,Z,Y,D,I,U,V,$,J,G,F,R,se,ae,oe,me,le],styles:[".dialog-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:600;margin-bottom:0}.title-icon[_ngcontent-%COMP%]{color:#10b981;font-size:24px}.dialog-content[_ngcontent-%COMP%]{min-width:400px;max-width:500px}.payment-details[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:20px;margin-bottom:20px}.amount-section[_ngcontent-%COMP%]{text-align:center;margin-bottom:16px}.amount-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#64748b;margin:0 0 8px;text-transform:uppercase;letter-spacing:.5px}.amount-display[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:#10b981;margin-bottom:16px}.description-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#64748b;margin:0 0 8px;text-transform:uppercase;letter-spacing:.5px}.description-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 8px;color:#374151;line-height:1.5}.business-name[_ngcontent-%COMP%]{font-weight:600;color:#1f2937}.payment-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.full-width[_ngcontent-%COMP%]{width:100%}.payment-note[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;padding:12px;background:#dbeafe;border:1px solid #bfdbfe;border-radius:8px;margin-top:16px}.payment-note[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#3b82f6;font-size:20px;margin-top:2px}.payment-note[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#1e40af;line-height:1.4}mat-dialog-actions[_ngcontent-%COMP%]{padding-top:16px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}.stripe-form[_ngcontent-%COMP%]{margin:20px 0}.stripe-elements[_ngcontent-%COMP%]{border:1px solid #e2e8f0;border-radius:8px;padding:16px;background:#fff}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#ef4444;margin-top:12px;font-size:14px}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#ffffffe6;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;border-radius:12px}.loading-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-weight:500;color:#64748b}"]})};function Mt(r,e){r&1&&(o(0,"mat-error"),s(1," Amount is required "),i())}function Pt(r,e){r&1&&(o(0,"mat-error"),s(1," Amount must be greater than 0 "),i())}function St(r,e){r&1&&(o(0,"mat-error"),s(1," Description is required "),i())}function wt(r,e){r&1&&(o(0,"mat-error"),s(1," Message is required "),i())}var Ze=class r{constructor(e){this.data=e;let t=this.data?.defaultAmount||"",n=this.data?.isStartPayment||!1,a=n?"Project payment":"",p=n?"Payment is required to start working on your project. This amount covers the agreed services and deliverables.":"";this.paymentForm=this.formBuilder.group({amount:[t,[y.required,y.min(.01)]],description:[a,[y.required,y.minLength(3)]],content:[p,[y.required,y.minLength(10)]]})}dialogRef=u(L);formBuilder=u(k);paymentForm;onCancel(){this.dialogRef.close()}onSubmit(){if(this.paymentForm.valid){let e=this.paymentForm.value,t={amount:parseFloat(e.amount),description:e.description,content:e.content};this.dialogRef.close(t)}}static \u0275fac=function(t){return new(t||r)(re(H))};static \u0275cmp=w({type:r,selectors:[["app-payment-request-modal"]],decls:29,vars:10,consts:[["mat-dialog-title","",1,"dialog-title"],[1,"title-icon"],["mat-dialog-content","",1,"dialog-content"],[1,"payment-form",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","type","number","formControlName","amount","placeholder","0.00","min","0.01","step","0.01"],[4,"ngIf"],["matInput","","formControlName","description",3,"placeholder"],["matInput","","formControlName","content","rows","4",3,"placeholder"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(t,n){if(t&1&&(o(0,"h1",0)(1,"mat-icon",1),s(2,"payment"),i(),s(3),i(),o(4,"div",2)(5,"form",3)(6,"mat-form-field",4)(7,"mat-label"),s(8,"Amount ($)"),i(),h(9,"input",5),_(10,Mt,2,0,"mat-error",6)(11,Pt,2,0,"mat-error",6),i(),o(12,"mat-form-field",4)(13,"mat-label"),s(14,"Description"),i(),h(15,"input",7),_(16,St,2,0,"mat-error",6),i(),o(17,"mat-form-field",4)(18,"mat-label"),s(19,"Message to Client"),i(),h(20,"textarea",8),_(21,wt,2,0,"mat-error",6),i()()(),o(22,"div",9)(23,"button",10),v("click",function(){return n.onCancel()}),s(24," Cancel "),i(),o(25,"button",11),v("click",function(){return n.onSubmit()}),o(26,"mat-icon"),s(27,"send"),i(),s(28),i()()),t&2){let a,p,C,d;l(3),b(" ",n.data!=null&&n.data.isStartPayment?"Request Project Payment":"Request Additional Payment"," "),l(2),c("formGroup",n.paymentForm),l(5),c("ngIf",(a=n.paymentForm.get("amount"))==null?null:a.hasError("required")),l(),c("ngIf",(p=n.paymentForm.get("amount"))==null?null:p.hasError("min")),l(4),c("placeholder",n.data!=null&&n.data.isStartPayment?"Payment for project services":"Why is additional payment needed?"),l(),c("ngIf",(C=n.paymentForm.get("description"))==null?null:C.hasError("required")),l(4),c("placeholder",n.data!=null&&n.data.isStartPayment?"Message about project payment and start...":"Explain the payment request in detail..."),l(),c("ngIf",(d=n.paymentForm.get("content"))==null?null:d.hasError("required")),l(4),c("disabled",n.paymentForm.invalid),l(3),b(" ",n.data!=null&&n.data.isStartPayment?"Start Project & Request Payment":"Send Payment Request"," ")}},dependencies:[E,W,N,j,Q,Te,O,q,Ae,T,A,B,K,Z,Y,D,I,U,V,$,J,G,X,F,R],styles:[".dialog-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:600;margin-bottom:0}.title-icon[_ngcontent-%COMP%]{color:#3b82f6;font-size:24px}.dialog-content[_ngcontent-%COMP%]{min-width:400px;max-width:500px}.payment-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin-top:16px}.full-width[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]{padding-top:16px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}"]})};function Et(r,e){r&1&&(o(0,"mat-error"),s(1," Completion details are required "),i())}function Rt(r,e){r&1&&(o(0,"mat-error"),s(1," Please provide more detailed information (at least 20 characters) "),i())}var tt=class r{dialogRef=u(L);formBuilder=u(k);completionForm;constructor(){this.completionForm=this.formBuilder.group({content:["Project has been completed and is ready for review.",[y.required,y.minLength(20)]]})}onCancel(){this.dialogRef.close()}onSubmit(){if(this.completionForm.valid){let e={content:this.completionForm.value.content};this.dialogRef.close(e)}}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=w({type:r,selectors:[["app-completion-request-modal"]],decls:23,vars:4,consts:[["mat-dialog-title","",1,"dialog-title"],[1,"title-icon"],["mat-dialog-content","",1,"dialog-content"],[1,"description"],[1,"completion-form",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","content","rows","6","placeholder","Describe what has been completed, delivered, or achieved..."],[4,"ngIf"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(t,n){if(t&1&&(o(0,"h1",0)(1,"mat-icon",1),s(2,"check_circle"),i(),s(3," Request Project Completion "),i(),o(4,"div",2)(5,"p",3),s(6," You're about to request client approval for project completion. Please describe what has been completed and delivered. "),i(),o(7,"form",4)(8,"mat-form-field",5)(9,"mat-label"),s(10,"Completion Details"),i(),h(11,"textarea",6),o(12,"mat-hint"),s(13,"Be specific about deliverables and outcomes"),i(),_(14,Et,2,0,"mat-error",7)(15,Rt,2,0,"mat-error",7),i()()(),o(16,"div",8)(17,"button",9),v("click",function(){return n.onCancel()}),s(18," Cancel "),i(),o(19,"button",10),v("click",function(){return n.onSubmit()}),o(20,"mat-icon"),s(21,"send"),i(),s(22," Request Completion Approval "),i()()),t&2){let a,p;l(7),c("formGroup",n.completionForm),l(7),c("ngIf",(a=n.completionForm.get("content"))==null?null:a.hasError("required")),l(),c("ngIf",(p=n.completionForm.get("content"))==null?null:p.hasError("minlength")),l(4),c("disabled",n.completionForm.invalid)}},dependencies:[E,W,N,j,Q,O,q,T,A,B,K,Z,Y,D,I,U,V,$,Ne,J,G,X,F,R],styles:[".dialog-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:600;margin-bottom:0}.title-icon[_ngcontent-%COMP%]{color:#10b981;font-size:24px}.dialog-content[_ngcontent-%COMP%]{min-width:400px;max-width:500px}.description[_ngcontent-%COMP%]{color:#64748b;font-size:14px;line-height:1.5;margin:0 0 16px;padding:12px;background:#f8fafc;border-radius:8px;border-left:4px solid #10b981}.completion-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.full-width[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]{padding-top:16px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}"]})};var Ft=()=>[1,2,3,4,5],It=(r,e)=>e._id;function Dt(r,e){r&1&&(o(0,"div",2),h(1,"mat-spinner",5),o(2,"span",6),s(3,"Loading projects..."),i()())}function Ot(r,e){if(r&1){let t=z();o(0,"div",3)(1,"mat-icon",7),s(2,"work_off"),i(),o(3,"h3",8),s(4,"No Completed Projects"),i(),o(5,"p",9),s(6,"You need to complete a project with this business before you can leave a review."),i(),o(7,"button",10),v("click",function(){M(t);let a=f();return P(a.dialogRef.close())}),s(8," Close "),i()()}}function qt(r,e){if(r&1&&(o(0,"span",32),s(1),i()),r&2){let t=f().$implicit,n=f(2);l(),b(" - Completed ",n.formatDate(t.completed_at),"")}}function jt(r,e){if(r&1&&(o(0,"mat-option",14),s(1),_(2,qt,2,1,"span",32),i()),r&2){let t=e.$implicit;c("value",t._id),l(),b(" ",t.title," "),l(),x(t.completed_at?2:-1)}}function Tt(r,e){if(r&1){let t=z();o(0,"mat-icon",33),v("click",function(){let a=M(t).$implicit,p=f(2);return P(p.setRating(a))}),s(1," star "),i()}if(r&2){let t,n,a=e.$implicit,p=f(2);Se("text-yellow-400",a<=((t=p.reviewForm.get("rating"))==null?null:t.value))("text-gray-300",a>((n=p.reviewForm.get("rating"))==null?null:n.value))}}function At(r,e){r&1&&h(0,"mat-spinner",31)}function kt(r,e){if(r&1){let t=z();o(0,"form",11),v("ngSubmit",function(){M(t);let a=f();return P(a.submitReview())}),o(1,"mat-form-field",12)(2,"mat-label"),s(3,"Select Project"),i(),o(4,"mat-select",13),ge(5,jt,3,3,"mat-option",14,It),i()(),o(7,"div",15)(8,"label",16),s(9,"Overall Rating *"),i(),o(10,"div",17),ge(11,Tt,2,4,"mat-icon",18,we),o(13,"span",19),s(14),i()()(),o(15,"mat-form-field",12)(16,"mat-label"),s(17,"Review"),i(),o(18,"textarea",20),s(19,"            "),i()(),o(20,"div",21)(21,"div")(22,"label",16),s(23,"Service Quality"),i(),o(24,"mat-slider",22),h(25,"input",23),i(),o(26,"div",24),s(27),i()(),o(28,"div")(29,"label",16),s(30,"Communication"),i(),o(31,"mat-slider",22),h(32,"input",25),i(),o(33,"div",24),s(34),i()(),o(35,"div")(36,"label",16),s(37,"Timeliness"),i(),o(38,"mat-slider",22),h(39,"input",26),i(),o(40,"div",24),s(41),i()(),o(42,"div")(43,"label",16),s(44,"Value for Money"),i(),o(45,"mat-slider",22),h(46,"input",27),i(),o(47,"div",24),s(48),i()()(),o(49,"div",28)(50,"button",29),v("click",function(){M(t);let a=f();return P(a.dialogRef.close())}),s(51," Cancel "),i(),o(52,"button",30),_(53,At,1,0,"mat-spinner",31),s(54," Submit Review "),i()()()}if(r&2){let t,n,a,p,C,d=f();c("formGroup",d.reviewForm),l(5),fe(d.completedProjects()),l(6),fe(Ie(12,Ft)),l(3),b("",((t=d.reviewForm.get("rating"))==null?null:t.value)||0,"/5"),l(10),c("displayWith",d.formatSliderLabel),l(3),b("",((n=d.reviewForm.get("service_quality"))==null?null:n.value)||0,"/5"),l(4),c("displayWith",d.formatSliderLabel),l(3),b("",((a=d.reviewForm.get("communication"))==null?null:a.value)||0,"/5"),l(4),c("displayWith",d.formatSliderLabel),l(3),b("",((p=d.reviewForm.get("timeliness"))==null?null:p.value)||0,"/5"),l(4),c("displayWith",d.formatSliderLabel),l(3),b("",((C=d.reviewForm.get("value_for_money"))==null?null:C.value)||0,"/5"),l(4),c("disabled",!d.reviewForm.valid||d.submitting()),l(),x(d.submitting()?53:-1)}}var nt=class r{reviewSubmitted=new Me;fb=u(k);reviewService=u(Ge);dialogRef=u(L);data=u(H,{optional:!0});completedProjects=S([]);submitting=S(!1);loadingProjects=S(!1);get businessId(){return this.data?.businessId||""}get businessName(){return this.data?.businessName||"Business"}get projectId(){return this.data?.projectId||null}get projectTitle(){return this.data?.projectTitle||"Current Project"}reviewForm;constructor(){this.reviewForm=this.fb.group({project_id:["",y.required],rating:[0,[y.required,y.min(1),y.max(5)]],review_text:[""],service_quality:[5],communication:[5],timeliness:[5],value_for_money:[5]})}ngOnInit(){this.projectId?(this.reviewForm.patchValue({project_id:this.projectId}),this.completedProjects.set([{_id:this.projectId,title:this.projectTitle,business_id:{_id:this.businessId,name:this.businessName},completed_at:new Date,client_id:"",business_owner_id:"",status:"completed"}])):this.loadCompletedProjects()}loadCompletedProjects(){return m(this,null,function*(){try{this.loadingProjects.set(!0);let t=(yield this.reviewService.getCompletedProjectsForReviewAsync()).filter(n=>n.business_id._id===this.businessId);this.completedProjects.set(t)}catch(e){console.error("Error loading completed projects:",e)}finally{this.loadingProjects.set(!1)}})}setRating(e){this.reviewForm.patchValue({rating:e})}formatSliderLabel(e){return`${e}`}formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Date not specified"}submitReview(){return m(this,null,function*(){if(!this.reviewForm.invalid)try{this.submitting.set(!0);let e=this.reviewForm.value,t={project_id:e.project_id,rating:e.rating,review_text:e.review_text||void 0,service_quality:e.service_quality,communication:e.communication,timeliness:e.timeliness,value_for_money:e.value_for_money};yield this.reviewService.createReviewAsync(t),this.reviewSubmitted.emit(),this.dialogRef.close(!0)}catch(e){console.error("Error submitting review:",e)}finally{this.submitting.set(!1)}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=w({type:r,selectors:[["app-review-form"]],outputs:{reviewSubmitted:"reviewSubmitted"},decls:6,vars:1,consts:[[1,"p-6"],[1,"text-xl","font-semibold","text-gray-900","mb-4"],[1,"flex","items-center","justify-center","py-8"],[1,"text-center","py-8"],[3,"formGroup"],["diameter","40"],[1,"ml-3","text-gray-600"],[1,"text-gray-400","text-6xl","mb-4"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-600","mb-4"],["mat-button","","color","primary",3,"click"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"w-full","mb-4"],["formControlName","project_id","required",""],[3,"value"],[1,"mb-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","items-center","space-x-2"],[1,"cursor-pointer","text-2xl","hover:text-yellow-400","transition-colors",3,"text-yellow-400","text-gray-300"],[1,"ml-2","text-sm","text-gray-600"],["matInput","","formControlName","review_text","rows","4","placeholder","Share your experience working with this business..."],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-6"],["min","1","max","5","step","1","discrete","",3,"displayWith"],["matSliderThumb","","formControlName","service_quality"],[1,"text-xs","text-gray-500","mt-1"],["matSliderThumb","","formControlName","communication"],["matSliderThumb","","formControlName","timeliness"],["matSliderThumb","","formControlName","value_for_money"],[1,"flex","justify-end","space-x-3"],["type","button","mat-button","",3,"click"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],["diameter","20",1,"mr-2"],[1,"text-sm","text-gray-500"],[1,"cursor-pointer","text-2xl","hover:text-yellow-400","transition-colors",3,"click"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"h2",1),s(2,"Leave a Review"),i(),_(3,Dt,4,0,"div",2)(4,Ot,9,0,"div",3)(5,kt,55,13,"form",4),i()),t&2&&(l(3),x(n.loadingProjects()?3:n.completedProjects().length===0?4:5))},dependencies:[E,N,j,Q,O,q,ke,T,A,B,U,V,$,G,X,D,I,se,ae,oe,F,R,Ue,$e,Ve,me,le],styles:["[_nghost-%COMP%]{display:block;max-width:600px}.mat-mdc-slider[_ngcontent-%COMP%]{width:100%}mat-icon.text-yellow-400[_ngcontent-%COMP%]{color:#fbbf24}mat-icon.text-gray-300[_ngcontent-%COMP%]{color:#d1d5db}"]})};export{ce as a,He as b,Ze as c,tt as d,nt as e};
