import{a as y}from"./chunk-32N7BY3Y.js";import{O as p,S as m,jc as c,kc as T,l as o,m as g}from"./chunk-5O25OI26.js";import{a as d,b as l,d as i}from"./chunk-QEZ3K4DX.js";var f=class u{http=m(T);config=m(y);get apiUrl(){return this.config.getApiUrl("/admin/transactions")}getTransactions(t={}){let e=new c;return Object.entries(t).forEach(([n,s])=>{s!=null&&s!==""&&(e=e.set(n,s.toString()))}),this.http.get(this.apiUrl,{params:e}).pipe(g(n=>({transactions:(n.transactions||n.data?.transactions||[]).map(r=>l(d({},r),{id:r._id,userId:typeof r.user_id=="string"?r.user_id:r.user_id?._id,type:this.mapTransactionTypeToFrontend(r.transaction_type),user:typeof r.user_id=="object"?{_id:r.user_id._id,firstName:r.user_id.first_name,lastName:r.user_id.last_name,email:r.user_id.email}:void 0,currency:"USD",fee:r.fee||0,completedAt:r.processing_completed_at,paymentDetails:{method:r.payment_method,transactionId:r.stripe_payment_intent_id,gateway:r.stripe_payment_intent_id?"stripe":void 0}})),pagination:{currentPage:n.page||1,totalPages:n.totalPages||1,totalCount:n.total||0,perPage:t.limit||25,hasNext:(n.page||1)<(n.totalPages||1),hasPrev:(n.page||1)>1}})))}mapTransactionTypeToFrontend(t){switch(t){case"PROJECT_STARTED":case"PROJECT_COMPLETED":case"ADDITIONAL_PAYMENT":return"payment";case"WITHDRAWAL":return"withdrawal";case"REFUND":return"refund";case"PLATFORM_FEE":return"fee";case"WITHDRAWAL_RESERVED":return"escrow";default:return"payment"}}getTransactionsAsync(){return i(this,arguments,function*(t={}){return o(this.getTransactions(t))})}getTransaction(t){return this.http.get(`${this.apiUrl}/${t}`)}getTransactionAsync(t){return i(this,null,function*(){return o(this.getTransaction(t))})}getTransactionStats(t={}){let e=new c;return Object.entries(t).forEach(([n,s])=>{s!=null&&s!==""&&(e=e.set(n,s.toString()))}),this.http.get(`${this.apiUrl}/stats`,{params:e}).pipe(g(n=>{let s=n.summary||{},r=n.byStatus||{},a=n.byType||{};return{total:s.total||0,totalAmount:s.totalAmount||0,pending:s.pending||0,pendingAmount:r.pending?.amount||0,completed:s.completed||0,completedAmount:r.completed?.amount||0,failed:s.failed||0,failedAmount:r.failed?.amount||0,payments:a.PROJECT_STARTED?.count||a.PROJECT_COMPLETED?.count||0,paymentsAmount:(a.PROJECT_STARTED?.amount||0)+(a.PROJECT_COMPLETED?.amount||0),withdrawals:a.WITHDRAWAL?.count||0,withdrawalsAmount:a.WITHDRAWAL?.amount||0,refunds:a.REFUND?.count||0,refundsAmount:a.REFUND?.amount||0,byStatus:{pending:r.pending?.count||0,completed:r.completed?.count||0,failed:r.failed?.count||0,cancelled:r.cancelled?.count||0},byType:{payment:(a.PROJECT_STARTED?.count||0)+(a.PROJECT_COMPLETED?.count||0)+(a.ADDITIONAL_PAYMENT?.count||0),withdrawal:a.WITHDRAWAL?.count||0,refund:a.REFUND?.count||0,fee:a.PLATFORM_FEE?.count||0,escrow:a.WITHDRAWAL_RESERVED?.count||0}}}))}getTransactionStatsAsync(){return i(this,arguments,function*(t={}){return o(this.getTransactionStats(t))})}updateTransactionStatus(t,e,n){return this.http.patch(`${this.apiUrl}/${t}/status`,{status:e,reason:n})}updateTransactionStatusAsync(t,e,n){return i(this,null,function*(){return o(this.updateTransactionStatus(t,e,n))})}processRefund(t,e,n){return this.http.post(`${this.apiUrl}/${t}/refund`,{amount:e,reason:n})}processRefundAsync(t,e,n){return i(this,null,function*(){return o(this.processRefund(t,e,n))})}bulkUpdateTransactions(t,e){return this.http.patch(`${this.apiUrl}/bulk`,{transactionIds:t,updates:e})}bulkUpdateTransactionsAsync(t,e){return i(this,null,function*(){return o(this.bulkUpdateTransactions(t,e))})}exportTransactions(t={}){let e=new c;return Object.entries(t).forEach(([n,s])=>{s!=null&&s!==""&&(e=e.set(n,s.toString()))}),this.http.get(`${this.apiUrl}/export`,{params:e,responseType:"blob"})}getTransactionEventsAsync(t){return i(this,null,function*(){return(yield this.http.get(`${this.apiUrl}/${t}/events`).toPromise())||[]})}getTransactionRefundsAsync(t){return i(this,null,function*(){return(yield this.http.get(`${this.apiUrl}/${t}/refunds`).toPromise())||[]})}retryTransactionAsync(t){return i(this,null,function*(){return yield this.http.post(`${this.apiUrl}/${t}/retry`,{}).toPromise()})}deleteTransactionAsync(t){return i(this,null,function*(){yield this.http.delete(`${this.apiUrl}/${t}`).toPromise()})}getStatusColor(t){switch(t){case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}}getStatusLabel(t){switch(t){case"completed":return"Completed";case"pending":return"Pending";case"processing":return"Processing";case"failed":return"Failed";case"cancelled":return"Cancelled";default:return t}}getTypeColor(t){switch(t){case"payment":return"bg-green-100 text-green-800";case"withdrawal":return"bg-blue-100 text-blue-800";case"refund":return"bg-yellow-100 text-yellow-800";case"escrow_release":return"bg-purple-100 text-purple-800";case"escrow_hold":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}}getTypeLabel(t){switch(t){case"payment":return"Payment";case"withdrawal":return"Withdrawal";case"refund":return"Refund";case"escrow_release":return"Escrow Release";case"escrow_hold":return"Escrow Hold";default:return t}}formatCurrency(t,e="USD"){return new Intl.NumberFormat("en-US",{style:"currency",currency:e,minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}formatDate(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}getUserName(t){return typeof t=="string"?`User ID: ${t}`:`${t.first_name} ${t.last_name}`.trim()||t.email}getBusinessName(t){return typeof t=="string"?`Business ID: ${t}`:t.name}getProjectTitle(t){return typeof t=="string"?`Project ID: ${t}`:t.title}static \u0275fac=function(e){return new(e||u)};static \u0275prov=p({token:u,factory:u.\u0275fac,providedIn:"root"})};export{f as a};
