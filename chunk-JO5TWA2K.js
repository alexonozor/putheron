import{a as re,e as ve}from"./chunk-LBGHG66S.js";import{g as _e,j as fe}from"./chunk-DGEBZL2V.js";import{a as G}from"./chunk-54OYESWZ.js";import{a as N,b as ye,c as $}from"./chunk-QCYMMLYN.js";import{a as L,fa as Z,ha as be,ia as xe,ja as F,ka as Ce,la as U,sa as H,u as he}from"./chunk-OIQ4AZ5F.js";import"./chunk-ZBD3I6MR.js";import{$a as ee,$b as se,Bb as P,Ca as p,Fa as k,Ia as y,Ib as z,Jb as E,Ka as m,Ma as D,Na as O,O as W,Oa as o,Pa as a,Qa as g,R as f,Rb as B,Sb as oe,Tb as V,Ua as x,W as h,Wa as u,X as _,Xa as d,Xb as ae,Y as M,Z as j,ab as te,bb as ne,bc as Q,d as C,ec as le,fb as l,fc as de,ga as b,gb as v,hb as w,ib as ie,ic as ce,kc as me,lc as pe,pa as I,qa as s,rb as R,sb as A,sc as ge,uc as ue,ya as S,za as X}from"./chunk-3RLE7VBR.js";var K=class n{static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-messages"]],decls:1,vars:0,template:function(e,i){e&1&&g(0,"router-outlet")},dependencies:[E,oe],encapsulation:2})};var Me=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=X({type:n});static \u0275inj=W({imports:[he,Z,Z]})}return n})();var Te=(n,t)=>t._id;function je(n,t){n&1&&(o(0,"div",10),g(1,"mat-spinner",14),a())}function Pe(n,t){if(n&1&&(o(0,"div",11)(1,"div",15)(2,"mat-icon",16),l(3,"error"),a(),o(4,"span",17),l(5),a()()()),n&2){let e=d();s(5),v(e.error())}}function Ie(n,t){if(n&1&&g(0,"img",22),n&2){let e=d().$implicit;k("src",e.project_id.business_id.logo_url,I)("alt",e.project_id.business_id.name)}}function De(n,t){n&1&&(o(0,"div",23)(1,"mat-icon",36),l(2,"business"),a()())}function Oe(n,t){if(n&1){let e=x();o(0,"div",19),u("click",function(){let r=h(e).$implicit,c=d(2);return _(c.openChat(r))}),o(1,"div",20)(2,"div",21),p(3,Ie,1,2,"img",22)(4,De,3,0,"div",23),a(),o(5,"div",24)(6,"div",25)(7,"div",26)(8,"h3",27),l(9),a(),o(10,"div",28)(11,"span",29),l(12),a(),o(13,"span",30),l(14,"\u2022"),a(),o(15,"span",29),l(16),a()(),o(17,"div",31)(18,"span",32),l(19),R(20,"titlecase"),a(),o(21,"span",33),l(22),a()()(),o(23,"div",34)(24,"button",35),u("click",function(r){let c=h(e).$implicit,T=d(2);return _(T.viewProject(c.project_id._id,r))}),o(25,"mat-icon"),l(26,"open_in_new"),a()(),o(27,"mat-icon",30),l(28,"chevron_right"),a()()()()()()}if(n&2){let e=t.$implicit,i=d(2);s(3),m(e.project_id.business_id.logo_url?3:4),s(6),v(e.title),s(3),w(" With ",i.getOtherParticipant(e).last_name||"Unknown User"," "),s(4),v(e.project_id.business_id.name),s(2),y(i.getProjectStatusColor(e.project_id.status)),s(),w(" ",A(20,8,e.project_id.status)," "),s(3),v(i.formatDate(e.last_message_at))}}function Re(n,t){if(n&1&&(o(0,"div",12),D(1,Oe,29,10,"div",18,Te),a()),n&2){let e=d();s(),O(e.chats())}}function Ae(n,t){if(n&1){let e=x();o(0,"div",13)(1,"div",37)(2,"mat-icon",38),l(3,"chat_bubble_outline"),a()(),o(4,"h3",39),l(5,"No conversations yet"),a(),o(6,"p",40),l(7," Start a conversation by creating a project or accepting project requests. "),a(),o(8,"button",41),u("click",function(){h(e);let r=d();return _(r.navigateToProjects())}),l(9," View Projects "),a()()}}var q=class n{chatService=f(G);authService=f(L);projectService=f(N);router=f(V);route=f(B);loading=b(!1);error=b(null);chats=b([]);unreadCount=b(0);user=this.authService.user;hasChats=P(()=>this.chats().length>0);ngOnInit(){if(!this.user()){this.router.navigate(["/auth"]);return}this.loadChats(),this.loadUnreadCount()}loadChats(){return C(this,null,function*(){this.loading.set(!0),this.error.set(null);try{let t=yield this.chatService.getUserChatsAsync();this.chats.set(t)}catch(t){console.error("Error loading chats:",t),this.error.set("Failed to load chats")}finally{this.loading.set(!1)}})}loadUnreadCount(){return C(this,null,function*(){try{let t=yield this.chatService.getUnreadMessageCountAsync();this.unreadCount.set(t)}catch(t){console.error("Error loading unread count:",t)}})}openChat(t){this.router.navigate(["../chat",t._id],{relativeTo:this.route})}viewProject(t,e){e.stopPropagation(),this.router.navigate(["/dashboard/projects",t])}getOtherParticipant(t){let e=this.user()?._id;return t.project_id.client_id._id===e?t.project_id.business_owner_id:t.project_id.client_id}getProjectStatusColor(t){let e={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",accepted:"bg-blue-100 text-blue-800 border-blue-200",in_progress:"bg-purple-100 text-purple-800 border-purple-200",completed:"bg-green-100 text-green-800 border-green-200",rejected:"bg-red-100 text-red-800 border-red-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200"};return e[t]||e.pending}formatDate(t){let e=new Date(t),r=(new Date().getTime()-e.getTime())/(1e3*60*60);if(r<1){let c=Math.floor(r*60);return c<1?"Just now":`${c}m ago`}else return r<24?`${Math.floor(r)}h ago`:r<48?"Yesterday":e.toLocaleDateString()}refreshChats(){return C(this,null,function*(){yield this.loadChats(),yield this.loadUnreadCount()})}navigateBack(){this.router.navigate(["/dashboard"])}navigateToProjects(){this.router.navigate(["/dashboard/projects"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-chat-list"]],decls:20,vars:5,consts:[[1,"min-h-screen","bg-gray-50"],[1,"max-w-6xl","mx-auto","px-4","py-8"],[1,"flex","items-center","justify-between","mb-8"],[1,"flex","items-center","space-x-4"],["mat-icon-button","",1,"flex","items-center","justify-center","w-10","h-10","rounded-full","bg-white","shadow-sm","border","border-gray-200","hover:bg-gray-50","transition-colors",3,"click"],[1,"text-gray-600"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-gray-600","mt-1"],["mat-raised-button","","color","primary",1,"px-6","py-3","text-base","font-semibold","rounded-lg",3,"click","disabled"],[1,"mr-2"],[1,"flex","justify-center","items-center","py-12"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-6","mb-6"],[1,"space-y-4"],[1,"text-center","py-12"],["diameter","40"],[1,"flex","items-center"],[1,"text-red-600","mr-2"],[1,"text-red-800","font-medium"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","p-6","cursor-pointer","hover:shadow-md","transition-all","duration-200"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","p-6","cursor-pointer","hover:shadow-md","transition-all","duration-200",3,"click"],[1,"flex","items-start","space-x-4"],[1,"flex-shrink-0"],[1,"w-12","h-12","rounded-full","object-cover","border","border-gray-200",3,"src","alt"],[1,"w-12","h-12","rounded-full","bg-gradient-to-br","from-blue-400","to-blue-600","flex","items-center","justify-center"],[1,"flex-1","min-w-0"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"text-lg","font-semibold","text-gray-900","mb-1"],[1,"flex","items-center","space-x-2","mb-2"],[1,"text-sm","text-gray-600"],[1,"text-gray-400"],[1,"flex","items-center","space-x-3"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","border"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","space-x-2"],["mat-icon-button","",1,"text-gray-400","hover:text-gray-600",3,"click"],[1,"text-white"],[1,"mx-auto","w-24","h-24","bg-gray-100","rounded-full","flex","items-center","justify-center","mb-6"],[1,"text-gray-400","w-12","h-12"],[1,"text-xl","font-medium","text-gray-900","mb-2"],[1,"text-gray-500","mb-6"],["mat-raised-button","","color","primary",1,"px-6","py-3","text-base","font-semibold","rounded-lg",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),u("click",function(){return i.navigateBack()}),o(5,"mat-icon",5),l(6,"arrow_back"),a()(),o(7,"div")(8,"h1",6),l(9,"Messages"),a(),o(10,"p",7),l(11,"Communicate with your project partners"),a()()(),o(12,"button",8),u("click",function(){return i.refreshChats()}),o(13,"mat-icon",9),l(14,"refresh"),a(),l(15," Refresh "),a()(),p(16,je,2,0,"div",10)(17,Pe,6,1,"div",11)(18,Re,3,0,"div",12)(19,Ae,10,0,"div",13),a()()),e&2&&(s(12),k("disabled",i.loading()),s(4),m(i.loading()?16:-1),s(),m(i.error()&&!i.loading()?17:-1),s(),m(i.hasChats()&&!i.loading()?18:-1),s(),m(!i.hasChats()&&!i.loading()&&!i.error()?19:-1))},dependencies:[E,z,ae,H,F,xe,be,U,Ce,$,ye,Me],styles:[".chat-item[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.chat-item[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.unread-indicator[_ngcontent-%COMP%]{position:absolute;top:-2px;right:-2px;width:8px;height:8px;background-color:#ef4444;border-radius:50%;border:2px solid white}"]})};var ze=["messagesContainer"],Be=(n,t)=>t._id;function Ve(n,t){if(n&1&&g(0,"img",16),n&2){let e=d();k("src",e.project_id.business_id.logo_url,I)("alt",e.project_id.business_id.name)}}function Le(n,t){n&1&&(o(0,"div",17),M(),o(1,"svg",27),g(2,"path",28),a()())}function Fe(n,t){if(n&1&&(o(0,"div",4),p(1,Ve,1,2,"img",16)(2,Le,3,0,"div",17),o(3,"div",18)(4,"h1",19),l(5),a(),o(6,"div",20)(7,"span",21),l(8),a(),o(9,"span",22),l(10,"\u2022"),a(),o(11,"div",23),g(12,"div",24),o(13,"span",25),l(14),a()(),o(15,"span",22),l(16,"\u2022"),a(),o(17,"span",26),l(18),R(19,"titlecase"),a()()()()),n&2){let e,i=t,r=d();s(),m(i.project_id.business_id.logo_url?1:2),s(4),v(i.title),s(3),v(((e=r.otherParticipant())==null?null:e.last_name)||"Unknown User"),s(4),y(r.isConnected()?"bg-green-500":"bg-red-500"),s(2),v(r.isConnected()?"Connected":"Offline"),s(3),y(r.getProjectStatusColor(i.project_id.status)),s(),w(" ",A(19,9,i.project_id.status)," ")}}function Ne(n,t){if(n&1){let e=x();o(0,"button",38),u("click",function(){h(e);let r=d(2);return _(r.handleProjectAction("accept"))}),l(1," Accept "),a()}}function Ue(n,t){if(n&1){let e=x();o(0,"button",39),u("click",function(){h(e);let r=d(2);return _(r.handleProjectAction("start"))}),l(1," Start "),a()}}function $e(n,t){if(n&1){let e=x();o(0,"button",40),u("click",function(){h(e);let r=d(2);return _(r.handleProjectAction("complete"))}),l(1," Complete "),a()}}function He(n,t){if(n&1){let e=x();o(0,"button",41),u("click",function(){h(e);let r=d(2);return _(r.handleProjectAction("accept"))}),l(1," Accept Project "),a()}}function Ge(n,t){if(n&1){let e=x();o(0,"button",42),u("click",function(){h(e);let r=d(2);return _(r.handleProjectAction("reject"))}),l(1," Reject "),a()}}function Ke(n,t){if(n&1){let e=x();o(0,"button",43),u("click",function(){h(e);let r=d(2);return _(r.handleProjectAction("start"))}),l(1," Start Project "),a()}}function qe(n,t){if(n&1){let e=x();o(0,"button",44),u("click",function(){h(e);let r=d(2);return _(r.handleProjectAction("complete"))}),l(1," Mark Complete "),a()}}function Ye(n,t){if(n&1&&(o(0,"div",29),p(1,Ne,2,0,"button",30)(2,Ue,2,0,"button",31)(3,$e,2,0,"button",32),a(),o(4,"div",33),p(5,He,2,0,"button",34)(6,Ge,2,0,"button",35)(7,Ke,2,0,"button",36)(8,qe,2,0,"button",37),a()),n&2){let e=d();s(),m(e.canPerformAction("accept")?1:e.canPerformAction("start")?2:e.canPerformAction("complete")?3:-1),s(4),m(e.canPerformAction("accept")?5:-1),s(),m(e.canPerformAction("reject")?6:-1),s(),m(e.canPerformAction("start")?7:-1),s(),m(e.canPerformAction("complete")?8:-1)}}function Qe(n,t){n&1&&(o(0,"div",12)(1,"div",45),g(2,"div",46),o(3,"p",47),l(4,"Loading conversation..."),a()()())}function Ze(n,t){if(n&1&&(o(0,"div",13)(1,"div",48)(2,"div",49),M(),o(3,"svg",50),g(4,"path",51),a(),j(),o(5,"span",52),l(6),a()()()()),n&2){let e=d();s(6),v(e.error())}}function Je(n,t){if(n&1&&(o(0,"div",56)(1,"span",63),l(2),a()()),n&2){let e=d().$implicit,i=d(3);s(2),w(" ",i.formatMessageDate(e.createdAt)," ")}}function We(n,t){if(n&1&&(o(0,"div",59)(1,"span",64),l(2),a()()),n&2){let e=d().$implicit;s(2),ie(" ",e.sender_id.email.charAt(0).toUpperCase(),"",e.sender_id.last_name.charAt(0).toUpperCase()," ")}}function Xe(n,t){if(n&1&&(o(0,"div",61),M(),o(1,"svg",65),g(2,"path",66),a(),l(3),a()),n&2){let e=d().$implicit;s(3),w(" ",e.content," ")}}function et(n,t){n&1&&(o(0,"span",69),l(1,"(edited)"),a())}function tt(n,t){if(n&1&&(o(0,"div",67)(1,"p",68),l(2),a(),p(3,et,2,0,"span",69),o(4,"div",70),l(5),a()()),n&2){let e=d().$implicit,i=d(3);y(i.isMyMessage(e)?"bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-br-md":"bg-white border border-gray-200 text-gray-900 rounded-bl-md"),s(2),v(e.content),s(),m(e.is_edited?3:-1),s(),y(i.isMyMessage(e)?"text-blue-100 text-right":"text-gray-500 text-right"),s(),w(" ",i.formatMessageTime(e.createdAt)," ")}}function nt(n,t){if(n&1&&(p(0,Je,3,1,"div",56),o(1,"div",57)(2,"div",58),p(3,We,3,2,"div",59),o(4,"div",60),p(5,Xe,4,1,"div",61)(6,tt,6,7,"div",62),a()()()),n&2){let e=t.$implicit,i=t.$index,r=d(3);m(r.shouldShowDateDivider(i)?0:-1),s(),y(r.isMyMessage(e)?"justify-end":"justify-start"),s(),y(r.isMyMessage(e)?"flex-row-reverse space-x-reverse":""),s(),m(r.isMyMessage(e)?-1:3),s(2),m(e.message_type==="project_update"?5:6)}}function it(n,t){if(n&1&&(o(0,"div",54),D(1,nt,7,7,null,null,Be),a()),n&2){let e=d(2);s(),O(e.messages())}}function ot(n,t){if(n&1&&(o(0,"div",55)(1,"div",71),M(),o(2,"svg",72),g(3,"path",73),a()(),j(),o(4,"h3",74),l(5,"Start the conversation"),a(),o(6,"p",75),l(7," No messages yet. Send the first message to start discussing your project "),o(8,"span",76),l(9),a()()()),n&2){let e,i=d(2);s(9),w('"',(e=i.chat())==null?null:e.title,'"')}}function at(n,t){if(n&1&&(o(0,"div",14,0)(2,"div",53),p(3,it,3,0,"div",54)(4,ot,10,1,"div",55),a()()),n&2){let e=d();s(3),m(e.hasMessages()?3:4)}}function rt(n,t){if(n&1&&(o(0,"div",77)(1,"div",86)(2,"div",87),g(3,"div",88)(4,"div",89)(5,"div",90),a(),o(6,"span"),l(7),a()()()),n&2){let e=d(2);s(7),v(e.getTypingText())}}function st(n,t){n&1&&g(0,"div",84)}function lt(n,t){n&1&&(M(),o(0,"svg",85),g(1,"path",91),a())}function dt(n,t){if(n&1){let e=x();o(0,"div",15),p(1,rt,8,1,"div",77),o(2,"div",78)(3,"form",79),u("ngSubmit",function(){h(e);let r=d();return _(r.sendMessage())}),o(4,"div",80)(5,"div",81)(6,"textarea",82),u("input",function(){h(e);let r=d();return _(r.onTextareaInput())})("keydown",function(r){h(e);let c=d();return _(c.onTextareaKeydown(r))}),a()()(),o(7,"button",83),p(8,st,1,0,"div",84)(9,lt,2,0,":svg:svg",85),a()()()()}if(n&2){let e=d();s(),m(e.typingUsers().length>0?1:-1),s(2),k("formGroup",e.messageForm),s(4),k("disabled",!e.messageForm.valid||e.sendingMessage()),s(),m(e.sendingMessage()?8:9)}}var Y=class n{messagesContainer;chatService=f(G);authService=f(L);projectService=f(N);socketService=f(re);router=f(V);route=f(B);formBuilder=f(ge);loading=b(!1);messagesLoading=b(!1);sendingMessage=b(!1);error=b(null);chat=b(null);messages=b([]);typingUsers=b([]);isConnected=b(!1);messageForm;user=this.authService.user;hasMessages=P(()=>this.messages().length>0);otherParticipant=P(()=>{let t=this.chat(),e=this.user()?._id;return!t||!e?null:t.project_id.client_id._id===e?t.project_id.business_owner_id:t.project_id.client_id});chatId=null;shouldScrollToBottom=!1;refreshInterval;subscriptions=[];typingTimeout;constructor(){this.messageForm=this.formBuilder.group({content:["",[Q.required,Q.maxLength(1e3)]]})}ngOnInit(){if(!this.user()){this.router.navigate(["/auth"]);return}this.setupSocketSubscriptions(),this.route.params.subscribe(t=>{this.chatId=t.chatId,this.chatId&&(this.loadChat(),this.loadMessages(),this.markMessagesAsRead(),this.joinSocketRoom())})}ngOnDestroy(){this.refreshInterval&&clearInterval(this.refreshInterval),this.typingTimeout&&clearTimeout(this.typingTimeout),this.chatId&&this.socketService.leaveChat(this.chatId),this.subscriptions.forEach(t=>t.unsubscribe())}ngAfterViewChecked(){this.shouldScrollToBottom&&(this.scrollToBottom(),this.shouldScrollToBottom=!1)}setupSocketSubscriptions(){let t=this.socketService.isConnected$.subscribe(c=>{this.isConnected.set(c)}),e=this.socketService.onNewMessage().subscribe(c=>{if(c.success&&c.data){let T=this.messages();this.messages.set([...T,c.data]),this.shouldScrollToBottom=!0}}),i=this.socketService.onMessageError().subscribe(c=>{console.error("Socket message error:",c),this.error.set(c.error||"Message failed to send")}),r=this.socketService.getTypingUsersForChat().subscribe(c=>{let T=this.user()?._id,Se=c.filter(ke=>ke.userId!==T);this.typingUsers.set(Se)});this.subscriptions.push(t,e,i,r)}joinSocketRoom(){return C(this,null,function*(){if(this.chatId)try{yield this.socketService.joinChat(this.chatId),console.log("Joined socket room for chat:",this.chatId)}catch(t){console.error("Failed to join socket room:",t)}})}loadChat(){return C(this,null,function*(){if(this.chatId){this.loading.set(!0),this.error.set(null);try{let t=yield this.chatService.getChatByIdAsync(this.chatId);this.chat.set(t)}catch(t){console.error("Error loading chat:",t),this.error.set("Failed to load chat")}finally{this.loading.set(!1)}}})}loadMessages(t=!0){return C(this,null,function*(){if(this.chatId){t&&this.messagesLoading.set(!0);try{let e=yield this.chatService.getChatMessagesAsync(this.chatId);this.messages.set(e.reverse()),this.shouldScrollToBottom=!0}catch(e){console.error("Error loading messages:",e),t&&this.error.set("Failed to load messages")}finally{t&&this.messagesLoading.set(!1)}}})}sendMessage(){return C(this,null,function*(){let t=this.messageForm.get("content")?.value?.trim();if(!t||!this.chatId||this.sendingMessage()){console.log("Cannot send message:",{content:t,chatId:this.chatId,sending:this.sendingMessage()});return}this.sendingMessage.set(!0),this.error.set(null);try{console.log("Sending message via socket:",{chatId:this.chatId,content:t}),this.socketService.stopTyping(this.chatId);let e=yield this.socketService.sendMessage(this.chatId,t);if(e.success)this.messageForm.reset(),console.log("Message sent successfully via socket");else throw new Error(e.error||"Failed to send message")}catch(e){console.error("Error sending message via socket:",e);try{console.log("Falling back to HTTP message sending"),yield this.chatService.sendMessageAsync(this.chatId,{content:t,message_type:"text"}),this.messageForm.reset(),yield this.loadMessages(!1),this.shouldScrollToBottom=!0,console.log("Message sent successfully via HTTP fallback")}catch(i){console.error("HTTP fallback also failed:",i),this.error.set("Failed to send message. Please try again.")}}finally{this.sendingMessage.set(!1)}})}markMessagesAsRead(){return C(this,null,function*(){if(this.chatId)try{yield this.chatService.markMessagesAsReadAsync(this.chatId)}catch(t){console.error("Error marking messages as read:",t)}})}isMyMessage(t){return t.sender_id._id===this.user()?._id}formatMessageTime(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}formatMessageDate(t){let e=new Date(t),i=new Date,r=new Date(i);return r.setDate(r.getDate()-1),e.toDateString()===i.toDateString()?"Today":e.toDateString()===r.toDateString()?"Yesterday":e.toLocaleDateString()}shouldShowDateDivider(t){if(t===0)return!0;let e=this.messages()[t],i=this.messages()[t-1],r=new Date(e.createdAt).toDateString(),c=new Date(i.createdAt).toDateString();return r!==c}onTextareaInput(){this.chatId&&(this.socketService.startTyping(this.chatId),this.typingTimeout&&clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(()=>{this.socketService.stopTyping(this.chatId)},3e3))}onTextareaKeydown(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}getTypingText(){let t=this.typingUsers();return t.length===0?"":t.length===1?`${t[0].userName||"Someone"} is typing...`:t.length===2?`${t[0].userName||"Someone"} and ${t[1].userName||"someone else"} are typing...`:"Several people are typing..."}getProjectStatusColor(t){let e={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",accepted:"bg-blue-100 text-blue-800 border-blue-200",in_progress:"bg-purple-100 text-purple-800 border-purple-200",completed:"bg-green-100 text-green-800 border-green-200",rejected:"bg-red-100 text-red-800 border-red-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200"};return e[t]||e.pending}goToProjectDetails(){let t=this.chat();t&&this.router.navigate(["/dashboard/projects",t.project_id._id])}handleProjectAction(t){return C(this,null,function*(){let e=this.chat();if(e)try{let i=e.project_id._id;switch(t){case"accept":yield this.projectService.updateProjectAsync(i,{status:"accepted"});break;case"reject":let r=prompt("Please provide a reason for rejection:");if(!r)return;yield this.projectService.updateProjectAsync(i,{status:"rejected",rejection_reason:r});break;case"start":yield this.projectService.updateProjectAsync(i,{status:"in_progress"});break;case"complete":yield this.projectService.updateProjectAsync(i,{status:"completed"});break}yield this.loadChat(),yield this.chatService.sendMessageAsync(this.chatId,{content:`Project status updated to: ${t==="start"?"in progress":t}d`,message_type:"project_update"}),yield this.loadMessages(!1)}catch(i){console.error(`Error ${t}ing project:`,i),this.error.set(`Failed to ${t} project`)}})}canPerformAction(t){let e=this.chat(),i=this.user();if(!e||!i)return!1;let r=e.project_id.business_owner_id._id===i._id,c=e.project_id.status;switch(t){case"accept":case"reject":return r&&c==="pending";case"start":return r&&c==="accepted";case"complete":return r&&c==="in_progress";default:return!1}}scrollToBottom(){try{let t=this.messagesContainer?.nativeElement;t&&(t.scrollTop=t.scrollHeight)}catch(t){console.error("Error scrolling to bottom:",t)}}onKeyPress(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}navigateBack(){this.router.navigate(["dashboard","messages","chats"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-chat-room"]],viewQuery:function(e,i){if(e&1&&ee(ze,5),e&2){let r;te(r=ne())&&(i.messagesContainer=r.first)}},decls:18,vars:6,consts:[["messagesContainer",""],[1,"flex","flex-col","h-screen","bg-gray-50"],[1,"bg-white","border-b","border-gray-200","px-4","py-3","shadow-sm","sticky","top-0","z-10"],[1,"flex","items-center","justify-between","w-full","max-w-4xl","mx-auto"],[1,"flex","items-center","space-x-3","min-w-0","flex-1"],[1,"p-2","hover:bg-gray-100","rounded-full","transition-colors","duration-200","flex-shrink-0",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"flex","items-center","space-x-2","flex-shrink-0"],[1,"p-2","hover:bg-gray-100","rounded-full","transition-colors","duration-200",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"],[1,"flex-1","overflow-hidden","bg-gray-50"],[1,"flex","items-center","justify-center","h-full"],[1,"flex","items-center","justify-center","h-full","p-6"],[1,"h-full","overflow-y-auto","scrollbar-thin","scrollbar-thumb-gray-300","scrollbar-track-transparent","hover:scrollbar-thumb-gray-400"],[1,"bg-white","border-t","border-gray-200","px-4","py-4","sticky","bottom-0"],[1,"w-10","h-10","rounded-full","object-cover","border-2","border-gray-200","flex-shrink-0",3,"src","alt"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-blue-500","to-purple-600","flex","items-center","justify-center","flex-shrink-0"],[1,"min-w-0","flex-1"],[1,"text-lg","font-semibold","text-gray-900","truncate"],[1,"flex","items-center","space-x-2","text-sm","text-gray-600"],[1,"truncate"],[1,"text-gray-400","hidden","sm:inline"],[1,"flex","items-center","space-x-1"],[1,"w-2","h-2","rounded-full"],[1,"text-xs"],[1,"inline-flex","items-center","px-2","py-0.5","rounded-full","text-xs","font-medium","whitespace-nowrap"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"md:hidden"],[1,"bg-green-600","hover:bg-green-700","text-white","px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-colors","duration-200"],[1,"bg-blue-600","hover:bg-blue-700","text-white","px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-colors","duration-200"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-colors","duration-200"],[1,"hidden","md:flex","items-center","space-x-2"],[1,"bg-green-600","hover:bg-green-700","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors","duration-200"],[1,"bg-red-600","hover:bg-red-700","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors","duration-200"],[1,"bg-blue-600","hover:bg-blue-700","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors","duration-200"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors","duration-200"],[1,"bg-green-600","hover:bg-green-700","text-white","px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-colors","duration-200",3,"click"],[1,"bg-blue-600","hover:bg-blue-700","text-white","px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-colors","duration-200",3,"click"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-3","py-1.5","rounded-lg","text-xs","font-medium","transition-colors","duration-200",3,"click"],[1,"bg-green-600","hover:bg-green-700","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors","duration-200",3,"click"],[1,"bg-red-600","hover:bg-red-700","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors","duration-200",3,"click"],[1,"bg-blue-600","hover:bg-blue-700","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors","duration-200",3,"click"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors","duration-200",3,"click"],[1,"flex","flex-col","items-center","space-y-4"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-600"],[1,"text-gray-500"],[1,"bg-red-50","border","border-red-200","rounded-xl","p-6","max-w-md","mx-auto"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-red-600","mr-3","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-red-800","font-medium"],[1,"w-full","max-w-4xl","mx-auto","px-4","py-6"],[1,"space-y-4"],[1,"flex","flex-col","items-center","justify-center","h-full","text-center","py-12","min-h-96"],[1,"flex","justify-center","my-8"],[1,"flex"],[1,"flex","items-end","space-x-2","max-w-xs","sm:max-w-sm","lg:max-w-md"],[1,"w-8","h-8","rounded-full","bg-gradient-to-br","from-gray-400","to-gray-600","flex","items-center","justify-center","flex-shrink-0","shadow-sm"],[1,"relative","group"],[1,"bg-gradient-to-r","from-yellow-50","to-amber-50","border","border-yellow-200","text-yellow-800","px-4","py-3","rounded-xl","text-sm","text-center","shadow-sm","max-w-xs"],[1,"px-4","py-3","rounded-2xl","text-sm","break-words","shadow-sm","relative",3,"class"],[1,"bg-white","text-gray-500","text-sm","px-4","py-2","rounded-full","shadow-sm","border","border-gray-200"],[1,"text-white","text-xs","font-medium"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-yellow-600","mr-2","inline"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"px-4","py-3","rounded-2xl","text-sm","break-words","shadow-sm","relative"],[1,"leading-relaxed"],[1,"text-xs","opacity-75","ml-2","italic"],[1,"text-xs","mt-1","opacity-70"],[1,"w-20","h-20","bg-gradient-to-br","from-blue-100","to-purple-100","rounded-full","flex","items-center","justify-center","mb-6"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-10","h-10","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],[1,"text-xl","font-semibold","text-gray-900","mb-2"],[1,"text-gray-500","mb-6","max-w-md","px-4"],[1,"font-medium"],[1,"w-full","max-w-4xl","mx-auto","mb-3"],[1,"w-full","max-w-4xl","mx-auto"],[1,"flex","items-end","space-x-3",3,"ngSubmit","formGroup"],[1,"flex-1"],[1,"relative"],["formControlName","content","placeholder","Type your message...","rows","1",1,"w-full","resize-none","rounded-2xl","border","border-gray-300","px-4","py-3","text-sm","focus:border-blue-500","focus:ring-2","focus:ring-blue-200","focus:outline-none","transition-all","duration-200","max-h-32","bg-gray-50","focus:bg-white",2,"min-height","44px",3,"input","keydown"],["type","submit",1,"flex-shrink-0","w-12","h-12","bg-gradient-to-r","from-blue-600","to-blue-700","hover:from-blue-700","hover:to-blue-800","disabled:from-gray-400","disabled:to-gray-500","text-white","rounded-full","flex","items-center","justify-center","transition-all","duration-200","shadow-lg","hover:shadow-xl","disabled:shadow-sm","transform","hover:scale-105","disabled:scale-100",3,"disabled"],[1,"animate-spin","rounded-full","h-5","w-5","border-b-2","border-white"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],[1,"flex","items-center","space-x-2","text-sm","text-gray-500","px-4"],[1,"flex","space-x-1"],[1,"w-2","h-2","bg-gray-400","rounded-full","animate-pulse"],[1,"w-2","h-2","bg-gray-400","rounded-full","animate-pulse",2,"animation-delay","0.2s"],[1,"w-2","h-2","bg-gray-400","rounded-full","animate-pulse",2,"animation-delay","0.4s"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 19l9 2-9-18-9 18 9-2zm0 0v-8"]],template:function(e,i){if(e&1&&(o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"button",5),u("click",function(){return i.navigateBack()}),M(),o(5,"svg",6),g(6,"path",7),a()(),p(7,Fe,20,11,"div",4),a(),j(),o(8,"div",8),p(9,Ye,9,5),o(10,"button",9),u("click",function(){return i.goToProjectDetails()}),M(),o(11,"svg",6),g(12,"path",10),a()()()()(),j(),o(13,"div",11),p(14,Qe,5,0,"div",12)(15,Ze,7,1,"div",13)(16,at,5,1,"div",14),a(),p(17,dt,10,4,"div",15),a()),e&2){let r,c;s(7),m((r=i.chat())?7:-1,r),s(2),m((c=i.chat())?9:-1,c),s(5),m(i.loading()||i.messagesLoading()?14:-1),s(),m(i.error()&&!i.loading()?15:-1),s(),m(!i.loading()&&!i.messagesLoading()&&!i.error()?16:-1),s(),m(!i.loading()&&!i.error()?17:-1)}},dependencies:[E,z,ue,ce,se,le,de,me,pe,H,F,U,$,_e,fe,ve],styles:["[_nghost-%COMP%]{display:block;height:100vh;overflow:hidden}.scrollbar-thin[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.scrollbar-track-transparent[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.scrollbar-thumb-gray-300[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#d1d5db99;border-radius:3px}.scrollbar-thumb-gray-300[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb, .hover\\:scrollbar-thumb-gray-400[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:#9ca3afcc}.overflow-y-auto[_ngcontent-%COMP%]{scrollbar-width:thin;scrollbar-color:rgba(209,213,219,.6) transparent}.message-container[_ngcontent-%COMP%]{padding:.5rem 0}.message-bubble[_ngcontent-%COMP%]{max-width:75%;word-wrap:break-word;position:relative}.messages-background[_ngcontent-%COMP%]{background-color:#f0f2f5;background-image:radial-gradient(circle at 1px 1px,rgba(255,255,255,.3) 1px,transparent 0);background-size:20px 20px}textarea[_ngcontent-%COMP%]{field-sizing:content;min-height:44px;max-height:120px;line-height:1.4}.overflow-y-auto[_ngcontent-%COMP%]{scroll-behavior:smooth}@keyframes _ngcontent-%COMP%_slideInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.message-enter[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInUp .3s ease-out}textarea[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #3b82f61a;border-color:#3b82f6}.message-status[_ngcontent-%COMP%]{display:inline-flex;align-items:center;margin-left:4px;opacity:.7}@media (max-width: 768px){.max-w-xs[_ngcontent-%COMP%]{max-width:75%}.sm\\:max-w-sm[_ngcontent-%COMP%]{max-width:80%}.lg\\:max-w-md[_ngcontent-%COMP%]{max-width:85%}.sticky.top-0[_ngcontent-%COMP%]{padding:.75rem 1rem}.message-bubble[_ngcontent-%COMP%]{max-width:85%}}@media (max-width: 640px){.space-x-3[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not([hidden]) ~ [_ngcontent-%COMP%]:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.5rem * var(--tw-space-x-reverse));margin-left:calc(.5rem * (1 - var(--tw-space-x-reverse)))}.message-bubble[_ngcontent-%COMP%]{max-width:90%}.w-8.h-8[_ngcontent-%COMP%]{width:1.75rem;height:1.75rem}.sticky.bottom-0[_ngcontent-%COMP%]{padding:.75rem}}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.transform.hover\\:scale-105[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.sticky[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky}.z-10[_ngcontent-%COMP%]{z-index:10}.message-time[_ngcontent-%COMP%]{font-size:.75rem;opacity:.7;margin-top:.25rem}.system-message[_ngcontent-%COMP%]{margin:1rem auto;text-align:center;max-width:80%}.date-divider[_ngcontent-%COMP%]{position:sticky;top:4rem;z-index:5;background:#ffffffe6;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);margin:1rem 0}.error-state[_ngcontent-%COMP%]{padding:2rem;text-align:center}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:1rem}.focus\\:ring-2[_ngcontent-%COMP%]:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 rgba(0, 0, 0, 0))}.typing-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.5rem 1rem;background-color:#0000000d;border-radius:1rem}.typing-dots[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.typing-dot[_ngcontent-%COMP%]{width:.5rem;height:.5rem;background-color:#0006;border-radius:50%;animation:_ngcontent-%COMP%_typingPulse 1.4s infinite ease-in-out}.typing-dot[_ngcontent-%COMP%]:nth-child(1){animation-delay:0s}.typing-dot[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.typing-dot[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}@keyframes _ngcontent-%COMP%_typingPulse{0%,60%,to{transform:scale(1);opacity:.4}30%{transform:scale(1.2);opacity:1}}.connection-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem;font-size:.75rem}.status-dot[_ngcontent-%COMP%]{width:.5rem;height:.5rem;border-radius:50%;transition:background-color .3s ease}.status-connected[_ngcontent-%COMP%]{background-color:#10b981}.status-disconnected[_ngcontent-%COMP%]{background-color:#ef4444}"]})};var xn=[{path:"",component:K,children:[{path:"chats",component:q},{path:"chat/:chatId",component:Y},{path:"",redirectTo:"chats",pathMatch:"full"}]}];export{xn as MESSAGES_ROUTES};
