import{a as d}from"./chunk-IZ7UM5CL.js";import{B as p}from"./chunk-REOVWAHI.js";import{$ as l,fa as i,o as n}from"./chunk-BEPULU6C.js";import{a as c,b as g,e as r}from"./chunk-JKOY2XUY.js";var m=class a{http=i(p);configService=i(d);get apiUrl(){return this.configService.getApiUrl("/projects")}createProject(e){return this.http.post(this.apiUrl,e)}createProjectAsync(e){return r(this,null,function*(){return(yield n(this.createProject(e))).data})}getMyProjects(e="client"){return this.http.get(`${this.apiUrl}?role=${e}`)}getMyProjectsAsync(e="client"){return r(this,null,function*(){return(yield n(this.getMyProjects(e))).data})}getAllMyProjectsAsync(){return r(this,null,function*(){try{let[e,t]=yield Promise.all([this.getMyProjectsAsync("client"),this.getMyProjectsAsync("business_owner")]);return[...e,...t].filter((u,P,j)=>P===j.findIndex(y=>y._id===u._id))}catch(e){return console.error("Error loading all projects:",e),[]}})}getBusinessProjects(e){return this.http.get(`${this.apiUrl}/business/${e}`)}getBusinessProjectsAsync(e){return r(this,null,function*(){return(yield n(this.getBusinessProjects(e))).data})}getBusinessPortfolio(e){return this.http.get(`${this.apiUrl}/business/${e}/portfolio`)}getBusinessPortfolioAsync(e){return r(this,null,function*(){return(yield n(this.getBusinessPortfolio(e))).data})}getProjectsByStatus(e,t="client"){return this.http.get(`${this.apiUrl}/status/${e}?role=${t}`)}getProjectsByStatusAsync(e,t="client"){return r(this,null,function*(){return(yield n(this.getProjectsByStatus(e,t))).data})}getProject(e){return this.http.get(`${this.apiUrl}/${e}?populate=selected_services,business_id,client_id,business_owner_id`)}getProjectAsync(e){return r(this,null,function*(){return(yield n(this.getProject(e))).data})}updateProject(e,t){return this.http.patch(`${this.apiUrl}/${e}`,t)}updateProjectAsync(e,t){return r(this,null,function*(){return(yield n(this.updateProject(e,t))).data})}deleteProject(e){return this.http.delete(`${this.apiUrl}/${e}`)}deleteProjectAsync(e){return r(this,null,function*(){yield n(this.deleteProject(e))})}calculatePaymentIntent(e){return this.http.post(`${this.apiUrl}/calculate-payment-intent`,{serviceIds:e})}calculatePaymentIntentAsync(e){return r(this,null,function*(){return(yield n(this.calculatePaymentIntent(e))).data})}createProjectAfterPayment(e,t){return this.http.post(`${this.apiUrl}/create-after-payment`,g(c({},e),{paymentIntentId:t}))}createProjectAfterPaymentAsync(e,t){return r(this,null,function*(){try{console.log("ProjectService: Creating project after payment"),console.log("Project Data:",e),console.log("Payment Intent ID:",t);let s=yield n(this.createProjectAfterPayment(e,t));if(console.log("ProjectService: Project creation response:",s),!s.success)throw new Error(s.message||"Failed to create project");return s.data}catch(s){throw console.error("ProjectService: Error creating project after payment:",s),s.error&&console.error("ProjectService: Server error details:",s.error),s}})}uploadProjectImage(e,t){let s=new FormData;return s.append("image",t),this.http.post(`${this.apiUrl}/${e}/upload-image`,s)}uploadProjectImageAsync(e,t){return r(this,null,function*(){let s=yield n(this.uploadProjectImage(e,t));if(!s.success)throw new Error(s.message||"Failed to upload project image");return s.data})}uploadProjectAttachments(e,t){let s=new FormData;return t.forEach(o=>{s.append("attachments",o)}),this.http.post(`${this.apiUrl}/${e}/upload-attachments`,s)}uploadProjectAttachmentsAsync(e,t){return r(this,null,function*(){let s=yield n(this.uploadProjectAttachments(e,t));if(!s.success)throw new Error(s.message||"Failed to upload project attachments");return s.data})}acceptProject(e){return this.http.post(`${this.apiUrl}/${e}/accept`,{})}acceptProjectAsync(e){return r(this,null,function*(){let t=yield n(this.acceptProject(e));if(!t.success)throw new Error(t.message||"Failed to accept project");return t.data})}startProject(e){return this.http.post(`${this.apiUrl}/${e}/start`,{})}startProjectAsync(e){return r(this,null,function*(){let t=yield n(this.startProject(e));if(!t.success)throw new Error(t.message||"Failed to start project");return t.data})}rejectProject(e,t){return this.http.post(`${this.apiUrl}/${e}/reject`,{reason:t})}rejectProjectAsync(e,t){return r(this,null,function*(){let s=yield n(this.rejectProject(e,t));if(!s.success)throw new Error(s.message||"Failed to reject project");return s.data})}createProjectPaymentIntent(e){return this.http.post(`${this.apiUrl}/${e}/payment-intent`,{})}createProjectPaymentIntentAsync(e){return r(this,null,function*(){return(yield n(this.createProjectPaymentIntent(e))).data})}confirmProjectPayment(e,t){return this.http.post(`${this.apiUrl}/${e}/confirm-payment`,{paymentIntentId:t})}confirmProjectPaymentAsync(e,t){return r(this,null,function*(){console.log("\u{1F525} FRONTEND SERVICE: confirmProjectPaymentAsync called"),console.log("\u{1F525} Project ID:",e),console.log("\u{1F525} Payment Intent ID:",t),console.log("\u{1F525} API URL:",`${this.apiUrl}/${e}/confirm-payment`);let s=yield n(this.confirmProjectPayment(e,t));return console.log("\u{1F525} FRONTEND SERVICE: Response received:",s),console.log("\u{1F525} Project status in response:",s.data?.status),s.data})}declineProjectPayment(e,t){return this.http.post(`${this.apiUrl}/${e}/decline-payment`,{reason:t})}declineProjectPaymentAsync(e,t){return r(this,null,function*(){return(yield n(this.declineProjectPayment(e,t))).data})}static \u0275fac=function(t){return new(t||a)};static \u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})};export{m as a};
