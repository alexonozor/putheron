import{b as L,c as B,e as m,h as j,i as G,l as q,m as z,n as H,o as W,p as J,q as K,r as Q,s as X,v as Y,x as Z}from"./chunk-Z3TDL5JS.js";import{a as V}from"./chunk-7XH4VAXZ.js";import{Ba as O,Ga as p,Ka as v,Ma as _,O as D,Pa as y,S as f,Sa as I,Ta as T,Ua as n,Va as i,W as k,Wa as u,X as h,Y as x,Z as F,_ as $,_a as N,ab as C,bb as c,ca as E,gc as R,ha as A,kc as P,l as d,nb as l,ob as b,pb as S,sa as s}from"./chunk-YOTEMOQK.js";import{a as M,b as U,d as g}from"./chunk-QEZ3K4DX.js";var w=class r{http=f(P);config=f(V);categoriesUrl=`${this.config.apiBaseUrl}/categories`;subcategoriesUrl=`${this.config.apiBaseUrl}/subcategories`;getCategories(t){let e=t!==void 0?`${this.categoriesUrl}?active=${t}`:this.categoriesUrl;return this.http.get(e)}getCategoriesAsync(t){return g(this,null,function*(){try{return(yield d(this.getCategories(t))).data||[]}catch(e){throw console.error("Error fetching categories:",e),e}})}getCategory(t){return this.http.get(`${this.categoriesUrl}/${t}`)}getCategoryAsync(t){return g(this,null,function*(){try{return(yield d(this.getCategory(t))).data}catch(e){throw console.error("Error fetching category:",e),e}})}createCategory(t){return this.http.post(this.categoriesUrl,t)}createCategoryAsync(t){return g(this,null,function*(){try{return(yield d(this.createCategory(t))).data}catch(e){throw console.error("Error creating category:",e),e}})}updateCategory(t,e){return this.http.patch(`${this.categoriesUrl}/${t}`,e)}updateCategoryAsync(t,e){return g(this,null,function*(){try{return(yield d(this.updateCategory(t,e))).data}catch(a){throw console.error("Error updating category:",a),a}})}deleteCategory(t){return this.http.delete(`${this.categoriesUrl}/${t}`)}deleteCategoryAsync(t){return g(this,null,function*(){try{yield d(this.deleteCategory(t))}catch(e){throw console.error("Error deleting category:",e),e}})}getSubcategories(t,e){let a=this.subcategoriesUrl,o=new URLSearchParams;return t!==void 0&&o.append("active",t.toString()),e&&o.append("category",e),o.toString()&&(a+=`?${o.toString()}`),this.http.get(a)}getSubcategoriesAsync(t,e){return g(this,null,function*(){try{return(yield d(this.getSubcategories(t,e))).data||[]}catch(a){throw console.error("Error fetching subcategories:",a),a}})}getSubcategoriesByCategory(t,e){let a=e!==void 0?`${this.subcategoriesUrl}/category/${t}?active=${e}`:`${this.subcategoriesUrl}/category/${t}`;return this.http.get(a)}getSubcategoriesByCategoryAsync(t,e){return g(this,null,function*(){try{return(yield d(this.getSubcategoriesByCategory(t,e))).data||[]}catch(a){throw console.error("Error fetching subcategories by category:",a),a}})}getSubcategory(t){return this.http.get(`${this.subcategoriesUrl}/${t}`)}getSubcategoryAsync(t){return g(this,null,function*(){try{return(yield d(this.getSubcategory(t))).data}catch(e){throw console.error("Error fetching subcategory:",e),e}})}createSubcategory(t){return this.http.post(this.subcategoriesUrl,t)}createSubcategoryAsync(t){return g(this,null,function*(){try{return(yield d(this.createSubcategory(t))).data}catch(e){throw console.error("Error creating subcategory:",e),e}})}updateSubcategory(t,e){return this.http.patch(`${this.subcategoriesUrl}/${t}`,e)}updateSubcategoryAsync(t,e){return g(this,null,function*(){try{return(yield d(this.updateSubcategory(t,e))).data}catch(a){throw console.error("Error updating subcategory:",a),a}})}deleteSubcategory(t){return this.http.delete(`${this.subcategoriesUrl}/${t}`)}deleteSubcategoryAsync(t){return g(this,null,function*(){try{yield d(this.deleteSubcategory(t))}catch(e){throw console.error("Error deleting subcategory:",e),e}})}getCategoriesWithSubcategories(){return g(this,null,function*(){try{let[t,e]=yield Promise.all([this.getCategoriesAsync(),this.getSubcategoriesAsync()]);return t.map(a=>U(M({},a),{subcategories:e.filter(o=>typeof o.category_id=="string"?o.category_id===a._id:o.category_id._id===a._id)}))}catch(t){throw console.error("Error fetching categories with subcategories:",t),t}})}generateSlug(t){return t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}static \u0275fac=function(e){return new(e||r)};static \u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"})};var re=(r,t)=>t._id;function oe(r,t){if(r&1&&(n(0,"div",11)(1,"div",47),F(),n(2,"svg",48),u(3,"path",49),i(),l(4),i()()),r&2){let e=c(2);s(4),S(" ",e.error()," ")}}function ie(r,t){if(r&1&&(n(0,"p",16),l(1),i()),r&2){let e=c(2);s(),b(e.getFieldError("name"))}}function ne(r,t){if(r&1&&(n(0,"p",16),l(1),i()),r&2){let e=c(2);s(),b(e.getFieldError("slug"))}}function ae(r,t){if(r&1&&(n(0,"option",23),l(1),i()),r&2){let e=t.$implicit;v("value",e._id),s(),b(e.name)}}function se(r,t){if(r&1&&(n(0,"p",16),l(1),i()),r&2){let e=c(2);s(),b(e.getFieldError("category_id"))}}function le(r,t){if(r&1&&(n(0,"p",16),l(1),i()),r&2){let e=c(2);s(),b(e.getFieldError("description"))}}function ce(r,t){if(r&1&&(n(0,"p",16),l(1),i()),r&2){let e=c(2);s(),b(e.getFieldError("sort_order"))}}function ge(r,t){if(r&1&&(n(0,"p",16),l(1),i()),r&2){let e=c(2);s(),b(e.getFieldError("meta_title"))}}function de(r,t){if(r&1&&(n(0,"p",16),l(1),i()),r&2){let e=c(2);s(),b(e.getFieldError("meta_description"))}}function ue(r,t){if(r&1&&(n(0,"div",46),u(1,"div",50),l(2),i()),r&2){let e=c(2);s(2),S(" ",e.submitButtonText," ")}}function me(r,t){if(r&1&&l(0),r&2){let e=c(2);S(" ",e.submitButtonText," ")}}function pe(r,t){if(r&1){let e=N();n(0,"div",0)(1,"div",1),C("click",function(){h(e);let o=c();return x(o.closeModal())}),i(),n(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h3",6),l(7),i(),n(8,"button",7),C("click",function(){h(e);let o=c();return x(o.closeModal())}),F(),n(9,"svg",8),u(10,"path",9),i()()()(),$(),n(11,"form",10),C("ngSubmit",function(){h(e);let o=c();return x(o.onSubmit())}),p(12,oe,5,1,"div",11),n(13,"div",12)(14,"div",13)(15,"div")(16,"label",14),l(17," Subcategory Name * "),i(),n(18,"input",15),C("input",function(){h(e);let o=c();return x(o.onNameChange())}),i(),p(19,ie,2,1,"p",16),i(),n(20,"div")(21,"label",17),l(22," Slug * "),i(),u(23,"input",18),p(24,ne,2,1,"p",16),n(25,"p",19),l(26,"URL-friendly version of the subcategory name"),i()()(),n(27,"div")(28,"label",20),l(29," Parent Category * "),i(),n(30,"select",21)(31,"option",22),l(32,"Select a category"),i(),I(33,ae,2,2,"option",23,re),i(),p(35,se,2,1,"p",16),i(),n(36,"div")(37,"label",24),l(38," Description "),i(),u(39,"textarea",25),p(40,le,2,1,"p",16),i(),n(41,"div",13)(42,"div")(43,"label",26),l(44," Icon Class "),i(),u(45,"input",27),n(46,"p",19),l(47,"FontAwesome icon class (optional)"),i()(),n(48,"div")(49,"label",28),l(50," Image URL "),i(),u(51,"input",29),n(52,"p",19),l(53,"Optional subcategory image"),i()()(),n(54,"div",13)(55,"div")(56,"label",30),l(57," Sort Order "),i(),u(58,"input",31),p(59,ce,2,1,"p",16),i(),n(60,"div")(61,"label",32),l(62," Status "),i(),n(63,"div",33),u(64,"input",34),n(65,"label",35),l(66," Active "),i()(),n(67,"p",19),l(68,"Active subcategories are visible to users"),i()()(),n(69,"div",36)(70,"h4",37),l(71,"SEO Information"),i(),n(72,"div",38)(73,"div")(74,"label",39),l(75," Meta Title "),i(),u(76,"input",40),p(77,ge,2,1,"p",16),n(78,"p",19),l(79),i()(),n(80,"div")(81,"label",41),l(82," Meta Description "),i(),u(83,"textarea",42),p(84,de,2,1,"p",16),n(85,"p",19),l(86),i()()()()(),n(87,"div",43)(88,"button",44),C("click",function(){h(e);let o=c();return x(o.closeModal())}),l(89," Cancel "),i(),n(90,"button",45),p(91,ue,3,1,"div",46)(92,me,1,1),i()()()()()()}if(r&2){let e,a,o=c();s(7),b(o.modalTitle),s(4),v("formGroup",o.subcategoryForm),s(),y(o.error()?12:-1),s(6),_("border-red-500",o.getFieldError("name")),s(),y(o.getFieldError("name")?19:-1),s(4),_("border-red-500",o.getFieldError("slug")),s(),y(o.getFieldError("slug")?24:-1),s(6),_("border-red-500",o.getFieldError("category_id")),s(3),T(o.categories),s(2),y(o.getFieldError("category_id")?35:-1),s(4),_("border-red-500",o.getFieldError("description")),s(),y(o.getFieldError("description")?40:-1),s(18),_("border-red-500",o.getFieldError("sort_order")),s(),y(o.getFieldError("sort_order")?59:-1),s(17),_("border-red-500",o.getFieldError("meta_title")),s(),y(o.getFieldError("meta_title")?77:-1),s(2),S(" Characters: ",((e=o.subcategoryForm.get("meta_title"))==null||e.value==null?null:e.value.length)||0,"/200 "),s(4),_("border-red-500",o.getFieldError("meta_description")),s(),y(o.getFieldError("meta_description")?84:-1),s(2),S(" Characters: ",((a=o.subcategoryForm.get("meta_description"))==null||a.value==null?null:a.value.length)||0,"/300 "),s(2),v("disabled",o.loading()),s(2),v("disabled",o.subcategoryForm.invalid||o.loading()),s(),y(o.loading()?91:92)}}var ee=class r{categoriesService=f(w);fb=f(Y);isOpen=!1;subcategory=null;categories=[];selectedCategoryId=null;close=new E;subcategoryCreated=new E;subcategoryUpdated=new E;subcategoryForm;loading=A(!1);error=A(null);constructor(){this.subcategoryForm=this.fb.group({name:["",[m.required,m.minLength(2),m.maxLength(100)]],slug:["",[m.required,m.minLength(2),m.maxLength(100)]],description:["",[m.maxLength(500)]],icon:[""],image_url:[""],category_id:["",[m.required]],is_active:[!0],sort_order:[0,[m.min(0)]],meta_title:["",[m.maxLength(200)]],meta_description:["",[m.maxLength(300)]]})}ngOnInit(){this.setupForm()}ngOnChanges(t){(t.subcategory||t.isOpen||t.selectedCategoryId)&&this.setupForm()}setupForm(){if(this.subcategory){let t=typeof this.subcategory.category_id=="string"?this.subcategory.category_id:this.subcategory.category_id._id;this.subcategoryForm.patchValue({name:this.subcategory.name,slug:this.subcategory.slug,description:this.subcategory.description||"",icon:this.subcategory.icon||"",image_url:this.subcategory.image_url||"",category_id:t,is_active:this.subcategory.is_active,sort_order:this.subcategory.sort_order||0,meta_title:this.subcategory.meta_title||"",meta_description:this.subcategory.meta_description||""})}else this.subcategoryForm.reset({name:"",slug:"",description:"",icon:"",image_url:"",category_id:this.selectedCategoryId||"",is_active:!0,sort_order:0,meta_title:"",meta_description:""});this.error.set(null)}onNameChange(){let t=this.subcategoryForm.get("name"),e=this.subcategoryForm.get("slug");if(t&&e&&t.value&&!this.subcategory){let a=this.categoriesService.generateSlug(t.value);e.setValue(a)}}onSubmit(){return g(this,null,function*(){if(this.subcategoryForm.invalid){this.subcategoryForm.markAllAsTouched();return}this.loading.set(!0),this.error.set(null);try{let t=this.subcategoryForm.value;if(this.subcategory){let e=yield this.categoriesService.updateSubcategoryAsync(this.subcategory._id,t);this.subcategoryUpdated.emit(e)}else{let e=yield this.categoriesService.createSubcategoryAsync(t);this.subcategoryCreated.emit(e)}this.closeModal()}catch(t){console.error("Error saving subcategory:",t),this.error.set(t.error?.message||`Failed to ${this.subcategory?"update":"create"} subcategory. Please try again.`)}finally{this.loading.set(!1)}})}closeModal(){this.subcategoryForm.reset(),this.error.set(null),this.close.emit()}getFieldError(t){let e=this.subcategoryForm.get(t);if(e&&e.errors&&e.touched){if(e.errors.required)return`${this.getFieldDisplayName(t)} is required`;if(e.errors.minlength)return`${this.getFieldDisplayName(t)} must be at least ${e.errors.minlength.requiredLength} characters`;if(e.errors.maxlength)return`${this.getFieldDisplayName(t)} must not exceed ${e.errors.maxlength.requiredLength} characters`;if(e.errors.min)return`${this.getFieldDisplayName(t)} must be at least ${e.errors.min.min}`}return null}getFieldDisplayName(t){return{name:"Subcategory name",slug:"Slug",description:"Description",category_id:"Category",sort_order:"Sort order",meta_title:"Meta title",meta_description:"Meta description",image_url:"Image URL"}[t]||t}get isEditMode(){return!!this.subcategory}get modalTitle(){return this.isEditMode?"Edit Subcategory":"Create New Subcategory"}get submitButtonText(){return this.loading()?this.isEditMode?"Updating...":"Creating...":this.isEditMode?"Update Subcategory":"Create Subcategory"}getCategoryName(t){return this.categories.find(a=>a._id===t)?.name||"Unknown Category"}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=O({type:r,selectors:[["app-subcategory-form-modal"]],inputs:{isOpen:"isOpen",subcategory:"subcategory",categories:"categories",selectedCategoryId:"selectedCategoryId"},outputs:{close:"close",subcategoryCreated:"subcategoryCreated",subcategoryUpdated:"subcategoryUpdated"},features:[k],decls:1,vars:1,consts:[["role","dialog","aria-modal","true",1,"fixed","inset-0","z-50","overflow-y-auto"],[1,"fixed","inset-0","bg-black","bg-opacity-50","transition-opacity",3,"click"],[1,"flex","min-h-full","items-end","justify-center","p-4","text-center","sm:items-center","sm:p-0"],[1,"relative","transform","overflow-hidden","rounded-xl","bg-white","shadow-2xl","transition-all","w-full","max-w-2xl"],[1,"bg-gradient-to-r","from-purple-600","to-pink-600","px-6","py-4"],[1,"flex","items-center","justify-between"],[1,"text-xl","font-semibold","text-white"],[1,"text-white","hover:text-gray-200","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6",3,"ngSubmit","formGroup"],[1,"mb-6","bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded-lg"],[1,"space-y-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["for","name",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","text","id","name","formControlName","name","placeholder","Enter subcategory name",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all",3,"input"],[1,"mt-1","text-sm","text-red-600"],["for","slug",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","text","id","slug","formControlName","slug","placeholder","subcategory-slug",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all","font-mono","text-sm"],[1,"mt-1","text-xs","text-gray-500"],["for","category_id",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","category_id","formControlName","category_id",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],["value",""],[3,"value"],["for","description",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","description","formControlName","description","rows","3","placeholder","Describe this subcategory...",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],["for","icon",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","text","id","icon","formControlName","icon","placeholder","fas fa-icon",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],["for","image_url",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","url","id","image_url","formControlName","image_url","placeholder","https://example.com/image.jpg",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],["for","sort_order",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","number","id","sort_order","formControlName","sort_order","min","0",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","items-center","pt-3"],["type","checkbox","id","is_active","formControlName","is_active",1,"w-5","h-5","text-purple-600","border-gray-300","rounded","focus:ring-purple-500"],["for","is_active",1,"ml-3","text-sm","text-gray-700"],[1,"border-t","border-gray-200","pt-6"],[1,"text-lg","font-medium","text-gray-900","mb-4"],[1,"space-y-4"],["for","meta_title",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","text","id","meta_title","formControlName","meta_title","placeholder","SEO title for search engines",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],["for","meta_description",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","meta_description","formControlName","meta_description","rows","3","placeholder","SEO description for search engines",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],[1,"flex","items-center","justify-end","gap-4","pt-6","border-t","border-gray-200","mt-6"],["type","button",1,"px-6","py-3","border","border-gray-300","text-gray-700","rounded-lg","hover:bg-gray-50","transition-colors","font-medium",3,"click","disabled"],["type","submit",1,"px-6","py-3","bg-gradient-to-r","from-purple-600","to-pink-600","text-white","rounded-lg","hover:shadow-lg","transition-all","duration-200","font-semibold","disabled:opacity-50","disabled:cursor-not-allowed","min-w-[160px]",3,"disabled"],[1,"flex","items-center","justify-center"],[1,"flex","items-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","mr-2"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule","evenodd"],[1,"animate-spin","rounded-full","h-5","w-5","border-b-2","border-white","mr-2"]],template:function(e,a){e&1&&p(0,pe,93,29,"div",0),e&2&&y(a.isOpen?0:-1)},dependencies:[R,Z,q,K,Q,B,z,L,J,j,G,X,H,W],encapsulation:2})};export{w as a,ee as b};
