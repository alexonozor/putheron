import{B as te,b as B,c as G,e as p,h as q,i as z,l as H,m as W,p as J,r as K,s as Q,t as X,u as Y,w as Z,z as ee}from"./chunk-BUMYHMI6.js";import{a as j}from"./chunk-YBFS2WES.js";import{A as L,t as V}from"./chunk-UFDTBXZU.js";import{$a as s,$b as c,Aa as I,Fb as y,Gb as b,Jb as T,Kb as R,Lb as w,Mb as n,Nb as o,Ob as m,Vb as P,Zb as v,aa as $,eb as F,fa as x,ka as C,la as S,lc as f,ma as M,na as O,nc as l,o as u,oc as _,pc as E,qb as N,ua as D}from"./chunk-WCXAA7HR.js";import{a as U,b as k,e as d}from"./chunk-JKOY2XUY.js";var A=class r{http=x(L);config=x(j);categoriesUrl=`${this.config.apiBaseUrl}/categories`;subcategoriesUrl=`${this.config.apiBaseUrl}/subcategories`;getCategories(t){let e=t!==void 0?`${this.categoriesUrl}?active=${t}`:this.categoriesUrl;return this.http.get(e)}getCategoriesAsync(t){return d(this,null,function*(){try{return(yield u(this.getCategories(t))).data||[]}catch(e){throw console.error("Error fetching categories:",e),e}})}getCategory(t){return this.http.get(`${this.categoriesUrl}/${t}`)}getCategoryAsync(t){return d(this,null,function*(){try{return(yield u(this.getCategory(t))).data}catch(e){throw console.error("Error fetching category:",e),e}})}createCategory(t){return this.http.post(this.categoriesUrl,t)}createCategoryAsync(t){return d(this,null,function*(){try{return(yield u(this.createCategory(t))).data}catch(e){throw console.error("Error creating category:",e),e}})}updateCategory(t,e){return this.http.patch(`${this.categoriesUrl}/${t}`,e)}updateCategoryAsync(t,e){return d(this,null,function*(){try{return(yield u(this.updateCategory(t,e))).data}catch(a){throw console.error("Error updating category:",a),a}})}deleteCategory(t){return this.http.delete(`${this.categoriesUrl}/${t}`)}deleteCategoryAsync(t){return d(this,null,function*(){try{yield u(this.deleteCategory(t))}catch(e){throw console.error("Error deleting category:",e),e}})}getSubcategories(t,e){let a=this.subcategoriesUrl,i=new URLSearchParams;return t!==void 0&&i.append("active",t.toString()),e&&i.append("category",e),i.toString()&&(a+=`?${i.toString()}`),this.http.get(a)}getSubcategoriesAsync(t,e){return d(this,null,function*(){try{return(yield u(this.getSubcategories(t,e))).data||[]}catch(a){throw console.error("Error fetching subcategories:",a),a}})}getSubcategoriesByCategory(t,e){let a=e!==void 0?`${this.subcategoriesUrl}/category/${t}?active=${e}`:`${this.subcategoriesUrl}/category/${t}`;return this.http.get(a)}getSubcategoriesByCategoryAsync(t,e){return d(this,null,function*(){try{return(yield u(this.getSubcategoriesByCategory(t,e))).data||[]}catch(a){throw console.error("Error fetching subcategories by category:",a),a}})}getSubcategory(t){return this.http.get(`${this.subcategoriesUrl}/${t}`)}getSubcategoryAsync(t){return d(this,null,function*(){try{return(yield u(this.getSubcategory(t))).data}catch(e){throw console.error("Error fetching subcategory:",e),e}})}createSubcategory(t){return this.http.post(this.subcategoriesUrl,t)}createSubcategoryAsync(t){return d(this,null,function*(){try{return(yield u(this.createSubcategory(t))).data}catch(e){throw console.error("Error creating subcategory:",e),e}})}updateSubcategory(t,e){return this.http.patch(`${this.subcategoriesUrl}/${t}`,e)}updateSubcategoryAsync(t,e){return d(this,null,function*(){try{return(yield u(this.updateSubcategory(t,e))).data}catch(a){throw console.error("Error updating subcategory:",a),a}})}deleteSubcategory(t){return this.http.delete(`${this.subcategoriesUrl}/${t}`)}deleteSubcategoryAsync(t){return d(this,null,function*(){try{yield u(this.deleteSubcategory(t))}catch(e){throw console.error("Error deleting subcategory:",e),e}})}getCategoriesWithSubcategories(){return d(this,null,function*(){try{let[t,e]=yield Promise.all([this.getCategoriesAsync(),this.getSubcategoriesAsync()]),a=t||[],i=e||[];return a.filter(h=>h&&h._id).map(h=>k(U({},h),{subcategories:i.filter(g=>!g||!g.category_id?(g?g.category_id||console.warn("Found subcategory with null category_id:",g):console.warn("Found null subcategory in data"),!1):typeof g.category_id=="string"?g.category_id===h._id:g.category_id&&typeof g.category_id=="object"&&g.category_id._id?g.category_id._id===h._id:(console.warn("Unexpected category_id format:",g.category_id),!1))}))}catch(t){throw console.error("Error fetching categories with subcategories:",t),t}})}generateSlug(t){return t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}static \u0275fac=function(e){return new(e||r)};static \u0275prov=$({token:r,factory:r.\u0275fac,providedIn:"root"})};var ie=(r,t)=>t._id;function ne(r,t){if(r&1&&(n(0,"div",11)(1,"div",47),M(),n(2,"svg",48),m(3,"path",49),o(),l(4),o()()),r&2){let e=c(2);s(4),E(" ",e.error()," ")}}function ae(r,t){if(r&1&&(n(0,"p",16),l(1),o()),r&2){let e=c(2);s(),_(e.getFieldError("name"))}}function se(r,t){if(r&1&&(n(0,"p",16),l(1),o()),r&2){let e=c(2);s(),_(e.getFieldError("slug"))}}function le(r,t){if(r&1&&(n(0,"option",23),l(1),o()),r&2){let e=t.$implicit;w("value",e._id),s(),_(e.name)}}function ce(r,t){if(r&1&&(n(0,"p",16),l(1),o()),r&2){let e=c(2);s(),_(e.getFieldError("category_id"))}}function de(r,t){if(r&1&&(n(0,"p",16),l(1),o()),r&2){let e=c(2);s(),_(e.getFieldError("description"))}}function ge(r,t){if(r&1&&(n(0,"p",16),l(1),o()),r&2){let e=c(2);s(),_(e.getFieldError("sort_order"))}}function ue(r,t){if(r&1&&(n(0,"p",16),l(1),o()),r&2){let e=c(2);s(),_(e.getFieldError("meta_title"))}}function me(r,t){if(r&1&&(n(0,"p",16),l(1),o()),r&2){let e=c(2);s(),_(e.getFieldError("meta_description"))}}function pe(r,t){if(r&1&&(n(0,"div",46),m(1,"div",50),l(2),o()),r&2){let e=c(2);s(2),E(" ",e.submitButtonText," ")}}function ye(r,t){if(r&1&&l(0),r&2){let e=c(2);E(" ",e.submitButtonText," ")}}function be(r,t){if(r&1){let e=P();n(0,"div",0)(1,"div",1),v("click",function(){C(e);let i=c();return S(i.closeModal())}),o(),n(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h3",6),l(7),o(),n(8,"button",7),v("click",function(){C(e);let i=c();return S(i.closeModal())}),M(),n(9,"svg",8),m(10,"path",9),o()()()(),O(),n(11,"form",10),v("ngSubmit",function(){C(e);let i=c();return S(i.onSubmit())}),y(12,ne,5,1,"div",11),n(13,"div",12)(14,"div",13)(15,"div")(16,"label",14),l(17," Subcategory Name * "),o(),n(18,"input",15),v("input",function(){C(e);let i=c();return S(i.onNameChange())}),o(),y(19,ae,2,1,"p",16),o(),n(20,"div")(21,"label",17),l(22," Slug * "),o(),m(23,"input",18),y(24,se,2,1,"p",16),n(25,"p",19),l(26,"URL-friendly version of the subcategory name"),o()()(),n(27,"div")(28,"label",20),l(29," Parent Category * "),o(),n(30,"select",21)(31,"option",22),l(32,"Select a category"),o(),T(33,le,2,2,"option",23,ie),o(),y(35,ce,2,1,"p",16),o(),n(36,"div")(37,"label",24),l(38," Description "),o(),m(39,"textarea",25),y(40,de,2,1,"p",16),o(),n(41,"div",13)(42,"div")(43,"label",26),l(44," Icon Class "),o(),m(45,"input",27),n(46,"p",19),l(47,"FontAwesome icon class (optional)"),o()(),n(48,"div")(49,"label",28),l(50," Image URL "),o(),m(51,"input",29),n(52,"p",19),l(53,"Optional subcategory image"),o()()(),n(54,"div",13)(55,"div")(56,"label",30),l(57," Sort Order "),o(),m(58,"input",31),y(59,ge,2,1,"p",16),o(),n(60,"div")(61,"label",32),l(62," Status "),o(),n(63,"div",33),m(64,"input",34),n(65,"label",35),l(66," Active "),o()(),n(67,"p",19),l(68,"Active subcategories are visible to users"),o()()(),n(69,"div",36)(70,"h4",37),l(71,"SEO Information"),o(),n(72,"div",38)(73,"div")(74,"label",39),l(75," Meta Title "),o(),m(76,"input",40),y(77,ue,2,1,"p",16),n(78,"p",19),l(79),o()(),n(80,"div")(81,"label",41),l(82," Meta Description "),o(),m(83,"textarea",42),y(84,me,2,1,"p",16),n(85,"p",19),l(86),o()()()()(),n(87,"div",43)(88,"button",44),v("click",function(){C(e);let i=c();return S(i.closeModal())}),l(89," Cancel "),o(),n(90,"button",45),y(91,pe,3,1,"div",46)(92,ye,1,1),o()()()()()()}if(r&2){let e,a,i=c();s(7),_(i.modalTitle),s(4),w("formGroup",i.subcategoryForm),s(),b(i.error()?12:-1),s(6),f("border-red-500",i.getFieldError("name")),s(),b(i.getFieldError("name")?19:-1),s(4),f("border-red-500",i.getFieldError("slug")),s(),b(i.getFieldError("slug")?24:-1),s(6),f("border-red-500",i.getFieldError("category_id")),s(3),R(i.categories),s(2),b(i.getFieldError("category_id")?35:-1),s(4),f("border-red-500",i.getFieldError("description")),s(),b(i.getFieldError("description")?40:-1),s(18),f("border-red-500",i.getFieldError("sort_order")),s(),b(i.getFieldError("sort_order")?59:-1),s(17),f("border-red-500",i.getFieldError("meta_title")),s(),b(i.getFieldError("meta_title")?77:-1),s(2),E(" Characters: ",((e=i.subcategoryForm.get("meta_title"))==null||e.value==null?null:e.value.length)||0,"/200 "),s(4),f("border-red-500",i.getFieldError("meta_description")),s(),b(i.getFieldError("meta_description")?84:-1),s(2),E(" Characters: ",((a=i.subcategoryForm.get("meta_description"))==null||a.value==null?null:a.value.length)||0,"/300 "),s(2),w("disabled",i.loading()),s(2),w("disabled",i.subcategoryForm.invalid||i.loading()),s(),b(i.loading()?91:92)}}var re=class r{categoriesService=x(A);fb=x(ee);isOpen=!1;subcategory=null;categories=[];selectedCategoryId=null;close=new F;subcategoryCreated=new F;subcategoryUpdated=new F;subcategoryForm;loading=D(!1);error=D(null);constructor(){this.subcategoryForm=this.fb.group({name:["",[p.required,p.minLength(2),p.maxLength(100)]],slug:["",[p.required,p.minLength(2),p.maxLength(100)]],description:["",[p.maxLength(500)]],icon:[""],image_url:[""],category_id:["",[p.required]],is_active:[!0],sort_order:[0,[p.min(0)]],meta_title:["",[p.maxLength(200)]],meta_description:["",[p.maxLength(300)]]})}ngOnInit(){this.setupForm()}ngOnChanges(t){(t.subcategory||t.isOpen||t.selectedCategoryId)&&this.setupForm()}setupForm(){if(this.subcategory){let t=typeof this.subcategory.category_id=="string"?this.subcategory.category_id:this.subcategory.category_id._id;this.subcategoryForm.patchValue({name:this.subcategory.name,slug:this.subcategory.slug,description:this.subcategory.description||"",icon:this.subcategory.icon||"",image_url:this.subcategory.image_url||"",category_id:t,is_active:this.subcategory.is_active,sort_order:this.subcategory.sort_order||0,meta_title:this.subcategory.meta_title||"",meta_description:this.subcategory.meta_description||""})}else this.subcategoryForm.reset({name:"",slug:"",description:"",icon:"",image_url:"",category_id:this.selectedCategoryId||"",is_active:!0,sort_order:0,meta_title:"",meta_description:""});this.error.set(null)}onNameChange(){let t=this.subcategoryForm.get("name"),e=this.subcategoryForm.get("slug");if(t&&e&&t.value&&!this.subcategory){let a=this.categoriesService.generateSlug(t.value);e.setValue(a)}}onSubmit(){return d(this,null,function*(){if(this.subcategoryForm.invalid){this.subcategoryForm.markAllAsTouched();return}this.loading.set(!0),this.error.set(null);try{let t=this.subcategoryForm.value;if(this.subcategory){let e=yield this.categoriesService.updateSubcategoryAsync(this.subcategory._id,t);this.subcategoryUpdated.emit(e)}else{let e=yield this.categoriesService.createSubcategoryAsync(t);this.subcategoryCreated.emit(e)}this.closeModal()}catch(t){console.error("Error saving subcategory:",t),this.error.set(t.error?.message||`Failed to ${this.subcategory?"update":"create"} subcategory. Please try again.`)}finally{this.loading.set(!1)}})}closeModal(){this.subcategoryForm.reset(),this.error.set(null),this.close.emit()}getFieldError(t){let e=this.subcategoryForm.get(t);if(e&&e.errors&&e.touched){if(e.errors.required)return`${this.getFieldDisplayName(t)} is required`;if(e.errors.minlength)return`${this.getFieldDisplayName(t)} must be at least ${e.errors.minlength.requiredLength} characters`;if(e.errors.maxlength)return`${this.getFieldDisplayName(t)} must not exceed ${e.errors.maxlength.requiredLength} characters`;if(e.errors.min)return`${this.getFieldDisplayName(t)} must be at least ${e.errors.min.min}`}return null}getFieldDisplayName(t){return{name:"Subcategory name",slug:"Slug",description:"Description",category_id:"Category",sort_order:"Sort order",meta_title:"Meta title",meta_description:"Meta description",image_url:"Image URL"}[t]||t}get isEditMode(){return!!this.subcategory}get modalTitle(){return this.isEditMode?"Edit Subcategory":"Create New Subcategory"}get submitButtonText(){return this.loading()?this.isEditMode?"Updating...":"Creating...":this.isEditMode?"Update Subcategory":"Create Subcategory"}getCategoryName(t){return this.categories.find(a=>a._id===t)?.name||"Unknown Category"}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=N({type:r,selectors:[["app-subcategory-form-modal"]],inputs:{isOpen:"isOpen",subcategory:"subcategory",categories:"categories",selectedCategoryId:"selectedCategoryId"},outputs:{close:"close",subcategoryCreated:"subcategoryCreated",subcategoryUpdated:"subcategoryUpdated"},features:[I],decls:1,vars:1,consts:[["role","dialog","aria-modal","true",1,"fixed","inset-0","z-50","overflow-y-auto"],[1,"fixed","inset-0","bg-black","bg-opacity-50","transition-opacity",3,"click"],[1,"flex","min-h-full","items-end","justify-center","p-4","text-center","sm:items-center","sm:p-0"],[1,"relative","transform","overflow-hidden","rounded-xl","bg-white","shadow-2xl","transition-all","w-full","max-w-2xl"],[1,"bg-gradient-to-r","from-purple-600","to-pink-600","px-6","py-4"],[1,"flex","items-center","justify-between"],[1,"text-xl","font-semibold","text-white"],[1,"text-white","hover:text-gray-200","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6",3,"ngSubmit","formGroup"],[1,"mb-6","bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded-lg"],[1,"space-y-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["for","name",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","text","id","name","formControlName","name","placeholder","Enter subcategory name",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all",3,"input"],[1,"mt-1","text-sm","text-red-600"],["for","slug",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","text","id","slug","formControlName","slug","placeholder","subcategory-slug",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all","font-mono","text-sm"],[1,"mt-1","text-xs","text-gray-500"],["for","category_id",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","category_id","formControlName","category_id",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],["value",""],[3,"value"],["for","description",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","description","formControlName","description","rows","3","placeholder","Describe this subcategory...",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],["for","icon",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","text","id","icon","formControlName","icon","placeholder","fas fa-icon",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],["for","image_url",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","url","id","image_url","formControlName","image_url","placeholder","https://example.com/image.jpg",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],["for","sort_order",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","number","id","sort_order","formControlName","sort_order","min","0",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","items-center","pt-3"],["type","checkbox","id","is_active","formControlName","is_active",1,"w-5","h-5","text-purple-600","border-gray-300","rounded","focus:ring-purple-500"],["for","is_active",1,"ml-3","text-sm","text-gray-700"],[1,"border-t","border-gray-200","pt-6"],[1,"text-lg","font-medium","text-gray-900","mb-4"],[1,"space-y-4"],["for","meta_title",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","text","id","meta_title","formControlName","meta_title","placeholder","SEO title for search engines",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],["for","meta_description",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","meta_description","formControlName","meta_description","rows","3","placeholder","SEO description for search engines",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","transition-all"],[1,"flex","items-center","justify-end","gap-4","pt-6","border-t","border-gray-200","mt-6"],["type","button",1,"px-6","py-3","border","border-gray-300","text-gray-700","rounded-lg","hover:bg-gray-50","transition-colors","font-medium",3,"click","disabled"],["type","submit",1,"px-6","py-3","bg-gradient-to-r","from-purple-600","to-pink-600","text-white","rounded-lg","hover:shadow-lg","transition-all","duration-200","font-semibold","disabled:opacity-50","disabled:cursor-not-allowed","min-w-[160px]",3,"disabled"],[1,"flex","items-center","justify-center"],[1,"flex","items-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","mr-2"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule","evenodd"],[1,"animate-spin","rounded-full","h-5","w-5","border-b-2","border-white","mr-2"]],template:function(e,a){e&1&&y(0,be,93,29,"div",0),e&2&&b(a.isOpen?0:-1)},dependencies:[V,te,H,X,Y,G,W,B,Q,q,z,Z,J,K],encapsulation:2})};export{A as a,re as b};
