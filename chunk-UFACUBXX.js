import{a as $,b as ee}from"./chunk-UW2ATRRX.js";import{h as Q,l as U,m as X}from"./chunk-66HTC5NI.js";import{d as W,e as H,h as J,k as K}from"./chunk-67MRJSI2.js";import"./chunk-WIJXL5PX.js";import"./chunk-RNGT6N3O.js";import"./chunk-UNULKHHN.js";import{a as Y,b as Z}from"./chunk-F52GGYS4.js";import"./chunk-2TVU5X7D.js";import{B as j,c as R,e as f,h as D,i as O,l as q,p as z,r as G,z as A}from"./chunk-6HVQSJLB.js";import"./chunk-3DWAHAUX.js";import{b as I,c as T,d as V}from"./chunk-CAUPKMHV.js";import{a as N}from"./chunk-SY63MTEM.js";import"./chunk-SRA5OYUU.js";import{s as F,t as B}from"./chunk-EZYZDCTR.js";import"./chunk-FTO62232.js";import"./chunk-LIZM4CZI.js";import"./chunk-QD7SSFII.js";import{b as E,d as M,e as L}from"./chunk-ARLYTOMD.js";import"./chunk-GTSDDWM5.js";import{t as P}from"./chunk-Z5YYMG7R.js";import{Db as x,Eb as m,Fb as d,Kb as s,Lb as n,Mb as l,Nb as g,Ub as S,Yb as C,_a as r,_b as p,fa as c,ka as y,la as _,mc as a,nc as k,pb as w,ua as u,xc as b}from"./chunk-ME5BD2TS.js";import{e as v}from"./chunk-JKOY2XUY.js";var te=()=>["/auth/forgot-password"],oe=()=>["/auth/signup"];function ne(t,e){t&1&&a(0," Email is required ")}function ae(t,e){t&1&&a(0," Invalid email format ")}function re(t,e){if(t&1&&(n(0,"mat-error"),m(1,ne,1,0)(2,ae,1,0),l()),t&2){let o=p();r(),d(o.emailControl!=null&&o.emailControl.hasError("required")?1:o.emailControl!=null&&o.emailControl.hasError("email")?2:-1)}}function le(t,e){t&1&&a(0," Password is required ")}function se(t,e){t&1&&a(0," Minimum 6 characters ")}function me(t,e){if(t&1&&(n(0,"mat-error"),m(1,le,1,0)(2,se,1,0),l()),t&2){let o=p();r(),d(o.passwordControl!=null&&o.passwordControl.hasError("required")?1:o.passwordControl!=null&&o.passwordControl.hasError("minlength")?2:-1)}}function de(t,e){if(t&1){let o=S();n(0,"div",10)(1,"button",18),C("click",function(){y(o);let h=p();return _(h.resendVerification())}),a(2," Resend Verification Email "),l()()}if(t&2){let o=p();r(),s("disabled",o.loading())}}function ce(t,e){t&1&&a(0," Sign In ")}function ue(t,e){t&1&&(n(0,"span",12),g(1,"mat-spinner",19),a(2," Signing In... "),l())}var ie=class t{authService=c(N);router=c(M);route=c(E);fb=c(A);snackBar=c($);loading=u(!1);showPassword=u(!1);showResendOption=u(!1);unverifiedEmail=u("");loginForm;constructor(){this.loginForm=this.fb.group({email:["",[f.required,f.email]],password:["",[f.required,f.minLength(6)]]})}ngOnInit(){this.route.queryParams.subscribe(e=>{e.message&&this.snackBar.open(e.message,"Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-info"]}),e.email&&this.loginForm.patchValue({email:e.email})})}onSubmit(){return v(this,null,function*(){if(!this.loginForm.valid){this.snackBar.open("Please fill in all required fields correctly","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]});return}let{email:e,password:o}=this.loginForm.value;this.loading.set(!0);try{let i=yield this.authService.signIn(e,o);i.data?(this.snackBar.open("Login successful! Redirecting...","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-success"]}),setTimeout(()=>{this.router.navigate(["/dashboard"])},1e3)):this.handleLoginError(i.error?.message||"Login failed. Please try again.")}catch(i){this.handleLoginError(i?.message||"An unexpected error occurred. Please try again.")}finally{this.loading.set(!1)}})}handleLoginError(e){if(e.includes("verify your email")||e.includes("email address before logging")){this.snackBar.open(e+" Click below to resend verification email.","Close",{duration:8e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]});let o=this.loginForm.get("email")?.value;o&&(this.unverifiedEmail.set(o),this.showResendOption.set(!0))}else this.snackBar.open(e,"Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}resendVerification(){return v(this,null,function*(){if(this.unverifiedEmail()){this.loading.set(!0);try{let e=yield this.authService.resendEmailVerification(this.unverifiedEmail());e.success?(this.snackBar.open("Verification email sent! Please check your inbox.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-success"]}),this.showResendOption.set(!1)):this.snackBar.open(e.message||"Failed to resend verification email.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}catch(e){this.snackBar.open(e?.message||"Failed to resend verification email.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.loading.set(!1)}}})}togglePasswordVisibility(){this.showPassword.update(e=>!e)}get emailControl(){return this.loginForm.get("email")}get passwordControl(){return this.loginForm.get("password")}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=w({type:t,selectors:[["app-login"]],decls:34,vars:16,consts:[[1,"login-container"],[1,"text-center","mb-8"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"space-y-6",3,"ngSubmit","formGroup"],["appearance","outline",1,"w-full"],["matInput","","type","email","formControlName","email","placeholder","your@email.com",3,"disabled"],["matSuffix",""],["matInput","","formControlName","password","placeholder","Enter password",3,"type","disabled"],["mat-icon-button","","matSuffix","","type","button",3,"click"],[1,"mb-4"],["mat-raised-button","","color","primary","type","submit",1,"w-full","py-3","text-base","font-medium","mb-4",3,"disabled"],[1,"flex","items-center","justify-center","gap-2"],[1,"space-y-3","text-center"],["mat-button","","color","primary",1,"text-sm",3,"routerLink"],[1,"mt-4","pt-4","border-t","border-gray-200"],[1,"text-sm","text-gray-600"],["mat-button","","color","primary",1,"text-sm","font-medium","ml-1",3,"routerLink"],["mat-stroked-button","","color","primary",1,"w-full",3,"click","disabled"],["diameter","16"]],template:function(o,i){o&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Welcome Back"),l(),n(4,"p",3),a(5,"Sign in to your account"),l()(),n(6,"form",4),C("ngSubmit",function(){return i.onSubmit()}),n(7,"mat-form-field",5)(8,"mat-label"),a(9,"Email Address"),l(),g(10,"input",6),n(11,"mat-icon",7),a(12,"email"),l(),m(13,re,3,1,"mat-error"),l(),n(14,"mat-form-field",5)(15,"mat-label"),a(16,"Password"),l(),g(17,"input",8),n(18,"button",9),C("click",function(){return i.togglePasswordVisibility()}),n(19,"mat-icon"),a(20),l()(),m(21,me,3,1,"mat-error"),l(),m(22,de,3,1,"div",10),n(23,"button",11),m(24,ce,1,0)(25,ue,3,0,"span",12),l(),n(26,"div",13)(27,"a",14),a(28," Forgot your password? "),l(),n(29,"div",15)(30,"p",16),a(31," Don't have an account? "),n(32,"a",17),a(33," Sign up "),l()()()()()()),o&2&&(r(6),s("formGroup",i.loginForm),r(4),s("disabled",i.loading()),r(3),d(i.emailControl!=null&&i.emailControl.invalid&&(i.emailControl!=null&&i.emailControl.touched)?13:-1),r(4),s("type",i.showPassword()?"text":"password")("disabled",i.loading()),r(),x("aria-label","Toggle password visibility")("aria-pressed",i.showPassword()),r(2),k(i.showPassword()?"visibility_off":"visibility"),r(),d(i.passwordControl!=null&&i.passwordControl.invalid&&(i.passwordControl!=null&&i.passwordControl.touched)?21:-1),r(),d(i.showResendOption()?22:-1),r(),s("disabled",i.loading()||!i.loginForm.valid),r(),d(i.loading()?25:24),r(3),s("routerLink",b(14,te)),r(5),s("routerLink",b(15,oe)))},dependencies:[P,j,q,R,D,O,z,G,L,Q,K,W,H,J,X,U,V,T,I,B,F,Z,Y,ee],styles:["[_nghost-%COMP%]{display:block}"]})};export{ie as LoginComponent};
