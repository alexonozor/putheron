import{a as Ge}from"./chunk-6MHXBLQA.js";import{a as Ae,b as Ve,c as Le}from"./chunk-E7RQWOJS.js";import{a as ke}from"./chunk-TAHVWCV6.js";import{d as z,e as K,h as Y,i as H,j as Z,k as W}from"./chunk-JSJFW26R.js";import{a as De}from"./chunk-ZRCWAC3Y.js";import{d as ne,h as G,i as ae,j as le,l as X,m as B}from"./chunk-3E6WONAP.js";import{d as V,e as J,f as Ne,k as L}from"./chunk-K7KKK75I.js";import{A as k,C as A,c as Q,e as f,h as D,i as O,m as T,n as Oe,q,s as N,x as Te,y as qe}from"./chunk-U7A7OHU6.js";import{a as oe,b as re}from"./chunk-NALWU7JT.js";import{c as R,d as j}from"./chunk-MLJYHTLM.js";import{a as je}from"./chunk-QD7SSFII.js";import{a as I,b as F}from"./chunk-QFHPWKDD.js";import{k as $,t as E}from"./chunk-FI3M32ZM.js";import{$a as m,$b as u,Da as be,Fb as x,Gb as C,Ib as Pe,Jb as pe,Kb as ue,Lb as s,Mb as r,Nb as n,Ob as g,Vb as U,Zb as y,_c as Re,aa as Ce,dc as Se,eb as Me,ec as we,fa as p,fc as Ee,ka as b,kb as ie,la as M,lc as Ie,nc as l,oc as fe,pc as v,qb as S,ua as P,wb as w,yc as Fe}from"./chunk-M7BUBJMW.js";import{e as _}from"./chunk-JKOY2XUY.js";var We="basil",it=function(e){return e===3?"v3":e},Ue="https://js.stripe.com",nt="".concat(Ue,"/").concat(We,"/stripe.js"),ot=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,rt=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,Be="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",at=function(e){return ot.test(e)||rt.test(e)},lt=function(){for(var e=document.querySelectorAll('script[src^="'.concat(Ue,'"]')),t=0;t<e.length;t++){var i=e[t];if(at(i.src))return i}return null},ze=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",i=document.createElement("script");i.src="".concat(nt).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(i),i},mt=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"7.9.0",startTime:t})},ee=null,me=null,se=null,st=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}},ct=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},dt=function(e){return ee!==null?ee:(ee=new Promise(function(t,i){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(Be),window.Stripe){t(window.Stripe);return}try{var a=lt();if(a&&e)console.warn(Be);else if(!a)a=ze(e);else if(a&&se!==null&&me!==null){var c;a.removeEventListener("load",se),a.removeEventListener("error",me),(c=a.parentNode)===null||c===void 0||c.removeChild(a),a=ze(e)}se=ct(t,i),me=st(i),a.addEventListener("load",se),a.addEventListener("error",me)}catch(h){i(h);return}}),ee.catch(function(t){return ee=null,Promise.reject(t)}))},pt=function(e,t,i){if(e===null)return null;var a=t[0],c=a.match(/^pk_test/),h=it(e.version),d=We;c&&h!==d&&console.warn("Stripe.js@".concat(h," was loaded on the page, but @stripe/stripe-js@").concat("7.9.0"," expected Stripe.js@").concat(d,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var xe=e.apply(void 0,t);return mt(xe,i),xe},te,$e=!1,Qe=function(){return te||(te=dt(null).catch(function(e){return te=null,Promise.reject(e)}),te)};Promise.resolve().then(function(){return Qe()}).catch(function(o){$e||console.warn(o)});var Je=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];$e=!0;var a=Date.now();return Qe().then(function(c){return pt(c,t,a)})};var ce=class o{stripePromise;stripe=null;constructor(){this.stripePromise=Je(je.stripe.publishableKey)}getStripe(){return _(this,null,function*(){return this.stripe||(this.stripe=yield this.stripePromise),this.stripe})}createElement(e){return _(this,null,function*(){let t=yield this.getStripe();if(!t)throw new Error("Stripe failed to load");let i=t.elements({clientSecret:e,appearance:{theme:"stripe",variables:{colorPrimary:"#3b82f6",colorBackground:"#ffffff",colorText:"#1f2937",colorDanger:"#ef4444",fontFamily:'"Inter", "Segoe UI", sans-serif',spacingUnit:"4px",borderRadius:"8px"},rules:{".Tab":{border:"1px solid #e5e7eb",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},".Tab:hover":{color:"#1f2937",backgroundColor:"#f9fafb"},".Tab--selected":{backgroundColor:"#3b82f6",color:"#ffffff"}}}}),a=i.create("payment",{layout:"tabs"});return{elements:i,paymentElement:a}})}confirmPayment(e,t,i){return _(this,null,function*(){let a=yield this.getStripe();if(!a)throw new Error("Stripe failed to load");return yield a.confirmPayment({elements:t,confirmParams:{return_url:i}})})}confirmPaymentWithoutRedirect(e,t){return _(this,null,function*(){let i=yield this.getStripe();if(!i)throw new Error("Stripe failed to load");let{error:a}=yield t.submit();if(a)throw a;return yield i.confirmPayment({elements:t,confirmParams:{},redirect:"if_required"})})}retrievePaymentIntent(e){return _(this,null,function*(){let t=yield this.getStripe();if(!t)throw new Error("Stripe failed to load");return yield t.retrievePaymentIntent(e)})}static \u0275fac=function(t){return new(t||o)};static \u0275prov=Ce({token:o,factory:o.\u0275fac,providedIn:"root"})};var ft=["stripeElements"];function gt(o,e){o&1&&(r(0,"mat-error"),l(1," Please select a payment method "),n())}function yt(o,e){if(o&1&&(r(0,"form",9)(1,"mat-form-field",15)(2,"mat-label"),l(3,"Payment Method"),n(),r(4,"mat-select",16)(5,"mat-option",17),l(6,"Credit/Debit Card"),n()(),w(7,gt,2,0,"mat-error",18),n(),r(8,"div",19)(9,"mat-icon"),l(10,"info"),n(),r(11,"p"),l(12,"This payment will be processed securely via Stripe."),n()()()),o&2){let t,i=u();s("formGroup",i.paymentForm),m(7),s("ngIf",(t=i.paymentForm.get("paymentMethod"))==null?null:t.hasError("required"))}}function vt(o,e){if(o&1&&(r(0,"div",21)(1,"mat-icon"),l(2,"error"),n(),r(3,"span"),l(4),n()()),o&2){let t=u(2);m(4),fe(t.stripeError())}}function _t(o,e){if(o&1&&(r(0,"div",10),g(1,"div",20,0),x(3,vt,5,1,"div",21),n()),o&2){let t=u();m(3),C(t.stripeError()?3:-1)}}function ht(o,e){o&1&&(r(0,"div",11),g(1,"mat-spinner",22),r(2,"p"),l(3,"Processing payment..."),n()())}function xt(o,e){if(o&1){let t=U();r(0,"button",23),y("click",function(){b(t);let a=u();return M(a.setupStripePayment())}),r(1,"mat-icon"),l(2,"credit_card"),n(),l(3," Proceed to Payment "),n()}if(o&2){let t=u();s("disabled",t.paymentForm.invalid||t.processing())}}function Ct(o,e){if(o&1){let t=U();r(0,"button",23),y("click",function(){b(t);let a=u();return M(a.processPayment())}),r(1,"mat-icon"),l(2,"lock"),n(),l(3," Complete Payment "),n()}if(o&2){let t=u();s("disabled",t.processing())}}var Xe=class o{constructor(e){this.data=e;this.paymentForm=this.formBuilder.group({paymentMethod:["card",[f.required]]})}stripeElementsRef;dialogRef=p(z);formBuilder=p(k);stripeService=p(ce);chatService=p(De);projectService=p(ke);cdr=p(Re);paymentForm;showStripeForm=P(!1);processing=P(!1);stripeError=P(null);elements=null;paymentElement=null;clientSecret=null;ngOnInit(){}ngAfterViewInit(){}setupStripePayment(){return _(this,null,function*(){if(!this.paymentForm.invalid){this.processing.set(!0),this.stripeError.set(null);try{let e;if((this.data.isProjectPayment||this.data.isInitialPayment)&&this.data.projectId)console.log("Creating project payment intent for project:",this.data.projectId),e=yield this.projectService.createProjectPaymentIntentAsync(this.data.projectId),console.log("Project payment intent created:",e);else if(this.data.chatId&&this.data.messageId)console.log("Creating additional payment intent for chat:",this.data.chatId,"message:",this.data.messageId),e=yield this.chatService.createAdditionalPaymentIntentAsync(this.data.chatId,this.data.messageId),console.log("Additional payment intent created:",e);else throw new Error("Missing required payment data");this.clientSecret=e.clientSecret;let{elements:t,paymentElement:i}=yield this.stripeService.createElement(this.clientSecret);this.elements=t,this.paymentElement=i,this.showStripeForm.set(!0),this.cdr.detectChanges(),setTimeout(()=>{this.stripeElementsRef?.nativeElement?this.paymentElement.mount(this.stripeElementsRef.nativeElement):this.stripeError.set("Unable to initialize payment form")},100)}catch(e){console.error("Error setting up payment:",e),this.stripeError.set(e.message||"Failed to setup payment")}finally{this.processing.set(!1)}}})}processPayment(){return _(this,null,function*(){if(!this.elements||!this.clientSecret){this.stripeError.set("Payment not properly initialized");return}this.processing.set(!0),this.stripeError.set(null);try{let e=yield this.stripeService.retrievePaymentIntent(this.clientSecret);console.log("Current payment intent status:",e.paymentIntent?.status);let t;if(e.paymentIntent?.status==="succeeded")console.log("Payment already succeeded, skipping confirmation"),t=e.paymentIntent;else{console.log("Attempting to confirm payment intent");let{error:i,paymentIntent:a}=yield this.stripeService.confirmPaymentWithoutRedirect(this.clientSecret,this.elements);if(i){console.error("Stripe payment confirmation error:",i),console.error("Error details:",{type:i.type,code:i.code,decline_code:i.decline_code,message:i.message,payment_intent:i.payment_intent}),this.stripeError.set(i.message||"Payment failed");return}t=a}if(t?.status==="succeeded"){console.log("Stripe payment succeeded:",t.id),console.log("Payment type:",this.data.isProjectPayment||this.data.isInitialPayment?"project":"additional");try{if((this.data.isProjectPayment||this.data.isInitialPayment)&&this.data.projectId){console.log("\u{1F50D} Confirming project payment for project:",this.data.projectId),console.log("\u{1F4DD} Payment modal data:",{isInitialPayment:this.data.isInitialPayment,isProjectPayment:this.data.isProjectPayment,messageId:this.data.messageId,chatId:this.data.chatId,projectId:this.data.projectId});let a=this.data.isInitialPayment?this.data.messageId:void 0,c=this.data.isInitialPayment?this.data.chatId:void 0;console.log("\u{1F4E4} Passing to backend:",{messageIdToPass:a,chatIdToPass:c}),yield this.projectService.confirmProjectPaymentAsync(this.data.projectId,t.id,a,c),console.log("\u2705 Project payment confirmed successfully")}else if(this.data.chatId&&this.data.messageId){console.log("Confirming additional payment for chat:",this.data.chatId,"message:",this.data.messageId);let a=yield this.chatService.confirmAdditionalPaymentAsync(this.data.chatId,this.data.messageId,t.id);console.log("Additional payment confirmed successfully, result:",a)}}catch(a){if(console.error("Backend confirmation error:",a),a?.message?.includes("already processed")||a?.message?.includes("already completed")||a?.status===409)console.log("Payment was already processed, continuing with success flow");else throw a}let i={amount:this.data.amount,description:this.data.description,paymentMethod:this.paymentForm.value.paymentMethod,paymentIntentId:t.id};this.dialogRef.close(i)}else this.stripeError.set("Payment was not completed successfully")}catch(e){console.error("Error processing payment:",e),this.stripeError.set(e.message||"Payment processing failed")}finally{this.processing.set(!1)}})}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||o)(ie(K))};static \u0275cmp=S({type:o,selectors:[["app-payment-modal"]],viewQuery:function(t,i){if(t&1&&Se(ft,5,be),t&2){let a;we(a=Ee())&&(i.stripeElementsRef=a.first)}},decls:26,vars:7,consts:[["stripeElements",""],["mat-dialog-title","",1,"dialog-title"],[1,"title-icon"],["mat-dialog-content","",1,"dialog-content"],[1,"payment-details"],[1,"amount-section"],[1,"amount-display"],[1,"description-section"],[1,"business-name"],[1,"payment-form",3,"formGroup"],[1,"stripe-form"],[1,"loading-overlay"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"disabled"],["appearance","outline",1,"full-width"],["formControlName","paymentMethod"],["value","card"],[4,"ngIf"],[1,"payment-note"],[1,"stripe-elements"],[1,"error-message"],["diameter","40"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(t,i){t&1&&(r(0,"h1",1)(1,"mat-icon",2),l(2,"payment"),n(),l(3," Make Payment "),n(),r(4,"div",3)(5,"div",4)(6,"div",5)(7,"h3"),l(8,"Payment Amount"),n(),r(9,"div",6),l(10),n()(),r(11,"div",7)(12,"h3"),l(13,"Payment For"),n(),r(14,"p"),l(15),n(),r(16,"p",8),l(17),n()()(),x(18,yt,13,2,"form",9)(19,_t,4,1,"div",10),x(20,ht,4,0,"div",11),n(),r(21,"div",12)(22,"button",13),y("click",function(){return i.onCancel()}),l(23," Cancel "),n(),x(24,xt,4,1,"button",14)(25,Ct,4,1,"button",14),n()),t&2&&(m(10),v(" $",i.data.amount," "),m(5),fe(i.data.description),m(2),v("To: ",i.data.businessName),m(),C(i.showStripeForm()?19:18),m(2),C(i.processing()?20:-1),m(2),s("disabled",i.processing()),m(2),C(i.showStripeForm()?25:24))},dependencies:[E,$,A,T,D,O,q,N,W,Y,Z,H,j,R,G,L,V,J,B,F,I,le,ae,ne,re,oe],styles:[".dialog-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:600;margin-bottom:0}.title-icon[_ngcontent-%COMP%]{color:#10b981;font-size:24px}.dialog-content[_ngcontent-%COMP%]{min-width:400px;max-width:500px}.payment-details[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:20px;margin-bottom:20px}.amount-section[_ngcontent-%COMP%]{text-align:center;margin-bottom:16px}.amount-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#64748b;margin:0 0 8px;text-transform:uppercase;letter-spacing:.5px}.amount-display[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:#10b981;margin-bottom:16px}.description-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#64748b;margin:0 0 8px;text-transform:uppercase;letter-spacing:.5px}.description-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 8px;color:#374151;line-height:1.5}.business-name[_ngcontent-%COMP%]{font-weight:600;color:#1f2937}.payment-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.full-width[_ngcontent-%COMP%]{width:100%}.payment-note[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;padding:12px;background:#dbeafe;border:1px solid #bfdbfe;border-radius:8px;margin-top:16px}.payment-note[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#3b82f6;font-size:20px;margin-top:2px}.payment-note[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#1e40af;line-height:1.4}mat-dialog-actions[_ngcontent-%COMP%]{padding-top:16px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}.stripe-form[_ngcontent-%COMP%]{margin:20px 0}.stripe-elements[_ngcontent-%COMP%]{border:1px solid #e2e8f0;border-radius:8px;padding:16px;background:#fff}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#ef4444;margin-top:12px;font-size:14px}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#ffffffe6;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;border-radius:12px}.loading-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-weight:500;color:#64748b}"]})};function bt(o,e){o&1&&(r(0,"mat-error"),l(1," Amount is required "),n())}function Mt(o,e){o&1&&(r(0,"mat-error"),l(1," Amount must be greater than 0 "),n())}function Pt(o,e){o&1&&(r(0,"mat-error"),l(1," Description is required "),n())}function St(o,e){o&1&&(r(0,"mat-error"),l(1," Message is required "),n())}var He=class o{constructor(e){this.data=e;let t=this.data?.defaultAmount||"",i=this.data?.isStartPayment||!1,a=i?"Project payment":"",c=i?"Payment is required to start working on your project. This amount covers the agreed services and deliverables.":"";this.paymentForm=this.formBuilder.group({amount:[t,[f.required,f.min(.01)]],description:[a,[f.required,f.minLength(3)]],content:[c,[f.required,f.minLength(10)]]})}dialogRef=p(z);formBuilder=p(k);paymentForm;onCancel(){this.dialogRef.close()}onSubmit(){if(this.paymentForm.valid){let e=this.paymentForm.value,t={amount:parseFloat(e.amount),description:e.description,content:e.content};this.dialogRef.close(t)}}static \u0275fac=function(t){return new(t||o)(ie(K))};static \u0275cmp=S({type:o,selectors:[["app-payment-request-modal"]],decls:29,vars:10,consts:[["mat-dialog-title","",1,"dialog-title"],[1,"title-icon"],["mat-dialog-content","",1,"dialog-content"],[1,"payment-form",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","type","number","formControlName","amount","placeholder","0.00","min","0.01","step","0.01"],[4,"ngIf"],["matInput","","formControlName","description",3,"placeholder"],["matInput","","formControlName","content","rows","4",3,"placeholder"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(t,i){if(t&1&&(r(0,"h1",0)(1,"mat-icon",1),l(2,"payment"),n(),l(3),n(),r(4,"div",2)(5,"form",3)(6,"mat-form-field",4)(7,"mat-label"),l(8,"Amount ($)"),n(),g(9,"input",5),w(10,bt,2,0,"mat-error",6)(11,Mt,2,0,"mat-error",6),n(),r(12,"mat-form-field",4)(13,"mat-label"),l(14,"Description"),n(),g(15,"input",7),w(16,Pt,2,0,"mat-error",6),n(),r(17,"mat-form-field",4)(18,"mat-label"),l(19,"Message to Client"),n(),g(20,"textarea",8),w(21,St,2,0,"mat-error",6),n()()(),r(22,"div",9)(23,"button",10),y("click",function(){return i.onCancel()}),l(24," Cancel "),n(),r(25,"button",11),y("click",function(){return i.onSubmit()}),r(26,"mat-icon"),l(27,"send"),n(),l(28),n()()),t&2){let a,c,h,d;m(3),v(" ",i.data!=null&&i.data.isStartPayment?"Request Project Payment":"Request Additional Payment"," "),m(2),s("formGroup",i.paymentForm),m(5),s("ngIf",(a=i.paymentForm.get("amount"))==null?null:a.hasError("required")),m(),s("ngIf",(c=i.paymentForm.get("amount"))==null?null:c.hasError("min")),m(4),s("placeholder",i.data!=null&&i.data.isStartPayment?"Payment for project services":"Why is additional payment needed?"),m(),s("ngIf",(h=i.paymentForm.get("description"))==null?null:h.hasError("required")),m(4),s("placeholder",i.data!=null&&i.data.isStartPayment?"Message about project payment and start...":"Explain the payment request in detail..."),m(),s("ngIf",(d=i.paymentForm.get("content"))==null?null:d.hasError("required")),m(4),s("disabled",i.paymentForm.invalid),m(3),v(" ",i.data!=null&&i.data.isStartPayment?"Start Project & Request Payment":"Send Payment Request"," ")}},dependencies:[E,$,A,T,Q,Oe,D,O,Te,q,N,W,Y,Z,H,j,R,G,L,V,J,B,X,F,I],styles:[".dialog-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:600;margin-bottom:0}.title-icon[_ngcontent-%COMP%]{color:#3b82f6;font-size:24px}.dialog-content[_ngcontent-%COMP%]{min-width:400px;max-width:500px}.payment-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin-top:16px}.full-width[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]{padding-top:16px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}"]})};function wt(o,e){o&1&&(r(0,"mat-error"),l(1," Completion details are required "),n())}function Et(o,e){o&1&&(r(0,"mat-error"),l(1," Please provide more detailed information (at least 20 characters) "),n())}var et=class o{dialogRef=p(z);formBuilder=p(k);completionForm;constructor(){this.completionForm=this.formBuilder.group({content:["Project has been completed and is ready for review.",[f.required,f.minLength(20)]]})}onCancel(){this.dialogRef.close()}onSubmit(){if(this.completionForm.valid){let e={content:this.completionForm.value.content};this.dialogRef.close(e)}}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=S({type:o,selectors:[["app-completion-request-modal"]],decls:23,vars:4,consts:[["mat-dialog-title","",1,"dialog-title"],[1,"title-icon"],["mat-dialog-content","",1,"dialog-content"],[1,"description"],[1,"completion-form",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","content","rows","6","placeholder","Describe what has been completed, delivered, or achieved..."],[4,"ngIf"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(t,i){if(t&1&&(r(0,"h1",0)(1,"mat-icon",1),l(2,"check_circle"),n(),l(3," Request Project Completion "),n(),r(4,"div",2)(5,"p",3),l(6," You're about to request client approval for project completion. Please describe what has been completed and delivered. "),n(),r(7,"form",4)(8,"mat-form-field",5)(9,"mat-label"),l(10,"Completion Details"),n(),g(11,"textarea",6),r(12,"mat-hint"),l(13,"Be specific about deliverables and outcomes"),n(),w(14,wt,2,0,"mat-error",7)(15,Et,2,0,"mat-error",7),n()()(),r(16,"div",8)(17,"button",9),y("click",function(){return i.onCancel()}),l(18," Cancel "),n(),r(19,"button",10),y("click",function(){return i.onSubmit()}),r(20,"mat-icon"),l(21,"send"),n(),l(22," Request Completion Approval "),n()()),t&2){let a,c;m(7),s("formGroup",i.completionForm),m(7),s("ngIf",(a=i.completionForm.get("content"))==null?null:a.hasError("required")),m(),s("ngIf",(c=i.completionForm.get("content"))==null?null:c.hasError("minlength")),m(4),s("disabled",i.completionForm.invalid)}},dependencies:[E,$,A,T,Q,D,O,q,N,W,Y,Z,H,j,R,G,L,V,Ne,J,B,X,F,I],styles:[".dialog-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:600;margin-bottom:0}.title-icon[_ngcontent-%COMP%]{color:#10b981;font-size:24px}.dialog-content[_ngcontent-%COMP%]{min-width:400px;max-width:500px}.description[_ngcontent-%COMP%]{color:#64748b;font-size:14px;line-height:1.5;margin:0 0 16px;padding:12px;background:#f8fafc;border-radius:8px;border-left:4px solid #10b981}.completion-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.full-width[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]{padding-top:16px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}"]})};var It=()=>[1,2,3,4,5],Ft=(o,e)=>e._id;function Rt(o,e){o&1&&(r(0,"div",2),g(1,"mat-spinner",5),r(2,"span",6),l(3,"Loading projects..."),n()())}function jt(o,e){if(o&1){let t=U();r(0,"div",3)(1,"mat-icon",7),l(2,"work_off"),n(),r(3,"h3",8),l(4,"No Completed Projects"),n(),r(5,"p",9),l(6,"You need to complete a project with this business before you can leave a review."),n(),r(7,"button",10),y("click",function(){b(t);let a=u();return M(a.dialogRef.close())}),l(8," Close "),n()()}}function Dt(o,e){if(o&1&&(r(0,"span",32),l(1),n()),o&2){let t=u().$implicit,i=u(2);m(),v(" - Completed ",i.formatDate(t.completed_at))}}function Ot(o,e){if(o&1&&(r(0,"mat-option",14),l(1),x(2,Dt,2,1,"span",32),n()),o&2){let t=e.$implicit;s("value",t._id),m(),v(" ",t.title," "),m(),C(t.completed_at?2:-1)}}function Tt(o,e){if(o&1){let t=U();r(0,"mat-icon",33),y("click",function(){let a=b(t).$implicit,c=u(2);return M(c.setRating(a))}),l(1," star "),n()}if(o&2){let t,i,a=e.$implicit,c=u(2);Ie("text-yellow-400",a<=((t=c.reviewForm.get("rating"))==null?null:t.value))("text-gray-300",a>((i=c.reviewForm.get("rating"))==null?null:i.value))}}function qt(o,e){o&1&&g(0,"mat-spinner",31)}function Nt(o,e){if(o&1){let t=U();r(0,"form",11),y("ngSubmit",function(){b(t);let a=u();return M(a.submitReview())}),r(1,"mat-form-field",12)(2,"mat-label"),l(3,"Select Project"),n(),r(4,"mat-select",13),pe(5,Ot,3,3,"mat-option",14,Ft),n()(),r(7,"div",15)(8,"label",16),l(9,"Overall Rating *"),n(),r(10,"div",17),pe(11,Tt,2,4,"mat-icon",18,Pe),r(13,"span",19),l(14),n()()(),r(15,"mat-form-field",12)(16,"mat-label"),l(17,"Review"),n(),r(18,"textarea",20),l(19,"            "),n()(),r(20,"div",21)(21,"div")(22,"label",16),l(23,"Service Quality"),n(),r(24,"mat-slider",22),g(25,"input",23),n(),r(26,"div",24),l(27),n()(),r(28,"div")(29,"label",16),l(30,"Communication"),n(),r(31,"mat-slider",22),g(32,"input",25),n(),r(33,"div",24),l(34),n()(),r(35,"div")(36,"label",16),l(37,"Timeliness"),n(),r(38,"mat-slider",22),g(39,"input",26),n(),r(40,"div",24),l(41),n()(),r(42,"div")(43,"label",16),l(44,"Value for Money"),n(),r(45,"mat-slider",22),g(46,"input",27),n(),r(47,"div",24),l(48),n()()(),r(49,"div",28)(50,"button",29),y("click",function(){b(t);let a=u();return M(a.dialogRef.close())}),l(51," Cancel "),n(),r(52,"button",30),x(53,qt,1,0,"mat-spinner",31),l(54," Submit Review "),n()()()}if(o&2){let t,i,a,c,h,d=u();s("formGroup",d.reviewForm),m(5),ue(d.completedProjects()),m(6),ue(Fe(12,It)),m(3),v("",((t=d.reviewForm.get("rating"))==null?null:t.value)||0,"/5"),m(10),s("displayWith",d.formatSliderLabel),m(3),v("",((i=d.reviewForm.get("service_quality"))==null?null:i.value)||0,"/5"),m(4),s("displayWith",d.formatSliderLabel),m(3),v("",((a=d.reviewForm.get("communication"))==null?null:a.value)||0,"/5"),m(4),s("displayWith",d.formatSliderLabel),m(3),v("",((c=d.reviewForm.get("timeliness"))==null?null:c.value)||0,"/5"),m(4),s("displayWith",d.formatSliderLabel),m(3),v("",((h=d.reviewForm.get("value_for_money"))==null?null:h.value)||0,"/5"),m(4),s("disabled",!d.reviewForm.valid||d.submitting()),m(),C(d.submitting()?53:-1)}}var tt=class o{reviewSubmitted=new Me;fb=p(k);reviewService=p(Ge);dialogRef=p(z);data=p(K,{optional:!0});completedProjects=P([]);submitting=P(!1);loadingProjects=P(!1);get businessId(){return this.data?.businessId||""}get businessName(){return this.data?.businessName||"Business"}get projectId(){return this.data?.projectId||null}get projectTitle(){return this.data?.projectTitle||"Current Project"}reviewForm;constructor(){this.reviewForm=this.fb.group({project_id:["",f.required],rating:[0,[f.required,f.min(1),f.max(5)]],review_text:[""],service_quality:[5],communication:[5],timeliness:[5],value_for_money:[5]})}ngOnInit(){this.projectId?(this.reviewForm.patchValue({project_id:this.projectId}),this.completedProjects.set([{_id:this.projectId,title:this.projectTitle,business_id:{_id:this.businessId,name:this.businessName},completed_at:new Date,client_id:"",business_owner_id:"",status:"completed"}])):this.loadCompletedProjects()}loadCompletedProjects(){return _(this,null,function*(){try{this.loadingProjects.set(!0);let t=(yield this.reviewService.getCompletedProjectsForReviewAsync()).filter(i=>i.business_id._id===this.businessId);this.completedProjects.set(t)}catch(e){console.error("Error loading completed projects:",e)}finally{this.loadingProjects.set(!1)}})}setRating(e){this.reviewForm.patchValue({rating:e})}formatSliderLabel(e){return`${e}`}formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Date not specified"}submitReview(){return _(this,null,function*(){if(!this.reviewForm.invalid)try{this.submitting.set(!0);let e=this.reviewForm.value,t={project_id:e.project_id,rating:e.rating,review_text:e.review_text||void 0,service_quality:e.service_quality,communication:e.communication,timeliness:e.timeliness,value_for_money:e.value_for_money};yield this.reviewService.createReviewAsync(t),this.reviewSubmitted.emit(),this.dialogRef.close(!0)}catch(e){console.error("Error submitting review:",e)}finally{this.submitting.set(!1)}})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=S({type:o,selectors:[["app-review-form"]],outputs:{reviewSubmitted:"reviewSubmitted"},decls:6,vars:1,consts:[[1,"p-6"],[1,"text-xl","font-semibold","text-gray-900","mb-4"],[1,"flex","items-center","justify-center","py-8"],[1,"text-center","py-8"],[3,"formGroup"],["diameter","40"],[1,"ml-3","text-gray-600"],[1,"text-gray-400","text-6xl","mb-4"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-600","mb-4"],["mat-button","","color","primary",3,"click"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"w-full","mb-4"],["formControlName","project_id","required",""],[3,"value"],[1,"mb-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","items-center","space-x-2"],[1,"cursor-pointer","text-2xl","hover:text-yellow-400","transition-colors",3,"text-yellow-400","text-gray-300"],[1,"ml-2","text-sm","text-gray-600"],["matInput","","formControlName","review_text","rows","4","placeholder","Share your experience working with this business..."],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-6"],["min","1","max","5","step","1","discrete","",3,"displayWith"],["matSliderThumb","","formControlName","service_quality"],[1,"text-xs","text-gray-500","mt-1"],["matSliderThumb","","formControlName","communication"],["matSliderThumb","","formControlName","timeliness"],["matSliderThumb","","formControlName","value_for_money"],[1,"flex","justify-end","space-x-3"],["type","button","mat-button","",3,"click"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],["diameter","20",1,"mr-2"],[1,"text-sm","text-gray-500"],[1,"cursor-pointer","text-2xl","hover:text-yellow-400","transition-colors",3,"click"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"h2",1),l(2,"Leave a Review"),n(),x(3,Rt,4,0,"div",2)(4,jt,9,0,"div",3)(5,Nt,55,13,"form",4),n()),t&2&&(m(3),C(i.loadingProjects()?3:i.completedProjects().length===0?4:5))},dependencies:[E,A,T,Q,D,O,qe,q,N,W,G,L,V,B,X,j,R,le,ae,ne,F,I,Le,Ae,Ve,re,oe],styles:["[_nghost-%COMP%]{display:block;max-width:600px}.mat-mdc-slider[_ngcontent-%COMP%]{width:100%}mat-icon.text-yellow-400[_ngcontent-%COMP%]{color:#fbbf24}mat-icon.text-gray-300[_ngcontent-%COMP%]{color:#d1d5db}"]})};export{Xe as a,He as b,et as c,tt as d};
