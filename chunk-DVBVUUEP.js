import{a as Tn}from"./chunk-LVK5L6RA.js";import{a as In}from"./chunk-3FNAV7GT.js";import{b as wn}from"./chunk-WDJLFRHZ.js";import{a as W}from"./chunk-X727KFFE.js";import{a as te,b as Ve}from"./chunk-VKEAGMTN.js";import{k as Ne}from"./chunk-URAN5HWD.js";import{a as Rn,b as En,c as An,h as kn}from"./chunk-JFPKTNPS.js";import{b as yn}from"./chunk-VQURNIK2.js";import{a as Xt,b as Zt}from"./chunk-G6YNDR7B.js";import"./chunk-W6WUGSQN.js";import"./chunk-F5X5MWHG.js";import{a as vn,b as Ie}from"./chunk-EHFHNXQ2.js";import{c as xn}from"./chunk-F2LLY2CR.js";import{a as Z,b as J,c as bn,d as Mn,e as Fe,f as Ue,g as De,h as Le}from"./chunk-UGVZ2NZX.js";import{a as _n}from"./chunk-7RWCIHFI.js";import{a as Cn,b as Pn,c as On,f as Sn,g as ee}from"./chunk-WC4V5MBK.js";import{a as hn,b as ke}from"./chunk-5IB3J52A.js";import"./chunk-OIXXJWNI.js";import{a as $t,b as Kt,c as Yt,d as fe,e as qt,f as Qt,g as nt,h as N,j as Ee,l as Ae,m as j}from"./chunk-HUQJ3NC3.js";import{d as Pe,e as Oe,f as Se,h as we,j as fn,k as Re}from"./chunk-SQHEFKI2.js";import"./chunk-HOTTC6Q3.js";import{A as X,a as dn,b as cn,c as L,e as E,h as V,i as ve,k as ye,l as be,m as mn,o as pn,p as Me,q as Ce,u as gn,v as un,y as q,z as Q}from"./chunk-IOQBSONU.js";import{a as Te,b as B}from"./chunk-ZH2LY4H3.js";import{b as xe}from"./chunk-TD3AVWK7.js";import"./chunk-SGYCFQGT.js";import{b as en,l as tn,m as nn,o as on,s as he,v as rn}from"./chunk-ECO3GEC4.js";import{b as Jt,c as _e,e as D}from"./chunk-SUTJIGUH.js";import{a as ln}from"./chunk-5X5YCIDJ.js";import{a as an}from"./chunk-QSI3HFOI.js";import{p as F,q as U}from"./chunk-A72LFUZP.js";import{A as et,B as ue,D as Ht,F as tt,c as Nt,d as jt,f as Bt,o as Wt,w as zt,x as ge,y as Gt}from"./chunk-IGUJQH2A.js";import{a as sn}from"./chunk-IZ7UM5CL.js";import"./chunk-YYV7O7JP.js";import"./chunk-MEFNJ5SS.js";import"./chunk-GUCRBWY4.js";import{B as Vt,k,l as I,t as T}from"./chunk-REOVWAHI.js";import{$ as yt,$b as Qe,A as me,Ab as qe,B as $e,Bb as c,Ca as Ye,Cb as pe,Cc as Ze,D as pt,Db as oe,Ea as C,Eb as w,F as gt,H as ut,Ic as Je,J as ft,K as _t,Ka as Ot,Lb as o,Lc as z,Mb as i,Nb as b,Ob as It,Oc as Lt,Pa as St,Pb as Tt,Rb as M,U as ht,V as H,Vb as _,Wb as m,Xb as Ft,Y as xt,Yb as Ut,Zb as Dt,_ as vt,a as ce,aa as bt,ac as Xe,bc as re,c as ze,ca as Ke,cb as l,cc as se,eb as wt,f as Ge,fa as g,fc as R,gb as Rt,gc as r,hb as O,hc as v,ic as f,jb as Et,jc as A,k as G,ka as Mt,lc as $,ma as Ct,mc as K,na as h,nc as Y,o as He,oa as x,ob as S,pb as At,pc as ae,q as ct,qb as kt,ub as u,v as mt,ya as ie,za as Pt}from"./chunk-BEPULU6C.js";import{e as y}from"./chunk-JKOY2XUY.js";function $n(s,n){s&1&&(o(0,"mat-error"),r(1," Role name is required "),i())}function Kn(s,n){s&1&&(o(0,"mat-error"),r(1," Role name must be at least 2 characters "),i())}function Yn(s,n){s&1&&(o(0,"mat-error"),r(1," Description is required "),i())}function qn(s,n){s&1&&(o(0,"mat-error"),r(1," Description must be at least 5 characters "),i())}function Qn(s,n){s&1&&(o(0,"mat-error"),r(1," Priority must be at least 1 "),i())}function Xn(s,n){s&1&&(o(0,"mat-error"),r(1," Priority cannot exceed 100 "),i())}function Zn(s,n){if(s&1&&(o(0,"span",44),r(1),i()),s&2){let e=m().$implicit;l(),f(" - ",e.description," ")}}function Jn(s,n){if(s&1){let e=M();o(0,"div",35)(1,"div",36)(2,"label",37)(3,"mat-checkbox",38),_("change",function(){let a=h(e).$implicit,d=m(2);return x(d.togglePermission(a._id))}),i(),o(4,"div")(5,"div",39),r(6),i(),o(7,"div",40),r(8),u(9,Zn,2,1,"span",41),i()()()(),o(10,"div",42)(11,"span",43),r(12),i()()()}if(s&2){let e=n.$implicit,t=m(2);l(3),c("checked",t.isPermissionSelected(e._id)),l(3),f(" ",e.name," "),l(2),A(" ",e.module,".",e.action," "),l(),c("ngIf",e.description),l(3),f(" ",e.action," ")}}function ei(s,n){if(s&1&&(o(0,"div",29)(1,"div",30)(2,"h4",31),r(3),i(),o(4,"p",32),r(5),i()(),o(6,"div",33),u(7,Jn,13,6,"div",34),i()()),s&2){let e=n.$implicit,t=m();l(3),v(e),l(2),f(" ",t.getPermissionsByModule()[e].length," permissions "),l(2),c("ngForOf",t.getPermissionsByModule()[e])("ngForTrackBy",t.trackByPermissionId)}}function ti(s,n){s&1&&(o(0,"div",45)(1,"mat-icon",46),r(2,"security"),i(),o(3,"p"),r(4,"No permissions available"),i()())}function ni(s,n){if(s&1&&(o(0,"div",47)(1,"div",48)(2,"mat-icon",49),r(3,"error"),i(),o(4,"span",50),r(5),i()()()),s&2){let e=m();l(5),v(e.errorMessage)}}function ii(s,n){if(s&1&&(o(0,"span"),r(1),i()),s&2){let e=m();l(),f(" ",e.isEditing?"Update Role":"Create Role"," ")}}function oi(s,n){if(s&1&&(o(0,"span",48),b(1,"mat-spinner",51),r(2),i()),s&2){let e=m();l(2),f(" ",e.isEditing?"Updating...":"Creating..."," ")}}var le=class s{constructor(n,e,t,a){this.fb=n;this.roleService=e;this.dialogRef=t;this.data=a;this.isEditing=!!a.role,this.allPermissions.set(a.permissions||[]),this.roleForm=this.fb.group({name:["",[E.required,E.minLength(2)]],display_name:[""],description:["",[E.required,E.minLength(5)]],color:["#6366f1"],priority:[50,[E.min(1),E.max(100)]],permissions:[[]]})}roleForm;isEditing;isSaving=!1;errorMessage="";selectedPermissions=[];allPermissions=C([]);ngOnInit(){this.data.role&&this.loadRoleData()}loadRoleData(){let n=this.data.role;this.selectedPermissions=Array.isArray(n.permissions)?n.permissions.map(e=>typeof e=="string"?e:e._id):[],this.roleForm.patchValue({name:n.name,display_name:n.display_name||"",description:n.description,color:n.color||"#6366f1",priority:n.priority,permissions:this.selectedPermissions})}isPermissionSelected(n){return this.selectedPermissions.includes(n)}togglePermission(n){let e=this.selectedPermissions.indexOf(n);e>-1?this.selectedPermissions.splice(e,1):this.selectedPermissions.push(n),this.roleForm.patchValue({permissions:this.selectedPermissions})}saveRole(){return y(this,null,function*(){if(!this.roleForm.invalid)try{this.isSaving=!0,this.errorMessage="";let n=this.roleForm.value,e={name:n.name.trim(),display_name:n.display_name?.trim()||void 0,description:n.description.trim(),color:n.color,priority:n.priority,permissions:this.selectedPermissions},t;this.isEditing&&this.data.role?t=yield this.roleService.updateRoleAsync(this.data.role._id,e):t=yield this.roleService.createRoleAsync(e),this.dialogRef.close({success:!0,role:t})}catch(n){this.errorMessage=n.message||"Failed to save role"}finally{this.isSaving=!1}})}onCancel(){this.dialogRef.close({success:!1})}getPermissionsByModule(){let n=this.allPermissions().reduce((e,t)=>{let a=t.module||"Other";return e[a]||(e[a]=[]),e[a].push(t),e},{});return Object.keys(n).forEach(e=>{n[e].sort((t,a)=>t.name.localeCompare(a.name))}),n}getModuleNames(){return Object.keys(this.getPermissionsByModule()).sort()}trackByPermissionId(n,e){return e._id}static \u0275fac=function(e){return new(e||s)(O(q),O(W),O(Z),O(J))};static \u0275cmp=S({type:s,selectors:[["app-role-form-modal"]],decls:68,vars:16,consts:[[1,"role-form-modal"],["mat-dialog-title","",1,"flex","items-center","justify-between"],[1,"text-xl","font-semibold","text-gray-900"],["mat-dialog-content","",1,"max-h-[70vh]","overflow-y-auto"],[1,"space-y-6",3,"formGroup"],[1,"shadow-none","border"],[1,"text-lg"],[1,"space-y-4","pt-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","e.g., content_manager"],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","display_name","placeholder","e.g., Content Manager"],["matInput","","formControlName","description","rows","3","placeholder","Describe the role and its responsibilities..."],[1,"grid","grid-cols-2","gap-4"],["appearance","outline"],["matInput","","type","color","formControlName","color",1,"h-10"],["matInput","","type","number","formControlName","priority","min","1","max","100"],[1,"text-lg","flex","items-center","justify-between","w-full"],[1,"text-sm","font-normal","text-gray-500"],[1,"pt-4"],[1,"space-y-4","max-h-96","overflow-y-auto"],["class","border rounded-lg",4,"ngFor","ngForOf"],["class","text-center py-8 text-gray-500",4,"ngIf"],["class","p-4 bg-red-50 border border-red-200 rounded-lg",4,"ngIf"],["mat-dialog-actions","",1,"flex","justify-end","space-x-3","pt-4","border-t"],["mat-button","",1,"text-gray-600",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],["class","flex items-center",4,"ngIf"],[1,"border","rounded-lg"],[1,"bg-gray-50","px-4","py-3","border-b"],[1,"font-medium","text-gray-900","capitalize"],[1,"text-sm","text-gray-500"],[1,"p-4","space-y-2"],["class","flex items-center justify-between p-2 rounded hover:bg-gray-50",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","items-center","justify-between","p-2","rounded","hover:bg-gray-50"],[1,"flex-1"],[1,"flex","items-center","cursor-pointer"],[1,"mr-3",3,"change","checked"],[1,"font-medium","text-sm","text-gray-900"],[1,"text-xs","text-gray-500"],["class","ml-2",4,"ngIf"],[1,"ml-3"],[1,"inline-flex","items-center","px-2","py-0.5","rounded","text-xs","font-medium","bg-blue-100","text-blue-800"],[1,"ml-2"],[1,"text-center","py-8","text-gray-500"],[1,"text-4xl","mb-2","opacity-50"],[1,"p-4","bg-red-50","border","border-red-200","rounded-lg"],[1,"flex","items-center"],[1,"text-red-600","mr-2"],[1,"text-red-700","text-sm"],["diameter","16",1,"mr-2"]],template:function(e,t){if(e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),r(3),i()(),o(4,"div",3)(5,"form",4)(6,"mat-card",5)(7,"mat-card-header")(8,"mat-card-title",6),r(9,"Basic Information"),i()(),o(10,"mat-card-content",7)(11,"mat-form-field",8)(12,"mat-label"),r(13,"Role Name *"),i(),b(14,"input",9),o(15,"mat-icon",10),r(16,"badge"),i(),u(17,$n,2,0,"mat-error",11)(18,Kn,2,0,"mat-error",11),i(),o(19,"mat-form-field",8)(20,"mat-label"),r(21,"Display Name"),i(),b(22,"input",12),o(23,"mat-icon",10),r(24,"label"),i(),o(25,"mat-hint"),r(26,"Friendly name for display purposes"),i()(),o(27,"mat-form-field",8)(28,"mat-label"),r(29,"Description *"),i(),b(30,"textarea",13),o(31,"mat-icon",10),r(32,"description"),i(),u(33,Yn,2,0,"mat-error",11)(34,qn,2,0,"mat-error",11),i(),o(35,"div",14)(36,"mat-form-field",15)(37,"mat-label"),r(38,"Color"),i(),b(39,"input",16),o(40,"mat-icon",10),r(41,"palette"),i()(),o(42,"mat-form-field",15)(43,"mat-label"),r(44,"Priority"),i(),b(45,"input",17),o(46,"mat-icon",10),r(47,"priority_high"),i(),u(48,Qn,2,0,"mat-error",11)(49,Xn,2,0,"mat-error",11),i()()()(),o(50,"mat-card",5)(51,"mat-card-header")(52,"mat-card-title",18)(53,"span"),r(54,"Permissions"),i(),o(55,"span",19),r(56),i()()(),o(57,"mat-card-content",20)(58,"div",21),u(59,ei,8,4,"div",22),i(),u(60,ti,5,0,"div",23),i()(),u(61,ni,6,1,"div",24),i()(),o(62,"div",25)(63,"button",26),_("click",function(){return t.onCancel()}),r(64," Cancel "),i(),o(65,"button",27),_("click",function(){return t.saveRole()}),u(66,ii,2,1,"span",11)(67,oi,3,1,"span",28),i()()()),e&2){let a,d,p,P,ne,dt;l(3),f(" ",t.isEditing?"Edit Role":"Create New Role"," "),l(2),c("formGroup",t.roleForm),l(12),c("ngIf",(a=t.roleForm.get("name"))==null?null:a.hasError("required")),l(),c("ngIf",(d=t.roleForm.get("name"))==null?null:d.hasError("minlength")),l(15),c("ngIf",(p=t.roleForm.get("description"))==null?null:p.hasError("required")),l(),c("ngIf",(P=t.roleForm.get("description"))==null?null:P.hasError("minlength")),l(14),c("ngIf",(ne=t.roleForm.get("priority"))==null?null:ne.hasError("min")),l(),c("ngIf",(dt=t.roleForm.get("priority"))==null?null:dt.hasError("max")),l(7),A(" ",t.selectedPermissions.length," of ",t.allPermissions().length," selected "),l(3),c("ngForOf",t.getModuleNames()),l(),c("ngIf",t.allPermissions().length===0),l(),c("ngIf",t.errorMessage),l(4),c("disabled",t.roleForm.invalid||t.isSaving),l(),c("ngIf",!t.isSaving),l(),c("ngIf",t.isSaving)}},dependencies:[T,k,I,Q,be,L,mn,V,ve,un,gn,X,Me,Ce,Le,Fe,De,Ue,D,_e,N,Re,Pe,Se,Oe,we,j,Ae,Ee,ke,hn,U,F,B,Te,ee,Cn,On,Sn,Pn,xe],styles:[".role-form-modal[_ngcontent-%COMP%]{min-width:600px;max-width:800px}@media (max-width: 768px){.role-form-modal[_ngcontent-%COMP%]{min-width:90vw;max-width:95vw}}"]})};var li=["panel"],di=["*"];function ci(s,n){if(s&1&&(o(0,"div",1,0),Ut(2),i()),s&2){let e=n.id,t=m();w(t._classList),oe("mat-mdc-autocomplete-visible",t.showPanel)("mat-mdc-autocomplete-hidden",!t.showPanel)("mat-autocomplete-panel-animations-enabled",!t._animationsDisabled)("mat-primary",t._color==="primary")("mat-accent",t._color==="accent")("mat-warn",t._color==="warn"),c("id",t.id),qe("aria-label",t.ariaLabel||null)("aria-labelledby",t._getPanelAriaLabelledby(e))}}var at=class{source;option;constructor(n,e){this.source=n,this.option=e}},Ln=new Ke("mat-autocomplete-default-options",{providedIn:"root",factory:mi});function mi(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1,hideSingleSelectionIndicator:!1,requireSelection:!1,hasBackdrop:!1}}var Vn=(()=>{class s{_changeDetectorRef=g(Je);_elementRef=g(Ye);_defaults=g(Ln);_animationsDisabled=g(Ot,{optional:!0})==="NoopAnimations";_activeOptionChanges=ce.EMPTY;_keyManager;showPanel=!1;get isOpen(){return this._isOpen&&this.showPanel}_isOpen=!1;_latestOpeningTrigger;_setColor(e){this._color=e,this._changeDetectorRef.markForCheck()}_color;template;panel;options;optionGroups;ariaLabel;ariaLabelledby;displayWith=null;autoActiveFirstOption;autoSelectActiveOption;requireSelection;panelWidth;disableRipple;optionSelected=new ie;opened=new ie;closed=new ie;optionActivated=new ie;set classList(e){this._classList=e,this._elementRef.nativeElement.className=""}_classList;get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._syncParentProperties()}_hideSingleSelectionIndicator;_syncParentProperties(){if(this.options)for(let e of this.options)e._changeDetectorRef.markForCheck()}id=g(zt).getId("mat-autocomplete-");inertGroups;constructor(){let e=g(Bt);this.inertGroups=e?.SAFARI||!1,this.autoActiveFirstOption=!!this._defaults.autoActiveFirstOption,this.autoSelectActiveOption=!!this._defaults.autoSelectActiveOption,this.requireSelection=!!this._defaults.requireSelection,this._hideSingleSelectionIndicator=this._defaults.hideSingleSelectionIndicator??!1}ngAfterContentInit(){this._keyManager=new Gt(this.options).withWrap().skipPredicate(this._skipPredicate),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._keyManager?.destroy(),this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options?.length,this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){let t=new at(this,e);this.optionSelected.emit(t)}_getPanelAriaLabelledby(e){if(this.ariaLabel)return null;let t=e?e+" ":"";return this.ariaLabelledby?t+this.ariaLabelledby:e}_skipPredicate(){return!1}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=S({type:s,selectors:[["mat-autocomplete"]],contentQueries:function(t,a,d){if(t&1&&(Qe(d,fe,5),Qe(d,Kt,5)),t&2){let p;re(p=se())&&(a.options=p),re(p=se())&&(a.optionGroups=p)}},viewQuery:function(t,a){if(t&1&&(Xe(wt,7),Xe(li,5)),t&2){let d;re(d=se())&&(a.template=d.first),re(d=se())&&(a.panel=d.first)}},hostAttrs:[1,"mat-mdc-autocomplete"],inputs:{ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:[2,"autoActiveFirstOption","autoActiveFirstOption",z],autoSelectActiveOption:[2,"autoSelectActiveOption","autoSelectActiveOption",z],requireSelection:[2,"requireSelection","requireSelection",z],panelWidth:"panelWidth",disableRipple:[2,"disableRipple","disableRipple",z],classList:[0,"class","classList"],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",z]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["matAutocomplete"],features:[ae([{provide:$t,useExisting:s}])],ngContentSelectors:di,decls:1,vars:0,consts:[["panel",""],["role","listbox",1,"mat-mdc-autocomplete-panel","mdc-menu-surface","mdc-menu-surface--open",3,"id"]],template:function(t,a){t&1&&(Ft(),u(0,ci,3,17,"ng-template"))},styles:[`div.mat-mdc-autocomplete-panel{width:100%;max-height:256px;visibility:hidden;transform-origin:center top;overflow:auto;padding:8px 0;box-sizing:border-box;position:relative;border-radius:var(--mat-autocomplete-container-shape, var(--mat-sys-corner-extra-small));box-shadow:var(--mat-autocomplete-container-elevation-shadow, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12));background-color:var(--mat-autocomplete-background-color, var(--mat-sys-surface-container))}@media(forced-colors: active){div.mat-mdc-autocomplete-panel{outline:solid 1px}}.cdk-overlay-pane:not(.mat-mdc-autocomplete-panel-above) div.mat-mdc-autocomplete-panel{border-top-left-radius:0;border-top-right-radius:0}.mat-mdc-autocomplete-panel-above div.mat-mdc-autocomplete-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:center bottom}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-visible{visibility:visible}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-hidden{visibility:hidden;pointer-events:none}@keyframes _mat-autocomplete-enter{from{opacity:0;transform:scaleY(0.8)}to{opacity:1;transform:none}}.mat-autocomplete-panel-animations-enabled{animation:_mat-autocomplete-enter 120ms cubic-bezier(0, 0, 0.2, 1)}mat-autocomplete{display:none}
`],encapsulation:2,changeDetection:0})}return s})();var pi={provide:dn,useExisting:vt(()=>lt),multi:!0};var Nn=new Ke("mat-autocomplete-scroll-strategy",{providedIn:"root",factory:()=>{let s=g(he);return()=>s.scrollStrategies.reposition()}});function gi(s){return()=>s.scrollStrategies.reposition()}var ui={provide:Nn,deps:[he],useFactory:gi},lt=(()=>{class s{_environmentInjector=g(Mt);_element=g(Ye);_overlay=g(he);_viewContainerRef=g(Et);_zone=g(Pt);_changeDetectorRef=g(Je);_dir=g(Ht,{optional:!0});_formField=g(fn,{optional:!0,host:!0});_viewportRuler=g(tn);_scrollStrategy=g(Nn);_renderer=g(Rt);_defaults=g(Ln,{optional:!0});_overlayRef;_portal;_componentDestroyed=!1;_initialized=new Ge;_keydownSubscription;_outsideClickSubscription;_cleanupWindowBlur;_previousValue;_valueOnAttach;_valueOnLastKeydown;_positionStrategy;_manuallyFloatingLabel=!1;_closingActionsSubscription;_viewportSubscription=ce.EMPTY;_breakpointObserver=g(Wt);_handsetLandscapeSubscription=ce.EMPTY;_canOpenOnNextFocus=!0;_valueBeforeAutoSelection;_pendingAutoselectedOption;_closeKeyEventStream=new Ge;_windowBlurHandler=()=>{this._canOpenOnNextFocus=this.panelOpen||!this._hasFocus()};_onChange=()=>{};_onTouched=()=>{};autocomplete;position="auto";connectedTo;autocompleteAttribute="off";autocompleteDisabled;constructor(){}_aboveClass="mat-mdc-autocomplete-panel-above";ngAfterViewInit(){this._initialized.next(),this._initialized.complete(),this._cleanupWindowBlur=this._renderer.listen("window","blur",this._windowBlurHandler)}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){this._cleanupWindowBlur?.(),this._handsetLandscapeSubscription.unsubscribe(),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete(),this._clearFromModal()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}_overlayAttached=!1;openPanel(){this._openPanelInternal()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._latestOpeningTrigger===this&&(this.autocomplete._isOpen=!1,this.autocomplete._latestOpeningTrigger=null),this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._updatePanelState(),this._componentDestroyed||this._changeDetectorRef.detectChanges(),this._trackedModal&&ue(this._trackedModal,"aria-owns",this.autocomplete.id))}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return me(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe($e(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe($e(()=>this._overlayAttached)):G()).pipe(ct(e=>e instanceof Yt?e:null))}optionSelections=mt(()=>{let e=this.autocomplete?this.autocomplete.options:null;return e?e.changes.pipe(ht(e),H(()=>me(...e.map(t=>t.onSelectionChange)))):this._initialized.pipe(H(()=>this.optionSelections))});get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return new ze(e=>{let t=d=>{let p=jt(d),P=this._formField?this._formField.getConnectedOverlayOrigin().nativeElement:null,ne=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;this._overlayAttached&&p!==this._element.nativeElement&&!this._hasFocus()&&(!P||!P.contains(p))&&(!ne||!ne.contains(p))&&this._overlayRef&&!this._overlayRef.overlayElement.contains(p)&&e.next(d)},a=[this._renderer.listen("document","click",t),this._renderer.listen("document","auxclick",t),this._renderer.listen("document","touchend",t)];return()=>{a.forEach(d=>d())}})}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){let t=e.keyCode,a=ge(e);if(t===27&&!a&&e.preventDefault(),this._valueOnLastKeydown=this._element.nativeElement.value,this.activeOption&&t===13&&this.panelOpen&&!a)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){let d=this.autocomplete._keyManager.activeItem,p=t===38||t===40;t===9||p&&!a&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):p&&this._canOpen()&&this._openPanelInternal(this._valueOnLastKeydown),(p||this.autocomplete._keyManager.activeItem!==d)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._valueOnLastKeydown),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){let t=e.target,a=t.value;if(t.type==="number"&&(a=a==""?null:parseFloat(a)),this._previousValue!==a){if(this._previousValue=a,this._pendingAutoselectedOption=null,(!this.autocomplete||!this.autocomplete.requireSelection)&&this._onChange(a),!a)this._clearPreviousSelectedOption(null,!1);else if(this.panelOpen&&!this.autocomplete.requireSelection){let d=this.autocomplete.options?.find(p=>p.selected);if(d){let p=this._getDisplayValue(d.value);a!==p&&d.deselect(!1)}}if(this._canOpen()&&this._hasFocus()){let d=this._valueOnLastKeydown??this._element.nativeElement.value;this._valueOnLastKeydown=null,this._openPanelInternal(d)}}}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(this._previousValue),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this._openPanelInternal()}_hasFocus(){return Nt()===this._element.nativeElement}_floatLabel(e=!1){this._formField&&this._formField.floatLabel==="auto"&&(e?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField&&(this._formField.floatLabel="auto"),this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){let e=new ze(a=>{St(()=>{a.next()},{injector:this._environmentInjector})}),t=this.autocomplete.options?.changes.pipe(xt(()=>this._positionStrategy.reapplyLastPosition()),ft(0))??G();return me(e,t).pipe(H(()=>this._zone.run(()=>{let a=this.panelOpen;return this._resetActiveItem(),this._updatePanelState(),this._changeDetectorRef.detectChanges(),this.panelOpen&&this._overlayRef.updatePosition(),a!==this.panelOpen&&(this.panelOpen?this._emitOpened():this.autocomplete.closed.emit()),this.panelClosingActions})),ut(1)).subscribe(a=>this._setValueAndClose(a))}_emitOpened(){this.autocomplete.opened.emit()}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_getDisplayValue(e){let t=this.autocomplete;return t&&t.displayWith?t.displayWith(e):e}_assignOptionValue(e){let t=this._getDisplayValue(e);e==null&&this._clearPreviousSelectedOption(null,!1),this._updateNativeInputValue(t??"")}_updateNativeInputValue(e){this._formField?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e}_setValueAndClose(e){let t=this.autocomplete,a=e?e.source:this._pendingAutoselectedOption;a?(this._clearPreviousSelectedOption(a),this._assignOptionValue(a.value),this._onChange(a.value),t._emitSelectEvent(a),this._element.nativeElement.focus()):t.requireSelection&&this._element.nativeElement.value!==this._valueOnAttach&&(this._clearPreviousSelectedOption(null),this._assignOptionValue(null),this._onChange(null)),this.closePanel()}_clearPreviousSelectedOption(e,t){this.autocomplete?.options?.forEach(a=>{a!==e&&a.selected&&a.deselect(t)})}_openPanelInternal(e=this._element.nativeElement.value){if(this._attachOverlay(e),this._floatLabel(),this._trackedModal){let t=this.autocomplete.id;et(this._trackedModal,"aria-owns",t)}}_attachOverlay(e){this.autocomplete;let t=this._overlayRef;t?(this._positionStrategy.setOrigin(this._getConnectedElement()),t.updateSize({width:this._getPanelWidth()})):(this._portal=new en(this.autocomplete.template,this._viewContainerRef,{id:this._formField?.getLabelId()}),t=this._overlay.create(this._getOverlayConfig()),this._overlayRef=t,this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&t&&t.updateSize({width:this._getPanelWidth()})}),this._handsetLandscapeSubscription=this._breakpointObserver.observe(_n.HandsetLandscape).subscribe(d=>{d.matches?this._positionStrategy.withFlexibleDimensions(!0).withGrowAfterOpen(!0).withViewportMargin(8):this._positionStrategy.withFlexibleDimensions(!1).withGrowAfterOpen(!1).withViewportMargin(0)})),t&&!t.hasAttached()&&(t.attach(this._portal),this._valueOnAttach=e,this._valueOnLastKeydown=null,this._closingActionsSubscription=this._subscribeToClosingActions());let a=this.panelOpen;this.autocomplete._isOpen=this._overlayAttached=!0,this.autocomplete._latestOpeningTrigger=this,this.autocomplete._setColor(this._formField?.color),this._updatePanelState(),this._applyModalPanelOwnership(),this.panelOpen&&a!==this.panelOpen&&this._emitOpened()}_handlePanelKeydown=e=>{(e.keyCode===27&&!ge(e)||e.keyCode===38&&ge(e,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(this._valueBeforeAutoSelection??""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),e.stopPropagation(),e.preventDefault())};_updatePanelState(){if(this.autocomplete._setVisibility(),this.panelOpen){let e=this._overlayRef;this._keydownSubscription||(this._keydownSubscription=e.keydownEvents().subscribe(this._handlePanelKeydown)),this._outsideClickSubscription||(this._outsideClickSubscription=e.outsidePointerEvents().subscribe())}else this._keydownSubscription?.unsubscribe(),this._outsideClickSubscription?.unsubscribe(),this._keydownSubscription=this._outsideClickSubscription=null}_getOverlayConfig(){return new on({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir??void 0,hasBackdrop:this._defaults?.hasBackdrop,backdropClass:this._defaults?.backdropClass,panelClass:this._defaults?.overlayPanelClass})}_getOverlayPosition(){let e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){let t=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],a=this._aboveClass,d=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:a},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:a}],p;this.position==="above"?p=d:this.position==="below"?p=t:p=[...t,...d],e.withPositions(p)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){let e=this.autocomplete;if(e.autoActiveFirstOption){let t=-1;for(let a=0;a<e.options.length;a++)if(!e.options.get(a).disabled){t=a;break}e._keyManager.setActiveItem(t)}else e._keyManager.setActiveItem(-1)}_canOpen(){let e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_scrollToOption(e){let t=this.autocomplete,a=qt(e,t.options,t.optionGroups);if(e===0&&a===1)t._setScrollTop(0);else if(t.panel){let d=t.options.toArray()[e];if(d){let p=d._getHostElement(),P=Qt(p.offsetTop,p.offsetHeight,t._getScrollTop(),t.panel.nativeElement.offsetHeight);t._setScrollTop(P)}}}_trackedModal=null;_applyModalPanelOwnership(){let e=this._element.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!e)return;let t=this.autocomplete.id;this._trackedModal&&ue(this._trackedModal,"aria-owns",t),et(e,"aria-owns",t),this._trackedModal=e}_clearFromModal(){if(this._trackedModal){let e=this.autocomplete.id;ue(this._trackedModal,"aria-owns",e),this._trackedModal=null}}static \u0275fac=function(t){return new(t||s)};static \u0275dir=kt({type:s,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-mdc-autocomplete-trigger"],hostVars:7,hostBindings:function(t,a){t&1&&_("focusin",function(){return a._handleFocus()})("blur",function(){return a._onTouched()})("input",function(p){return a._handleInput(p)})("keydown",function(p){return a._handleKeydown(p)})("click",function(){return a._handleClick()}),t&2&&qe("autocomplete",a.autocompleteAttribute)("role",a.autocompleteDisabled?null:"combobox")("aria-autocomplete",a.autocompleteDisabled?null:"list")("aria-activedescendant",a.panelOpen&&a.activeOption?a.activeOption.id:null)("aria-expanded",a.autocompleteDisabled?null:a.panelOpen.toString())("aria-controls",a.autocompleteDisabled||!a.panelOpen||a.autocomplete==null?null:a.autocomplete.id)("aria-haspopup",a.autocompleteDisabled?null:"listbox")},inputs:{autocomplete:[0,"matAutocomplete","autocomplete"],position:[0,"matAutocompletePosition","position"],connectedTo:[0,"matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:[0,"autocomplete","autocompleteAttribute"],autocompleteDisabled:[2,"matAutocompleteDisabled","autocompleteDisabled",z]},exportAs:["matAutocompleteTrigger"],features:[ae([pi]),Ct]})}return s})(),jn=(()=>{class s{static \u0275fac=function(t){return new(t||s)};static \u0275mod=At({type:s});static \u0275inj=bt({providers:[ui],imports:[rn,nt,tt,nn,nt,tt]})}return s})();var je=class s{http=g(Vt);config=g(sn);getApiUrl(n){return this.config.getApiUrl(`/users${n}`)}getAllUsers(n){let e={};return n?.isActive!==void 0&&(e.isActive=n.isActive.toString()),n?.search&&(e.search=n.search),n?.limit&&(e.limit=n.limit.toString()),n?.offset&&(e.offset=n.offset.toString()),this.http.get(this.getApiUrl(""),{params:e})}getAllUsersAsync(n){return y(this,null,function*(){let e=yield He(this.getAllUsers(n));if(!e.success||!e.data)throw new Error(e.error||"Failed to fetch users");return e.data})}getUserById(n){return this.http.get(this.getApiUrl(`/${n}`))}getUserByIdAsync(n){return y(this,null,function*(){let e=yield He(this.getUserById(n));if(!e.success||!e.data)throw new Error(e.error||"Failed to fetch user");return e.data})}static \u0275fac=function(e){return new(e||s)};static \u0275prov=yt({token:s,factory:s.\u0275fac,providedIn:"root"})};function _i(s,n){s&1&&(o(0,"div",50)(1,"mat-icon",51),r(2,"star"),i()())}function hi(s,n){s&1&&(o(0,"mat-option",52)(1,"div",53)(2,"mat-icon",54),r(3,"hourglass_empty"),i(),o(4,"span"),r(5,"Loading users..."),i()()())}function xi(s,n){if(s&1&&(o(0,"mat-option",52)(1,"div",55)(2,"mat-icon",44),r(3,"search_off"),i(),o(4,"span"),r(5),i()()()),s&2){let e=m();l(5),f('No users found for "',e.userSearchControl.value,'"')}}function vi(s,n){s&1&&(o(0,"mat-option",52)(1,"div",55)(2,"mat-icon",44),r(3,"search"),i(),o(4,"span"),r(5,"Type at least 2 characters to search"),i()()())}function yi(s,n){if(s&1&&(o(0,"mat-option",56)(1,"div",57)(2,"div",58),r(3),i(),o(4,"div",59)(5,"div",60),r(6),i(),o(7,"div",61),r(8),i(),o(9,"div",62),r(10),i()(),o(11,"div",63),r(12," Available "),i()()()),s&2){let e=n.$implicit,t=m();c("value",e),l(3),f(" ",t.getUserInitials(e)," "),l(3),v(t.getUserDisplayName(e)),l(2),v(e.email),l(2),v(e.username)}}function bi(s,n){s&1&&(o(0,"mat-error"),r(1," Please select a user to assign to this role "),i())}function Mi(s,n){s&1&&(o(0,"mat-hint"),r(1,"Searching users..."),i())}function Ci(s,n){if(s&1&&(o(0,"mat-hint"),r(1),i()),s&2){let e=m();l(),A("",e.filteredUsers().length," available user",e.filteredUsers().length===1?"":"s","")}}function Pi(s,n){if(s&1&&(o(0,"mat-hint"),r(1),i()),s&2){let e=m();l(),f('No users found for "',e.userSearchControl.value,'"')}}function Oi(s,n){s&1&&(o(0,"mat-hint"),r(1,"Type at least 2 characters to search for users"),i())}function Si(s,n){if(s&1&&(o(0,"mat-error"),r(1),i()),s&2){let e,t=m();l(),f(" ",(e=t.assignForm.get("expires_at"))==null||e.errors==null||e.errors.pastDate==null?null:e.errors.pastDate.message," ")}}function wi(s,n){s&1&&(o(0,"mat-icon",64),r(1,"hourglass_empty"),i())}function Ri(s,n){s&1&&(o(0,"mat-icon"),r(1,"person_add"),i())}function Ei(s,n){s&1&&(o(0,"div",65),b(1,"mat-progress-spinner",66),o(2,"p",67),r(3,"Loading assigned users..."),i()())}function Ai(s,n){s&1&&(o(0,"div",68)(1,"div",69)(2,"mat-icon",70),r(3,"group_off"),i()(),o(4,"h4",71),r(5,"No users assigned"),i(),o(6,"p",72),r(7,"This role hasn't been assigned to any users yet."),i(),o(8,"p",73),r(9,"Use the form above to assign your first user to this role."),i()())}function ki(s,n){if(s&1&&(o(0,"span",10)(1,"mat-icon",82),r(2,"event"),i(),r(3),i()),s&2){let e=m().$implicit,t=m(2);oe("text-orange-600",t.isExpiringSoon(e)),l(3),f(" Expires ",t.formatDate(e.expires_at)," ")}}function Ii(s,n){if(s&1&&(o(0,"span",91)(1,"mat-icon",92),r(2,"note"),i()()),s&2){let e=m().$implicit;Dt("matTooltip",e.notes)}}function Ti(s,n){if(s&1){let e=M();o(0,"button",93),_("click",function(){h(e);let a=m().$implicit,d=m(2);return x(d.extendExpiry(a))}),o(1,"mat-icon",90),r(2,"schedule"),i()()}}function Fi(s,n){if(s&1){let e=M();o(0,"div",76)(1,"div",77)(2,"div",3)(3,"div",4)(4,"div",78),r(5),i(),b(6,"div",79),i(),o(7,"div",59)(8,"h4",20),r(9),i(),o(10,"p",80),r(11),i(),o(12,"div",81)(13,"span",10)(14,"mat-icon",82),r(15,"schedule"),i(),r(16),i(),u(17,ki,4,3,"span",83),i()()(),o(18,"div",41)(19,"div",37)(20,"span",84),b(21,"div",85),r(22),i(),u(23,Ii,3,1,"span",86),i(),o(24,"div",87),u(25,Ti,3,0,"button",88),o(26,"button",89),_("click",function(){let a=h(e).$implicit,d=m(2);return x(d.removeUserFromRole(a))}),o(27,"mat-icon",90),r(28,"person_remove"),i()()()()()()}if(s&2){let e,t=n.$implicit,a=m(2);l(5),f(" ",a.getUserInitials(a.getUser(t))," "),l(),w(a.getStatusClass(t)==="active"?"bg-green-500":a.getStatusClass(t)==="expiring"?"bg-yellow-500":"bg-red-500"),l(3),v(a.getUserDisplayName(a.getUser(t))),l(2),v((e=a.getUser(t))==null?null:e.email),l(5),f(" Assigned ",a.formatDate(t.assigned_at||t.createdAt)," "),l(),c("ngIf",t.expires_at),l(3),w(a.getStatusClass(t)==="active"?"bg-green-100 text-green-700 border border-green-200":a.getStatusClass(t)==="expiring"?"bg-orange-100 text-orange-700 border border-orange-200":a.getStatusClass(t)==="expired"?"bg-red-100 text-red-700 border border-red-200":"bg-gray-100 text-gray-700 border border-gray-200"),l(),w(a.getStatusClass(t)==="active"?"bg-green-500":a.getStatusClass(t)==="expiring"?"bg-orange-500":a.getStatusClass(t)==="expired"?"bg-red-500":"bg-gray-500"),l(),f(" ",a.getStatusText(t)," "),l(),c("ngIf",t.notes),l(2),c("ngIf",t.expires_at&&a.isExpiringSoon(t))}}function Ui(s,n){if(s&1&&(o(0,"div",74),u(1,Fi,29,14,"div",75),i()),s&2){let e=m();l(),c("ngForOf",e.roleUsers())("ngForTrackBy",e.trackByUserRole)}}var Be=class s{constructor(n){this.data=n;this.assignForm=this.fb.group({user_id:["",E.required],expires_at:["",[this.futureDateValidator]],notes:[""]}),this.setupUserSearch()}roleService=g(W);userService=g(je);authService=g(ln);authorizationService=g(an);fb=g(q);snackBar=g(te);dialogRef=g(Z);searchSubscription;roleUsers=C([]);allUsers=C([]);filteredUsers=C([]);assignForm;isLoading=!1;isLoadingUsers=!1;isAssigning=!1;userSearchControl=this.fb.control("");minDate=new Date;availableUsers=Lt(()=>{let n=this.roleUsers().map(e=>typeof e.user_id=="object"&&e.user_id!==null&&"_id"in e.user_id?e.user_id._id:e.user_id?.toString()||"");return this.allUsers().filter(e=>e.isActive!==!1&&!n.includes(e._id))});ngOnInit(){return y(this,null,function*(){yield this.loadRoleUsers()})}ngOnDestroy(){this.searchSubscription?.unsubscribe()}setupUserSearch(){this.searchSubscription=this.userSearchControl.valueChanges.pipe(gt(300),_t(),H(n=>{let e=(n||"").trim();return!e||e.length<2?(this.isLoadingUsers=!1,G({success:!0,data:[]})):(this.isLoadingUsers=!0,this.userService.getAllUsers({isActive:!0,search:e,limit:50}).pipe(pt(t=>(console.error("Search failed:",t),this.isLoadingUsers=!1,G({success:!1,data:[]})))))})).subscribe(n=>{this.isLoadingUsers=!1,n.success&&n.data?(this.allUsers.set(n.data),this.filteredUsers.set(this.availableUsers())):(this.allUsers.set([]),this.filteredUsers.set([]))})}searchUsers(n){return y(this,null,function*(){try{let e=n.trim();if(!e||e.length<2){this.allUsers.set([]),this.filteredUsers.set([]);return}this.isLoadingUsers=!0;let t=yield this.userService.getAllUsersAsync({isActive:!0,search:e,limit:50});console.log("Loaded users from API:",t),this.allUsers.set(t||[]),this.filteredUsers.set(this.availableUsers())}catch(e){console.error("Failed to load users:",e),this.allUsers.set([]),this.filteredUsers.set([])}finally{this.isLoadingUsers=!1}})}loadRoleUsers(){return y(this,null,function*(){try{this.isLoading=!0,console.log("Loading users for role:",this.data.role._id);let n=yield this.roleService.getRoleUsersAsync(this.data.role._id);console.log("Loaded role users:",n),this.roleUsers.set(n),this.filteredUsers.set(this.availableUsers())}catch(n){console.error("Failed to load role users:",n),this.snackBar.open("Failed to load role users","Close",{duration:3e3}),this.roleUsers.set([])}finally{this.isLoading=!1}})}assignUserToRole(){return y(this,null,function*(){if(this.assignForm.invalid){console.log("Form is invalid:",this.assignForm.errors);return}try{this.isAssigning=!0;let n=this.assignForm.value;console.log("Form values:",n);let e={user_id:n.user_id,role_id:this.data.role._id,expires_at:n.expires_at?new Date(n.expires_at):void 0,notes:n.notes?.trim()||void 0};console.log("Assignment data:",e),yield this.roleService.assignRoleAsync(e),this.snackBar.open("User assigned to role successfully","Close",{duration:3e3}),this.assignForm.reset(),this.userSearchControl.setValue(""),yield this.loadRoleUsers();let t=this.authService.user();t&&t._id===e.user_id&&(console.log("Refreshing permissions for current user after role assignment"),yield this.authorizationService.refreshPermissions(t._id),this.snackBar.open("Your permissions have been updated!","Close",{duration:3e3}))}catch(n){console.error("Failed to assign user:",n),this.snackBar.open(n.message||"Failed to assign user to role","Close",{duration:5e3})}finally{this.isAssigning=!1}})}removeUserFromRole(n){return y(this,null,function*(){let e=this.getUser(n),t=this.getUserDisplayName(e);if(confirm(`Are you sure you want to remove "${t}" from the role "${this.data.role.display_name||this.data.role.name}"?`))try{let a=typeof n.user_id=="object"&&n.user_id!==null&&"_id"in n.user_id?n.user_id._id:n.user_id?.toString()||"";yield this.roleService.removeRoleAsync(a,this.data.role._id),this.snackBar.open("User removed from role successfully","Close",{duration:3e3});let d=this.authService.currentUser;d&&d._id===a&&(console.log("Current user was removed from role, refreshing permissions..."),this.authorizationService.loadUserPermissions(a)),yield this.loadRoleUsers()}catch(a){console.error("Failed to remove user:",a),this.snackBar.open(a.message||"Failed to remove user from role","Close",{duration:5e3})}})}extendExpiry(n){return y(this,null,function*(){console.log("Extend expiry for:",n),this.snackBar.open("Extend expiry functionality coming soon","Close",{duration:3e3})})}displayUser=n=>n?`${this.getUserDisplayName(n)} (${n.email})`:"";onUserSelected(n){let e=n.option.value;e&&this.assignForm.patchValue({user_id:e._id})}getUserById(n){return this.allUsers().find(e=>e._id===n.toString())}getUser(n){return n.user_id&&typeof n.user_id=="object"&&"_id"in n.user_id?n.user_id:this.getUserById(n.user_id)}getUserDisplayName(n){if(!n)return"Unknown User";let e=n.first_name||n.firstName||"",t=n.last_name||n.lastName||"";return`${e} ${t}`.trim()||n.username||n.email}getUserInitials(n){if(!n)return"UK";let e=n.first_name||n.firstName||n.username||""||n.email||"U",t=n.last_name||n.lastName||(n.username||"").charAt(1)||n.email||"K";return`${e.charAt(0)}${t.charAt(0)}`.toUpperCase()}getPermissionCount(){return Array.isArray(this.data.role.permissions)?this.data.role.permissions.length:0}isExpiringSoon(n){if(!n.expires_at)return!1;let e=new Date(n.expires_at),t=new Date,a=Math.ceil((e.getTime()-t.getTime())/(1e3*60*60*24));return a<=7&&a>0}getStatusClass(n){if(!n.is_active)return"inactive";if(n.expires_at){if(new Date(n.expires_at)<new Date)return"expired";if(this.isExpiringSoon(n))return"expiring"}return"active"}getStatusText(n){switch(this.getStatusClass(n)){case"inactive":return"Inactive";case"expired":return"Expired";case"expiring":return"Expiring Soon";default:return"Active"}}formatDate(n){return n?new Date(n).toLocaleDateString():"N/A"}futureDateValidator(n){if(!n.value)return null;let e=new Date(n.value),t=new Date;return t.setHours(0,0,0,0),e<t?{pastDate:{message:"Expiry date cannot be in the past"}}:null}openDatePicker(n){n.open()}trackByUserRole(n,e){return e._id}static \u0275fac=function(e){return new(e||s)(O(J))};static \u0275cmp=S({type:s,selectors:[["app-role-users-modal"]],features:[ae([Zt()])],decls:98,vars:35,consts:[["userAutocomplete","matAutocomplete"],["picker",""],["mat-dialog-title","",1,"flex!","items-center!","justify-between!","p-6!","border-b!","border-gray-200!"],[1,"flex","items-center","space-x-4"],[1,"relative"],[1,"w-14","h-14","rounded-2xl","flex","items-center","justify-center","text-white","shadow-lg"],[1,"text-2xl"],["class","absolute -top-1 -right-1 w-6 h-6 bg-amber-400 rounded-full flex items-center justify-center",4,"ngIf"],[1,"text-2xl","font-bold","text-gray-900","mb-1"],[1,"flex","items-center","space-x-4","text-sm","text-gray-600"],[1,"flex","items-center"],[1,"w-4","h-4","mr-1"],["mat-icon-button","","mat-dialog-close","",1,"text-gray-400","hover:text-gray-600"],[1,"p-0","max-h-[70vh]","overflow-y-auto"],[1,"p-6","bg-gradient-to-r","from-blue-50","via-indigo-50","to-purple-50","border-b","border-gray-100"],[1,"max-w-4xl","mx-auto"],[1,"bg-white","rounded-2xl","shadow-sm","border","border-gray-200","p-6"],[1,"flex","items-center","space-x-3","mb-6"],[1,"w-10","h-10","bg-gradient-to-r","from-blue-500","to-indigo-600","rounded-xl","flex","items-center","justify-center"],[1,"text-white"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],["appearance","outline",1,"w-full"],["matInput","","placeholder","Type to search users...",3,"formControl","matAutocomplete","disabled"],[3,"optionSelected","displayWith"],["disabled","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["appearance","outline",1,"w-full","date-picker-field"],["matInput","","formControlName","expires_at","placeholder","Click to select date","readonly","",3,"click","focus","matDatepicker","min"],["matIconSuffix","",3,"click","for"],["startView","month"],["matInput","","formControlName","notes","rows","3","placeholder","Add any notes about this role assignment..."],[1,"flex","justify-end"],["mat-raised-button","","type","submit",1,"px-8","py-3","bg-gradient-to-r","from-blue-600","to-indigo-600","hover:from-blue-700","hover:to-indigo-700","text-white","font-semibold","rounded-xl","shadow-lg","transform","transition-all","duration-200","hover:scale-105",3,"disabled"],[1,"flex","items-center","space-x-2"],["class","animate-spin",4,"ngIf"],[1,"p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","space-x-3"],[1,"w-10","h-10","bg-gradient-to-r","from-purple-500","to-pink-600","rounded-xl","flex","items-center","justify-center"],["mat-stroked-button","",1,"flex","items-center","space-x-2","px-4","py-2","border","border-gray-300","rounded-lg","hover:bg-gray-50","transition-colors",3,"click","disabled"],[1,"w-4","h-4"],["class","flex flex-col items-center justify-center py-12 space-y-4",4,"ngIf"],["class","text-center py-16 bg-gray-50 rounded-2xl border-2 border-dashed border-gray-300",4,"ngIf"],["class","grid gap-4",4,"ngIf"],[1,"flex","justify-end","p-6","border-t","border-gray-200","bg-gray-50"],["mat-stroked-button","","mat-dialog-close","",1,"px-6","py-2","border","border-gray-300","text-gray-700","rounded-lg","hover:bg-white","transition-colors"],[1,"absolute","-top-1","-right-1","w-6","h-6","bg-amber-400","rounded-full","flex","items-center","justify-center"],[1,"text-xs","text-white"],["disabled",""],[1,"flex","items-center","space-x-2","py-2"],[1,"animate-spin","w-4","h-4"],[1,"flex","items-center","space-x-2","py-2","text-gray-500"],[3,"value"],[1,"flex","items-center","space-x-3","py-2"],[1,"w-8","h-8","bg-gradient-to-r","from-purple-400","to-pink-500","rounded-full","flex","items-center","justify-center","text-white","text-sm","font-semibold"],[1,"flex-1","min-w-0"],[1,"font-medium","text-gray-900"],[1,"text-sm","text-gray-500","truncate"],[1,"text-xs","text-gray-400"],[1,"text-xs","text-green-600","bg-green-100","px-2","py-1","rounded-full"],[1,"animate-spin"],[1,"flex","flex-col","items-center","justify-center","py-12","space-y-4"],["diameter","48",1,"text-blue-600"],[1,"text-gray-600","font-medium"],[1,"text-center","py-16","bg-gray-50","rounded-2xl","border-2","border-dashed","border-gray-300"],[1,"w-16","h-16","mx-auto","bg-gray-200","rounded-full","flex","items-center","justify-center","mb-4"],[1,"text-3xl","text-gray-400"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600","mb-4"],[1,"text-sm","text-gray-500"],[1,"grid","gap-4"],["class","bg-white rounded-2xl border border-gray-200 p-6 hover:shadow-lg transition-all duration-200 hover:border-gray-300",4,"ngFor","ngForOf","ngForTrackBy"],[1,"bg-white","rounded-2xl","border","border-gray-200","p-6","hover:shadow-lg","transition-all","duration-200","hover:border-gray-300"],[1,"flex","items-center","justify-between"],[1,"w-12","h-12","bg-gradient-to-r","from-indigo-500","to-purple-600","rounded-xl","flex","items-center","justify-center","text-white","font-bold","text-lg"],[1,"absolute","-bottom-1","-right-1","w-4","h-4","rounded-full","border-2","border-white"],[1,"text-sm","text-gray-600","mb-2"],[1,"flex","items-center","space-x-4","text-xs","text-gray-500"],[1,"w-3","h-3","mr-1"],["class","flex items-center",3,"text-orange-600",4,"ngIf"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-xs","font-medium"],[1,"w-1.5","h-1.5","rounded-full","mr-1.5"],["class","inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700 cursor-help",3,"matTooltip",4,"ngIf"],[1,"flex","items-center","space-x-1"],["mat-icon-button","","matTooltip","Extend Expiry","class","text-orange-600 hover:bg-orange-50",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Remove User from Role",1,"text-red-600","hover:bg-red-50",3,"click"],[1,"w-5","h-5"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-blue-100","text-blue-700","cursor-help",3,"matTooltip"],[1,"w-3","h-3"],["mat-icon-button","","matTooltip","Extend Expiry",1,"text-orange-600","hover:bg-orange-50",3,"click"]],template:function(e,t){if(e&1){let a=M();o(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"mat-icon",6),r(5),i()(),u(6,_i,3,0,"div",7),i(),o(7,"div")(8,"h2",8),r(9),i(),o(10,"div",9)(11,"span",10)(12,"mat-icon",11),r(13,"people"),i(),r(14),i(),o(15,"span",10)(16,"mat-icon",11),r(17,"security"),i(),r(18),i()()()(),o(19,"button",12)(20,"mat-icon"),r(21,"close"),i()()(),o(22,"mat-dialog-content",13)(23,"div",14)(24,"div",15)(25,"div",16)(26,"div",17)(27,"div",18)(28,"mat-icon",19),r(29,"person_add"),i()(),o(30,"div")(31,"h3",20),r(32,"Add User to Role"),i(),o(33,"p",21),r(34,"Assign a new user to this role with optional settings"),i()()(),o(35,"form",22),_("ngSubmit",function(){return h(a),x(t.assignUserToRole())}),o(36,"div",23)(37,"mat-form-field",24)(38,"mat-label"),r(39,"Search and Select User"),i(),b(40,"input",25),o(41,"mat-autocomplete",26,0),_("optionSelected",function(p){return h(a),x(t.onUserSelected(p))}),u(43,hi,6,0,"mat-option",27)(44,xi,6,1,"mat-option",27)(45,vi,6,0,"mat-option",27)(46,yi,13,5,"mat-option",28),i(),u(47,bi,2,0,"mat-error",29)(48,Mi,2,0,"mat-hint",29)(49,Ci,2,2,"mat-hint",29)(50,Pi,2,1,"mat-hint",29)(51,Oi,2,0,"mat-hint",29),i(),o(52,"mat-form-field",30)(53,"mat-label"),r(54,"Expiry Date (Optional)"),i(),o(55,"input",31),_("click",function(){h(a);let p=R(58);return x(t.openDatePicker(p))})("focus",function(){h(a);let p=R(58);return x(t.openDatePicker(p))}),i(),o(56,"mat-datepicker-toggle",32),_("click",function(){h(a);let p=R(58);return x(t.openDatePicker(p))}),i(),b(57,"mat-datepicker",33,1),u(59,Si,2,1,"mat-error",29),o(60,"mat-hint"),r(61,"Leave empty for permanent assignment (cannot select past dates)"),i()()(),o(62,"mat-form-field",24)(63,"mat-label"),r(64,"Assignment Notes (Optional)"),i(),b(65,"textarea",34),o(66,"mat-hint"),r(67,"Optional notes about why this user is being assigned this role"),i()(),o(68,"div",35)(69,"button",36)(70,"div",37),u(71,wi,2,0,"mat-icon",38)(72,Ri,2,0,"mat-icon",29),o(73,"span"),r(74),i()()()()()()()(),o(75,"div",39)(76,"div",15)(77,"div",40)(78,"div",41)(79,"div",42)(80,"mat-icon",19),r(81,"group"),i()(),o(82,"div")(83,"h3",20),r(84,"Assigned Users"),i(),o(85,"p",21),r(86,"Users currently assigned to this role"),i()()(),o(87,"button",43),_("click",function(){return h(a),x(t.loadRoleUsers())}),o(88,"mat-icon",44),r(89,"refresh"),i(),o(90,"span"),r(91,"Refresh"),i()()(),u(92,Ei,4,0,"div",45)(93,Ai,10,0,"div",46)(94,Ui,2,2,"div",47),i()()(),o(95,"mat-dialog-actions",48)(96,"button",49),r(97," Close "),i()()}if(e&2){let a,d,p=R(42),P=R(58);l(3),pe("background","linear-gradient(135deg, "+(t.data.role.color||"#6366f1")+", "+(t.data.role.color||"#6366f1")+"cc)"),l(2),v(t.data.role.is_system_role?"security":"admin_panel_settings"),l(),c("ngIf",t.data.role.is_system_role),l(3),v(t.data.role.display_name||t.data.role.name),l(5),f(" ",t.roleUsers().length," users assigned "),l(4),f(" ",t.getPermissionCount()," permissions "),l(17),c("formGroup",t.assignForm),l(5),c("formControl",t.userSearchControl)("matAutocomplete",p)("disabled",t.isLoadingUsers),l(),c("displayWith",t.displayUser),l(2),c("ngIf",t.isLoadingUsers),l(),c("ngIf",!t.isLoadingUsers&&t.filteredUsers().length===0&&t.userSearchControl.value&&t.userSearchControl.value.length>=2),l(),c("ngIf",!t.isLoadingUsers&&t.filteredUsers().length===0&&(!t.userSearchControl.value||t.userSearchControl.value.length<2)),l(),c("ngForOf",t.filteredUsers()),l(),c("ngIf",(a=t.assignForm.get("user_id"))==null?null:a.hasError("required")),l(),c("ngIf",t.isLoadingUsers),l(),c("ngIf",!t.isLoadingUsers&&t.filteredUsers().length>0),l(),c("ngIf",!t.isLoadingUsers&&t.filteredUsers().length===0&&t.userSearchControl.value&&t.userSearchControl.value.length>=2),l(),c("ngIf",!t.isLoadingUsers&&t.filteredUsers().length===0&&(!t.userSearchControl.value||t.userSearchControl.value.length<2)),l(4),c("matDatepicker",P)("min",t.minDate),l(),c("for",P),l(3),c("ngIf",(d=t.assignForm.get("expires_at"))==null?null:d.hasError("pastDate")),l(10),c("disabled",t.assignForm.invalid||t.isAssigning||t.isLoadingUsers),l(2),c("ngIf",t.isAssigning),l(),c("ngIf",!t.isAssigning),l(2),v(t.isAssigning?"Assigning User...":"Assign User to Role"),l(13),c("disabled",t.isLoading),l(),oe("animate-spin",t.isLoading),l(4),c("ngIf",t.isLoading),l(),c("ngIf",!t.isLoading&&t.roleUsers().length===0),l(),c("ngIf",!t.isLoading&&t.roleUsers().length>0)}},dependencies:[T,k,I,X,be,L,V,ve,pn,Me,Ce,Le,Mn,Fe,De,Ue,D,_e,Jt,U,F,N,Re,Pe,Se,Oe,we,Ee,fe,j,Ae,jn,Vn,lt,kn,Rn,En,An,Xt,Ne,xn,B,Te,xe,ee,Ie,vn],styles:[".role-users-modal[_ngcontent-%COMP%]{min-width:700px;max-width:900px}.role-users-modal[_ngcontent-%COMP%]   .dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:24px;border-bottom:1px solid var(--mat-divider-color);margin:-24px -24px 0}.role-users-modal[_ngcontent-%COMP%]   .dialog-header[_ngcontent-%COMP%]   .role-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.role-users-modal[_ngcontent-%COMP%]   .dialog-header[_ngcontent-%COMP%]   .role-info[_ngcontent-%COMP%]   .role-badge[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff}.role-users-modal[_ngcontent-%COMP%]   .dialog-header[_ngcontent-%COMP%]   .role-info[_ngcontent-%COMP%]   .role-badge[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:28px;width:28px;height:28px}.role-users-modal[_ngcontent-%COMP%]   .dialog-header[_ngcontent-%COMP%]   .role-info[_ngcontent-%COMP%]   .role-details[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:600;color:var(--mat-text-primary)}.role-users-modal[_ngcontent-%COMP%]   .dialog-header[_ngcontent-%COMP%]   .role-info[_ngcontent-%COMP%]   .role-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0 0;font-size:14px;color:var(--mat-text-secondary)}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]{padding:0;margin:0;max-height:70vh;overflow-y:auto}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .add-user-card[_ngcontent-%COMP%]{margin:24px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .add-user-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:18px;font-weight:600}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .add-user-card[_ngcontent-%COMP%]   .assign-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:16px;margin-bottom:16px}@media (max-width: 768px){.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .add-user-card[_ngcontent-%COMP%]   .assign-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .add-user-card[_ngcontent-%COMP%]   .assign-form[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .add-user-card[_ngcontent-%COMP%]   .assign-form[_ngcontent-%COMP%]   .user-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px 0}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .add-user-card[_ngcontent-%COMP%]   .assign-form[_ngcontent-%COMP%]   .user-option[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;color:#fff;font-size:12px;font-weight:600}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .add-user-card[_ngcontent-%COMP%]   .assign-form[_ngcontent-%COMP%]   .user-option[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-weight:500;color:var(--mat-text-primary)}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .add-user-card[_ngcontent-%COMP%]   .assign-form[_ngcontent-%COMP%]   .user-option[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-email[_ngcontent-%COMP%]{font-size:12px;color:var(--mat-text-secondary)}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .add-user-card[_ngcontent-%COMP%]   .assign-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:24px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .add-user-card[_ngcontent-%COMP%]   .assign-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   .loading-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]{padding:0 24px 24px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin:0;font-size:18px;font-weight:600;color:var(--mat-text-primary)}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;gap:16px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--mat-text-secondary);margin:0}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;text-align:center}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;color:var(--mat-text-disabled);margin-bottom:16px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 8px;font-size:18px;font-weight:500;color:var(--mat-text-primary)}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--mat-text-secondary)}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:16px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px;flex:1}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-avatar-large[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;color:#fff;font-size:16px;font-weight:600;flex-shrink:0}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 4px;font-size:16px;font-weight:600;color:var(--mat-text-primary)}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-email[_ngcontent-%COMP%]{margin:0 0 8px;font-size:14px;color:var(--mat-text-secondary)}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .assignment-info[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;font-size:12px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .assignment-info[_ngcontent-%COMP%]   .assigned-date[_ngcontent-%COMP%], .role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .assignment-info[_ngcontent-%COMP%]   .expires-date[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:var(--mat-text-secondary)}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .assignment-info[_ngcontent-%COMP%]   .assigned-date[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .assignment-info[_ngcontent-%COMP%]   .expires-date[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .assignment-info[_ngcontent-%COMP%]   .expires-date.expires-soon[_ngcontent-%COMP%]{color:#f57c00}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:12px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]   .status-badges[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;justify-content:flex-end}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]   .status-badges[_ngcontent-%COMP%]   .status-chip[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:11px;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]   .status-badges[_ngcontent-%COMP%]   .status-chip.status-active[_ngcontent-%COMP%]{background-color:#e8f5e8;color:#2e7d32}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]   .status-badges[_ngcontent-%COMP%]   .status-chip.status-inactive[_ngcontent-%COMP%]{background-color:#f3f4f6;color:#6b7280}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]   .status-badges[_ngcontent-%COMP%]   .status-chip.status-expiring[_ngcontent-%COMP%]{background-color:#fff3e0;color:#f57c00}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]   .status-badges[_ngcontent-%COMP%]   .status-chip.status-expired[_ngcontent-%COMP%]{background-color:#ffebee;color:#d32f2f}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]   .status-badges[_ngcontent-%COMP%]   .notes-chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:4px 8px;border-radius:12px;font-size:11px;font-weight:500;background-color:#e3f2fd;color:#1976d2;cursor:help}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]   .status-badges[_ngcontent-%COMP%]   .notes-chip[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:12px;width:12px;height:12px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]{display:flex;gap:4px}.role-users-modal[_ngcontent-%COMP%]   .dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid var(--mat-divider-color);margin:0 -24px -24px;justify-content:flex-end}@media (max-width: 768px){.role-users-modal[_ngcontent-%COMP%]{min-width:95vw}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .add-user-card[_ngcontent-%COMP%]{margin:16px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]{padding:0 16px 16px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:12px}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]{flex-direction:row;align-items:center;justify-content:space-between}.role-users-modal[_ngcontent-%COMP%]   .dialog-content[_ngcontent-%COMP%]   .assigned-users-section[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-assignment[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]   .status-badges[_ngcontent-%COMP%]{justify-content:flex-start}}.mat-mdc-dialog-title[_ngcontent-%COMP%]:before{display:inline-block;width:0;height:40px;content:none!important;vertical-align:0}.date-picker-field[_ngcontent-%COMP%]   .mat-mdc-form-field-input-control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{cursor:pointer}.date-picker-field[_ngcontent-%COMP%]   .mat-mdc-form-field-input-control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:hover{background-color:#00000005}.date-picker-field[_ngcontent-%COMP%]   .mat-datepicker-toggle[_ngcontent-%COMP%]{cursor:pointer}.date-picker-field[_ngcontent-%COMP%]   .mat-datepicker-toggle[_ngcontent-%COMP%]:hover   .mat-datepicker-toggle-default-icon[_ngcontent-%COMP%]{color:var(--mat-primary);transform:scale(1.1);transition:all .2s ease}  .mat-datepicker-content .mat-calendar-body-disabled{color:#0000004d!important;background-color:#0000000d!important;cursor:not-allowed!important}"]})};function Di(s,n){if(s&1){let e=M();o(0,"div",26)(1,"div",4)(2,"div",27),b(3,"div",28),o(4,"div",29)(5,"h4",30),r(6),i(),o(7,"p",31),r(8),i(),o(9,"span",32),r(10),i()()(),o(11,"button",33),_("click",function(){let a=h(e).$implicit,d=m(2);return x(d.removePermission(a._id))}),o(12,"mat-icon",34),r(13,"remove_circle"),i()()()()}if(s&2){let e=n.$implicit,t=m(2);l(6),f(" ",e.name," "),l(2),v(e.description||"No description"),l(2),A(" ",e.module,".",e.action," "),l(),c("disabled",t.isLoading)("title","Remove "+e.name)}}function Li(s,n){if(s&1&&(o(0,"div",24),u(1,Di,14,6,"div",25),i()),s&2){let e=m();l(),c("ngForOf",e.currentPermissions)}}function Vi(s,n){s&1&&(o(0,"div",35)(1,"mat-icon",36),r(2,"security"),i(),o(3,"p",37),r(4,"No permissions assigned"),i(),o(5,"p",38),r(6,"Add permissions from the available list below"),i()())}function Ni(s,n){if(s&1){let e=M();o(0,"div",40)(1,"div",4)(2,"div",27),b(3,"div",41),o(4,"div",29)(5,"h4",42),r(6),i(),o(7,"p",31),r(8),i(),o(9,"span",43),r(10),i()()(),o(11,"button",44),_("click",function(){let a=h(e).$implicit,d=m(2);return x(d.addPermission(a._id))}),o(12,"mat-icon",34),r(13,"add_circle"),i()()()()}if(s&2){let e=n.$implicit,t=m(2);l(6),f(" ",e.name," "),l(2),v(e.description||"No description"),l(2),A(" ",e.module,".",e.action," "),l(),c("disabled",t.isLoading)("title","Add "+e.name)}}function ji(s,n){if(s&1&&(o(0,"div",24),u(1,Ni,14,6,"div",39),i()),s&2){let e=m();l(),c("ngForOf",e.filteredAvailablePermissions)}}function Bi(s,n){if(s&1&&(o(0,"div",35)(1,"mat-icon",36),r(2,"done_all"),i(),o(3,"p",37),r(4),i(),o(5,"p",38),r(6),i()()),s&2){let e=m();l(4),f(" ",e.searchTerm?"No matching permissions found":"All permissions are already assigned"," "),l(2),f(" ",e.searchTerm?"Try adjusting your search terms":"This role has all available permissions"," ")}}function Wi(s,n){s&1&&(o(0,"div",45)(1,"div",46)(2,"div",47)(3,"mat-icon",48),r(4,"refresh"),i(),o(5,"span",49),r(6,"Updating permissions..."),i()()()())}var We=class s{constructor(n,e){this.dialogRef=n;this.data=e}roleService=g(W);snackBar=g(te);currentPermissions=[];availablePermissions=[];filteredAvailablePermissions=[];searchTerm="";isLoading=!1;ngOnInit(){this.loadPermissions()}loadPermissions(){this.currentPermissions=this.getRolePermissions(this.data.role),this.availablePermissions=this.getAvailablePermissions(this.data.role),this.filteredAvailablePermissions=[...this.availablePermissions]}getRolePermissions(n){return Array.isArray(n.permissions)?n.permissions.map(e=>typeof e=="string"?this.data.allPermissions.find(t=>t._id===e):e).filter(e=>!!e):[]}getAvailablePermissions(n){let e=this.getRolePermissionIds(n);return this.data.allPermissions.filter(t=>t.is_active&&!e.includes(t._id))}getRolePermissionIds(n){return Array.isArray(n.permissions)?n.permissions.map(e=>typeof e=="string"?e:e._id):[]}filterAvailablePermissions(){if(!this.searchTerm.trim()){this.filteredAvailablePermissions=[...this.availablePermissions];return}let n=this.searchTerm.toLowerCase();this.filteredAvailablePermissions=this.availablePermissions.filter(e=>e.name.toLowerCase().includes(n)||e.description?.toLowerCase().includes(n)||e.module.toLowerCase().includes(n)||e.action.toLowerCase().includes(n))}getGroupedPermissions(n){return n.reduce((e,t)=>{let a=this.getModuleDisplayName(t.module);return e[a]||(e[a]=[]),e[a].push(t),e},{})}getModuleDisplayName(n){return{users:"User Management",businesses:"Business Management",services:"Services Management",categories:"Categories Management",projects:"Projects Management",reviews:"Reviews Management",transactions:"Transactions Management",reports:"Reports & Analytics",analytics:"Analytics",roles:"Roles Management",permissions:"Permissions Management",dashboard:"Dashboard Access",settings:"System Settings",audit:"Audit & Logging"}[n]||n.charAt(0).toUpperCase()+n.slice(1)}getGroupedAvailablePermissions(){return this.getGroupedPermissions(this.filteredAvailablePermissions)}getGroupedCurrentPermissions(){return this.getGroupedPermissions(this.currentPermissions)}getObjectKeys(n){return Object.keys(n)}addPermission(n){return y(this,null,function*(){try{this.isLoading=!0,yield this.roleService.addPermissionsToRoleAsync(this.data.role._id,[n]);let e=this.data.allPermissions.find(t=>t._id===n);e&&(this.currentPermissions.push(e),this.availablePermissions=this.availablePermissions.filter(t=>t._id!==n),this.filterAvailablePermissions(),Array.isArray(this.data.role.permissions)?this.data.role.permissions.push(n):this.data.role.permissions=[n]),this.showSuccessMessage("Permission added successfully")}catch(e){console.error("Add permission error:",e),this.showErrorMessage(e.message||"Failed to add permission")}finally{this.isLoading=!1}})}removePermission(n){return y(this,null,function*(){let e=this.currentPermissions.find(t=>t._id===n);if(e&&confirm(`Remove "${e.name}" from this role?`))try{this.isLoading=!0,yield this.roleService.removePermissionsFromRoleAsync(this.data.role._id,[n]),this.currentPermissions=this.currentPermissions.filter(t=>t._id!==n),this.availablePermissions.push(e),this.availablePermissions.sort((t,a)=>t.name.localeCompare(a.name)),this.filterAvailablePermissions(),Array.isArray(this.data.role.permissions)&&(this.data.role.permissions=this.data.role.permissions.filter(t=>(typeof t=="string"?t:t._id)!==n)),this.showSuccessMessage("Permission removed successfully")}catch(t){console.error("Remove permission error:",t),this.showErrorMessage(t.message||"Failed to remove permission")}finally{this.isLoading=!1}})}closeModal(){this.dialogRef.close()}showSuccessMessage(n){this.snackBar.open(n,"Close",{duration:3e3,horizontalPosition:"right",verticalPosition:"top",panelClass:["success-snackbar"]})}showErrorMessage(n){this.snackBar.open(n,"Close",{duration:5e3,horizontalPosition:"right",verticalPosition:"top",panelClass:["error-snackbar"]})}static \u0275fac=function(e){return new(e||s)(O(Z),O(J))};static \u0275cmp=S({type:s,selectors:[["app-permission-management-modal"]],decls:45,vars:11,consts:[["noCurrentPermissions",""],["noAvailablePermissions",""],[1,"bg-white","overflow-hidden"],[1,"bg-gradient-to-r","from-indigo-600","to-purple-600","text-white","px-8","py-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold"],[1,"text-indigo-100","mt-1"],[1,"p-2","text-indigo-100","hover:text-white","hover:bg-white/20","rounded-lg","transition-colors",3,"click"],[1,"p-8","max-h-[70vh]","overflow-y-auto"],[1,"mb-8"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-lg","font-semibold","text-gray-900","flex","items-center","gap-2"],[1,"text-green-600"],[1,"text-sm","text-gray-500","bg-gray-100","px-3","py-1","rounded-full"],["class","grid gap-3 max-h-60 overflow-y-auto pr-2",4,"ngIf","ngIfElse"],[1,"text-blue-600"],[1,"relative","max-w-xs"],["type","text","placeholder","Search permissions...",1,"w-full","pl-10","pr-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500","text-sm",3,"ngModelChange","input","ngModel"],[1,"absolute","left-3","top-2.5","text-gray-400","text-base"],[1,"border-t","border-gray-200","px-8","py-4","bg-gray-50"],[1,"text-sm","text-gray-600"],[1,"font-medium"],[1,"px-6","py-2","bg-gray-600","text-white","rounded-lg","hover:bg-gray-700","transition-colors",3,"click"],["class","absolute inset-0 bg-black/20 flex items-center justify-center z-50",4,"ngIf"],[1,"grid","gap-3","max-h-60","overflow-y-auto","pr-2"],["class","group bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-4 hover:shadow-md transition-all duration-200",4,"ngFor","ngForOf"],[1,"group","bg-gradient-to-r","from-green-50","to-emerald-50","border","border-green-200","rounded-xl","p-4","hover:shadow-md","transition-all","duration-200"],[1,"flex","items-center","gap-4","flex-1"],[1,"w-3","h-3","rounded-full","bg-gradient-to-r","from-green-400","to-emerald-500"],[1,"flex-1"],[1,"font-semibold","text-gray-900","group-hover:text-green-700","transition-colors"],[1,"text-sm","text-gray-600","mt-1"],[1,"inline-block","text-xs","font-mono","text-green-600","bg-green-100","px-2","py-1","rounded","mt-2"],[1,"p-2","text-red-500","hover:bg-red-50","rounded-lg","transition-colors","opacity-0","group-hover:opacity-100",3,"click","disabled","title"],[1,"text-lg"],[1,"text-center","py-8","bg-gray-50","rounded-xl"],[1,"text-4xl","text-gray-400","mb-2"],[1,"text-gray-600","font-medium"],[1,"text-sm","text-gray-500"],["class","group bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-4 hover:shadow-md transition-all duration-200",4,"ngFor","ngForOf"],[1,"group","bg-gradient-to-r","from-blue-50","to-indigo-50","border","border-blue-200","rounded-xl","p-4","hover:shadow-md","transition-all","duration-200"],[1,"w-3","h-3","rounded-full","bg-gradient-to-r","from-blue-400","to-indigo-500"],[1,"font-semibold","text-gray-900","group-hover:text-blue-700","transition-colors"],[1,"inline-block","text-xs","font-mono","text-blue-600","bg-blue-100","px-2","py-1","rounded","mt-2"],[1,"p-2","text-green-500","hover:bg-green-50","rounded-lg","transition-colors","opacity-0","group-hover:opacity-100",3,"click","disabled","title"],[1,"absolute","inset-0","bg-black/20","flex","items-center","justify-center","z-50"],[1,"bg-white","rounded-xl","p-6","shadow-xl"],[1,"flex","items-center","gap-3"],[1,"animate-spin","text-2xl","text-indigo-600"],[1,"text-gray-700","font-medium"]],template:function(e,t){if(e&1){let a=M();o(0,"div",2)(1,"div",3)(2,"div",4)(3,"div")(4,"h2",5),r(5,"Manage Permissions"),i(),o(6,"p",6),r(7),i()(),o(8,"button",7),_("click",function(){return h(a),x(t.closeModal())}),o(9,"mat-icon"),r(10,"close"),i()()()(),o(11,"div",8)(12,"div",9)(13,"div",10)(14,"h3",11)(15,"mat-icon",12),r(16,"check_circle"),i(),r(17),i(),o(18,"span",13),r(19),i()(),u(20,Li,2,1,"div",14)(21,Vi,7,0,"ng-template",null,0,Ze),i(),o(23,"div")(24,"div",10)(25,"h3",11)(26,"mat-icon",15),r(27,"add_circle"),i(),r(28),i(),o(29,"div",16)(30,"input",17),Y("ngModelChange",function(p){return h(a),K(t.searchTerm,p)||(t.searchTerm=p),x(p)}),_("input",function(){return h(a),x(t.filterAvailablePermissions())}),i(),o(31,"mat-icon",18),r(32,"search"),i()()(),u(33,ji,2,1,"div",14)(34,Bi,7,2,"ng-template",null,1,Ze),i()(),o(36,"div",19)(37,"div",4)(38,"div",20)(39,"span",21),r(40),i(),r(41," permissions assigned to this role "),i(),o(42,"button",22),_("click",function(){return h(a),x(t.closeModal())}),r(43," Done "),i()()(),u(44,Wi,7,0,"div",23),i()}if(e&2){let a=R(22),d=R(35);l(7),f("Role: ",t.data.role.display_name||t.data.role.name,""),l(10),f(" Current Permissions (",t.currentPermissions.length,") "),l(2),f(" ",t.currentPermissions.length," assigned "),l(),c("ngIf",t.currentPermissions.length>0)("ngIfElse",a),l(8),f(" Available Permissions (",t.filteredAvailablePermissions.length,") "),l(2),$("ngModel",t.searchTerm),l(3),c("ngIf",t.filteredAvailablePermissions.length>0)("ngIfElse",d),l(7),v(t.currentPermissions.length),l(4),c("ngIf",t.isLoading)}},dependencies:[T,k,I,Q,L,V,ye,D,U,F,B,Ve,N,j],styles:[".permission-item[_ngcontent-%COMP%]{transition:all .3s ease}.permission-item[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 2s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}[_nghost-%COMP%]     .max-h-60::-webkit-scrollbar{width:6px}[_nghost-%COMP%]     .max-h-60::-webkit-scrollbar-track{background:#f1f5f9;border-radius:3px}[_nghost-%COMP%]     .max-h-60::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}[_nghost-%COMP%]     .max-h-60::-webkit-scrollbar-thumb:hover{background:#94a3b8}[_nghost-%COMP%]     .success-snackbar{background-color:#10b981!important;color:#fff!important}[_nghost-%COMP%]     .error-snackbar{background-color:#ef4444!important;color:#fff!important}[_nghost-%COMP%]     .permission-management-dialog .mat-mdc-dialog-container{padding:0!important;overflow:hidden!important;border-radius:16px!important}[_nghost-%COMP%]     .permission-management-dialog .mat-mdc-dialog-surface{border-radius:16px!important}"]})};function zi(s,n){if(s&1){let e=M();o(0,"button",44),_("click",function(){h(e);let a=m();return x(a.openCreateRoleModal())}),o(1,"mat-icon",11),r(2,"add_circle"),i(),o(3,"span"),r(4,"New Role"),i()()}}function Gi(s,n){s&1&&(o(0,"div",45)(1,"div",46)(2,"div",17),b(3,"div",47)(4,"div",48),i(),o(5,"p",49),r(6,"Loading roles..."),i()()())}function Hi(s,n){if(s&1){let e=M();o(0,"button",56),_("click",function(){h(e);let a=m(2);return x(a.openCreateRoleModal())}),o(1,"mat-icon",57),r(2,"add"),i(),r(3," Create Your First Role "),i()}}function $i(s,n){s&1&&(o(0,"div",50)(1,"div",46)(2,"div",51)(3,"mat-icon",52),r(4,"admin_panel_settings"),i()(),o(5,"div",3)(6,"h3",53),r(7,"No roles found"),i(),o(8,"p",54),r(9,"No roles match your current filters. Try adjusting your search criteria or create a new role."),i()(),u(10,Hi,4,0,"button",55),i()()),s&2&&(l(10),c("hasPermission","roles.create"))}function Ki(s,n){s&1&&(o(0,"span",91)(1,"mat-icon",80),r(2,"star"),i(),r(3," System "),i())}function Yi(s,n){s&1&&(o(0,"div",92)(1,"mat-icon",93),r(2,"verified"),i()())}function qi(s,n){if(s&1){let e=M();o(0,"button",94),_("click",function(){h(e);let a=m().$implicit,d=m(2);return x(d.editRole(a))}),o(1,"mat-icon",57),r(2,"edit"),i()()}if(s&2){let e=m().$implicit;c("title","Edit "+e.name)}}function Qi(s,n){if(s&1){let e=M();o(0,"button",96),_("click",function(){h(e);let a=m(2).$implicit,d=m(2);return x(d.deleteRole(a))}),o(1,"mat-icon",57),r(2,"delete"),i()()}if(s&2){let e=m(2).$implicit;c("title","Delete "+e.name)}}function Xi(s,n){if(s&1&&(It(0),u(1,Qi,3,1,"button",95),Tt()),s&2){let e=m().$implicit;l(),c("ngIf",!e.is_system_role)}}function Zi(s,n){if(s&1){let e=M();o(0,"tr",65)(1,"td",66)(2,"div",67)(3,"span",68),b(4,"div",69),r(5),i(),u(6,Ki,4,0,"span",70),i()(),o(7,"td",66)(8,"div",4)(9,"div",17)(10,"div",71)(11,"mat-icon",11),r(12),i()(),u(13,Yi,3,0,"div",72),i(),o(14,"div",73)(15,"p",74),r(16),i(),o(17,"p",75),r(18),i()()()(),o(19,"td",76)(20,"div",77)(21,"p",78),r(22),i()()(),o(23,"td",66)(24,"span",79)(25,"mat-icon",80),r(26,"security"),i(),r(27),i()(),o(28,"td",66)(29,"div",81)(30,"mat-icon",82),r(31,"flag"),i(),o(32,"span",83),r(33),i()()(),o(34,"td",84),r(35),i(),o(36,"td",85)(37,"div",86),u(38,qi,3,1,"button",87),o(39,"button",88),_("click",function(){let a=h(e).$implicit,d=m(2);return x(d.viewRoleUsers(a))}),o(40,"mat-icon",57),r(41,"people"),i()(),o(42,"button",89),_("click",function(){let a=h(e).$implicit,d=m(2);return x(d.manageRolePermissions(a))}),o(43,"mat-icon",57),r(44,"security"),i()(),u(45,Xi,2,1,"ng-container",90),i()()()}if(s&2){let e=n.$implicit,t=m(2);l(3),w(e.is_active?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"),l(),w(e.is_active?"bg-green-500":"bg-red-500"),l(),f(" ",e.is_active?"Active":"Inactive"," "),l(),c("ngIf",e.is_system_role),l(4),pe("background","linear-gradient(135deg, "+(e.color||"#3b82f6")+", "+(e.color||"#1d4ed8")+")"),l(2),v(e.is_system_role?"security":"admin_panel_settings"),l(),c("ngIf",e.is_system_role),l(3),v(e.display_name||e.name),l(2),v(e.name),l(3),c("title",e.description),l(),f(" ",e.description," "),l(5),f(" ",t.getPermissionCount(e)," permissions "),l(6),v(e.priority),l(2),f(" ",t.formatDate(e.createdAt)," "),l(3),c("hasPermission","roles.edit"),l(),c("title","Manage users in "+e.name),l(3),c("title","Manage permissions for "+e.name),l(3),c("hasPermission","roles.delete")}}function Ji(s,n){if(s&1&&(o(0,"div",58)(1,"table",59)(2,"thead",60)(3,"tr")(4,"th",61),r(5,"Status"),i(),o(6,"th",61),r(7,"Role"),i(),o(8,"th",61),r(9,"Description"),i(),o(10,"th",61),r(11,"Permissions"),i(),o(12,"th",61),r(13,"Priority"),i(),o(14,"th",61),r(15,"Created"),i(),o(16,"th",62),r(17,"Actions"),i()()(),o(18,"tbody",63),u(19,Zi,46,21,"tr",64),i()()()),s&2){let e=m();l(19),c("ngForOf",e.tableDataSource())("ngForTrackBy",e.trackByRoleId)}}function eo(s,n){if(s&1&&(o(0,"div",97)(1,"div",98)(2,"div",99)(3,"div",100)(4,"mat-icon",101),r(5,"error"),i()(),o(6,"div")(7,"h3",102),r(8,"Something went wrong"),i(),o(9,"p",103),r(10),i()()()()()),s&2){let e=m();l(10),v(e.errorMessage)}}function to(s,n){if(s&1&&(o(0,"div",104),r(1),i()),s&2){let e=m();l(),f(" ",e.successMessage," ")}}var Bn=class s{roleService=g(W);fb=g(q);dialog=g(bn);snackBar=g(te);allRoles=C([]);allPermissions=C([]);filteredRoles=C([]);isLoading=!1;errorMessage="";successMessage="";searchTerm="";showOnlyActive=!0;showSystemRoles=!1;showPermissionDetails={};displayedColumns=["status","name","description","permissions","priority","created","actions"];tableDataSource=C([]);constructor(){}ngOnInit(){return y(this,null,function*(){yield this.loadRoles(),yield this.loadPermissions()})}loadRoles(){return y(this,null,function*(){try{this.isLoading=!0,this.errorMessage="",console.log("Loading roles...");let n=yield this.roleService.getAllRolesAsync({is_active:void 0,is_system_role:void 0});console.log("Loaded roles:",n.length),this.allRoles.set(n),this.filterRoles()}catch(n){console.error("Failed to load roles:",n),this.errorMessage=n.message||"Failed to load roles"}finally{this.isLoading=!1}})}loadPermissions(){return y(this,null,function*(){try{let n=yield this.roleService.getAllPermissionsAsync({is_active:!0});this.allPermissions.set(n)}catch(n){console.error("Failed to load permissions:",n)}})}filterRoles(){let n=[...this.allRoles()];if(this.searchTerm.trim()){let e=this.searchTerm.toLowerCase();n=n.filter(t=>t.name.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||t.display_name?.toLowerCase().includes(e))}this.showOnlyActive&&(n=n.filter(e=>e.is_active)),this.showSystemRoles||(n=n.filter(e=>!e.is_system_role)),n.sort((e,t)=>e.priority!==t.priority?t.priority-e.priority:e.name.localeCompare(t.name)),this.filteredRoles.set(n),this.tableDataSource.set(n)}openCreateRoleModal(){this.dialog.open(le,{width:"800px",maxWidth:"95vw",data:{permissions:this.allPermissions()}}).afterClosed().subscribe(e=>{e?.success&&(this.showSuccessMessage((e.role,"Role created successfully")),this.loadRoles())})}editRole(n){this.dialog.open(le,{width:"800px",maxWidth:"95vw",data:{role:n,permissions:this.allPermissions()}}).afterClosed().subscribe(t=>{t?.success&&(this.showSuccessMessage("Role updated successfully"),this.loadRoles())})}togglePermissionDetails(n){this.showPermissionDetails[n]=!this.showPermissionDetails[n]}addPermissionToRole(n,e){return y(this,null,function*(){try{this.isLoading=!0,this.errorMessage="",yield this.roleService.addPermissionsToRoleAsync(n._id,[e]),this.showSuccessMessage("Permission added to role successfully"),yield this.loadRoles()}catch(t){console.error("Add permission error:",t),this.errorMessage=t.message||"Failed to add permission to role",this.snackBar.open(this.errorMessage,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.isLoading=!1}})}removePermissionFromRole(n,e){return y(this,null,function*(){let t=this.allPermissions().find(d=>d._id===e),a=t?t.name:"Unknown Permission";if(confirm(`Remove "${a}" from role "${n.display_name||n.name}"?`))try{this.isLoading=!0,this.errorMessage="",yield this.roleService.removePermissionsFromRoleAsync(n._id,[e]),this.showSuccessMessage("Permission removed from role successfully"),yield this.loadRoles()}catch(d){console.error("Remove permission error:",d),this.errorMessage=d.message||"Failed to remove permission from role",this.snackBar.open(this.errorMessage,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.isLoading=!1}})}setRolePermissions(n,e){return y(this,null,function*(){try{this.isLoading=!0,this.errorMessage="",yield this.roleService.setRolePermissionsAsync(n._id,e),this.showSuccessMessage("Role permissions updated successfully"),yield this.loadRoles()}catch(t){console.error("Set permissions error:",t),this.errorMessage=t.message||"Failed to update role permissions",this.snackBar.open(this.errorMessage,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.isLoading=!1}})}deleteRole(n){return y(this,null,function*(){if(confirm(`Are you sure you want to delete the role "${n.display_name||n.name}"? This action cannot be undone.`))try{this.isLoading=!0,this.errorMessage="",console.log("Deleting role:",n._id),yield this.roleService.deleteRoleAsync(n._id),this.showSuccessMessage("Role deleted successfully"),yield this.loadRoles()}catch(e){console.error("Delete role error:",e);let t="Failed to delete role";e.error?.message?t=e.error.message:e.message?t=e.message:e.status===404?t="Role not found":e.status===403?t="You do not have permission to delete this role":e.status===400&&(t="Cannot delete role - it may be in use or protected"),this.errorMessage=t,this.snackBar.open(t,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.isLoading=!1}})}manageRolePermissions(n){this.openPermissionManagementModal(n)}openPermissionManagementModal(n){this.dialog.open(We,{data:{role:n,allPermissions:this.allPermissions()},width:"900px",maxWidth:"95vw",maxHeight:"90vh",panelClass:"permission-management-dialog",disableClose:!1}).afterClosed().subscribe(()=>{this.loadRoles()})}showSuccessMessage(n){this.snackBar.open(n,"Close",{duration:5e3,horizontalPosition:"right",verticalPosition:"top",panelClass:["success-snackbar"]})}viewRoleUsers(n){this.dialog.open(Be,{data:{role:n},width:"900px",maxWidth:"95vw",maxHeight:"90vh",panelClass:"role-users-dialog",disableClose:!1}).afterClosed().subscribe(()=>{this.loadRoles()})}getPermissionCount(n){return Array.isArray(n.permissions)?n.permissions.length:0}getRolePermissions(n){return Array.isArray(n.permissions)?n.permissions.map(e=>typeof e=="string"?this.allPermissions().find(t=>t._id===e):e).filter(e=>!!e):[]}getAvailablePermissions(n){let e=this.getRolePermissionIds(n);return this.allPermissions().filter(t=>t.is_active&&!e.includes(t._id))}getRolePermissionIds(n){return Array.isArray(n.permissions)?n.permissions.map(e=>typeof e=="string"?e:e._id):[]}hasPermission(n,e){return this.getRolePermissionIds(n).includes(e)}formatDate(n){return new Date(n).toLocaleDateString()}trackByRoleId(n,e){return e._id}trackByPermissionId(n,e){return e._id}getActiveRolesCount(){return this.allRoles().filter(n=>n.is_active).length}getSystemRolesCount(){return this.allRoles().filter(n=>n.is_system_role).length}getTotalRolesCount(){return this.allRoles().length}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=S({type:s,selectors:[["app-role-management"]],decls:71,vars:12,consts:[[1,"min-h-screen","bg-gradient-to-br","from-slate-50","via-blue-50","to-indigo-50","p-4","md:p-8"],[1,"mb-8"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-4"],[1,"space-y-2"],[1,"flex","items-center","gap-3"],[1,"h-8","w-8","bg-gradient-to-r","from-blue-600","to-indigo-600","rounded-xl","flex","items-center","justify-center"],[1,"text-white","text-lg"],[1,"text-3xl","font-bold","bg-gradient-to-r","from-gray-900","to-gray-600","bg-clip-text","text-transparent"],[1,"text-gray-600","max-w-2xl"],["class","inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold rounded-xl shadow-lg shadow-blue-500/25 transition-all duration-200 hover:shadow-xl hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",3,"click",4,"hasPermission"],[1,"inline-flex","items-center","gap-2","px-4","py-3","bg-white","hover:bg-gray-50","text-gray-700","font-medium","rounded-xl","shadow-sm","border","border-gray-200","transition-all","duration-200","hover:shadow-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2",3,"click"],[1,"text-lg"],[1,"bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-sm","border","border-white/20","p-6","mb-8"],[1,"grid","grid-cols-1","lg:grid-cols-12","gap-6"],[1,"lg:col-span-4","space-y-3"],[1,"text-sm","font-semibold","text-gray-900","flex","items-center","gap-2"],[1,"text-blue-600","text-base"],[1,"relative"],["type","text","placeholder","Search roles by name or description...",1,"w-full","pl-11","pr-4","py-3","bg-gray-50/50","border","border-gray-200","rounded-xl","text-sm","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-blue-500/20","focus:border-blue-500","transition-colors",3,"ngModelChange","input","ngModel"],[1,"absolute","left-3.5","top-3.5","text-gray-400","text-base"],[1,"lg:col-span-3","space-y-3"],[1,"text-green-600","text-base"],[1,"space-y-3"],[1,"flex","items-center","gap-3","cursor-pointer","group"],["type","checkbox",1,"w-4","h-4","text-blue-600","bg-gray-50","border-gray-300","rounded","focus:ring-blue-500","focus:ring-2","transition-colors",3,"ngModelChange","change","ngModel"],[1,"text-sm","text-gray-700","group-hover:text-gray-900","transition-colors","select-none"],["type","checkbox",1,"w-4","h-4","text-amber-600","bg-gray-50","border-gray-300","rounded","focus:ring-amber-500","focus:ring-2","transition-colors",3,"ngModelChange","change","ngModel"],[1,"text-purple-600","text-base"],[1,"grid","grid-cols-3","gap-2"],[1,"text-center","p-2","bg-blue-50","rounded-lg","border","border-blue-100"],[1,"text-lg","font-bold","text-blue-600"],[1,"text-xs","text-blue-600/70","font-medium"],[1,"text-center","p-2","bg-green-50","rounded-lg","border","border-green-100"],[1,"text-lg","font-bold","text-green-600"],[1,"text-xs","text-green-600/70","font-medium"],[1,"text-center","p-2","bg-amber-50","rounded-lg","border","border-amber-100"],[1,"text-lg","font-bold","text-amber-600"],[1,"text-xs","text-amber-600/70","font-medium"],[1,"bg-white/90","backdrop-blur-sm","rounded-2xl","shadow-lg","border","border-white/20","overflow-hidden"],["class","flex items-center justify-center py-16",4,"ngIf"],["class","text-center py-16",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],["class","mt-8 mx-auto max-w-2xl",4,"ngIf"],["class","mt-6 p-4 bg-green-50 border-l-4 border-green-400 text-green-700",4,"ngIf"],[1,"inline-flex","items-center","gap-2","px-6","py-3","bg-gradient-to-r","from-blue-600","to-indigo-600","hover:from-blue-700","hover:to-indigo-700","text-white","font-semibold","rounded-xl","shadow-lg","shadow-blue-500/25","transition-all","duration-200","hover:shadow-xl","hover:scale-105","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2",3,"click"],[1,"flex","items-center","justify-center","py-16"],[1,"flex","flex-col","items-center","space-y-4"],[1,"w-12","h-12","border-4","border-blue-200","rounded-full","animate-spin"],[1,"w-12","h-12","border-4","border-blue-600","border-t-transparent","rounded-full","animate-spin","absolute","top-0"],[1,"text-gray-600","font-medium"],[1,"text-center","py-16"],[1,"w-20","h-20","bg-gradient-to-r","from-blue-100","to-indigo-100","rounded-full","flex","items-center","justify-center"],[1,"text-blue-600","text-3xl"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-gray-500","max-w-sm"],["class","inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",3,"click",4,"hasPermission"],[1,"inline-flex","items-center","gap-2","px-4","py-2","bg-blue-600","hover:bg-blue-700","text-white","font-medium","rounded-lg","transition-colors",3,"click"],[1,"text-base"],[1,"overflow-x-auto"],[1,"w-full"],[1,"bg-gradient-to-r","from-gray-50","to-blue-50/30"],[1,"px-6","py-4","text-left","text-xs","font-semibold","text-gray-700","uppercase","tracking-wider"],[1,"px-6","py-4","text-right","text-xs","font-semibold","text-gray-700","uppercase","tracking-wider"],[1,"divide-y","divide-gray-100"],["class","group hover:bg-blue-50/30 transition-colors duration-200",4,"ngFor","ngForOf","ngForTrackBy"],[1,"group","hover:bg-blue-50/30","transition-colors","duration-200"],[1,"px-6","py-4","whitespace-nowrap"],[1,"flex","items-center","gap-2"],[1,"inline-flex","items-center","gap-1.5","px-3","py-1","rounded-full","text-xs","font-semibold"],[1,"w-1.5","h-1.5","rounded-full"],["class","inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-gradient-to-r from-amber-100 to-orange-100 text-amber-700 border border-amber-200",4,"ngIf"],[1,"w-11","h-11","rounded-xl","flex","items-center","justify-center","text-white","shadow-lg"],["class","absolute -top-1 -right-1 w-4 h-4 bg-amber-400 rounded-full flex items-center justify-center",4,"ngIf"],[1,"min-w-0","flex-1"],[1,"text-sm","font-semibold","text-gray-900","truncate"],[1,"text-xs","text-gray-500","truncate"],[1,"px-6","py-4"],[1,"max-w-xs"],[1,"text-sm","text-gray-700","truncate",3,"title"],[1,"inline-flex","items-center","gap-1","px-3","py-1","rounded-full","text-xs","font-semibold","bg-gradient-to-r","from-blue-100","to-indigo-100","text-blue-700","border","border-blue-200"],[1,"text-xs"],[1,"flex","items-center","gap-1","text-sm","text-gray-700"],[1,"text-base","text-gray-400"],[1,"font-medium"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-600"],[1,"px-6","py-4","whitespace-nowrap","text-right"],[1,"flex","items-center","justify-end","gap-1","opacity-60","group-hover:opacity-100","transition-opacity","duration-200"],["class","p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors",3,"title","click",4,"hasPermission"],[1,"p-2","text-purple-600","hover:bg-purple-100","rounded-lg","transition-colors",3,"click","title"],[1,"p-2","text-green-600","hover:bg-green-100","rounded-lg","transition-colors",3,"click","title"],[4,"hasPermission"],[1,"inline-flex","items-center","gap-1","px-2","py-1","rounded-full","text-xs","font-semibold","bg-gradient-to-r","from-amber-100","to-orange-100","text-amber-700","border","border-amber-200"],[1,"absolute","-top-1","-right-1","w-4","h-4","bg-amber-400","rounded-full","flex","items-center","justify-center"],[1,"text-xs","text-white"],[1,"p-2","text-blue-600","hover:bg-blue-100","rounded-lg","transition-colors",3,"click","title"],["class","p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors",3,"title","click",4,"ngIf"],[1,"p-2","text-red-600","hover:bg-red-100","rounded-lg","transition-colors",3,"click","title"],[1,"mt-8","mx-auto","max-w-2xl"],[1,"bg-gradient-to-r","from-red-50","to-pink-50","border","border-red-200","rounded-2xl","p-6","shadow-sm"],[1,"flex","items-center","gap-4"],[1,"w-12","h-12","bg-gradient-to-r","from-red-500","to-pink-600","rounded-full","flex","items-center","justify-center","flex-shrink-0"],[1,"text-white","text-xl"],[1,"text-lg","font-semibold","text-red-900","mb-1"],[1,"text-red-700","leading-relaxed"],[1,"mt-6","p-4","bg-green-50","border-l-4","border-green-400","text-green-700"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"mat-icon",6),r(7,"admin_panel_settings"),i()(),o(8,"h1",7),r(9," Role Management "),i()(),o(10,"p",8),r(11," Define and manage user roles with granular permissions to control access across your platform "),i()(),o(12,"div",4),u(13,zi,5,0,"button",9),o(14,"button",10),_("click",function(){return t.loadRoles()}),o(15,"mat-icon",11),r(16,"refresh"),i(),o(17,"span"),r(18,"Refresh"),i()()()()(),o(19,"div",12)(20,"div",13)(21,"div",14)(22,"h3",15)(23,"mat-icon",16),r(24,"search"),i(),r(25," Search & Filter "),i(),o(26,"div",17)(27,"input",18),Y("ngModelChange",function(d){return K(t.searchTerm,d)||(t.searchTerm=d),d}),_("input",function(){return t.filterRoles()}),i(),o(28,"mat-icon",19),r(29,"search"),i()()(),o(30,"div",20)(31,"h3",15)(32,"mat-icon",21),r(33,"filter_list"),i(),r(34," Filters "),i(),o(35,"div",22)(36,"label",23)(37,"input",24),Y("ngModelChange",function(d){return K(t.showOnlyActive,d)||(t.showOnlyActive=d),d}),_("change",function(){return t.filterRoles()}),i(),o(38,"span",25),r(39,"Active roles only"),i()(),o(40,"label",23)(41,"input",26),Y("ngModelChange",function(d){return K(t.showSystemRoles,d)||(t.showSystemRoles=d),d}),_("change",function(){return t.filterRoles()}),i(),o(42,"span",25),r(43,"Include system roles"),i()()()(),o(44,"div",20)(45,"h3",15)(46,"mat-icon",27),r(47,"analytics"),i(),r(48," Statistics "),i(),o(49,"div",28)(50,"div",29)(51,"div",30),r(52),i(),o(53,"div",31),r(54,"Total"),i()(),o(55,"div",32)(56,"div",33),r(57),i(),o(58,"div",34),r(59,"Active"),i()(),o(60,"div",35)(61,"div",36),r(62),i(),o(63,"div",37),r(64,"System"),i()()()()()(),o(65,"div",38),u(66,Gi,7,0,"div",39)(67,$i,11,1,"div",40)(68,Ji,20,2,"div",41),i(),u(69,eo,11,1,"div",42)(70,to,2,1,"div",43),i()),e&2&&(l(13),c("hasPermission","roles.create"),l(14),$("ngModel",t.searchTerm),l(10),$("ngModel",t.showOnlyActive),l(4),$("ngModel",t.showSystemRoles),l(11),v(t.getTotalRolesCount()),l(5),v(t.getActiveRolesCount()),l(5),v(t.getSystemRolesCount()),l(4),c("ngIf",t.isLoading),l(),c("ngIf",!t.isLoading&&t.tableDataSource().length===0),l(),c("ngIf",!t.isLoading&&t.tableDataSource().length>0),l(),c("ngIf",t.errorMessage),l(),c("ngIf",t.successMessage))},dependencies:[T,k,I,Q,L,cn,V,ye,X,D,U,F,ee,N,j,ke,B,Ve,Ie,Ne,In,yn,wn,Tn],encapsulation:2})};export{Bn as RoleManagementComponent};
