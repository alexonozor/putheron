import{a as ft,b as ut,c as _t}from"./chunk-DVJGIJEZ.js";import"./chunk-PVDG46DZ.js";import{a as L,b as pt}from"./chunk-BQAOSCDJ.js";import{a as mt,b as D}from"./chunk-M23MWY4A.js";import{a as w}from"./chunk-7YGFLBJ2.js";import{a as k,c as j,h as I}from"./chunk-7UZH7J7I.js";import{d as X,h as lt,i as ct,j as dt}from"./chunk-ZEPG7XYP.js";import"./chunk-667ILHIJ.js";import"./chunk-ZLE5IO2O.js";import{d as rt,k as st}from"./chunk-WUPIU6OB.js";import{A as nt,B as ot,C as at}from"./chunk-3JRZMC5D.js";import{a as et,b as it}from"./chunk-2WQD2DAV.js";import{s as Z,t as tt,u as A}from"./chunk-IZGM5G4Z.js";import"./chunk-OXNSH2WS.js";import"./chunk-QD7SSFII.js";import{a as T,b as M}from"./chunk-EPCK2AMG.js";import"./chunk-WF7V7INI.js";import{g as W,l as K}from"./chunk-HNHRL3LT.js";import"./chunk-S4SH23H7.js";import{p as H,w as N}from"./chunk-5TL7AFVW.js";import{Hb as d,Ic as Q,Jb as m,Jc as $,Mb as U,Nb as J,Ob as C,Pb as i,Qb as n,Rb as b,Vc as S,Yb as x,ab as s,ac as f,cc as c,fb as R,ga as E,gc as z,hc as Y,ic as q,la as u,ma as _,pc as B,qc as r,rb as y,rc as g,sc as v,uc as G,va as P}from"./chunk-VCYZZ2B3.js";import{e as h}from"./chunk-JKOY2XUY.js";var O=class a{totalCount=0;unreadCount=0;readCount=0;static \u0275fac=function(e){return new(e||a)};static \u0275cmp=y({type:a,selectors:[["app-notification-stats"]],inputs:{totalCount:"totalCount",unreadCount:"unreadCount",readCount:"readCount"},decls:37,vars:3,consts:[[1,"grid","grid-cols-1","sm:grid-cols-3","gap-6"],[1,"overflow-hidden","hover:shadow-lg","transition-shadow","bg-white!"],[1,"p-6"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-sm","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"text-blue-600","text-2xl"],[1,"space-y-2"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"text-purple-600","text-2xl"],[1,"text-3xl","font-bold","text-purple-600"],[1,"text-green-600","text-2xl"],[1,"text-3xl","font-bold","text-green-600"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"mat-card",1)(2,"mat-card-content",2)(3,"div",3)(4,"h3",4),r(5,"Total Notifications"),n(),i(6,"mat-icon",5),r(7,"notifications_outline"),n()(),i(8,"div",6)(9,"p",7),r(10),n(),i(11,"p",8),r(12,"All notifications received"),n()()()(),i(13,"mat-card",1)(14,"mat-card-content",2)(15,"div",3)(16,"h3",4),r(17,"Unread"),n(),i(18,"mat-icon",9),r(19,"mark_email_unread_outline"),n()(),i(20,"div",6)(21,"p",10),r(22),n(),i(23,"p",8),r(24,"Notifications awaiting action"),n()()()(),i(25,"mat-card",1)(26,"mat-card-content",2)(27,"div",3)(28,"h3",4),r(29,"Read"),n(),i(30,"mat-icon",11),r(31,"mark_email_read_outline"),n()(),i(32,"div",6)(33,"p",12),r(34),n(),i(35,"p",8),r(36,"Already reviewed"),n()()()()()),e&2&&(s(10),g(o.totalCount),s(12),g(o.unreadCount),s(12),g(o.readCount))},dependencies:[N,I,k,j,M,T],encapsulation:2})};function Et(a,t){if(a&1&&(i(0,"span",21),r(1),Q(2,"uppercase"),n()),a&2){let e=c();B(e.getPriorityBadgeClass()),s(),v(" ",$(2,3,e.notification.priority)," ")}}function yt(a,t){if(a&1&&(i(0,"div",13)(1,"div",22),r(2),n(),i(3,"div",23),r(4),n()()),a&2){let e=c();s(2),v("Project: ",e.notification.project_id.title),s(2),g(e.notification.project_id.description)}}function bt(a,t){if(a&1&&(i(0,"div",14)(1,"div",24),r(2),n()()),a&2){let e=c();s(2),v("Business: ",e.notification.business_id.name)}}function St(a,t){if(a&1&&(i(0,"div",15),r(1),n()),a&2){let e=c();s(),G(" From: ",e.notification.sender_id.first_name," ",e.notification.sender_id.last_name," (",e.notification.sender_id.email,") ")}}function Nt(a,t){if(a&1&&(i(0,"span"),r(1),n()),a&2){let e=c();s(),v("\u2022 Read ",e.formatTimeAgo(e.notification.read_at))}}function Tt(a,t){if(a&1){let e=x();i(0,"button",25),f("click",function(l){u(e);let p=c();return _(p.onMarkAsRead(l))}),i(1,"mat-icon"),r(2,"done"),n()()}}function Mt(a,t){a&1&&b(0,"div",20)}var F=class a{notification;click=new R;markAsRead=new R;delete=new R;notificationService=E(w);onCardClick(){this.click.emit(this.notification)}onMarkAsRead(t){t.stopPropagation(),this.markAsRead.emit(this.notification)}onDelete(t){t.stopPropagation(),this.delete.emit(this.notification)}getNotificationIcon(){return this.notificationService.getNotificationIcon(this.notification.type)}getPriorityBadgeClass(){let t={low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"};return t[this.notification.priority]||t.medium}getCardClass(){let t="";return this.notification.priority==="urgent"?t+="border-l-4 border-red-400 ":this.notification.priority==="high"?t+="border-l-4 border-orange-400 ":this.notification.is_read||(t+="border-l-4 border-blue-400 "),t}getTypeLabel(){return{project_created:"Project Created",project_accepted:"Project Accepted",project_rejected:"Project Rejected",project_started:"Project Started",project_completed:"Project Completed",project_completed_by_business:"Project Completed - Awaiting Approval",project_completion_approved:"Project Completion Approved",project_completion_rejected:"Project Completion Rejected",additional_payment_requested:"Payment Requested",additional_payment_approved:"Payment Approved",additional_payment_rejected:"Payment Rejected",additional_payment_completed:"Payment Received",business_approved:"Business Approved",business_rejected:"Business Rejected",business_suspended:"Business Suspended",business_reactivated:"Business Reactivated",review_received:"Review Received",review_replied:"Review Replied",payment_request:"Payment Request",payment_approved:"Payment Approved",payment_rejected:"Payment Rejected",completion_request:"Completion Request",completion_approved:"Completion Approved",completion_rejected:"Completion Rejected",promotion:"Promotion",system_announcement:"Announcement",message_received:"Message"}[this.notification.type]||"Notification"}formatTimeAgo(t){return this.notificationService.formatTimeAgo(t)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=y({type:a,selectors:[["app-notification-item"]],inputs:{notification:"notification"},outputs:{click:"click",markAsRead:"markAsRead",delete:"delete"},decls:30,vars:14,consts:[[1,"overflow-hidden","hover:shadow-lg","transition-shadow","cursor-pointer",3,"click"],[1,"p-6"],[1,"flex","items-start","gap-4"],[1,"flex-shrink-0"],[1,"w-12","h-12","rounded-full","bg-gray-100","flex","items-center","justify-center","text-xl"],[1,"flex-1","min-w-0"],[1,"flex","items-start","justify-between","gap-4"],[1,"flex-1"],[1,"flex","flex-wrap","items-center","gap-2","mb-2"],[1,"text-lg","font-semibold","text-gray-900"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium",3,"class"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-gray-100","text-gray-800"],[1,"text-gray-700","mb-3"],[1,"mb-3","p-3","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"mb-3","p-3","bg-green-50","rounded-lg","border","border-green-200"],[1,"text-sm","text-gray-600","mb-3"],[1,"flex","items-center","gap-4","text-sm","text-gray-500"],[1,"flex","items-center","gap-2","flex-shrink-0"],["mat-icon-button","","matTooltip","Mark as read",1,"text-blue-600","hover:text-blue-800","hover:bg-blue-50"],["mat-icon-button","","matTooltip","Delete notification",1,"text-red-600","hover:text-red-800","hover:bg-red-50",3,"click"],[1,"w-3","h-3","bg-blue-500","rounded-full","flex-shrink-0"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium"],[1,"text-sm","font-medium","text-blue-900"],[1,"text-sm","text-blue-700"],[1,"text-sm","font-medium","text-green-900"],["mat-icon-button","","matTooltip","Mark as read",1,"text-blue-600","hover:text-blue-800","hover:bg-blue-50",3,"click"]],template:function(e,o){e&1&&(i(0,"mat-card",0),f("click",function(){return o.onCardClick()}),i(1,"mat-card-content",1)(2,"div",2)(3,"div",3)(4,"div",4),r(5),n()(),i(6,"div",5)(7,"div",6)(8,"div",7)(9,"div",8)(10,"h3",9),r(11),n(),d(12,Et,3,5,"span",10),i(13,"span",11),r(14),n()(),i(15,"p",12),r(16),n(),d(17,yt,5,2,"div",13),d(18,bt,3,1,"div",14),d(19,St,2,3,"div",15),i(20,"div",16)(21,"span"),r(22),n(),d(23,Nt,2,1,"span"),n()(),i(24,"div",17),d(25,Tt,3,0,"button",18),i(26,"button",19),f("click",function(p){return o.onDelete(p)}),i(27,"mat-icon"),r(28,"delete"),n()(),d(29,Mt,1,0,"div",20),n()()()()()()),e&2&&(B("bg-white! "+o.getCardClass()),s(5),v(" ",o.getNotificationIcon()," "),s(6),g(o.notification.title),s(),m(o.notification.priority!=="low"?12:-1),s(2),v(" ",o.getTypeLabel()," "),s(2),g(o.notification.message),s(),m(o.notification.project_id?17:-1),s(),m(o.notification.business_id?18:-1),s(),m(o.notification.sender_id?19:-1),s(3),g(o.formatTimeAgo(o.notification.createdAt)),s(),m(o.notification.is_read&&o.notification.read_at?23:-1),s(2),m(o.notification.is_read?-1:25),s(4),m(o.notification.is_read?-1:29))},dependencies:[N,I,k,j,M,T,A,Z,D,mt,H],styles:["[_nghost-%COMP%]{display:block;width:100%}"]})};var It=(a,t)=>t._id;function Pt(a,t){if(a&1){let e=x();i(0,"button",29),f("click",function(){u(e);let l=c();return _(l.markAllAsRead())}),i(1,"mat-icon"),r(2,"mark_email_read"),n(),r(3," Mark All Read "),n()}}function Rt(a,t){if(a&1){let e=x();i(0,"button",30),f("click",function(){u(e);let l=c();return _(l.handleClearFilters())}),i(1,"mat-icon"),r(2,"clear"),n(),r(3," Clear Filters "),n()}}function At(a,t){if(a&1&&(i(0,"div",24),b(1,"app-notification-stats",31),n()),a&2){let e=c();s(),C("totalCount",e.totalCount())("unreadCount",e.unreadCount())("readCount",e.readCount())}}function wt(a,t){a&1&&(i(0,"div",25),b(1,"mat-spinner",32),n())}function kt(a,t){if(a&1&&b(0,"app-empty-state",26),a&2){let e=c();C("title","No notifications found")("description",e.getEmptyMessage())("icon","notifications_none")}}function jt(a,t){if(a&1){let e=x();i(0,"app-notification-item",34),f("click",function(){let l=u(e).$implicit,p=c(2);return _(p.onNotificationClick(l))})("markAsRead",function(){let l=u(e).$implicit,p=c(2);return _(p.onMarkAsRead(l))})("delete",function(){let l=u(e).$implicit,p=c(2);return _(p.onDeleteNotification(l))}),n()}if(a&2){let e=t.$implicit;C("notification",e)}}function Dt(a,t){if(a&1&&(i(0,"div",27),U(1,jt,1,1,"app-notification-item",33,It),n()),a&2){let e=c();s(),J(e.paginatedNotifications())}}function Lt(a,t){if(a&1){let e=x();i(0,"mat-paginator",35,0),f("page",function(l){u(e);let p=c();return _(p.onPageChange(l))}),n()}if(a&2){let e=c();C("length",e.filteredNotifications().length)("pageSize",e.pageSize())}}var V=class a{notificationService=E(w);router=E(W);fb=E(nt);paginator;selectedType=P("");selectedStatus=P("");pageIndex=P(0);pageSize=P(10);Math=Math;notifications=this.notificationService.notifications;unreadCount=this.notificationService.unreadCount;isLoading=this.notificationService.isLoading;filterForm=this.fb.group({type:[""],status:[""]});totalCount=S(()=>this.notifications().length);readCount=S(()=>this.notifications().filter(t=>t.is_read).length);filteredNotifications=S(()=>{let t=this.notifications(),e=this.selectedType();e&&(t=t.filter(l=>l.type===e));let o=this.selectedStatus();return o==="read"?t=t.filter(l=>l.is_read):o==="unread"&&(t=t.filter(l=>!l.is_read)),t});paginatedNotifications=S(()=>{let t=this.pageIndex()*this.pageSize(),e=t+this.pageSize();return this.filteredNotifications().slice(t,e)});hasActiveFilters=S(()=>!!(this.selectedType()||this.selectedStatus()));ngOnInit(){this.loadNotifications()}loadNotifications(){return h(this,null,function*(){try{yield this.notificationService.getNotifications({limit:100,page:1})}catch(t){console.error("Error loading notifications:",t)}})}refreshNotifications(){return h(this,null,function*(){yield this.loadNotifications()})}applyFilters(){this.pageIndex.set(0),this.paginator&&this.paginator.firstPage()}onPageChange(t){this.pageIndex.set(t.pageIndex),this.pageSize.set(t.pageSize)}markAllAsRead(){return h(this,null,function*(){try{yield this.notificationService.markAllAsRead()}catch(t){console.error("Error marking all as read:",t)}})}onTypeChange(t){this.selectedType.set(t),this.applyFilters()}onStatusChange(t){this.selectedStatus.set(t),this.applyFilters()}onNotificationClick(t){t.is_read||this.notificationService.markAsRead(t._id).catch(e=>{console.error("Error marking notification as read:",e)}),this.navigateFromNotification(t)}onMarkAsRead(t){return h(this,null,function*(){if(!t.is_read)try{yield this.notificationService.markAsRead(t._id)}catch(e){console.error("Error marking notification as read:",e)}})}onDeleteNotification(t){return h(this,null,function*(){if(confirm("Are you sure you want to delete this notification?"))try{yield this.notificationService.deleteNotification(t._id)}catch(e){console.error("Error deleting notification:",e)}})}navigateFromNotification(t){if(["project_created","project_accepted","project_rejected","project_started","project_completed","project_completed_by_business","project_completion_approved","project_completion_rejected","additional_payment_requested","additional_payment_approved","additional_payment_rejected","additional_payment_completed","payment_request","payment_approved","payment_rejected","completion_request","completion_approved","completion_rejected"].includes(t.type)&&t.project_id){let o=typeof t.project_id=="string"?t.project_id:t.project_id._id;this.router.navigate(["/dashboard/projects",o]);return}switch(t.type){case"message_received":t.metadata?.chatId&&this.router.navigate(["/dashboard/messages/chat",t.metadata.chatId]);break;case"business_approved":case"business_rejected":case"business_suspended":case"business_reactivated":if(t.business_id){let o=typeof t.business_id=="string"?t.business_id:t.business_id._id;this.router.navigate(["/dashboard/businesses",o])}break;case"review_received":if(t.project_id){let o=typeof t.project_id=="string"?t.project_id:t.project_id._id;this.router.navigate(["/project-details",o])}break;default:break}}handleClearFilters=()=>{this.selectedType.set(""),this.selectedStatus.set(""),this.pageIndex.set(0),this.paginator&&this.paginator.firstPage()};getEmptyMessage(){return this.selectedType()&&this.selectedStatus()?`No ${this.selectedStatus()} notifications of this type found.`:this.selectedType()?"No notifications of this type found.":this.selectedStatus()?`No ${this.selectedStatus()} notifications found.`:"You don't have any notifications yet."}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=y({type:a,selectors:[["app-list-notifications"]],viewQuery:function(e,o){if(e&1&&z(L,5),e&2){let l;Y(l=q())&&(o.paginator=l.first)}},decls:49,vars:9,consts:[["paginator",""],[1,"min-h-screen","bg-gray-50"],[1,"lg:max-w-7xl","px-4","sm:px-6","lg:px-8","py-8"],[1,"px-6","pt-6"],["title","Notifications","subtitle","Manage all your notifications"],["matButton","filled","color","primary",1,"flex","items-center",3,"click"],[1,"mr-2"],[1,"flex","flex-col","sm:flex-row","gap-4","items-start","sm:items-center"],["appearance","outline","subscriptSizing","dynamic",1,"w-full","sm:w-64"],[3,"selectionChange","value"],["value",""],["value","project_created"],["value","project_accepted"],["value","project_rejected"],["value","project_started"],["value","project_completed"],["value","message_received"],["value","promotion"],["value","system_announcement"],["appearance","outline","subscriptSizing","dynamic",1,"w-full","sm:w-48"],["value","unread"],["value","read"],["mat-raised-button","","color","primary",1,"!normal-case"],["mat-stroked-button","",1,"!normal-case"],[1,"mb-8"],[1,"flex","items-center","justify-center","py-16"],[3,"title","description","icon"],[1,"grid","grid-cols-1","gap-4","mb-8"],["showFirstLastButtons","",1,"!sticky","!bottom-0","!bg-white","!border-t","border-gray-100",3,"length","pageSize"],["mat-raised-button","","color","primary",1,"!normal-case",3,"click"],["mat-stroked-button","",1,"!normal-case",3,"click"],[3,"totalCount","unreadCount","readCount"],["diameter","50"],[3,"notification"],[3,"click","markAsRead","delete","notification"],["showFirstLastButtons","",1,"!sticky","!bottom-0","!bg-white","!border-t","border-gray-100",3,"page","length","pageSize"]],template:function(e,o){e&1&&(i(0,"div",1)(1,"div",2)(2,"div",3)(3,"app-dashboard-subheader",4)(4,"button",5),f("click",function(){return o.refreshNotifications()}),i(5,"mat-icon",6),r(6,"refresh"),n(),r(7," Refresh "),n()()(),i(8,"app-business-search-filter")(9,"div",7)(10,"mat-form-field",8)(11,"mat-label"),r(12,"Notification Type"),n(),i(13,"mat-select",9),f("selectionChange",function(p){return o.onTypeChange(p.value)}),i(14,"mat-option",10),r(15,"All Types"),n(),i(16,"mat-option",11),r(17,"Project Created"),n(),i(18,"mat-option",12),r(19,"Project Accepted"),n(),i(20,"mat-option",13),r(21,"Project Rejected"),n(),i(22,"mat-option",14),r(23,"Project Started"),n(),i(24,"mat-option",15),r(25,"Project Completed"),n(),i(26,"mat-option",16),r(27,"Messages"),n(),i(28,"mat-option",17),r(29,"Promotions"),n(),i(30,"mat-option",18),r(31,"Announcements"),n()()(),i(32,"mat-form-field",19)(33,"mat-label"),r(34,"Status"),n(),i(35,"mat-select",9),f("selectionChange",function(p){return o.onStatusChange(p.value)}),i(36,"mat-option",10),r(37,"All Status"),n(),i(38,"mat-option",20),r(39,"Unread"),n(),i(40,"mat-option",21),r(41,"Read"),n()()(),d(42,Pt,4,0,"button",22),d(43,Rt,4,0,"button",23),n()(),d(44,At,2,3,"div",24),d(45,wt,2,0,"div",25),d(46,kt,1,3,"app-empty-state",26),d(47,Dt,3,0,"div",27),d(48,Lt,2,2,"mat-paginator",28),n()()),e&2&&(s(13),C("value",o.selectedType()),s(22),C("value",o.selectedStatus()),s(7),m(o.unreadCount()>0?42:-1),s(),m(o.hasActiveFilters()?43:-1),s(),m(o.isLoading()?-1:44),s(),m(o.isLoading()&&o.filteredNotifications().length===0?45:-1),s(),m(!o.isLoading()&&o.filteredNotifications().length===0?46:-1),s(),m(o.filteredNotifications().length>0&&!o.isLoading()?47:-1),s(),m(o.filteredNotifications().length>0&&!o.isLoading()?48:-1))},dependencies:[N,K,ot,at,A,tt,M,T,lt,st,rt,dt,ct,X,it,et,D,pt,L,I,ft,ut,O,F,_t],encapsulation:2})};var je=[{path:"",component:V},{path:"list",redirectTo:"",pathMatch:"full"}];export{je as NOTIFICATION_ROUTES};
