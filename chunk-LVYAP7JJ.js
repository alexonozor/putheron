import{a as F}from"./chunk-QHPZHR3U.js";import{A as Q,h as Y,k as $,s as G,t as W,u as H}from"./chunk-BUMYHMI6.js";import"./chunk-YBFS2WES.js";import"./chunk-QD7SSFII.js";import{g as U,l as B}from"./chunk-42IDZLZS.js";import"./chunk-UHITDPPY.js";import{t as J}from"./chunk-UFDTBXZU.js";import{$a as s,$b as d,Fb as m,Gb as p,Ib as j,Jb as A,Kb as M,Lb as T,Mb as n,Nb as o,Ob as x,Rc as C,Vb as b,Zb as u,fa as S,ka as f,la as g,lc as V,ma as y,mc as h,na as R,nc as r,oc as E,pc as _,qb as k,rc as I,sc as D,tc as O,ua as w,uc as L}from"./chunk-WCXAA7HR.js";import{e as v}from"./chunk-JKOY2XUY.js";var q=(a,t)=>t._id;function z(a,t){if(a&1){let e=b();n(0,"button",34),u("click",function(){f(e);let l=d();return g(l.markAllAsRead())}),r(1),o()}if(a&2){let e=d();T("disabled",e.isMarkingAllRead),s(),_(" ",e.isMarkingAllRead?"Marking...":"Mark All Read"," ")}}function K(a,t){a&1&&(n(0,"div",30),x(1,"div",35),o())}function X(a,t){if(a&1&&(n(0,"div",31),y(),n(1,"svg",36),x(2,"path",37),o(),R(),n(3,"h3",38),r(4,"No notifications found"),o(),n(5,"p",3),r(6),o()()),a&2){let e=d();s(6),E(e.getEmptyMessage())}}function Z(a,t){if(a&1&&(n(0,"span",62),r(1),o()),a&2){let e=d().$implicit,i=d(2);h(i.getPriorityBadgeClass(e.priority)),s(),_(" ",e.priority.toUpperCase()," ")}}function ee(a,t){if(a&1&&(n(0,"div",52)(1,"div",63),r(2),o(),n(3,"div",64),r(4),o()()),a&2){let e=d().$implicit;s(2),_("Project: ",e.project_id.title),s(2),E(e.project_id.description)}}function te(a,t){if(a&1&&(n(0,"div",53)(1,"div",65),r(2),o()()),a&2){let e=d().$implicit;s(2),_("Business: ",e.business_id.name)}}function ie(a,t){if(a&1&&(n(0,"div",54),r(1),o()),a&2){let e=d().$implicit;s(),I(" From: ",e.sender_id.first_name," ",e.sender_id.last_name," (",e.sender_id.email,") ")}}function ne(a,t){if(a&1&&(n(0,"span"),r(1),o()),a&2){let e=d().$implicit,i=d(2);s(),_("\u2022 Read ",i.formatTimeAgo(e.read_at))}}function oe(a,t){if(a&1){let e=b();n(0,"button",66),u("click",function(l){f(e);let c=d().$implicit,P=d(2);return g(P.markAsRead(c,l))}),y(),n(1,"svg",59),x(2,"path",67),o()()}}function ae(a,t){a&1&&x(0,"div",61)}function re(a,t){if(a&1){let e=b();n(0,"div",40),u("click",function(){let l=f(e).$implicit,c=d(2);return g(c.handleNotificationClick(l))}),n(1,"div",41)(2,"div",42)(3,"div",43),r(4),o()(),n(5,"div",44)(6,"div",45)(7,"div",46)(8,"div",47)(9,"h3",48),r(10),o(),m(11,Z,2,3,"span",49),n(12,"span",50),r(13),o()(),n(14,"p",51),r(15),o(),m(16,ee,5,2,"div",52),m(17,te,3,1,"div",53),m(18,ie,2,3,"div",54),n(19,"div",55)(20,"span"),r(21),o(),m(22,ne,2,1,"span"),o()(),n(23,"div",56),m(24,oe,3,0,"button",57),n(25,"button",58),u("click",function(l){let c=f(e).$implicit,P=d(2);return g(P.deleteNotification(c,l))}),y(),n(26,"svg",59),x(27,"path",60),o()(),m(28,ae,1,0,"div",61),o()()()()()}if(a&2){let e=t.$implicit,i=d(2);h(i.getNotificationStyles(e)),s(4),_(" ",i.getNotificationIcon(e.type)," "),s(6),_(" ",e.title," "),s(),p(e.priority!=="low"?11:-1),s(2),_(" ",i.getTypeLabel(e.type)," "),s(2),E(e.message),s(),p(e.project_id?16:-1),s(),p(e.business_id?17:-1),s(),p(e.sender_id?18:-1),s(3),E(i.formatTimeAgo(e.createdAt)),s(),p(e.is_read&&e.read_at?22:-1),s(2),p(e.is_read?-1:24),s(4),p(e.is_read?-1:28)}}function se(a,t){if(a&1&&(n(0,"div",32),A(1,re,29,14,"div",39,q),o()),a&2){let e=d();s(),M(e.paginatedNotifications())}}function le(a,t){if(a&1){let e=b();n(0,"button",72),u("click",function(){let l=f(e).$implicit,c=d(2);return g(c.goToPage(l))}),r(1),o()}if(a&2){let e=t.$implicit,i=d(2);h(e===i.currentPage()?"text-white bg-blue-600":"text-gray-500 bg-white border border-gray-300 hover:bg-gray-50"),s(),_(" ",e," ")}}function de(a,t){if(a&1){let e=b();n(0,"div",33)(1,"div",68),r(2),o(),n(3,"div",69)(4,"button",70),u("click",function(){f(e);let l=d();return g(l.goToPage(l.currentPage()-1))}),r(5," Previous "),o(),A(6,le,2,3,"button",71,j),n(8,"button",70),u("click",function(){f(e);let l=d();return g(l.goToPage(l.currentPage()+1))}),r(9," Next "),o()()()}if(a&2){let e=d();s(2),I(" Showing ",(e.currentPage()-1)*e.itemsPerPage+1," to ",e.Math.min(e.currentPage()*e.itemsPerPage,e.filteredNotifications().length)," of ",e.filteredNotifications().length," notifications "),s(2),T("disabled",e.currentPage()===1),s(2),M(e.visiblePages()),s(2),T("disabled",e.currentPage()===e.totalPages())}}var N=class a{notificationService=S(F);router=S(U);selectedType="";selectedStatus="";currentPage=w(1);itemsPerPage=10;isMarkingAllRead=!1;Math=Math;notifications=this.notificationService.notifications;unreadCount=this.notificationService.unreadCount;isLoading=this.notificationService.isLoading;totalCount=C(()=>this.notifications().length);readCount=C(()=>this.notifications().filter(t=>t.is_read).length);filteredNotifications=C(()=>{let t=this.notifications();return this.selectedType&&(t=t.filter(e=>e.type===this.selectedType)),this.selectedStatus==="read"?t=t.filter(e=>e.is_read):this.selectedStatus==="unread"&&(t=t.filter(e=>!e.is_read)),t});totalPages=C(()=>Math.ceil(this.filteredNotifications().length/this.itemsPerPage));paginatedNotifications=C(()=>{let t=(this.currentPage()-1)*this.itemsPerPage,e=t+this.itemsPerPage;return this.filteredNotifications().slice(t,e)});visiblePages=C(()=>{let t=this.totalPages(),e=this.currentPage(),i=[];if(t<=7)for(let l=1;l<=t;l++)i.push(l);else if(e<=4){for(let l=1;l<=5;l++)i.push(l);i.push(-1),i.push(t)}else if(e>=t-3){i.push(1),i.push(-1);for(let l=t-4;l<=t;l++)i.push(l)}else{i.push(1),i.push(-1);for(let l=e-1;l<=e+1;l++)i.push(l);i.push(-1),i.push(t)}return i});ngOnInit(){this.loadNotifications()}loadNotifications(){return v(this,null,function*(){try{yield this.notificationService.getNotifications({limit:100,page:1})}catch(t){console.error("Error loading notifications:",t)}})}refreshNotifications(){return v(this,null,function*(){yield this.loadNotifications()})}applyFilters(){this.currentPage.set(1)}goToPage(t){t>=1&&t<=this.totalPages()&&this.currentPage.set(t)}markAllAsRead(){return v(this,null,function*(){this.isMarkingAllRead=!0;try{yield this.notificationService.markAllAsRead()}catch(t){console.error("Error marking all as read:",t)}finally{this.isMarkingAllRead=!1}})}markAsRead(t,e){return v(this,null,function*(){if(e.stopPropagation(),!t.is_read)try{yield this.notificationService.markAsRead(t._id)}catch(i){console.error("Error marking notification as read:",i)}})}deleteNotification(t,e){return v(this,null,function*(){if(e.stopPropagation(),confirm("Are you sure you want to delete this notification?"))try{yield this.notificationService.deleteNotification(t._id)}catch(i){console.error("Error deleting notification:",i)}})}handleNotificationClick(t){t.is_read||this.notificationService.markAsRead(t._id).catch(e=>{console.error("Error marking notification as read:",e)}),this.navigateFromNotification(t)}navigateFromNotification(t){if(["project_created","project_accepted","project_rejected","project_started","project_completed","project_completed_by_business","project_completion_approved","project_completion_rejected","additional_payment_requested","additional_payment_approved","additional_payment_rejected","additional_payment_completed","payment_request","payment_approved","payment_rejected","completion_request","completion_approved","completion_rejected"].includes(t.type)&&t.project_id){let i=typeof t.project_id=="string"?t.project_id:t.project_id._id;this.router.navigate(["/dashboard/projects",i]);return}switch(t.type){case"message_received":t.metadata?.chatId&&this.router.navigate(["/dashboard/messages/chat",t.metadata.chatId]);break;case"business_approved":case"business_rejected":case"business_suspended":case"business_reactivated":if(t.business_id){let i=typeof t.business_id=="string"?t.business_id:t.business_id._id;this.router.navigate(["/dashboard/businesses",i])}break;case"review_received":if(t.project_id){let i=typeof t.project_id=="string"?t.project_id:t.project_id._id;this.router.navigate(["/project-details",i])}break;default:break}}getNotificationIcon(t){return this.notificationService.getNotificationIcon(t)}getNotificationStyles(t){let e="";return t.priority==="urgent"?e+="border-l-4 border-red-400 bg-red-50 ":t.priority==="high"?e+="border-l-4 border-orange-400 bg-orange-50 ":t.is_read||(e+="bg-blue-50 "),e}getPriorityBadgeClass(t){let e={low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"};return e[t]||e.medium}getTypeLabel(t){return{project_created:"Project Created",project_accepted:"Project Accepted",project_rejected:"Project Rejected",project_started:"Project Started",project_completed:"Project Completed",project_completed_by_business:"Project Completed - Awaiting Approval",project_completion_approved:"Project Completion Approved",project_completion_rejected:"Project Completion Rejected",additional_payment_requested:"Payment Requested",additional_payment_approved:"Payment Approved",additional_payment_rejected:"Payment Rejected",additional_payment_completed:"Payment Received",business_approved:"Business Approved",business_rejected:"Business Rejected",business_suspended:"Business Suspended",business_reactivated:"Business Reactivated",review_received:"Review Received",review_replied:"Review Replied",payment_request:"Payment Request",payment_approved:"Payment Approved",payment_rejected:"Payment Rejected",completion_request:"Completion Request",completion_approved:"Completion Approved",completion_rejected:"Completion Rejected",promotion:"Promotion",system_announcement:"Announcement",message_received:"Message"}[t]||"Notification"}formatTimeAgo(t){return this.notificationService.formatTimeAgo(t)}getEmptyMessage(){return this.selectedType&&this.selectedStatus?`No ${this.selectedStatus} notifications of type "${this.getTypeLabel(this.selectedType)}" found.`:this.selectedType?`No notifications of type "${this.getTypeLabel(this.selectedType)}" found.`:this.selectedStatus?`No ${this.selectedStatus} notifications found.`:"You don't have any notifications yet."}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=k({type:a,selectors:[["app-list-notifications"]],decls:61,vars:11,consts:[[1,"max-w-4xl","mx-auto","p-6"],[1,"mb-8"],[1,"text-3xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"mb-6","flex","flex-col","sm:flex-row","gap-4","items-start","sm:items-center","justify-between"],[1,"flex","flex-wrap","gap-3"],[1,"px-3","py-2","border","border-gray-300","rounded-lg","text-sm","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],["value",""],["value","project_created"],["value","project_accepted"],["value","project_rejected"],["value","project_started"],["value","project_completed"],["value","message_received"],["value","promotion"],["value","system_announcement"],["value","unread"],["value","read"],[1,"flex","gap-2"],[1,"px-4","py-2","text-sm","font-medium","text-blue-600","bg-blue-50","border","border-blue-200","rounded-lg","hover:bg-blue-100","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"px-4","py-2","text-sm","font-medium","text-gray-600","bg-white","border","border-gray-300","rounded-lg","hover:bg-gray-50","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","inline","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"mb-6","grid","grid-cols-1","sm:grid-cols-3","gap-4"],[1,"bg-white","border","border-gray-200","rounded-lg","p-4"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"text-2xl","font-bold","text-blue-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"bg-white","border","border-gray-200","rounded-lg","overflow-hidden"],[1,"flex","items-center","justify-center","py-12"],[1,"text-center","py-12"],[1,"divide-y","divide-gray-200"],[1,"mt-6","flex","items-center","justify-between"],[1,"px-4","py-2","text-sm","font-medium","text-blue-600","bg-blue-50","border","border-blue-200","rounded-lg","hover:bg-blue-100","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","mx-auto","mb-4","text-gray-300"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 17h5l-5.5-7V7a5 5 0 00-4.5-4.5A5 5 0 005.5 7v3L0 17h5m5 0v1a3 3 0 01-6 0v-1m6 0v1a3 3 0 006 0v-1"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"p-6","hover:bg-gray-50","transition-colors","duration-200","cursor-pointer",3,"class"],[1,"p-6","hover:bg-gray-50","transition-colors","duration-200","cursor-pointer",3,"click"],[1,"flex","items-start","space-x-4"],[1,"flex-shrink-0","mt-1"],[1,"w-10","h-10","rounded-full","bg-gray-100","flex","items-center","justify-center","text-lg"],[1,"flex-1","min-w-0"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-lg","font-medium","text-gray-900"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium",3,"class"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-gray-100","text-gray-800"],[1,"text-gray-700","mb-3"],[1,"mb-3","p-3","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"mb-3","p-3","bg-green-50","rounded-lg","border","border-green-200"],[1,"text-sm","text-gray-600","mb-3"],[1,"flex","items-center","gap-4","text-sm","text-gray-500"],[1,"flex","items-center","space-x-2","ml-4"],["title","Mark as read",1,"p-2","text-blue-600","hover:text-blue-800","hover:bg-blue-50","rounded-lg","transition-colors","duration-200"],["title","Delete notification",1,"p-2","text-red-600","hover:text-red-800","hover:bg-red-50","rounded-lg","transition-colors","duration-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"w-3","h-3","bg-blue-500","rounded-full"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium"],[1,"text-sm","font-medium","text-blue-900"],[1,"text-sm","text-blue-700"],[1,"text-sm","font-medium","text-green-900"],["title","Mark as read",1,"p-2","text-blue-600","hover:text-blue-800","hover:bg-blue-50","rounded-lg","transition-colors","duration-200",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-sm","text-gray-700"],[1,"flex","items-center","space-x-2"],[1,"px-3","py-2","text-sm","font-medium","text-gray-500","bg-white","border","border-gray-300","rounded-md","hover:bg-gray-50","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-3","py-2","text-sm","font-medium","rounded-md",3,"class"],[1,"px-3","py-2","text-sm","font-medium","rounded-md",3,"click"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),r(3,"Notifications"),o(),n(4,"p",3),r(5,"Stay updated with your projects and messages"),o()(),n(6,"div",4)(7,"div",5)(8,"select",6),L("ngModelChange",function(c){return O(i.selectedType,c)||(i.selectedType=c),c}),u("ngModelChange",function(){return i.applyFilters()}),n(9,"option",7),r(10,"All Types"),o(),n(11,"option",8),r(12,"Project Created"),o(),n(13,"option",9),r(14,"Project Accepted"),o(),n(15,"option",10),r(16,"Project Rejected"),o(),n(17,"option",11),r(18,"Project Started"),o(),n(19,"option",12),r(20,"Project Completed"),o(),n(21,"option",13),r(22,"Messages"),o(),n(23,"option",14),r(24,"Promotions"),o(),n(25,"option",15),r(26,"Announcements"),o()(),n(27,"select",6),L("ngModelChange",function(c){return O(i.selectedStatus,c)||(i.selectedStatus=c),c}),u("ngModelChange",function(){return i.applyFilters()}),n(28,"option",7),r(29,"All Status"),o(),n(30,"option",16),r(31,"Unread"),o(),n(32,"option",17),r(33,"Read"),o()()(),n(34,"div",18),m(35,z,2,2,"button",19),n(36,"button",20),u("click",function(){return i.refreshNotifications()}),y(),n(37,"svg",21),x(38,"path",22),o(),r(39," Refresh "),o()()(),R(),n(40,"div",23)(41,"div",24)(42,"div",25),r(43),o(),n(44,"div",26),r(45,"Total Notifications"),o()(),n(46,"div",24)(47,"div",27),r(48),o(),n(49,"div",26),r(50,"Unread"),o()(),n(51,"div",24)(52,"div",28),r(53),o(),n(54,"div",26),r(55,"Read"),o()()(),n(56,"div",29),m(57,K,2,0,"div",30)(58,X,7,1,"div",31)(59,se,3,0,"div",32),o(),m(60,de,10,5,"div",33),o()),e&2&&(s(8),D("ngModel",i.selectedType),s(19),D("ngModel",i.selectedStatus),s(8),p(i.unreadCount()>0?35:-1),s(),T("disabled",i.isLoading()),s(),V("animate-spin",i.isLoading()),s(6),E(i.totalCount()),s(5),E(i.unreadCount()),s(5),E(i.readCount()),s(4),p(i.isLoading()&&i.filteredNotifications().length===0?57:i.filteredNotifications().length===0?58:59),s(3),p(i.filteredNotifications().length>i.itemsPerPage?60:-1))},dependencies:[J,B,Q,W,H,G,Y,$],encapsulation:2})};var Pe=[{path:"",component:N},{path:"list",redirectTo:"",pathMatch:"full"}];export{Pe as NOTIFICATION_ROUTES};
