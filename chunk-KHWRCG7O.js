import{a as te,b as oe}from"./chunk-UW2ATRRX.js";import{h as Q,l as W,m as X}from"./chunk-66HTC5NI.js";import{d as j,e as H,h as J,k as K}from"./chunk-67MRJSI2.js";import"./chunk-WIJXL5PX.js";import"./chunk-RNGT6N3O.js";import"./chunk-UNULKHHN.js";import{a as Y,b as ee}from"./chunk-F52GGYS4.js";import"./chunk-2TVU5X7D.js";import{B as Z,c as z,e as x,h as q,i as A,l as O,p as G,r as U,z as $}from"./chunk-6HVQSJLB.js";import"./chunk-3DWAHAUX.js";import{b as L,c as I,d as D}from"./chunk-CAUPKMHV.js";import{a as B}from"./chunk-HHKFLDM6.js";import"./chunk-SRA5OYUU.js";import{s as F,t as V}from"./chunk-EZYZDCTR.js";import"./chunk-FTO62232.js";import"./chunk-LIZM4CZI.js";import"./chunk-QD7SSFII.js";import{a as T,c as N,d as R}from"./chunk-CHN72C3K.js";import"./chunk-GTSDDWM5.js";import{t as E}from"./chunk-Z5YYMG7R.js";import{Db as k,Eb as l,Fb as d,Kb as m,Lb as i,Mb as r,Nb as C,Pc as w,Ub as M,Yb as y,_a as a,_b as p,fa as h,ka as _,kc as f,la as b,mc as o,nc as u,pb as S,ua as c,xc as v}from"./chunk-ME5BD2TS.js";import{e as g}from"./chunk-JKOY2XUY.js";var re=()=>["/auth/forgot-password"],ie=()=>["/auth/login"],ae=()=>["/auth/signup"];function se(n,t){n&1&&(i(0,"div",1),C(1,"mat-spinner",4),i(2,"p",5),o(3,"Verifying reset token..."),r()())}function le(n,t){n&1&&(i(0,"div",2)(1,"div",6)(2,"mat-icon",7),o(3,"error_outline"),r(),i(4,"h2",8),o(5,"Invalid Reset Link"),r(),i(6,"p",5),o(7,"This password reset link is invalid or has expired."),r()(),i(8,"button",9),o(9," Request New Reset Link "),r(),i(10,"div",10)(11,"p",11),o(12," Remember your password? "),i(13,"a",12),o(14," Back to Login "),r()()()()),n&2&&(a(8),m("routerLink",v(2,re)),a(5),m("routerLink",v(3,ie)))}function de(n,t){if(n&1&&(i(0,"p",14),o(1,"Resetting password for: "),i(2,"strong"),o(3),r()()),n&2){let e=p(2);a(3),u(e.userEmail())}}function ce(n,t){n&1&&o(0," New password is required ")}function me(n,t){n&1&&o(0," Password must be at least 8 characters long ")}function ue(n,t){n&1&&o(0," Password must contain uppercase, lowercase, number, and special character ")}function pe(n,t){if(n&1&&(i(0,"mat-error"),l(1,ce,1,0)(2,me,1,0)(3,ue,1,0),r()),n&2){let e=p(2);a(),d(e.newPasswordControl!=null&&e.newPasswordControl.hasError("required")?1:e.newPasswordControl!=null&&e.newPasswordControl.hasError("minlength")?2:e.newPasswordControl!=null&&e.newPasswordControl.hasError("pattern")?3:-1)}}function we(n,t){n&1&&o(0," Please confirm your password ")}function he(n,t){if(n&1&&(i(0,"mat-error"),l(1,we,1,0),r()),n&2){let e=p(2);a(),d(e.confirmPasswordControl!=null&&e.confirmPasswordControl.hasError("required")?1:-1)}}function fe(n,t){n&1&&(i(0,"mat-error"),o(1," Passwords do not match "),r())}function Pe(n,t){n&1&&o(0," Reset Password ")}function ge(n,t){n&1&&(i(0,"span",26),C(1,"mat-spinner",29),o(2," Resetting Password... "),r())}function Ce(n,t){if(n&1){let e=M();i(0,"div",3)(1,"div",13)(2,"h2",8),o(3,"Set New Password"),r(),l(4,de,4,1,"p",14),i(5,"p",5),o(6,"Please enter your new password below."),r()(),i(7,"form",15),y("ngSubmit",function(){_(e);let P=p();return b(P.onSubmit())}),i(8,"mat-form-field",16)(9,"mat-label"),o(10,"New Password"),r(),C(11,"input",17),i(12,"button",18),y("click",function(){_(e);let P=p();return b(P.togglePasswordVisibility())}),i(13,"mat-icon"),o(14),r()(),l(15,pe,4,1,"mat-error"),r(),i(16,"mat-form-field",16)(17,"mat-label"),o(18,"Confirm New Password"),r(),C(19,"input",19),i(20,"button",18),y("click",function(){_(e);let P=p();return b(P.toggleConfirmPasswordVisibility())}),i(21,"mat-icon"),o(22),r()(),l(23,he,2,1,"mat-error"),l(24,fe,2,0,"mat-error"),r(),i(25,"div",20)(26,"h4",21),o(27,"Password Requirements:"),r(),i(28,"div",22)(29,"div",23)(30,"mat-icon",24),o(31),r(),o(32," At least 8 characters long "),r(),i(33,"div",23)(34,"mat-icon",24),o(35),r(),o(36," One uppercase letter "),r(),i(37,"div",23)(38,"mat-icon",24),o(39),r(),o(40," One lowercase letter "),r(),i(41,"div",23)(42,"mat-icon",24),o(43),r(),o(44," One number "),r(),i(45,"div",23)(46,"mat-icon",24),o(47),r(),o(48," One special character (@$!%*?&) "),r()()(),i(49,"button",25),l(50,Pe,1,0)(51,ge,3,0,"span",26),r(),i(52,"div",27)(53,"a",28),o(54," Remember your password? Back to Login "),r(),i(55,"div",10)(56,"p",11),o(57," Don't have an account? "),i(58,"a",12),o(59," Sign up "),r()()()()()()}if(n&2){let e=p();a(4),d(e.userEmail()?4:-1),a(3),m("formGroup",e.resetPasswordForm),a(4),m("type",e.showPassword()?"text":"password")("disabled",e.loading()),a(),k("aria-label","Toggle password visibility")("aria-pressed",e.showPassword()),a(2),u(e.showPassword()?"visibility_off":"visibility"),a(),d(e.newPasswordControl!=null&&e.newPasswordControl.invalid&&(e.newPasswordControl!=null&&e.newPasswordControl.touched)?15:-1),a(4),m("type",e.showConfirmPassword()?"text":"password")("disabled",e.loading()),a(),k("aria-label","Toggle confirm password visibility")("aria-pressed",e.showConfirmPassword()),a(2),u(e.showConfirmPassword()?"visibility_off":"visibility"),a(),d(e.confirmPasswordControl!=null&&e.confirmPasswordControl.invalid&&(e.confirmPasswordControl!=null&&e.confirmPasswordControl.touched)?23:-1),a(),d(e.resetPasswordForm.hasError("passwordMismatch")&&(e.confirmPasswordControl!=null&&e.confirmPasswordControl.touched)?24:-1),a(5),f("text-green-600",e.hasMinLength())("text-gray-500",!e.hasMinLength()),a(2),u(e.hasMinLength()?"check_circle":"radio_button_unchecked"),a(2),f("text-green-600",e.hasUppercase())("text-gray-500",!e.hasUppercase()),a(2),u(e.hasUppercase()?"check_circle":"radio_button_unchecked"),a(2),f("text-green-600",e.hasLowercase())("text-gray-500",!e.hasLowercase()),a(2),u(e.hasLowercase()?"check_circle":"radio_button_unchecked"),a(2),f("text-green-600",e.hasNumber())("text-gray-500",!e.hasNumber()),a(2),u(e.hasNumber()?"check_circle":"radio_button_unchecked"),a(2),f("text-green-600",e.hasSpecialChar())("text-gray-500",!e.hasSpecialChar()),a(2),u(e.hasSpecialChar()?"check_circle":"radio_button_unchecked"),a(2),m("disabled",!e.isFormValid()||e.loading()),a(),d(e.loading()?51:50),a(3),m("routerLink",v(44,ie)),a(5),m("routerLink",v(45,ae))}}function ve(n){let t=n.get("newPassword"),e=n.get("confirmPassword");return!t||!e||t.value===e.value?null:{passwordMismatch:!0}}var ne=class n{authService=h(B);router=h(N);route=h(T);fb=h($);snackBar=h(te);loading=c(!1);verifyingToken=c(!1);tokenValid=c(!1);userEmail=c("");showPassword=c(!1);showConfirmPassword=c(!1);currentPassword=c("");formValid=c(!1);resetToken="";resetPasswordForm;isFormValid=w(()=>this.formValid());hasMinLength=w(()=>this.currentPassword().length>=8);hasUppercase=w(()=>{let t=this.currentPassword();return/[A-Z]/.test(t)});hasLowercase=w(()=>{let t=this.currentPassword();return/[a-z]/.test(t)});hasNumber=w(()=>{let t=this.currentPassword();return/\d/.test(t)});hasSpecialChar=w(()=>{let t=this.currentPassword();return/[@$!%*?&]/.test(t)});constructor(){this.resetPasswordForm=this.fb.group({newPassword:["",[x.required,x.minLength(8),x.pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/)]],confirmPassword:["",[x.required]]},{validators:ve}),this.resetPasswordForm.get("newPassword")?.valueChanges.subscribe(t=>{this.currentPassword.set(t||"")}),this.resetPasswordForm.statusChanges.subscribe(()=>{this.formValid.set(this.resetPasswordForm.valid)}),this.formValid.set(this.resetPasswordForm.valid)}ngOnInit(){return g(this,null,function*(){this.route.queryParams.subscribe(t=>g(this,null,function*(){this.resetToken=t.token,this.resetToken?yield this.verifyToken():this.snackBar.open("Invalid reset link. Please request a new password reset.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}))})}verifyToken(){return g(this,null,function*(){this.verifyingToken.set(!0);try{let t=yield this.authService.verifyResetToken(this.resetToken);t.success?(this.tokenValid.set(!0),this.userEmail.set(t?.data?.email||"")):(this.snackBar.open(t.message||"Invalid or expired reset token.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]}),this.tokenValid.set(!1))}catch(t){this.snackBar.open(t?.message||"Invalid or expired reset token.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]}),this.tokenValid.set(!1)}finally{this.verifyingToken.set(!1)}})}onSubmit(){return g(this,null,function*(){if(!this.resetPasswordForm.valid){this.resetPasswordForm.hasError("passwordMismatch")?this.snackBar.open("Passwords do not match","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]}):this.snackBar.open("Please check all fields and try again","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]});return}let{newPassword:t,confirmPassword:e}=this.resetPasswordForm.value;this.loading.set(!0);try{let s=yield this.authService.resetPassword(this.resetToken,t,e);s.success?(this.snackBar.open(s.message||"Password has been reset successfully!","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-success"]}),setTimeout(()=>{this.router.navigate(["/auth/login"],{queryParams:{message:"Password reset successful. Please log in with your new password."}})},2e3)):this.snackBar.open(s.message||"Failed to reset password. Please try again.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}catch(s){this.snackBar.open(s?.message||"An unexpected error occurred. Please try again.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.loading.set(!1)}})}togglePasswordVisibility(){this.showPassword.set(!this.showPassword())}toggleConfirmPasswordVisibility(){this.showConfirmPassword.set(!this.showConfirmPassword())}get newPasswordControl(){return this.resetPasswordForm.get("newPassword")}get confirmPasswordControl(){return this.resetPasswordForm.get("confirmPassword")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-reset-password"]],decls:4,vars:3,consts:[[1,"reset-password-container"],[1,"text-center","space-y-4"],[1,"text-center","space-y-6"],[1,"reset-form-container"],["diameter","40"],[1,"text-gray-600"],[1,"mb-6"],[1,"text-6xl","text-red-500","mb-4"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],["mat-raised-button","","color","primary",1,"w-full","py-3","text-base","font-medium",3,"routerLink"],[1,"mt-4","pt-4","border-t","border-gray-200"],[1,"text-sm","text-gray-600"],["mat-button","","color","primary",1,"text-sm","font-medium","ml-1",3,"routerLink"],[1,"text-center","mb-8"],[1,"text-gray-600","mb-2"],[1,"space-y-6",3,"ngSubmit","formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","newPassword","placeholder","Enter your new password",3,"type","disabled"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["matInput","","formControlName","confirmPassword","placeholder","Confirm your new password",3,"type","disabled"],[1,"mb-4","p-4","bg-gray-50","border","border-gray-200","rounded-lg"],[1,"text-sm","font-medium","text-gray-700","mb-3"],[1,"space-y-2"],[1,"flex","items-center","text-sm"],[1,"text-sm","mr-2"],["mat-raised-button","","color","primary","type","submit",1,"w-full","py-3","text-base","font-medium","mb-4",3,"disabled"],[1,"flex","items-center","justify-center","gap-2"],[1,"space-y-3","text-center"],["mat-button","","color","primary",1,"text-sm",3,"routerLink"],["diameter","16"]],template:function(e,s){e&1&&(i(0,"div",0),l(1,se,4,0,"div",1),l(2,le,15,4,"div",2),l(3,Ce,60,46,"div",3),r()),e&2&&(a(),d(s.verifyingToken()?1:-1),a(),d(!s.verifyingToken()&&!s.tokenValid()?2:-1),a(),d(!s.verifyingToken()&&s.tokenValid()?3:-1))},dependencies:[E,Z,O,z,q,A,G,U,R,Q,K,j,H,J,X,W,D,I,L,V,F,ee,Y,oe],encapsulation:2})};export{ne as ResetPasswordComponent};
