import{a as ze,b as Be}from"./chunk-7CLBSEGG.js";import{c as De}from"./chunk-5LJRD7SL.js";import{a as W,b as qe,c as oe,d as Ve,e as Ae}from"./chunk-36WARNJW.js";import{a as Fe}from"./chunk-4SFR4OAV.js";import"./chunk-MK2SQHHV.js";import{a as K}from"./chunk-OYKPKFOG.js";import{c as Ie,h as Ee}from"./chunk-RHOIMVXD.js";import{g as Q}from"./chunk-WC4V5MBK.js";import"./chunk-SGMUXARX.js";import"./chunk-FGA65A7Y.js";import"./chunk-OIXXJWNI.js";import{h as je,m as Re}from"./chunk-RXAK7GQU.js";import"./chunk-SQHEFKI2.js";import{a as ie}from"./chunk-7RWCIHFI.js";import"./chunk-VRCQRP53.js";import{B as Oe,c as ye,e as ne,h as ve,i as we,l as Me,p as Pe,r as ke,z as Se}from"./chunk-MOPYAMLF.js";import{a as Te,b as Y}from"./chunk-ZH2LY4H3.js";import{b as xe}from"./chunk-AJJKGR3O.js";import{d as Ce}from"./chunk-PBEHQLRR.js";import{a as be}from"./chunk-7URIQAJJ.js";import"./chunk-XYHN2STO.js";import"./chunk-QVSCKNGL.js";import{b as he,c as fe,e as H}from"./chunk-SUTJIGUH.js";import{a as G}from"./chunk-VJC62ZZJ.js";import"./chunk-WZKZJ5DF.js";import{p as L,q as U}from"./chunk-A72LFUZP.js";import{o as ue}from"./chunk-IGUJQH2A.js";import"./chunk-GS6LNAK5.js";import"./chunk-QD7SSFII.js";import{a as $,b as _e,c as N,g as ge}from"./chunk-MEFNJ5SS.js";import"./chunk-GUCRBWY4.js";import{n as me,t as E}from"./chunk-REOVWAHI.js";import{Bb as O,Db as A,Ea as y,Eb as D,Gb as p,Hb as ae,Jb as z,Kb as B,Lb as a,Mb as r,Nb as v,Oc as j,Rb as f,Vb as _,Wb as l,ab as V,ac as re,bc as se,cb as s,cc as ce,fa as w,gc as c,hc as x,ic as M,jc as le,na as g,oa as u,ob as I,pa as R,qa as q,ub as C,xc as de,yc as pe}from"./chunk-BEPULU6C.js";import{a as te,e as h}from"./chunk-JKOY2XUY.js";var J=class i{static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-messages"]],decls:1,vars:0,template:function(e,n){e&1&&v(0,"router-outlet")},dependencies:[E,_e],encapsulation:2})};var We=(i,t)=>t._id;function Je(i,t){i&1&&(a(0,"div",10),v(1,"mat-spinner",14),r())}function Xe(i,t){if(i&1&&(a(0,"div",11)(1,"div",15)(2,"mat-icon",16),c(3,"error"),r(),a(4,"span",17),c(5),r()()()),i&2){let e=l();s(5),x(e.error())}}function Ze(i,t){if(i&1&&v(0,"img",22),i&2){let e=l().$implicit;O("src",e.project_id.business_id.logo_url,V)("alt",e.project_id.business_id.name)}}function et(i,t){i&1&&(a(0,"div",23)(1,"mat-icon",36),c(2,"business"),r()())}function tt(i,t){if(i&1){let e=f();a(0,"div",19),_("click",function(){let o=g(e).$implicit,d=l(2);return u(d.openChat(o))}),a(1,"div",20)(2,"div",21),C(3,Ze,1,2,"img",22)(4,et,3,0,"div",23),r(),a(5,"div",24)(6,"div",25)(7,"div",26)(8,"h3",27),c(9),r(),a(10,"div",28)(11,"span",29),c(12),r(),a(13,"span",30),c(14,"\u2022"),r(),a(15,"span",29),c(16),r()(),a(17,"div",31)(18,"span",32),c(19),de(20,"titlecase"),r(),a(21,"span",33),c(22),r()()(),a(23,"div",34)(24,"button",35),_("click",function(o){let d=g(e).$implicit,b=l(2);return u(b.viewProject((d.project_id==null?null:d.project_id._id)||"",o))}),a(25,"mat-icon"),c(26,"open_in_new"),r()(),a(27,"mat-icon",30),c(28,"chevron_right"),r()()()()()()}if(i&2){let e=t.$implicit,n=l(2);s(3),p(!(e.project_id==null||e.project_id.business_id==null)&&e.project_id.business_id.logo_url?3:4),s(6),x(e.title),s(3),M(" With ",n.getOtherParticipant(e).last_name||"Unknown User"," "),s(4),x((e.project_id==null||e.project_id.business_id==null?null:e.project_id.business_id.name)||"Unknown Business"),s(2),D(n.getProjectStatusColor((e.project_id==null?null:e.project_id.status)||"unknown")),s(),M(" ",pe(20,8,(e.project_id==null?null:e.project_id.status)||"Unknown")," "),s(3),x(n.formatDate(e.last_message_at))}}function nt(i,t){if(i&1&&(a(0,"div",12),z(1,tt,29,10,"div",18,We),r()),i&2){let e=l();s(),B(e.chats())}}function it(i,t){if(i&1){let e=f();a(0,"div",13)(1,"div",37)(2,"mat-icon",38),c(3,"chat_bubble_outline"),r()(),a(4,"h3",39),c(5,"No conversations yet"),r(),a(6,"p",40),c(7," Start a conversation by creating a project or accepting project requests. "),r(),a(8,"button",41),_("click",function(){g(e);let o=l();return u(o.navigateToProjects())}),c(9," View Projects "),r()()}}var X=class i{chatService=w(W);authService=w(G);projectService=w(K);router=w(N);route=w($);loading=y(!1);error=y(null);chats=y([]);unreadCount=y(0);user=this.authService.user;hasChats=j(()=>this.chats().length>0);ngOnInit(){if(!this.user()){this.router.navigate(["/auth"]);return}this.loadChats(),this.loadUnreadCount()}loadChats(){return h(this,null,function*(){this.loading.set(!0),this.error.set(null);try{let t=yield this.chatService.getUserChatsAsync();this.chats.set(t)}catch(t){console.error("Error loading chats:",t),this.error.set("Failed to load chats")}finally{this.loading.set(!1)}})}loadUnreadCount(){return h(this,null,function*(){try{let t=yield this.chatService.getUnreadMessageCountAsync();this.unreadCount.set(t)}catch(t){console.error("Error loading unread count:",t)}})}openChat(t){this.router.navigate(["../chat",t._id],{relativeTo:this.route})}viewProject(t,e){e.stopPropagation(),t&&this.router.navigate(["/dashboard/projects",t])}getOtherParticipant(t){let e=this.user()?._id;return t.project_id?t.project_id.client_id._id===e?t.project_id.business_owner_id:t.project_id.client_id:{last_name:"Unknown User",email:""}}getProjectStatusColor(t){let e={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",accepted:"bg-blue-100 text-blue-800 border-blue-200",in_progress:"bg-purple-100 text-purple-800 border-purple-200",completed:"bg-green-100 text-green-800 border-green-200",rejected:"bg-red-100 text-red-800 border-red-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200"};return e[t]||e.pending}formatDate(t){let e=new Date(t),o=(new Date().getTime()-e.getTime())/(1e3*60*60);if(o<1){let d=Math.floor(o*60);return d<1?"Just now":`${d}m ago`}else return o<24?`${Math.floor(o)}h ago`:o<48?"Yesterday":e.toLocaleDateString()}refreshChats(){return h(this,null,function*(){yield this.loadChats(),yield this.loadUnreadCount()})}navigateBack(){this.router.navigate(["/dashboard"])}navigateToProjects(){this.router.navigate(["/dashboard/projects"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-chat-list"]],decls:20,vars:5,consts:[[1,"min-h-screen","bg-gray-50"],[1,"max-w-6xl","mx-auto","px-4","py-8"],[1,"flex","items-center","justify-between","mb-8"],[1,"flex","items-center","space-x-4"],["mat-icon-button","",1,"flex","items-center","justify-center","w-10","h-10","rounded-full","bg-white","shadow-sm","border","border-gray-200","hover:bg-gray-50","transition-colors",3,"click"],[1,"text-gray-600"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-gray-600","mt-1"],["mat-raised-button","","color","primary",1,"px-6","py-3","text-base","font-semibold","rounded-lg",3,"click","disabled"],[1,"mr-2"],[1,"flex","justify-center","items-center","py-12"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-6","mb-6"],[1,"space-y-4"],[1,"text-center","py-12"],["diameter","40"],[1,"flex","items-center"],[1,"text-red-600","mr-2"],[1,"text-red-800","font-medium"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","p-6","cursor-pointer","hover:shadow-md","transition-all","duration-200"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","p-6","cursor-pointer","hover:shadow-md","transition-all","duration-200",3,"click"],[1,"flex","items-start","space-x-4"],[1,"flex-shrink-0"],[1,"w-12","h-12","rounded-full","object-cover","border","border-gray-200",3,"src","alt"],[1,"w-12","h-12","rounded-full","bg-gradient-to-br","from-blue-400","to-blue-600","flex","items-center","justify-center"],[1,"flex-1","min-w-0"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"text-lg","font-semibold","text-gray-900","mb-1"],[1,"flex","items-center","space-x-2","mb-2"],[1,"text-sm","text-gray-600"],[1,"text-gray-400"],[1,"flex","items-center","space-x-3"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","border"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","space-x-2"],["mat-icon-button","",1,"text-gray-400","hover:text-gray-600",3,"click"],[1,"text-white"],[1,"mx-auto","w-24","h-24","bg-gray-100","rounded-full","flex","items-center","justify-center","mb-6"],[1,"text-gray-400","w-12","h-12"],[1,"text-xl","font-medium","text-gray-900","mb-2"],[1,"text-gray-500","mb-6"],["mat-raised-button","","color","primary",1,"px-6","py-3","text-base","font-semibold","rounded-lg",3,"click"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),_("click",function(){return n.navigateBack()}),a(5,"mat-icon",5),c(6,"arrow_back"),r()(),a(7,"div")(8,"h1",6),c(9,"Messages"),r(),a(10,"p",7),c(11,"Communicate with your project partners"),r()()(),a(12,"button",8),_("click",function(){return n.refreshChats()}),a(13,"mat-icon",9),c(14,"refresh"),r(),c(15," Refresh "),r()(),C(16,Je,2,0,"div",10)(17,Xe,6,1,"div",11)(18,nt,3,0,"div",12)(19,it,10,0,"div",13),r()()),e&2&&(s(12),O("disabled",n.loading()),s(4),p(n.loading()?16:-1),s(),p(n.error()&&!n.loading()?17:-1),s(),p(n.hasChats()&&!n.loading()?18:-1),s(),p(!n.hasChats()&&!n.loading()&&!n.error()?19:-1))},dependencies:[E,me,ge,Q,H,fe,he,U,L,Y,Te,xe],styles:[".chat-item[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.chat-item[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.unread-indicator[_ngcontent-%COMP%]{position:absolute;top:-2px;right:-2px;width:8px;height:8px;background-color:#ef4444;border-radius:50%;border:2px solid white}"]})};var ot=["messagesContainer"],at=(i,t)=>t._id;function rt(i,t){if(i&1&&v(0,"img",17),i&2){let e=l();O("src",e.project_id.business_id.logo_url,V)("alt",e.project_id.business_id.name)}}function st(i,t){i&1&&(a(0,"div",18),R(),a(1,"svg",26),v(2,"path",27),r()())}function ct(i,t){if(i&1&&(a(0,"div",8),C(1,rt,1,2,"img",17)(2,st,3,0,"div",18),a(3,"div",19)(4,"h2",20),c(5),r(),a(6,"div",21)(7,"span",22),c(8),r(),a(9,"div",23),v(10,"div",24),a(11,"span",25),c(12),r()()()()()),i&2){let e,n=t,o=l();s(),p(!(n.project_id==null||n.project_id.business_id==null)&&n.project_id.business_id.logo_url?1:2),s(4),x(n.title),s(3),x(((e=o.otherParticipant())==null?null:e.last_name)||"Unknown User"),s(2),A("online",o.isConnected()),s(2),x(o.isConnected()?"Online":"Offline")}}function lt(i,t){if(i&1){let e=f();a(0,"button",38),_("click",function(){g(e);let o=l(2);return u(o.handleProjectAction("accept"))}),c(1," Accept "),r()}}function dt(i,t){if(i&1){let e=f();a(0,"button",39),_("click",function(){g(e);let o=l(2);return u(o.handleProjectAction("reject"))}),c(1," Reject "),r()}}function pt(i,t){if(i&1){let e=f();a(0,"button",40),_("click",function(){g(e);let o=l(2);return u(o.handleProjectAction("request_payment"))}),c(1," Request Initial Payment "),r()}}function mt(i,t){if(i&1){let e=f();a(0,"button",41),_("click",function(){g(e);let o=l(2);return u(o.handleProjectAction("start"))}),c(1," Start "),r()}}function _t(i,t){if(i&1){let e=f();a(0,"button",42),_("click",function(){g(e);let o=l(2);return u(o.handleProjectAction("complete"))}),c(1," Request Completion "),r()}}function gt(i,t){if(i&1){let e=f();a(0,"button",42),_("click",function(){g(e);let o=l(2);return u(o.handleProjectAction("approve_completion"))}),c(1," Approve Completion "),r()}}function ut(i,t){if(i&1){let e=f();a(0,"button",43),_("click",function(){g(e);let o=l(2);return u(o.handleReviewAction())}),c(1),r()}if(i&2){let e=l(2);s(),M(" ",e.reviewButtonText()," ")}}function ht(i,t){if(i&1){let e=f();a(0,"button",44),_("click",function(){g(e);let o=l(2);return u(o.openReportDialog())}),a(1,"mat-icon"),c(2,"flag"),r()()}}function ft(i,t){if(i&1){let e=f();a(0,"button",38),_("click",function(){g(e);let o=l(2);return u(o.handleProjectAction("accept"))}),c(1," Accept Project "),r()}}function Ct(i,t){if(i&1){let e=f();a(0,"button",39),_("click",function(){g(e);let o=l(2);return u(o.handleProjectAction("reject"))}),c(1," Reject "),r()}}function xt(i,t){if(i&1){let e=f();a(0,"button",40),_("click",function(){g(e);let o=l(2);return u(o.handleProjectAction("request_payment"))}),c(1," Request Initial Payment "),r()}}function bt(i,t){if(i&1){let e=f();a(0,"button",41),_("click",function(){g(e);let o=l(2);return u(o.handleProjectAction("start"))}),c(1," Start Project "),r()}}function yt(i,t){if(i&1){let e=f();a(0,"button",42),_("click",function(){g(e);let o=l(2);return u(o.handleProjectAction("complete"))}),c(1," Request Completion "),r()}}function vt(i,t){if(i&1){let e=f();a(0,"button",42),_("click",function(){g(e);let o=l(2);return u(o.handleProjectAction("approve_completion"))}),c(1," Approve Completion "),r()}}function wt(i,t){if(i&1){let e=f();a(0,"button",45),_("click",function(){g(e);let o=l(2);return u(o.requestAdditionalPayment())}),c(1," Request Payment "),r()}}function Mt(i,t){if(i&1){let e=f();a(0,"button",43),_("click",function(){g(e);let o=l(2);return u(o.handleReviewAction())}),c(1),r()}if(i&2){let e=l(2);s(),M(" ",e.reviewButtonText()," ")}}function Pt(i,t){if(i&1){let e=f();a(0,"button",44),_("click",function(){g(e);let o=l(2);return u(o.openReportDialog())}),a(1,"mat-icon"),c(2,"flag"),r(),c(3," Report User "),r()}}function kt(i,t){if(i&1&&(a(0,"div",28),C(1,lt,2,0,"button",29)(2,dt,2,0,"button",30)(3,pt,2,0,"button",31)(4,mt,2,0,"button",32)(5,_t,2,0,"button",33)(6,gt,2,0,"button",33)(7,ut,2,1,"button",34)(8,ht,3,0,"button",35),r(),a(9,"div",36),C(10,ft,2,0,"button",29)(11,Ct,2,0,"button",30)(12,xt,2,0,"button",31)(13,bt,2,0,"button",32)(14,yt,2,0,"button",33)(15,vt,2,0,"button",33)(16,wt,2,0,"button",37)(17,Mt,2,1,"button",34)(18,Pt,4,0,"button",35),r()),i&2){let e=l();s(),p(e.canPerformAction("accept")?1:-1),s(),p(e.canPerformAction("reject")?2:-1),s(),p(e.canPerformAction("request_payment")?3:-1),s(),p(e.canPerformAction("start")&&!e.canPerformAction("accept")&&!e.canPerformAction("request_payment")?4:e.canPerformAction("complete")?5:e.canPerformAction("approve_completion")?6:e.showReviewButton()?7:-1),s(4),p(e.otherParticipant()?8:-1),s(2),p(e.canPerformAction("accept")?10:-1),s(),p(e.canPerformAction("reject")?11:-1),s(),p(e.canPerformAction("request_payment")?12:-1),s(),p(e.canPerformAction("start")?13:-1),s(),p(e.canPerformAction("complete")?14:-1),s(),p(e.canPerformAction("approve_completion")?15:-1),s(),p(e.canRequestPayment()?16:-1),s(),p(e.showReviewButton()?17:-1),s(),p(e.otherParticipant()?18:-1)}}function St(i,t){i&1&&(a(0,"div",14),v(1,"div",46),a(2,"p",47),c(3,"Loading conversation..."),r()())}function Ot(i,t){if(i&1&&(a(0,"div",15)(1,"div",48),R(),a(2,"svg",49),v(3,"path",50),r(),q(),a(4,"span",51),c(5),r()()()),i&2){let e=l();s(5),x(e.error())}}function jt(i,t){if(i&1&&(a(0,"div",55)(1,"span",64),c(2),r()()),i&2){let e=l().$implicit,n=l(3);s(2),M(" ",n.formatMessageDate(e.createdAt)," ")}}function Rt(i,t){if(i&1&&(a(0,"div",58)(1,"span",65),c(2),r()()),i&2){let e=l().$implicit;s(2),le(" ",e.sender_id.email.charAt(0).toUpperCase(),"",e.sender_id.last_name.charAt(0).toUpperCase()," ")}}function Tt(i,t){if(i&1&&(a(0,"div",60),R(),a(1,"svg",66),v(2,"path",67),r(),c(3),r()),i&2){let e=l().$implicit;s(3),M(" ",e.content," ")}}function It(i,t){if(i&1){let e=f();a(0,"div",74)(1,"button",76),_("click",function(){g(e);let o=l(2).$implicit,d=l(3);return u(d.approvePaymentRequest(o._id))}),c(2," Approve & Pay "),r(),a(3,"button",39),_("click",function(){g(e);let o=l(2).$implicit,d=l(3);return u(d.rejectPaymentRequest(o._id))}),c(4," Reject "),r()()}}function Et(i,t){if(i&1&&(a(0,"div",61)(1,"div",68)(2,"mat-icon"),c(3,"payment"),r(),a(4,"h4"),c(5),r(),a(6,"span",69),c(7),r()(),a(8,"div",70)(9,"div",71),c(10),r(),a(11,"div",72),c(12),r(),a(13,"p",73),c(14),r()(),C(15,It,5,0,"div",74),a(16,"div",75),c(17),r()()),i&2){let e=l().$implicit,n=l(3);s(5),x(n.isInitialPayment(e)?"Initial Payment Request":"Additional Payment Request"),s(),D("status-"+e.payment_status),s(),M(" ",e.payment_status," "),s(3),M("$",e.payment_amount,""),s(2),x(e.payment_description),s(2),x(e.content),s(),p(n.canRespondToPayment(e)?15:-1),s(2),M(" ",n.formatMessageTime(e.createdAt)," ")}}function Ft(i,t){if(i&1){let e=f();a(0,"div",80)(1,"button",76),_("click",function(){g(e);let o=l(5);return u(o.approveCompletion())}),c(2," Approve Completion "),r(),a(3,"button",39),_("click",function(){g(e);let o=l(5);return u(o.rejectCompletion())}),c(4," Request Changes "),r()()}}function qt(i,t){if(i&1&&(a(0,"div",62)(1,"div",77)(2,"mat-icon"),c(3,"check_circle"),r(),a(4,"h4"),c(5,"Project Completion Request"),r(),a(6,"span",78),c(7),r()(),a(8,"div",79)(9,"p"),c(10),r()(),C(11,Ft,5,0,"div",80),a(12,"div",75),c(13),r()()),i&2){let e=l().$implicit,n=l(3);s(6),D("status-"+e.completion_status),s(),M(" ",e.completion_status," "),s(3),x(e.content),s(),p(n.canRespondToCompletion(e)?11:-1),s(2),M(" ",n.formatMessageTime(e.createdAt)," ")}}function Vt(i,t){if(i&1&&(a(0,"p",84),c(1),r()),i&2){let e=l(3).$implicit;s(),x(e.content)}}function At(i,t){if(i&1){let e=f();a(0,"div",82)(1,"img",86),_("click",function(){g(e);let o=l(2).$implicit,d=l(3);return u(d.downloadFile(o.file_url,o.file_name||"image"))}),r(),C(2,Vt,2,1,"p",84),r()}if(i&2){let e=l(2).$implicit;s(),O("src",e.file_url,V)("alt",e.file_name||"Image"),s(),p(e.content&&e.content!==e.file_name?2:-1)}}function Dt(i,t){if(i&1&&(a(0,"span",91),c(1),r()),i&2){let e=l(3).$implicit,n=l(3);s(),x(n.formatFileSize(e.file_size))}}function zt(i,t){if(i&1&&(a(0,"p",84),c(1),r()),i&2){let e=l(3).$implicit;s(),x(e.content)}}function Bt(i,t){if(i&1){let e=f();a(0,"div",83)(1,"div",87)(2,"mat-icon",88),c(3,"attach_file"),r(),a(4,"div",89)(5,"span",90),c(6),r(),C(7,Dt,2,1,"span",91),r(),a(8,"button",92),_("click",function(){g(e);let o=l(2).$implicit,d=l(3);return u(d.downloadFile(o.file_url,o.file_name||"file"))}),a(9,"mat-icon"),c(10,"download"),r()()(),C(11,zt,2,1,"p",84),r()}if(i&2){let e=l(2).$implicit;s(6),x(e.file_name),s(),p(e.file_size?7:-1),s(4),p(e.content&&e.content!==e.file_name?11:-1)}}function $t(i,t){if(i&1&&(a(0,"p",84),c(1),r()),i&2){let e=l(2).$implicit;s(),x(e.content)}}function Nt(i,t){i&1&&(a(0,"span",85),c(1,"(edited)"),r())}function Lt(i,t){if(i&1&&(a(0,"div",81),C(1,At,3,3,"div",82)(2,Bt,12,3,"div",83)(3,$t,2,1,"p",84)(4,Nt,2,0,"span",85),a(5,"div",75),c(6),r()()),i&2){let e=l().$implicit,n=l(3);A("my-bubble",n.isMyMessage(e))("other-bubble",!n.isMyMessage(e)),s(),p(n.isImageFile(e)?1:n.isFileMessage(e)?2:3),s(3),p(e.is_edited?4:-1),s(2),M(" ",n.formatMessageTime(e.createdAt)," ")}}function Ut(i,t){if(i&1&&(C(0,jt,3,1,"div",55),a(1,"div",56)(2,"div",57),C(3,Rt,3,2,"div",58),a(4,"div",59),C(5,Tt,4,1,"div",60)(6,Et,18,9,"div",61)(7,qt,14,6,"div",62)(8,Lt,7,7,"div",63),r()()()),i&2){let e=t.$implicit,n=t.$index,o=l(3);p(o.shouldShowDateDivider(n)?0:-1),s(),A("my-message",o.isMyMessage(e)),s(2),p(o.isMyMessage(e)?-1:3),s(2),p(e.message_type==="project_update"?5:o.isPaymentRequest(e)?6:o.isCompletionRequest(e)?7:8)}}function Ht(i,t){if(i&1&&(a(0,"div",53),z(1,Ut,9,5,null,null,at),r()),i&2){let e=l(2);s(),B(e.messages())}}function Gt(i,t){if(i&1&&(a(0,"div",54)(1,"div",93),R(),a(2,"svg",94),v(3,"path",95),r()(),q(),a(4,"h3",96),c(5,"Start the conversation"),r(),a(6,"p",97),c(7," No messages yet. Send the first message to start discussing your project "),a(8,"span",98),c(9),r()()()),i&2){let e,n=l(2);s(9),M('"',(e=n.chat())==null?null:e.title,'"')}}function Kt(i,t){if(i&1&&(a(0,"div",16,0)(2,"div",52),C(3,Ht,3,0,"div",53)(4,Gt,10,1,"div",54),r()()),i&2){let e=l();s(3),p(e.hasMessages()?3:4)}}function Yt(i,t){if(i&1&&(a(0,"div",99)(1,"div",100)(2,"div",101)(3,"mat-icon",102),c(4,"lock"),r(),a(5,"div",103)(6,"h4"),c(7),r(),a(8,"p"),c(9,"This conversation has been archived and is now read-only."),r()()()()()),i&2){let e=l(2);s(7),x(e.chatDisabledMessage())}}function Qt(i,t){if(i&1&&(a(0,"div",104)(1,"div",116),v(2,"div",117)(3,"div",117)(4,"div",117),r(),a(5,"span",118),c(6),r()()),i&2){let e=l(3);s(6),x(e.getTypingText())}}function Wt(i,t){i&1&&(a(0,"div",105),v(1,"div",119),a(2,"span",120),c(3,"Uploading files..."),r()())}function Jt(i,t){if(i&1){let e=f();a(0,"div",121)(1,"mat-icon",88),c(2),r(),a(3,"div",87)(4,"span",90),c(5),r(),a(6,"span",91),c(7),r()(),a(8,"button",125),_("click",function(){let o=g(e).$index,d=l(4);return u(d.removeSelectedFile(o))}),a(9,"mat-icon"),c(10,"close"),r()()()}if(i&2){let e=t.$implicit,n=l(4);s(2),x(n.getFileIcon(e)),s(3),x(e.name),s(2),x(n.formatFileSize(e.size))}}function Xt(i,t){if(i&1){let e=f();a(0,"div",106),z(1,Jt,11,3,"div",121,ae),a(3,"div",122)(4,"button",123),_("click",function(){g(e);let o=l(3);return u(o.uploadFiles(o.selectedFiles()))}),a(5,"mat-icon"),c(6,"cloud_upload"),r(),c(7," Upload Files "),r(),a(8,"button",124),_("click",function(){g(e);let o=l(3);return u(o.selectedFiles.set([]))}),c(9," Cancel "),r()()()}if(i&2){let e=l(3);s(),B(e.selectedFiles())}}function Zt(i,t){i&1&&v(0,"div",114)}function en(i,t){i&1&&(R(),a(0,"svg",115),v(1,"path",126),r())}function tn(i,t){if(i&1){let e=f();a(0,"div",99),C(1,Qt,7,1,"div",104)(2,Wt,4,0,"div",105)(3,Xt,10,0,"div",106),a(4,"div",107)(5,"input",108),_("change",function(o){g(e);let d=l(2);return u(d.onFileSelect(o))}),r(),a(6,"form",109),_("ngSubmit",function(){g(e);let o=l(2);return u(o.sendMessage())}),a(7,"button",110),_("click",function(){g(e);let o=l(2);return u(o.triggerFileInput())}),a(8,"mat-icon"),c(9,"attach_file"),r()(),a(10,"div",111)(11,"textarea",112),_("input",function(){g(e);let o=l(2);return u(o.onTextareaInput())})("keydown",function(o){g(e);let d=l(2);return u(d.onTextareaKeydown(o))}),r()(),a(12,"button",113),C(13,Zt,1,0,"div",114)(14,en,2,0,":svg:svg",115),r()()()()}if(i&2){let e=l(2);s(),p(e.typingUsers().length>0?1:-1),s(),p(e.uploadingFiles()?2:-1),s(),p(e.selectedFiles().length>0&&!e.uploadingFiles()?3:-1),s(3),O("formGroup",e.messageForm),s(),O("disabled",e.uploadingFiles()),s(5),A("sending",e.sendingMessage()),O("disabled",!e.messageForm.valid||e.sendingMessage()||e.uploadingFiles()),s(),p(e.sendingMessage()?13:14)}}function nn(i,t){if(i&1&&C(0,Yt,10,1,"div",99)(1,tn,15,9,"div",99),i&2){let e=l();p(e.isChatDisabled()?0:1)}}var Z=class i{messagesContainer;chatService=w(W);authService=w(G);projectService=w(K);reviewService=w(Fe);socketService=w(be);router=w(N);route=w($);formBuilder=w(Se);breakpointObserver=w(ue);dialog=w(Ie);reportsService=w(De);loading=y(!1);messagesLoading=y(!1);sendingMessage=y(!1);uploadingFiles=y(!1);error=y(null);chat=y(null);messages=y([]);typingUsers=y([]);isConnected=y(!1);isMobile=y(!1);selectedFiles=y([]);canLeaveReview=y(!1);existingReview=y(null);reviewButtonText=j(()=>this.existingReview()?`View Review (${this.existingReview().rating}\u2B50)`:this.canLeaveReview()?"Leave Review":"");showReviewButton=j(()=>!!(this.canLeaveReview()||this.existingReview()));isChatDisabled=j(()=>{let t=this.chat();if(!t||!t.project_id)return!1;let e=t.project_id.status;return e==="completed"||e==="settled"});chatDisabledMessage=j(()=>{let t=this.chat();if(!t||!t.project_id)return"";let e=t.project_id.status;return e==="completed"?"Project completed - Chat will be disabled after payment processing":e==="settled"?"Project completed and payment processed - Chat is now disabled":""});messageForm;user=this.authService.user;hasMessages=j(()=>this.messages().length>0);otherParticipant=j(()=>{let t=this.chat(),e=this.user()?._id;return!t||!e||!t.project_id?null:t.project_id.client_id._id===e?t.project_id.business_owner_id:t.project_id.client_id});chatId=null;shouldScrollToBottom=!1;refreshInterval;subscriptions=[];typingTimeout;constructor(){this.messageForm=this.formBuilder.group({content:["",[ne.required,ne.maxLength(1e3)]]})}ngOnInit(){if(!this.user()){this.router.navigate(["/auth"]);return}this.requestNotificationPermission(),this.setupMobileDetection(),this.setupSocketSubscriptions(),this.route.params.subscribe(t=>{this.chatId=t.chatId,this.chatId&&(this.loadChat(),this.checkReviewEligibility(),this.loadMessages(),this.markMessagesAsRead(),this.joinSocketRoom())})}ngOnDestroy(){this.refreshInterval&&clearInterval(this.refreshInterval),this.typingTimeout&&clearTimeout(this.typingTimeout),this.chatId&&this.socketService.leaveChat(this.chatId),this.subscriptions.forEach(t=>t.unsubscribe())}requestNotificationPermission(){"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission().then(t=>{console.log("Notification permission:",t)})}ngAfterViewChecked(){this.shouldScrollToBottom&&(this.scrollToBottom(),this.shouldScrollToBottom=!1)}setupMobileDetection(){let t=this.breakpointObserver.observe([ie.Handset,ie.Small]).subscribe(e=>{this.isMobile.set(e.matches)});this.subscriptions.push(t)}setupSocketSubscriptions(){let t=this.socketService.isConnected$.subscribe(m=>{this.isConnected.set(m)}),e=this.socketService.onNewMessage().subscribe(m=>{if(m.success&&m.data){let k=this.messages();if(k.find(S=>S._id===m.data._id)){console.log("Message already exists, skipping duplicate:",m.data._id);return}this.messages.set([...k,m.data]),this.shouldScrollToBottom=!0,m.data.message_type==="payment_request"&&this.handlePaymentRequestNotification(m.data)}}),n=this.socketService.onMessageError().subscribe(m=>{console.error("Socket message error:",m),this.error.set(m.error||"Message failed to send")}),o=this.socketService.getTypingUsersForChat().subscribe(m=>{let k=this.user()?._id,T=m.filter(S=>S.userId!==k);this.typingUsers.set(T)}),d=this.socketService.onEvent("files-uploaded").subscribe(m=>{m.chatId===this.chatId&&(console.log("Files uploaded in this chat, refreshing messages"),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),b=this.socketService.onEvent("payment-request-created").subscribe(m=>{m.chatId===this.chatId&&(console.log("Payment request created in this chat, refreshing messages"),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),F=this.socketService.onEvent("payment-approved").subscribe(m=>{m.chatId===this.chatId&&(console.log("Payment approved in this chat, refreshing messages"),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),P=this.socketService.onEvent("payment-rejected").subscribe(m=>{m.chatId===this.chatId&&(console.log("Payment rejected in this chat, refreshing messages"),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),ee=this.socketService.onEvent("payment-completed").subscribe(m=>{console.log("\u{1F4B0} Payment completed event received:",m),m.chatId===this.chatId?(console.log("\u2705 Payment completed in THIS chat, refreshing messages and chat data"),console.log("\u{1F504} About to call loadMessages..."),this.loadMessages(!1),console.log("\u{1F504} About to call loadChat..."),this.loadChat(),this.shouldScrollToBottom=!0,console.log("\u2705 Message and chat reload triggered")):console.log("\u274C Payment completed in different chat:",m.chatId,"vs",this.chatId)}),Le=this.socketService.onEvent("completion-request-created").subscribe(m=>{m.chatId===this.chatId&&(console.log("Completion request created in this chat, refreshing messages"),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),Ue=this.socketService.onEvent("completion-approved").subscribe(m=>{m.chatId===this.chatId&&(console.log("Completion approved in this chat, refreshing messages"),this.loadChat(),this.loadMessages(!1),this.checkReviewEligibility(),this.shouldScrollToBottom=!0)}),He=this.socketService.onEvent("completion-rejected").subscribe(m=>{m.chatId===this.chatId&&(console.log("Completion rejected in this chat, refreshing messages"),this.loadChat(),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),Ge=this.socketService.onEvent("project-status-updated").subscribe(m=>{console.log("Project status updated:",m);let k=this.chat();k&&k.project_id?._id===m.projectId&&(console.log("Project status updated for current chat, refreshing chat data"),this.loadChat(),this.loadMessages(!1),this.checkReviewEligibility(),this.shouldScrollToBottom=!0)}),Ke=this.socketService.onEvent("system-message").subscribe(m=>{console.log("System message received:",m),m.chatId===this.chatId&&(console.log("System message for current chat, refreshing messages"),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),Ye=this.socketService.onEvent("messageUpdated").subscribe(m=>{if(console.log("Message updated:",m),m.chat_id===this.chatId){console.log("Message updated in current chat, updating message in place");let k=this.messages(),T=k.findIndex(S=>S._id===m._id);if(T!==-1){let S=[...k];S[T]=te(te({},S[T]),m),this.messages.set(S),console.log("Message status updated in UI")}}});this.subscriptions.push(t,e,n,o,d,b,F,P,ee,Le,Ue,He,Ge,Ke,Ye)}joinSocketRoom(){return h(this,null,function*(){if(this.chatId)try{yield this.socketService.joinChat(this.chatId),console.log("Joined socket room for chat:",this.chatId)}catch(t){console.error("Failed to join socket room:",t)}})}loadChat(){return h(this,null,function*(){if(this.chatId){this.loading.set(!0),this.error.set(null);try{let t=yield this.chatService.getChatByIdAsync(this.chatId);this.chat.set(t)}catch(t){console.error("Error loading chat:",t),this.error.set("Failed to load chat")}finally{this.loading.set(!1)}}})}loadMessages(t=!0){return h(this,null,function*(){if(this.chatId){t&&this.messagesLoading.set(!0);try{let e=yield this.chatService.getChatMessagesAsync(this.chatId);this.messages.set(e.reverse()),this.shouldScrollToBottom=!0}catch(e){console.error("Error loading messages:",e),t&&this.error.set("Failed to load messages")}finally{t&&this.messagesLoading.set(!1)}}})}sendMessage(){return h(this,null,function*(){let t=this.messageForm.get("content")?.value?.trim();if(!t||!this.chatId||this.sendingMessage()){console.log("Cannot send message:",{content:t,chatId:this.chatId,sending:this.sendingMessage()});return}this.sendingMessage.set(!0),this.error.set(null);try{console.log("Sending message via socket:",{chatId:this.chatId,content:t}),this.socketService.stopTyping(this.chatId);let e=yield this.socketService.sendMessage(this.chatId,t);if(e.success&&e.data){let n=this.messages();n.find(d=>d._id===e.data._id)||(this.messages.set([...n,e.data]),this.shouldScrollToBottom=!0),this.messageForm.reset(),console.log("Message sent successfully via socket")}else throw new Error(e.error||"Failed to send message")}catch(e){console.error("Error sending message via socket:",e);try{console.log("Falling back to HTTP message sending"),yield this.chatService.sendMessageAsync(this.chatId,{content:t,message_type:"text"}),this.messageForm.reset(),yield this.loadMessages(!1),this.shouldScrollToBottom=!0,console.log("Message sent successfully via HTTP fallback")}catch(n){console.error("HTTP fallback also failed:",n),this.error.set("Failed to send message. Please try again.")}}finally{this.sendingMessage.set(!1)}})}onFileSelect(t){let e=t.target;if(e.files&&e.files.length>0){let n=Array.from(e.files);this.selectedFiles.set(n),this.uploadFiles(n)}}uploadFiles(t){return h(this,null,function*(){if(!(!this.chatId||t.length===0)){this.uploadingFiles.set(!0),this.error.set(null);try{let e=yield this.chatService.uploadChatFilesAsync(this.chatId,t);try{this.socketService.emit("files-uploaded",{chatId:this.chatId,fileCount:t.length,userId:this.user()?._id})}catch(n){console.warn("Failed to send real-time file upload notification:",n)}yield this.loadMessages(!1),this.shouldScrollToBottom=!0,this.selectedFiles.set([]),console.log("Files uploaded successfully:",e)}catch(e){console.error("Error uploading files:",e),this.error.set("Failed to upload files. Please try again.")}finally{this.uploadingFiles.set(!1)}}})}triggerFileInput(){let t=document.getElementById("fileInput");t&&t.click()}removeSelectedFile(t){let n=this.selectedFiles().filter((o,d)=>d!==t);this.selectedFiles.set(n)}getFileIcon(t){let e=t.type;return e.startsWith("image/")?"image":e.startsWith("video/")?"videocam":e.startsWith("audio/")?"audiotrack":e.includes("pdf")?"picture_as_pdf":e.includes("word")||e.includes("document")?"description":e.includes("excel")||e.includes("spreadsheet")?"table_chart":e.includes("powerpoint")||e.includes("presentation")?"slideshow":"attach_file"}formatFileSize(t){if(!t||t===0)return"0 Bytes";let e=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,o)).toFixed(2))+" "+n[o]}isImageFile(t){return t.message_type==="image"&&!!t.file_url}isFileMessage(t){return t.message_type==="file"&&!!t.file_url}downloadFile(t,e){let n=document.createElement("a");n.href=t,n.download=e,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)}markMessagesAsRead(){return h(this,null,function*(){if(this.chatId)try{yield this.chatService.markMessagesAsReadAsync(this.chatId)}catch(t){console.error("Error marking messages as read:",t)}})}isMyMessage(t){return t.sender_id._id===this.user()?._id}formatMessageTime(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}formatMessageDate(t){let e=new Date(t),n=new Date,o=new Date(n);return o.setDate(o.getDate()-1),e.toDateString()===n.toDateString()?"Today":e.toDateString()===o.toDateString()?"Yesterday":e.toLocaleDateString()}shouldShowDateDivider(t){if(t===0)return!0;let e=this.messages()[t],n=this.messages()[t-1],o=new Date(e.createdAt).toDateString(),d=new Date(n.createdAt).toDateString();return o!==d}onTextareaInput(){this.chatId&&(this.socketService.startTyping(this.chatId),this.typingTimeout&&clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(()=>{this.socketService.stopTyping(this.chatId)},3e3))}onTextareaKeydown(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}getTypingText(){let t=this.typingUsers();return t.length===0?"":t.length===1?`${t[0].userName||"Someone"} is typing...`:t.length===2?`${t[0].userName||"Someone"} and ${t[1].userName||"someone else"} are typing...`:"Several people are typing..."}getProjectStatusColor(t){let e={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",accepted:"bg-blue-100 text-blue-800 border-blue-200",in_progress:"bg-purple-100 text-purple-800 border-purple-200",awaiting_client_approval:"bg-orange-100 text-orange-800 border-orange-200",completed:"bg-green-100 text-green-800 border-green-200",rejected:"bg-red-100 text-red-800 border-red-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200"};return e[t]||e.pending}goToProjectDetails(){let t=this.chat();t&&t.project_id&&this.router.navigate(["/dashboard/projects",t.project_id._id])}handleProjectAction(t){return h(this,null,function*(){let e=this.chat();if(!(!e||!e.project_id))try{let n=e.project_id._id;switch(t){case"accept":yield this.projectService.updateProjectAsync(n,{status:"accepted"});break;case"reject":let d=prompt("Please provide a reason for rejection:");if(!d)return;yield this.projectService.updateProjectAsync(n,{status:"rejected",rejection_reason:d});break;case"request_payment":yield this.requestInitialPayment();return;case"start":yield this.projectService.updateProjectAsync(n,{status:"in_progress"});break;case"complete":yield this.requestCompletion();return;case"request_completion":yield this.requestCompletion();return;case"approve_completion":yield this.approveCompletion();return}yield this.loadChat();let o="";t==="accept"?o="Project has been accepted":t==="reject"?o="Project has been rejected":t==="start"?o="Project has been started and is now in progress":o=`Project status updated to: ${t}`,yield this.chatService.sendMessageAsync(this.chatId,{content:o,message_type:"project_update"}),yield this.loadMessages(!1)}catch(n){console.error(`Error ${t}ing project:`,n),this.error.set(`Failed to ${t} project`)}})}canPerformAction(t){let e=this.chat(),n=this.user();if(!e||!n||!e.project_id||this.isChatDisabled())return!1;let o=e.project_id.business_owner_id._id===n._id,d=e.project_id.client_id._id===n._id,b=e.project_id.status;switch(t){case"accept":case"reject":return o&&(b==="requested"||b==="under_review");case"request_payment":return o&&b==="accepted";case"start":return o&&b==="payment_completed";case"complete":case"request_completion":return o&&b==="in_progress";case"approve_completion":return d&&b==="awaiting_client_approval";default:return!1}}scrollToBottom(){try{let t=this.messagesContainer?.nativeElement;t&&(t.scrollTop=t.scrollHeight)}catch(t){console.error("Error scrolling to bottom:",t)}}handlePaymentRequestNotification(t){let e=this.user(),n=this.chat();e&&n&&n.project_id?.client_id._id===e._id&&(Notification.permission==="granted"&&new Notification("Payment Request Received",{body:`New payment request of $${t.payment_amount||"N/A"} from ${this.getOtherParticipantName()}`,icon:"/favicon.ico",tag:"payment-request"}),console.log("Payment request notification:",t))}getOtherParticipantName(){let t=this.otherParticipant();if(!t)return"Business Owner";let e=t.first_name||"",n=t.last_name||"";return`${e} ${n}`.trim()||"Business Owner"}requestInitialPayment(){return h(this,null,function*(){let t=this.chat();if(!(!t||!t.project_id||!this.chatId))try{let e=yield this.projectService.getProjectAsync(t.project_id._id);this.dialog.open(oe,{width:"500px",disableClose:!0,data:{defaultAmount:e.offered_price||0,isStartPayment:!0}}).afterClosed().subscribe(o=>h(this,null,function*(){if(o)try{yield this.projectService.updateProjectAsync(t.project_id._id,{status:"payment_requested"}),yield this.chatService.requestAdditionalPaymentAsync(this.chatId,o),yield this.chatService.sendMessageAsync(this.chatId,{content:"Payment has been requested to start the project",message_type:"project_update"}),yield this.loadChat(),yield this.loadMessages(!1)}catch(d){console.error("Error processing initial payment request:",d),this.error.set("Failed to request initial payment")}}))}catch(e){console.error("Error opening initial payment modal:",e),this.error.set("Failed to open payment request modal")}})}requestAdditionalPayment(){return h(this,null,function*(){this.dialog.open(oe,{width:"500px",disableClose:!0}).afterClosed().subscribe(e=>h(this,null,function*(){if(e)try{yield this.chatService.requestAdditionalPaymentAsync(this.chatId,e)}catch(n){console.error("Error requesting payment:",n),this.error.set("Failed to request additional payment")}}))})}approvePaymentRequest(t){return h(this,null,function*(){try{let e=this.messages().find(P=>P._id===t);if(!e){this.error.set("Payment request not found");return}let n=this.chat();if(!n){this.error.set("Chat information not available");return}let o=typeof n.project_id?.business_id=="string"?"Business Owner":n.project_id?.business_id?.name||"Business Owner",d=this.isInitialPayment(e),b=typeof n.project_id=="string"?n.project_id:n.project_id?._id;this.dialog.open(qe,{width:"500px",disableClose:!0,data:{amount:e.payment_amount||"0",description:e.payment_description||"Additional payment",businessName:o,chatId:this.chatId,messageId:t,projectId:b,isInitialPayment:d}}).afterClosed().subscribe(P=>h(this,null,function*(){if(P&&P.paymentIntentId)try{this.loadMessages(!1),this.shouldScrollToBottom=!0,console.log("Payment approved successfully with method:",P.paymentMethod),console.log("Payment completed for amount:",P.amount)}catch(ee){console.error("Error processing payment approval:",ee),this.error.set("Failed to process payment approval")}}))}catch(e){console.error("Error approving payment:",e),this.error.set("Failed to approve payment request")}})}rejectPaymentRequest(t){return h(this,null,function*(){let e=prompt("Please provide a reason for rejecting this payment request:");if(e)try{yield this.chatService.respondToPaymentRequestAsync(this.chatId,t,{status:"rejected",rejection_reason:e}),console.log("Payment request rejected with reason:",e)}catch(n){console.error("Error rejecting payment:",n),this.error.set("Failed to reject payment request")}})}requestCompletion(){return h(this,null,function*(){this.dialog.open(Ve,{width:"500px",disableClose:!0}).afterClosed().subscribe(e=>h(this,null,function*(){if(e)try{yield this.chatService.requestCompletionAsync(this.chatId,e);try{this.socketService.emit("completion-request-created",{chatId:this.chatId,content:e.content,userId:this.user()?._id})}catch(n){console.warn("Failed to send real-time completion request notification:",n)}yield this.loadChat(),yield this.loadMessages(!1)}catch(n){console.error("Error requesting completion:",n),this.error.set("Failed to request completion approval")}}))})}approveCompletion(){return h(this,null,function*(){try{yield this.loadMessages(!1);let t=this.messages();console.log("All messages:",t.length),console.log("Completion messages:",t.filter(n=>n.message_type==="completion_request"));let e=t.filter(n=>{let o=n.message_type==="completion_request",d=!n.completion_status||n.completion_status==="pending";return console.log(`Message ${n._id}: type=${n.message_type}, status=${n.completion_status}, isPending=${d}`),o&&d}).sort((n,o)=>new Date(o.createdAt).getTime()-new Date(n.createdAt).getTime())[0];if(!e){console.log("No pending completion request found"),console.log("Available completion messages:",t.filter(n=>n.message_type==="completion_request").map(n=>({id:n._id,type:n.message_type,status:n.completion_status,createdAt:n.createdAt}))),this.error.set("No pending completion request found. Please ensure a completion request has been sent first.");return}console.log("Found pending completion message:",e._id),yield this.chatService.respondToCompletionRequestAsync(this.chatId,e._id,{status:"approved"});try{this.socketService.emit("completion-approved",{chatId:this.chatId,messageId:e._id,userId:this.user()?._id})}catch(n){console.warn("Failed to send real-time completion approval notification:",n)}yield this.loadChat(),yield this.loadMessages(!1),yield this.checkReviewEligibility()}catch(t){console.error("Error approving completion:",t),this.error.set("Failed to approve completion")}})}rejectCompletion(){return h(this,null,function*(){let t=prompt("Please provide a reason for rejecting the completion:");if(t)try{yield this.loadMessages(!1);let e=this.messages(),n=e.filter(o=>{let d=o.message_type==="completion_request",b=!o.completion_status||o.completion_status==="pending";return d&&b}).sort((o,d)=>new Date(d.createdAt).getTime()-new Date(o.createdAt).getTime())[0];if(!n){console.log("Available completion messages:",e.filter(o=>o.message_type==="completion_request").map(o=>({id:o._id,type:o.message_type,status:o.completion_status,createdAt:o.createdAt}))),this.error.set("No pending completion request found. Please ensure a completion request has been sent first.");return}yield this.chatService.respondToCompletionRequestAsync(this.chatId,n._id,{status:"rejected",rejection_reason:t});try{this.socketService.emit("completion-rejected",{chatId:this.chatId,messageId:n._id,reason:t,userId:this.user()?._id})}catch(o){console.warn("Failed to send real-time completion rejection notification:",o)}yield this.loadChat(),yield this.loadMessages(!1)}catch(e){console.error("Error rejecting completion:",e),this.error.set("Failed to reject completion")}})}isPaymentRequest(t){return t.message_type==="payment_request"}isInitialPayment(t){let e=t.payment_description?.toLowerCase()||"";return e==="project payment"||e==="initial project payment"}isCompletionRequest(t){return t.message_type==="completion_request"}canRespondToPayment(t){let e=this.user(),n=this.chat();return!e||!n?!1:t.message_type==="payment_request"&&t.payment_status==="pending"&&n.project_id?.client_id._id===e._id}canRespondToCompletion(t){let e=this.user(),n=this.chat();return!e||!n?!1:t.message_type==="completion_request"&&t.completion_status==="pending"&&n.project_id?.client_id._id===e._id}canRequestPayment(){let t=this.user(),e=this.chat();return!t||!e||!e.project_id||this.isChatDisabled()?!1:e.project_id.business_owner_id._id===t._id&&["payment_completed","started","in_progress","awaiting_client_approval"].includes(e.project_id.status)}checkReviewEligibility(){return h(this,null,function*(){let t=this.user(),e=this.chat();if(!t||!e||!e.project_id){this.canLeaveReview.set(!1),this.existingReview.set(null);return}let n=typeof e.project_id.client_id=="string"?e.project_id.client_id:e.project_id.client_id._id,o=t._id===n,d=e.project_id.status==="completed";if(!o||!d){this.canLeaveReview.set(!1),this.existingReview.set(null);return}try{let F=(yield this.reviewService.getBusinessReviewsAsync(e.project_id.business_id._id)).find(P=>P.project_id._id===e.project_id._id&&P.user_id._id===t._id);F?(this.canLeaveReview.set(!1),this.existingReview.set(F)):(this.canLeaveReview.set(!0),this.existingReview.set(null))}catch(b){console.error("Chat: Error checking review eligibility:",b),this.canLeaveReview.set(!1),this.existingReview.set(null)}})}handleReviewAction(){this.existingReview()?this.viewExistingReview():this.canLeaveReview()&&this.openReviewDialog()}openReviewDialog(){return h(this,null,function*(){let t=this.chat();if(!t||!t.project_id)return;this.dialog.open(Ae,{width:"600px",data:{businessId:t.project_id.business_id._id,projectId:t.project_id._id,businessName:t.project_id.business_id.name,projectTitle:t.project_id.title}}).afterClosed().subscribe(n=>h(this,null,function*(){n&&(console.log("Review submitted successfully"),yield this.checkReviewEligibility())}))})}viewExistingReview(){let t=this.existingReview();if(!t)return;let e=["Your Review for this Project","",`Overall Rating: ${t.rating}/5 \u2B50`,"","Detailed Ratings:",`\u2022 Service Quality: ${t.service_quality||"N/A"}/5`,`\u2022 Communication: ${t.communication||"N/A"}/5`,`\u2022 Timeliness: ${t.timeliness||"N/A"}/5`,`\u2022 Value for Money: ${t.value_for_money||"N/A"}/5`,"",`Comment: ${t.comment||"No comment provided"}`,"",`Submitted: ${new Date(t.createdAt).toLocaleDateString()}`].join(`
`);alert(e)}openReportDialog(){return h(this,null,function*(){let t=this.chat();if(!t)return;let e=this.otherParticipant();if(!e)return;let n=this.getOtherParticipantName();this.dialog.open(ze,{width:"500px",data:{reportType:"user",targetId:e._id,targetName:n,contextInfo:`Chat conversation in project: ${t.project_id?.title||"Unknown Project"}`}}).afterClosed().subscribe(d=>h(this,null,function*(){if(d)try{let b={reported_user_id:e._id,report_type:"user",reason:d.reason,custom_reason:d.customReason,description:d.description,is_anonymous:d.isAnonymous};yield this.reportsService.submitReportAsync(b),this.dialog.open(Be,{width:"400px",data:{entityType:"user",entityName:n}})}catch(b){console.error("Failed to submit report:",b)}}))})}onKeyPress(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}navigateBack(){this.router.navigate(["dashboard","messages","chats"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-chat-room"]],viewQuery:function(e,n){if(e&1&&re(ot,5),e&2){let o;se(o=ce())&&(n.messagesContainer=o.first)}},decls:18,vars:6,consts:[["messagesContainer",""],[1,"chat-window"],[1,"chat-header"],[1,"chat-header-content"],[1,"header-left"],[1,"back-button",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"participant-info"],[1,"header-actions"],[1,"details-btn",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"],[1,"messages-container"],[1,"loading-state"],[1,"error-state"],[1,"messages-scroll"],[1,"participant-avatar",3,"src","alt"],[1,"participant-avatar-placeholder"],[1,"participant-details"],[1,"participant-name"],[1,"participant-status"],[1,"participant-username"],[1,"connection-status"],[1,"status-dot"],[1,"status-text"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"mobile-action"],[1,"action-btn","accept"],[1,"action-btn","reject"],[1,"action-btn","request-payment"],[1,"action-btn","start"],[1,"action-btn","complete"],[1,"action-btn","review"],["title","Report User",1,"action-btn","report"],[1,"desktop-actions"],[1,"action-btn",2,"background","#f59e0b","color","white"],[1,"action-btn","accept",3,"click"],[1,"action-btn","reject",3,"click"],[1,"action-btn","request-payment",3,"click"],[1,"action-btn","start",3,"click"],[1,"action-btn","complete",3,"click"],[1,"action-btn","review",3,"click"],["title","Report User",1,"action-btn","report",3,"click"],[1,"action-btn",2,"background","#f59e0b","color","white",3,"click"],[1,"loading-spinner"],[1,"loading-text"],[1,"error-content"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"error-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"error-message"],[1,"messages-content"],[1,"messages-list"],[1,"empty-state"],[1,"date-divider"],[1,"message-wrapper"],[1,"message-container"],[1,"message-avatar"],[1,"message-bubble-container"],[1,"system-message"],[1,"payment-request-message"],[1,"completion-request-message"],[1,"message-bubble",3,"my-bubble","other-bubble"],[1,"date-label"],[1,"avatar-initials"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"system-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"payment-header"],[1,"payment-status"],[1,"payment-details"],[1,"payment-amount"],[1,"payment-description"],[1,"payment-content"],[1,"payment-actions"],[1,"message-time"],[1,"action-btn","approve",3,"click"],[1,"completion-header"],[1,"completion-status"],[1,"completion-content"],[1,"completion-actions"],[1,"message-bubble"],[1,"image-attachment"],[1,"file-attachment"],[1,"message-text"],[1,"edited-indicator"],[1,"attachment-image",3,"click","src","alt"],[1,"file-info"],[1,"file-icon"],[1,"file-details"],[1,"file-name"],[1,"file-size"],[1,"download-btn",3,"click"],[1,"empty-icon"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],[1,"empty-title"],[1,"empty-description"],[1,"project-name"],[1,"input-container"],[1,"chat-disabled-container"],[1,"chat-disabled-content"],[1,"disabled-icon"],[1,"disabled-text"],[1,"typing-indicator"],[1,"upload-progress"],[1,"selected-files"],[1,"input-form-container"],["type","file","id","fileInput","multiple","","accept","image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.rar",2,"display","none",3,"change"],[1,"message-form",3,"ngSubmit","formGroup"],["type","button",1,"attachment-button",3,"click","disabled"],[1,"input-wrapper"],["formControlName","content","placeholder","Type your message...","rows","1",1,"message-input",3,"input","keydown"],["type","submit",1,"send-button",3,"disabled"],[1,"send-spinner"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"send-icon"],[1,"typing-dots"],[1,"typing-dot"],[1,"typing-text"],[1,"upload-spinner"],[1,"upload-text"],[1,"file-preview"],[1,"file-actions"],["type","button",1,"upload-btn",3,"click"],["type","button",1,"cancel-btn",3,"click"],["type","button",1,"remove-file-btn",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 19l9 2-9-18-9 18 9-2zm0 0v-8"]],template:function(e,n){if(e&1&&(a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"button",5),_("click",function(){return n.goToProjectDetails()}),R(),a(5,"svg",6),v(6,"path",7),r()(),C(7,ct,13,6,"div",8),r(),q(),a(8,"div",9),C(9,kt,19,14),a(10,"button",10),_("click",function(){return n.goToProjectDetails()}),R(),a(11,"svg",11),v(12,"path",12),r()()()()(),q(),a(13,"div",13),C(14,St,4,0,"div",14)(15,Ot,6,1,"div",15)(16,Kt,5,1,"div",16),r(),C(17,nn,2,1),r()),e&2){let o,d;s(7),p((o=n.chat())?7:-1,o),s(2),p((d=n.chat())?9:-1,d),s(5),p(n.loading()||n.messagesLoading()?14:-1),s(),p(n.error()&&!n.loading()?15:-1),s(),p(!n.loading()&&!n.messagesLoading()&&!n.error()?16:-1),s(),p(!n.loading()&&!n.error()?17:-1)}},dependencies:[E,Oe,Me,ye,ve,we,Pe,ke,Q,H,U,L,Y,je,Re,Ce,Ee],styles:["[_nghost-%COMP%]{display:block;height:100vh;overflow:hidden}.chat-window[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;background:#f8fafc}@media (min-width: 768px){.chat-window[_ngcontent-%COMP%]{max-width:600px;max-height:600px;border-radius:12px;box-shadow:0 20px 25px -5px #0000001a,0 10px 10px -5px #0000000a;border:1px solid #e2e8f0;background:#fff;position:relative;margin:20px auto}}@media (max-width: 767px){.chat-window[_ngcontent-%COMP%]{width:100vw;height:100vh;position:fixed;top:0;left:0;z-index:1000;background:#fff}}.chat-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid #e2e8f0;position:sticky;top:0;z-index:10}@media (min-width: 768px){.chat-header[_ngcontent-%COMP%]{border-top-left-radius:12px;border-top-right-radius:12px;padding:12px 16px}}@media (max-width: 767px){.chat-header[_ngcontent-%COMP%]{padding:16px 20px;box-shadow:0 1px 3px #0000001a}}.chat-header-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;flex:1;min-width:0}.back-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:8px;border:none;background:#f1f5f9;color:#64748b;cursor:pointer;transition:all .2s ease;flex-shrink:0}.back-button[_ngcontent-%COMP%]:hover{background:#e2e8f0;color:#475569}@media (max-width: 767px){.back-button[_ngcontent-%COMP%]{width:36px;height:36px}}.participant-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex:1;min-width:0}.participant-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover;border:2px solid #e2e8f0;flex-shrink:0}@media (max-width: 767px){.participant-avatar[_ngcontent-%COMP%]{width:36px;height:36px}}.participant-avatar-placeholder[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#3b82f6,#8b5cf6);display:flex;align-items:center;justify-content:center;flex-shrink:0}@media (max-width: 767px){.participant-avatar-placeholder[_ngcontent-%COMP%]{width:36px;height:36px}}.participant-details[_ngcontent-%COMP%]{flex:1;min-width:0}.participant-name[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#1e293b;margin:0;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media (max-width: 767px){.participant-name[_ngcontent-%COMP%]{font-size:16px}}.participant-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:2px}.participant-username[_ngcontent-%COMP%]{font-size:12px;color:#64748b;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media (max-width: 767px){.participant-username[_ngcontent-%COMP%]{font-size:13px}}.connection-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.status-dot[_ngcontent-%COMP%]{width:6px;height:6px;border-radius:50%;background:#ef4444}.status-dot.online[_ngcontent-%COMP%]{background:#10b981}.status-text[_ngcontent-%COMP%]{font-size:11px;color:#64748b}@media (max-width: 767px){.status-text[_ngcontent-%COMP%]{font-size:12px}}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-shrink:0}.mobile-action[_ngcontent-%COMP%]{display:block}@media (min-width: 768px){.mobile-action[_ngcontent-%COMP%]{display:none}}.desktop-actions[_ngcontent-%COMP%]{display:none;gap:8px}@media (min-width: 768px){.desktop-actions[_ngcontent-%COMP%]{display:flex}}.action-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;border:none;font-size:11px;font-weight:500;cursor:pointer;transition:all .2s ease}.action-btn.accept[_ngcontent-%COMP%]{background:#10b981;color:#fff}.action-btn.accept[_ngcontent-%COMP%]:hover{background:#059669}.action-btn.start[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.action-btn.start[_ngcontent-%COMP%]:hover{background:#2563eb}.action-btn.complete[_ngcontent-%COMP%]{background:#8b5cf6;color:#fff}.action-btn.complete[_ngcontent-%COMP%]:hover{background:#7c3aed}.action-btn.reject[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.action-btn.reject[_ngcontent-%COMP%]:hover{background:#dc2626}.action-btn.review[_ngcontent-%COMP%]{background:#f59e0b;color:#fff}.action-btn.review[_ngcontent-%COMP%]:hover{background:#d97706}.action-btn.report[_ngcontent-%COMP%]{background:#6b7280;color:#fff;display:flex;align-items:center;gap:4px}.action-btn.report[_ngcontent-%COMP%]:hover{background:#4b5563}.action-btn.report[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}@media (max-width: 767px){.action-btn[_ngcontent-%COMP%]{font-size:12px;padding:8px 14px}}.details-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:6px;border:none;background:#f1f5f9;color:#64748b;cursor:pointer;transition:all .2s ease}.details-btn[_ngcontent-%COMP%]:hover{background:#e2e8f0;color:#475569}@media (max-width: 767px){.details-btn[_ngcontent-%COMP%]{width:32px;height:32px}}.messages-container[_ngcontent-%COMP%]{flex:1;overflow:hidden;display:flex;flex-direction:column}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%;padding:20px}.loading-spinner[_ngcontent-%COMP%]{width:32px;height:32px;border:2px solid #e2e8f0;border-top:2px solid #3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.loading-text[_ngcontent-%COMP%]{margin-top:12px;font-size:14px;color:#64748b;text-align:center}.error-content[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px;background:#fef2f2;border:1px solid #fecaca;border-radius:8px;max-width:300px}.error-icon[_ngcontent-%COMP%]{width:20px;height:20px;color:#dc2626;margin-right:8px;flex-shrink:0}.error-message[_ngcontent-%COMP%]{font-size:14px;color:#b91c1c;font-weight:500}.messages-scroll[_ngcontent-%COMP%]{flex:1;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:thin;scrollbar-color:rgba(148,163,184,.3) transparent}.messages-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.messages-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.messages-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#94a3b84d;border-radius:2px}.messages-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b880}.messages-content[_ngcontent-%COMP%]{padding:16px}@media (max-width: 767px){.messages-content[_ngcontent-%COMP%]{padding:20px}}.messages-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.date-divider[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:16px 0}.date-label[_ngcontent-%COMP%]{background:#fff;color:#64748b;font-size:12px;padding:4px 12px;border-radius:12px;box-shadow:0 1px 3px #0000001a;border:1px solid #e2e8f0}.message-wrapper[_ngcontent-%COMP%]{display:flex}.message-wrapper.my-message[_ngcontent-%COMP%]{justify-content:flex-end}.message-container[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:8px;max-width:75%}.my-message[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]{flex-direction:row-reverse}.message-avatar[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background:linear-gradient(135deg,#64748b,#94a3b8);display:flex;align-items:center;justify-content:center;flex-shrink:0}.avatar-initials[_ngcontent-%COMP%]{font-size:10px;font-weight:600;color:#fff}.system-message[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fed7aa);border:1px solid #f59e0b;color:#92400e;padding:8px 12px;border-radius:12px;text-align:center;font-size:12px;display:flex;align-items:center;justify-content:center;gap:6px;max-width:250px;margin:0 auto}.system-icon[_ngcontent-%COMP%]{width:14px;height:14px;color:#d97706;flex-shrink:0}.payment-request-message[_ngcontent-%COMP%], .completion-request-message[_ngcontent-%COMP%]{background:#fff;border:2px solid #e2e8f0;border-radius:12px;padding:16px;margin:8px 0;max-width:400px;box-shadow:0 2px 8px #0000001a}@media (max-width: 767px){.payment-request-message[_ngcontent-%COMP%], .completion-request-message[_ngcontent-%COMP%]{max-width:100%;margin:12px 0}}.payment-header[_ngcontent-%COMP%], .completion-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #e2e8f0}.payment-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .completion-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#3b82f6;font-size:20px}.payment-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .completion-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:600;color:#1e293b;flex:1}.payment-status[_ngcontent-%COMP%], .completion-status[_ngcontent-%COMP%]{font-size:11px;font-weight:500;padding:2px 8px;border-radius:12px;text-transform:uppercase}.payment-status.status-pending[_ngcontent-%COMP%], .completion-status.status-pending[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.payment-status.status-approved[_ngcontent-%COMP%], .completion-status.status-approved[_ngcontent-%COMP%]{background:#d1fae5;color:#065f46}.payment-status.status-payment_pending[_ngcontent-%COMP%], .completion-status.status-payment_pending[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.payment-status.status-rejected[_ngcontent-%COMP%], .completion-status.status-rejected[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.payment-status.status-paid[_ngcontent-%COMP%], .completion-status.status-paid[_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.payment-details[_ngcontent-%COMP%]{margin-bottom:12px}.payment-details[_ngcontent-%COMP%]   .payment-amount[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#10b981;margin-bottom:4px}.payment-details[_ngcontent-%COMP%]   .payment-description[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#374151;margin-bottom:8px}.payment-details[_ngcontent-%COMP%]   .payment-content[_ngcontent-%COMP%]{font-size:13px;color:#6b7280;margin:0;line-height:1.4}.completion-content[_ngcontent-%COMP%]{margin-bottom:12px}.completion-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#374151;line-height:1.5}.payment-actions[_ngcontent-%COMP%], .completion-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:8px}.payment-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%], .completion-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;border:none;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s ease;flex:1}.payment-actions[_ngcontent-%COMP%]   .action-btn.approve[_ngcontent-%COMP%], .completion-actions[_ngcontent-%COMP%]   .action-btn.approve[_ngcontent-%COMP%]{background:#10b981;color:#fff}.payment-actions[_ngcontent-%COMP%]   .action-btn.approve[_ngcontent-%COMP%]:hover, .completion-actions[_ngcontent-%COMP%]   .action-btn.approve[_ngcontent-%COMP%]:hover{background:#059669}.payment-actions[_ngcontent-%COMP%]   .action-btn.reject[_ngcontent-%COMP%], .completion-actions[_ngcontent-%COMP%]   .action-btn.reject[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.payment-actions[_ngcontent-%COMP%]   .action-btn.reject[_ngcontent-%COMP%]:hover, .completion-actions[_ngcontent-%COMP%]   .action-btn.reject[_ngcontent-%COMP%]:hover{background:#dc2626}@media (max-width: 767px){.payment-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%], .completion-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{padding:10px 18px;font-size:13px}}.message-bubble-container[_ngcontent-%COMP%]{flex:1}.message-bubble[_ngcontent-%COMP%]{padding:8px 12px;border-radius:16px;font-size:14px;line-height:1.4;word-wrap:break-word;position:relative}.message-bubble.my-bubble[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;border-bottom-right-radius:4px}.message-bubble.other-bubble[_ngcontent-%COMP%]{background:#fff;color:#1e293b;border:1px solid #e2e8f0;border-bottom-left-radius:4px}@media (max-width: 767px){.message-bubble[_ngcontent-%COMP%]{font-size:15px;padding:10px 14px}}.message-text[_ngcontent-%COMP%]{margin:0;line-height:1.4}.edited-indicator[_ngcontent-%COMP%]{font-size:11px;opacity:.7;font-style:italic;margin-left:6px}.message-time[_ngcontent-%COMP%]{font-size:11px;margin-top:4px;opacity:.7;text-align:right}.my-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#fffc}.other-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#64748b}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:40px 20px;height:100%;min-height:300px}.empty-icon[_ngcontent-%COMP%]{width:48px;height:48px;background:linear-gradient(135deg,#ddd6fe,#c7d2fe);border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:16px;color:#6366f1}.empty-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#1e293b;margin:0 0 8px}.empty-description[_ngcontent-%COMP%]{font-size:14px;color:#64748b;margin:0;max-width:280px;line-height:1.5}.project-name[_ngcontent-%COMP%]{font-weight:500;color:#3b82f6}.input-container[_ngcontent-%COMP%]{background:#fff;border-top:1px solid #e2e8f0;position:sticky;bottom:0}@media (min-width: 768px){.input-container[_ngcontent-%COMP%]{border-bottom-left-radius:12px;border-bottom-right-radius:12px;padding:12px 16px}}@media (max-width: 767px){.input-container[_ngcontent-%COMP%]{padding:16px 20px;box-shadow:0 -1px 3px #0000001a}}.typing-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px;padding:0 4px}.typing-dots[_ngcontent-%COMP%]{display:flex;gap:2px}.typing-dot[_ngcontent-%COMP%]{width:4px;height:4px;background:#94a3b8;border-radius:50%;animation:_ngcontent-%COMP%_pulse 1.4s infinite}.typing-dot[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.typing-dot[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}.typing-text[_ngcontent-%COMP%]{font-size:12px;color:#64748b}.input-form-container[_ngcontent-%COMP%]{width:100%}.message-form[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:8px}.attachment-button[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;border:none;background:#f1f5f9;color:#64748b;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;flex-shrink:0}.attachment-button[_ngcontent-%COMP%]:hover:not(:disabled){background:#e2e8f0;color:#475569}.attachment-button[_ngcontent-%COMP%]:disabled{background:#94a3b8;cursor:not-allowed}@media (max-width: 767px){.attachment-button[_ngcontent-%COMP%]{width:40px;height:40px}}.input-wrapper[_ngcontent-%COMP%]{flex:1}.message-input[_ngcontent-%COMP%]{width:100%;resize:none;border:1px solid #e2e8f0;border-radius:20px;padding:10px 16px;font-size:14px;line-height:1.4;background:#f8fafc;color:#1e293b;min-height:40px;max-height:120px;transition:all .2s ease;outline:none}.message-input[_ngcontent-%COMP%]:focus{border-color:#3b82f6;background:#fff;box-shadow:0 0 0 3px #3b82f61a}.message-input[_ngcontent-%COMP%]::placeholder{color:#94a3b8}@media (max-width: 767px){.message-input[_ngcontent-%COMP%]{font-size:16px;padding:12px 18px;min-height:44px}}.send-button[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;border:none;background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;flex-shrink:0}.send-button[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#2563eb,#1d4ed8);transform:scale(1.05)}.send-button[_ngcontent-%COMP%]:disabled{background:#94a3b8;cursor:not-allowed;transform:none}.send-button.sending[_ngcontent-%COMP%]{background:#94a3b8}@media (max-width: 767px){.send-button[_ngcontent-%COMP%]{width:40px;height:40px}}.send-icon[_ngcontent-%COMP%]{width:16px;height:16px}.send-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top:2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.upload-progress[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px;padding:8px 12px;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0}.upload-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid #e2e8f0;border-top:2px solid #3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.upload-text[_ngcontent-%COMP%]{font-size:12px;color:#64748b}.selected-files[_ngcontent-%COMP%]{margin-bottom:12px;padding:12px;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0}.file-preview[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px;background:#fff;border-radius:6px;margin-bottom:8px;border:1px solid #e2e8f0}.file-preview[_ngcontent-%COMP%]:last-child{margin-bottom:8px}.file-icon[_ngcontent-%COMP%]{color:#64748b;font-size:20px;width:20px;height:20px;flex-shrink:0}.file-info[_ngcontent-%COMP%]{flex:1;min-width:0}.file-name[_ngcontent-%COMP%]{display:block;font-size:13px;font-weight:500;color:#1e293b;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.file-size[_ngcontent-%COMP%]{display:block;font-size:11px;color:#64748b;margin-top:2px}.remove-file-btn[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;border:none;background:#fee2e2;color:#dc2626;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;flex-shrink:0}.remove-file-btn[_ngcontent-%COMP%]:hover{background:#fecaca}.remove-file-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.file-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:8px}.upload-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;border:none;background:#3b82f6;color:#fff;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;gap:4px}.upload-btn[_ngcontent-%COMP%]:hover{background:#2563eb}.upload-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}.cancel-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;border:1px solid #e2e8f0;background:#fff;color:#64748b;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s ease}.cancel-btn[_ngcontent-%COMP%]:hover{background:#f8fafc;border-color:#cbd5e1}.image-attachment[_ngcontent-%COMP%]   .attachment-image[_ngcontent-%COMP%]{max-width:200px;max-height:200px;border-radius:8px;cursor:pointer;transition:opacity .2s ease}.image-attachment[_ngcontent-%COMP%]   .attachment-image[_ngcontent-%COMP%]:hover{opacity:.9}@media (max-width: 767px){.image-attachment[_ngcontent-%COMP%]   .attachment-image[_ngcontent-%COMP%]{max-width:250px;max-height:250px}}.image-attachment[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}.file-attachment[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px;background:#0000000d;border-radius:6px;margin-bottom:8px}.my-bubble[_ngcontent-%COMP%]   .file-attachment[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]{background:#ffffff1a}.file-attachment[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]{flex:1;min-width:0}.file-attachment[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{color:inherit;font-weight:500}.file-attachment[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]   .file-size[_ngcontent-%COMP%]{opacity:.7}.file-attachment[_ngcontent-%COMP%]   .download-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px;border:none;background:#0000001a;color:inherit;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;flex-shrink:0}.file-attachment[_ngcontent-%COMP%]   .download-btn[_ngcontent-%COMP%]:hover{background:#0003}.my-bubble[_ngcontent-%COMP%]   .file-attachment[_ngcontent-%COMP%]   .download-btn[_ngcontent-%COMP%]{background:#fff3}.my-bubble[_ngcontent-%COMP%]   .file-attachment[_ngcontent-%COMP%]   .download-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d}.file-attachment[_ngcontent-%COMP%]   .download-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.file-attachment[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_pulse{0%,70%,to{transform:scale(1);opacity:.5}35%{transform:scale(1.2);opacity:1}}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.message-wrapper[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn .3s ease-out}@media (prefers-reduced-motion: reduce){*[_ngcontent-%COMP%]{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}.chat-disabled-container[_ngcontent-%COMP%]{padding:20px;background:#f8fafc;border-top:1px solid #e2e8f0}@media (max-width: 767px){.chat-disabled-container[_ngcontent-%COMP%]{padding:16px}}.chat-disabled-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;background:#fff;padding:20px;border-radius:12px;border:1px solid #e2e8f0;text-align:center}@media (max-width: 767px){.chat-disabled-content[_ngcontent-%COMP%]{flex-direction:column;gap:8px;padding:16px}}.disabled-icon[_ngcontent-%COMP%]{color:#64748b;font-size:24px;width:24px;height:24px;flex-shrink:0}.disabled-text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 4px;font-size:14px;font-weight:600;color:#374151;line-height:1.4}.disabled-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:12px;color:#6b7280;line-height:1.4}@media (max-width: 767px){.disabled-text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:13px}.disabled-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:11px}}@media (prefers-contrast: high){.message-bubble.my-bubble[_ngcontent-%COMP%]{background:#000;color:#fff}.message-bubble.other-bubble[_ngcontent-%COMP%]{background:#fff;color:#000;border:2px solid #000}}"]})};var yi=[{path:"",component:J,children:[{path:"chats",component:X},{path:"chat/:chatId",component:Z},{path:"",redirectTo:"chats",pathMatch:"full"}]}];export{yi as MESSAGES_ROUTES};
