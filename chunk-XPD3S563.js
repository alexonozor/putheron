import{a as he,b as Xe,c as Ze}from"./chunk-2QHOLCNZ.js";import{a as We,b as Je}from"./chunk-EWKJ2SDA.js";import{c as Qe}from"./chunk-HTRWE6CS.js";import{a as le,c as Ke}from"./chunk-SWEYUOOJ.js";import{a as pe,c as Ye,e as ue,f as _e,g as ge,h as K}from"./chunk-TSKB4XYJ.js";import{a as Pe}from"./chunk-7RWCIHFI.js";import{g as me}from"./chunk-BX26ABL7.js";import"./chunk-53XJ47FX.js";import"./chunk-AFA2MZRQ.js";import"./chunk-N4HBF4XF.js";import{h as G,l as ce,m as H}from"./chunk-YXRTEDDD.js";import{b as ae,c as re,d as Ge,i as se}from"./chunk-QGINDIA5.js";import"./chunk-3ZSEQGMQ.js";import{A as U,c as D,e as k,h as A,i as B,l as z,m as Le,p as N,q as $,v as Ue,y as L}from"./chunk-ETX2MZON.js";import{a as He,b as de}from"./chunk-CTJEWONE.js";import{b as Ne,c as $e}from"./chunk-YKQONPAE.js";import{d as ze}from"./chunk-M2XDIGVG.js";import"./chunk-6XYYWDLI.js";import"./chunk-SGYCFQGT.js";import"./chunk-WEBD3P74.js";import{b as Be,c as V,e as F}from"./chunk-6VJK26JR.js";import{a as oe}from"./chunk-EKOSXNEL.js";import"./chunk-3Z3PFUFD.js";import{a as E,b as I}from"./chunk-JU5WLMV4.js";import{o as Ae}from"./chunk-KJ34UUD3.js";import"./chunk-MPWT2TAC.js";import"./chunk-YYV7O7JP.js";import{a as ne,b as Ve,c as ie,g as De}from"./chunk-ECKXYCMM.js";import"./chunk-ODLG6W26.js";import{l as te,n as qe,t as S}from"./chunk-VT4ZEATH.js";import{Bb as M,Db as W,Ea as w,Eb as J,Gb as p,Hb as Se,Jb as X,Kb as Z,Lb as o,Mb as r,Nb as x,Oc as j,Rb as b,Vb as m,Wb as l,ab as Q,ac as Re,bc as je,cb as c,cc as Te,fa as v,gc as s,hc as y,ic as P,jc as Ee,na as _,oa as g,ob as O,pa as T,qa as Y,ub as h,xc as Ie,yc as Fe}from"./chunk-ZABOWSPW.js";import{e as C}from"./chunk-JKOY2XUY.js";var fe=class i{static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-messages"]],decls:1,vars:0,template:function(e,n){e&1&&x(0,"router-outlet")},dependencies:[S,Ve],encapsulation:2})};var ct=(i,t)=>t._id;function lt(i,t){i&1&&(o(0,"div",10),x(1,"mat-spinner",14),r())}function dt(i,t){if(i&1&&(o(0,"div",11)(1,"div",15)(2,"mat-icon",16),s(3,"error"),r(),o(4,"span",17),s(5),r()()()),i&2){let e=l();c(5),y(e.error())}}function mt(i,t){if(i&1&&x(0,"img",22),i&2){let e=l().$implicit;M("src",e.project_id.business_id.logo_url,Q)("alt",e.project_id.business_id.name)}}function pt(i,t){i&1&&(o(0,"div",23)(1,"mat-icon",36),s(2,"business"),r()())}function ut(i,t){if(i&1){let e=b();o(0,"div",19),m("click",function(){let a=_(e).$implicit,d=l(2);return g(d.openChat(a))}),o(1,"div",20)(2,"div",21),h(3,mt,1,2,"img",22)(4,pt,3,0,"div",23),r(),o(5,"div",24)(6,"div",25)(7,"div",26)(8,"h3",27),s(9),r(),o(10,"div",28)(11,"span",29),s(12),r(),o(13,"span",30),s(14,"\u2022"),r(),o(15,"span",29),s(16),r()(),o(17,"div",31)(18,"span",32),s(19),Ie(20,"titlecase"),r(),o(21,"span",33),s(22),r()()(),o(23,"div",34)(24,"button",35),m("click",function(a){let d=_(e).$implicit,f=l(2);return g(f.viewProject((d.project_id==null?null:d.project_id._id)||"",a))}),o(25,"mat-icon"),s(26,"open_in_new"),r()(),o(27,"mat-icon",30),s(28,"chevron_right"),r()()()()()()}if(i&2){let e=t.$implicit,n=l(2);c(3),p(!(e.project_id==null||e.project_id.business_id==null)&&e.project_id.business_id.logo_url?3:4),c(6),y(e.title),c(3),P(" With ",n.getOtherParticipant(e).last_name||"Unknown User"," "),c(4),y((e.project_id==null||e.project_id.business_id==null?null:e.project_id.business_id.name)||"Unknown Business"),c(2),J(n.getProjectStatusColor((e.project_id==null?null:e.project_id.status)||"unknown")),c(),P(" ",Fe(20,8,(e.project_id==null?null:e.project_id.status)||"Unknown")," "),c(3),y(n.formatDate(e.last_message_at))}}function _t(i,t){if(i&1&&(o(0,"div",12),X(1,ut,29,10,"div",18,ct),r()),i&2){let e=l();c(),Z(e.chats())}}function gt(i,t){if(i&1){let e=b();o(0,"div",13)(1,"div",37)(2,"mat-icon",38),s(3,"chat_bubble_outline"),r()(),o(4,"h3",39),s(5,"No conversations yet"),r(),o(6,"p",40),s(7," Start a conversation by creating a project or accepting project requests. "),r(),o(8,"button",41),m("click",function(){_(e);let a=l();return g(a.navigateToProjects())}),s(9," View Projects "),r()()}}var be=class i{chatService=v(he);authService=v(oe);projectService=v(le);router=v(ie);route=v(ne);loading=w(!1);error=w(null);chats=w([]);unreadCount=w(0);user=this.authService.user;hasChats=j(()=>this.chats().length>0);ngOnInit(){if(!this.user()){this.router.navigate(["/auth"]);return}this.loadChats(),this.loadUnreadCount()}loadChats(){return C(this,null,function*(){this.loading.set(!0),this.error.set(null);try{let t=yield this.chatService.getUserChatsAsync();this.chats.set(t)}catch(t){console.error("Error loading chats:",t),this.error.set("Failed to load chats")}finally{this.loading.set(!1)}})}loadUnreadCount(){return C(this,null,function*(){try{let t=yield this.chatService.getUnreadMessageCountAsync();this.unreadCount.set(t)}catch(t){console.error("Error loading unread count:",t)}})}openChat(t){this.router.navigate(["../chat",t._id],{relativeTo:this.route})}viewProject(t,e){e.stopPropagation(),t&&this.router.navigate(["/dashboard/projects",t])}getOtherParticipant(t){let e=this.user()?._id;return t.project_id?t.project_id.client_id._id===e?t.project_id.business_owner_id:t.project_id.client_id:{last_name:"Unknown User",email:""}}getProjectStatusColor(t){let e={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",accepted:"bg-blue-100 text-blue-800 border-blue-200",in_progress:"bg-purple-100 text-purple-800 border-purple-200",completed:"bg-green-100 text-green-800 border-green-200",rejected:"bg-red-100 text-red-800 border-red-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200"};return e[t]||e.pending}formatDate(t){let e=new Date(t),a=(new Date().getTime()-e.getTime())/(1e3*60*60);if(a<1){let d=Math.floor(a*60);return d<1?"Just now":`${d}m ago`}else return a<24?`${Math.floor(a)}h ago`:a<48?"Yesterday":e.toLocaleDateString()}refreshChats(){return C(this,null,function*(){yield this.loadChats(),yield this.loadUnreadCount()})}navigateBack(){this.router.navigate(["/dashboard"])}navigateToProjects(){this.router.navigate(["/dashboard/projects"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-chat-list"]],decls:20,vars:5,consts:[[1,"min-h-screen","bg-gray-50"],[1,"max-w-6xl","mx-auto","px-4","py-8"],[1,"flex","items-center","justify-between","mb-8"],[1,"flex","items-center","space-x-4"],["mat-icon-button","",1,"flex","items-center","justify-center","w-10","h-10","rounded-full","bg-white","shadow-sm","border","border-gray-200","hover:bg-gray-50","transition-colors",3,"click"],[1,"text-gray-600"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-gray-600","mt-1"],["mat-raised-button","","color","primary",1,"px-6","py-3","text-base","font-semibold","rounded-lg",3,"click","disabled"],[1,"mr-2"],[1,"flex","justify-center","items-center","py-12"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-6","mb-6"],[1,"space-y-4"],[1,"text-center","py-12"],["diameter","40"],[1,"flex","items-center"],[1,"text-red-600","mr-2"],[1,"text-red-800","font-medium"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","p-6","cursor-pointer","hover:shadow-md","transition-all","duration-200"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","p-6","cursor-pointer","hover:shadow-md","transition-all","duration-200",3,"click"],[1,"flex","items-start","space-x-4"],[1,"flex-shrink-0"],[1,"w-12","h-12","rounded-full","object-cover","border","border-gray-200",3,"src","alt"],[1,"w-12","h-12","rounded-full","bg-gradient-to-br","from-blue-400","to-blue-600","flex","items-center","justify-center"],[1,"flex-1","min-w-0"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"text-lg","font-semibold","text-gray-900","mb-1"],[1,"flex","items-center","space-x-2","mb-2"],[1,"text-sm","text-gray-600"],[1,"text-gray-400"],[1,"flex","items-center","space-x-3"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","border"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","space-x-2"],["mat-icon-button","",1,"text-gray-400","hover:text-gray-600",3,"click"],[1,"text-white"],[1,"mx-auto","w-24","h-24","bg-gray-100","rounded-full","flex","items-center","justify-center","mb-6"],[1,"text-gray-400","w-12","h-12"],[1,"text-xl","font-medium","text-gray-900","mb-2"],[1,"text-gray-500","mb-6"],["mat-raised-button","","color","primary",1,"px-6","py-3","text-base","font-semibold","rounded-lg",3,"click"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),m("click",function(){return n.navigateBack()}),o(5,"mat-icon",5),s(6,"arrow_back"),r()(),o(7,"div")(8,"h1",6),s(9,"Messages"),r(),o(10,"p",7),s(11,"Communicate with your project partners"),r()()(),o(12,"button",8),m("click",function(){return n.refreshChats()}),o(13,"mat-icon",9),s(14,"refresh"),r(),s(15," Refresh "),r()(),h(16,lt,2,0,"div",10)(17,dt,6,1,"div",11)(18,_t,3,0,"div",12)(19,gt,10,0,"div",13),r()()),e&2&&(c(12),M("disabled",n.loading()),c(4),p(n.loading()?16:-1),c(),p(n.error()&&!n.loading()?17:-1),c(),p(n.hasChats()&&!n.loading()?18:-1),c(),p(!n.hasChats()&&!n.loading()&&!n.error()?19:-1))},dependencies:[S,qe,De,me,F,V,Be,I,E,de,He,Ne],styles:[".chat-item[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.chat-item[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.unread-indicator[_ngcontent-%COMP%]{position:absolute;top:-2px;right:-2px;width:8px;height:8px;background-color:#ef4444;border-radius:50%;border:2px solid white}"]})};function xt(i,t){i&1&&(o(0,"mat-error"),s(1," Amount is required "),r())}function bt(i,t){i&1&&(o(0,"mat-error"),s(1," Amount must be greater than 0 "),r())}function vt(i,t){i&1&&(o(0,"mat-error"),s(1," Description is required "),r())}function yt(i,t){i&1&&(o(0,"mat-error"),s(1," Message is required "),r())}var ve=class i{dialogRef=v(pe);formBuilder=v(L);paymentForm;constructor(){this.paymentForm=this.formBuilder.group({amount:["",[k.required,k.min(.01)]],description:["",[k.required,k.minLength(3)]],content:["",[k.required,k.minLength(10)]]})}onCancel(){this.dialogRef.close()}onSubmit(){if(this.paymentForm.valid){let t=this.paymentForm.value,e={amount:parseFloat(t.amount),description:t.description,content:t.content};this.dialogRef.close(e)}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-payment-request-modal"]],decls:29,vars:6,consts:[["mat-dialog-title","",1,"dialog-title"],[1,"title-icon"],["mat-dialog-content","",1,"dialog-content"],[1,"payment-form",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","type","number","formControlName","amount","placeholder","0.00","min","0.01","step","0.01"],[4,"ngIf"],["matInput","","formControlName","description","placeholder","Why is additional payment needed?"],["matInput","","formControlName","content","rows","4","placeholder","Explain the payment request in detail..."],["mat-dialog-actions","","align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(e,n){if(e&1&&(o(0,"h1",0)(1,"mat-icon",1),s(2,"payment"),r(),s(3," Request Additional Payment "),r(),o(4,"div",2)(5,"form",3)(6,"mat-form-field",4)(7,"mat-label"),s(8,"Amount ($)"),r(),x(9,"input",5),h(10,xt,2,0,"mat-error",6)(11,bt,2,0,"mat-error",6),r(),o(12,"mat-form-field",4)(13,"mat-label"),s(14,"Description"),r(),x(15,"input",7),h(16,vt,2,0,"mat-error",6),r(),o(17,"mat-form-field",4)(18,"mat-label"),s(19,"Message to Client"),r(),x(20,"textarea",8),h(21,yt,2,0,"mat-error",6),r()()(),o(22,"div",9)(23,"button",10),m("click",function(){return n.onCancel()}),s(24," Cancel "),r(),o(25,"button",11),m("click",function(){return n.onSubmit()}),o(26,"mat-icon"),s(27,"send"),r(),s(28," Send Payment Request "),r()()),e&2){let a,d,f,R;c(5),M("formGroup",n.paymentForm),c(5),M("ngIf",(a=n.paymentForm.get("amount"))==null?null:a.hasError("required")),c(),M("ngIf",(d=n.paymentForm.get("amount"))==null?null:d.hasError("min")),c(5),M("ngIf",(f=n.paymentForm.get("description"))==null?null:f.hasError("required")),c(5),M("ngIf",(R=n.paymentForm.get("content"))==null?null:R.hasError("required")),c(4),M("disabled",n.paymentForm.invalid)}},dependencies:[S,te,U,z,D,Le,A,B,Ue,N,$,K,ue,ge,_e,F,V,G,se,ae,re,H,ce,I,E],styles:[".dialog-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:600;margin-bottom:0}.title-icon[_ngcontent-%COMP%]{color:#3b82f6;font-size:24px}.dialog-content[_ngcontent-%COMP%]{min-width:400px;max-width:500px}.payment-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin-top:16px}.full-width[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]{padding-top:16px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}"]})};function Mt(i,t){i&1&&(o(0,"mat-error"),s(1," Completion details are required "),r())}function wt(i,t){i&1&&(o(0,"mat-error"),s(1," Please provide more detailed information (at least 20 characters) "),r())}var ye=class i{dialogRef=v(pe);formBuilder=v(L);completionForm;constructor(){this.completionForm=this.formBuilder.group({content:["Project has been completed and is ready for review.",[k.required,k.minLength(20)]]})}onCancel(){this.dialogRef.close()}onSubmit(){if(this.completionForm.valid){let t={content:this.completionForm.value.content};this.dialogRef.close(t)}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-completion-request-modal"]],decls:23,vars:4,consts:[["mat-dialog-title","",1,"dialog-title"],[1,"title-icon"],["mat-dialog-content","",1,"dialog-content"],[1,"description"],[1,"completion-form",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","content","rows","6","placeholder","Describe what has been completed, delivered, or achieved..."],[4,"ngIf"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(e,n){if(e&1&&(o(0,"h1",0)(1,"mat-icon",1),s(2,"check_circle"),r(),s(3," Request Project Completion "),r(),o(4,"div",2)(5,"p",3),s(6," You're about to request client approval for project completion. Please describe what has been completed and delivered. "),r(),o(7,"form",4)(8,"mat-form-field",5)(9,"mat-label"),s(10,"Completion Details"),r(),x(11,"textarea",6),o(12,"mat-hint"),s(13,"Be specific about deliverables and outcomes"),r(),h(14,Mt,2,0,"mat-error",7)(15,wt,2,0,"mat-error",7),r()()(),o(16,"div",8)(17,"button",9),m("click",function(){return n.onCancel()}),s(18," Cancel "),r(),o(19,"button",10),m("click",function(){return n.onSubmit()}),o(20,"mat-icon"),s(21,"send"),r(),s(22," Request Completion Approval "),r()()),e&2){let a,d;c(7),M("formGroup",n.completionForm),c(7),M("ngIf",(a=n.completionForm.get("content"))==null?null:a.hasError("required")),c(),M("ngIf",(d=n.completionForm.get("content"))==null?null:d.hasError("minlength")),c(4),M("disabled",n.completionForm.invalid)}},dependencies:[S,te,U,z,D,A,B,N,$,K,ue,ge,_e,F,V,G,se,ae,Ge,re,H,ce,I,E],styles:[".dialog-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:600;margin-bottom:0}.title-icon[_ngcontent-%COMP%]{color:#10b981;font-size:24px}.dialog-content[_ngcontent-%COMP%]{min-width:400px;max-width:500px}.description[_ngcontent-%COMP%]{color:#64748b;font-size:14px;line-height:1.5;margin:0 0 16px;padding:12px;background:#f8fafc;border-radius:8px;border-left:4px solid #10b981}.completion-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.full-width[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]{padding-top:16px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}"]})};var Pt=["messagesContainer"],kt=(i,t)=>t._id;function Ot(i,t){if(i&1&&x(0,"img",17),i&2){let e=l();M("src",e.project_id.business_id.logo_url,Q)("alt",e.project_id.business_id.name)}}function St(i,t){i&1&&(o(0,"div",18),T(),o(1,"svg",26),x(2,"path",27),r()())}function Rt(i,t){if(i&1&&(o(0,"div",8),h(1,Ot,1,2,"img",17)(2,St,3,0,"div",18),o(3,"div",19)(4,"h2",20),s(5),r(),o(6,"div",21)(7,"span",22),s(8),r(),o(9,"div",23),x(10,"div",24),o(11,"span",25),s(12),r()()()()()),i&2){let e,n=t,a=l();c(),p(!(n.project_id==null||n.project_id.business_id==null)&&n.project_id.business_id.logo_url?1:2),c(4),y(n.title),c(3),y(((e=a.otherParticipant())==null?null:e.last_name)||"Unknown User"),c(2),W("online",a.isConnected()),c(2),y(a.isConnected()?"Online":"Offline")}}function jt(i,t){if(i&1){let e=b();o(0,"button",37),m("click",function(){_(e);let a=l(2);return g(a.handleProjectAction("accept"))}),s(1," Accept "),r()}}function Tt(i,t){if(i&1){let e=b();o(0,"button",38),m("click",function(){_(e);let a=l(2);return g(a.handleProjectAction("start"))}),s(1," Start "),r()}}function Et(i,t){if(i&1){let e=b();o(0,"button",39),m("click",function(){_(e);let a=l(2);return g(a.handleProjectAction("complete"))}),s(1," Request Completion "),r()}}function It(i,t){if(i&1){let e=b();o(0,"button",39),m("click",function(){_(e);let a=l(2);return g(a.handleProjectAction("approve_completion"))}),s(1," Approve Completion "),r()}}function Ft(i,t){if(i&1){let e=b();o(0,"button",40),m("click",function(){_(e);let a=l(2);return g(a.handleReviewAction())}),s(1),r()}if(i&2){let e=l(2);c(),P(" ",e.reviewButtonText()," ")}}function qt(i,t){if(i&1){let e=b();o(0,"button",41),m("click",function(){_(e);let a=l(2);return g(a.openReportDialog())}),o(1,"mat-icon"),s(2,"flag"),r()()}}function Vt(i,t){if(i&1){let e=b();o(0,"button",37),m("click",function(){_(e);let a=l(2);return g(a.handleProjectAction("accept"))}),s(1," Accept Project "),r()}}function Dt(i,t){if(i&1){let e=b();o(0,"button",42),m("click",function(){_(e);let a=l(2);return g(a.handleProjectAction("reject"))}),s(1," Reject "),r()}}function At(i,t){if(i&1){let e=b();o(0,"button",38),m("click",function(){_(e);let a=l(2);return g(a.handleProjectAction("start"))}),s(1," Start Project "),r()}}function Bt(i,t){if(i&1){let e=b();o(0,"button",39),m("click",function(){_(e);let a=l(2);return g(a.handleProjectAction("complete"))}),s(1," Request Completion "),r()}}function zt(i,t){if(i&1){let e=b();o(0,"button",39),m("click",function(){_(e);let a=l(2);return g(a.handleProjectAction("approve_completion"))}),s(1," Approve Completion "),r()}}function Nt(i,t){if(i&1){let e=b();o(0,"button",43),m("click",function(){_(e);let a=l(2);return g(a.requestAdditionalPayment())}),s(1," Request Payment "),r()}}function $t(i,t){if(i&1){let e=b();o(0,"button",40),m("click",function(){_(e);let a=l(2);return g(a.handleReviewAction())}),s(1),r()}if(i&2){let e=l(2);c(),P(" ",e.reviewButtonText()," ")}}function Lt(i,t){if(i&1){let e=b();o(0,"button",41),m("click",function(){_(e);let a=l(2);return g(a.openReportDialog())}),o(1,"mat-icon"),s(2,"flag"),r(),s(3," Report User "),r()}}function Ut(i,t){if(i&1&&(o(0,"div",28),h(1,jt,2,0,"button",29)(2,Tt,2,0,"button",30)(3,Et,2,0,"button",31)(4,It,2,0,"button",31)(5,Ft,2,1,"button",32)(6,qt,3,0,"button",33),r(),o(7,"div",34),h(8,Vt,2,0,"button",29)(9,Dt,2,0,"button",35)(10,At,2,0,"button",30)(11,Bt,2,0,"button",31)(12,zt,2,0,"button",31)(13,Nt,2,0,"button",36)(14,$t,2,1,"button",32)(15,Lt,4,0,"button",33),r()),i&2){let e=l();c(),p(e.canPerformAction("accept")?1:e.canPerformAction("start")?2:e.canPerformAction("complete")?3:e.canPerformAction("approve_completion")?4:e.showReviewButton()?5:-1),c(5),p(e.otherParticipant()?6:-1),c(2),p(e.canPerformAction("accept")?8:-1),c(),p(e.canPerformAction("reject")?9:-1),c(),p(e.canPerformAction("start")?10:-1),c(),p(e.canPerformAction("complete")?11:-1),c(),p(e.canPerformAction("approve_completion")?12:-1),c(),p(e.canRequestPayment()?13:-1),c(),p(e.showReviewButton()?14:-1),c(),p(e.otherParticipant()?15:-1)}}function Gt(i,t){i&1&&(o(0,"div",14),x(1,"div",44),o(2,"p",45),s(3,"Loading conversation..."),r()())}function Ht(i,t){if(i&1&&(o(0,"div",15)(1,"div",46),T(),o(2,"svg",47),x(3,"path",48),r(),Y(),o(4,"span",49),s(5),r()()()),i&2){let e=l();c(5),y(e.error())}}function Kt(i,t){if(i&1&&(o(0,"div",53)(1,"span",62),s(2),r()()),i&2){let e=l().$implicit,n=l(3);c(2),P(" ",n.formatMessageDate(e.createdAt)," ")}}function Yt(i,t){if(i&1&&(o(0,"div",56)(1,"span",63),s(2),r()()),i&2){let e=l().$implicit;c(2),Ee(" ",e.sender_id.email.charAt(0).toUpperCase(),"",e.sender_id.last_name.charAt(0).toUpperCase()," ")}}function Qt(i,t){if(i&1&&(o(0,"div",58),T(),o(1,"svg",64),x(2,"path",65),r(),s(3),r()),i&2){let e=l().$implicit;c(3),P(" ",e.content," ")}}function Wt(i,t){if(i&1){let e=b();o(0,"div",72)(1,"button",74),m("click",function(){_(e);let a=l(2).$implicit,d=l(3);return g(d.approvePaymentRequest(a._id))}),s(2," Approve & Pay "),r(),o(3,"button",42),m("click",function(){_(e);let a=l(2).$implicit,d=l(3);return g(d.rejectPaymentRequest(a._id))}),s(4," Reject "),r()()}}function Jt(i,t){if(i&1&&(o(0,"div",59)(1,"div",66)(2,"mat-icon"),s(3,"payment"),r(),o(4,"h4"),s(5,"Additional Payment Request"),r(),o(6,"span",67),s(7),r()(),o(8,"div",68)(9,"div",69),s(10),r(),o(11,"div",70),s(12),r(),o(13,"p",71),s(14),r()(),h(15,Wt,5,0,"div",72),o(16,"div",73),s(17),r()()),i&2){let e=l().$implicit,n=l(3);c(6),J("status-"+e.payment_status),c(),P(" ",e.payment_status," "),c(3),P("$",e.payment_amount,""),c(2),y(e.payment_description),c(2),y(e.content),c(),p(n.canRespondToPayment(e)?15:-1),c(2),P(" ",n.formatMessageTime(e.createdAt)," ")}}function Xt(i,t){if(i&1){let e=b();o(0,"div",78)(1,"button",74),m("click",function(){_(e);let a=l(5);return g(a.approveCompletion())}),s(2," Approve Completion "),r(),o(3,"button",42),m("click",function(){_(e);let a=l(5);return g(a.rejectCompletion())}),s(4," Request Changes "),r()()}}function Zt(i,t){if(i&1&&(o(0,"div",60)(1,"div",75)(2,"mat-icon"),s(3,"check_circle"),r(),o(4,"h4"),s(5,"Project Completion Request"),r(),o(6,"span",76),s(7),r()(),o(8,"div",77)(9,"p"),s(10),r()(),h(11,Xt,5,0,"div",78),o(12,"div",73),s(13),r()()),i&2){let e=l().$implicit,n=l(3);c(6),J("status-"+e.completion_status),c(),P(" ",e.completion_status," "),c(3),y(e.content),c(),p(n.canRespondToCompletion(e)?11:-1),c(2),P(" ",n.formatMessageTime(e.createdAt)," ")}}function en(i,t){if(i&1&&(o(0,"p",82),s(1),r()),i&2){let e=l(3).$implicit;c(),y(e.content)}}function tn(i,t){if(i&1){let e=b();o(0,"div",80)(1,"img",84),m("click",function(){_(e);let a=l(2).$implicit,d=l(3);return g(d.downloadFile(a.file_url,a.file_name||"image"))}),r(),h(2,en,2,1,"p",82),r()}if(i&2){let e=l(2).$implicit;c(),M("src",e.file_url,Q)("alt",e.file_name||"Image"),c(),p(e.content&&e.content!==e.file_name?2:-1)}}function nn(i,t){if(i&1&&(o(0,"span",89),s(1),r()),i&2){let e=l(3).$implicit,n=l(3);c(),y(n.formatFileSize(e.file_size))}}function on(i,t){if(i&1&&(o(0,"p",82),s(1),r()),i&2){let e=l(3).$implicit;c(),y(e.content)}}function an(i,t){if(i&1){let e=b();o(0,"div",81)(1,"div",85)(2,"mat-icon",86),s(3,"attach_file"),r(),o(4,"div",87)(5,"span",88),s(6),r(),h(7,nn,2,1,"span",89),r(),o(8,"button",90),m("click",function(){_(e);let a=l(2).$implicit,d=l(3);return g(d.downloadFile(a.file_url,a.file_name||"file"))}),o(9,"mat-icon"),s(10,"download"),r()()(),h(11,on,2,1,"p",82),r()}if(i&2){let e=l(2).$implicit;c(6),y(e.file_name),c(),p(e.file_size?7:-1),c(4),p(e.content&&e.content!==e.file_name?11:-1)}}function rn(i,t){if(i&1&&(o(0,"p",82),s(1),r()),i&2){let e=l(2).$implicit;c(),y(e.content)}}function sn(i,t){i&1&&(o(0,"span",83),s(1,"(edited)"),r())}function cn(i,t){if(i&1&&(o(0,"div",79),h(1,tn,3,3,"div",80)(2,an,12,3,"div",81)(3,rn,2,1,"p",82)(4,sn,2,0,"span",83),o(5,"div",73),s(6),r()()),i&2){let e=l().$implicit,n=l(3);W("my-bubble",n.isMyMessage(e))("other-bubble",!n.isMyMessage(e)),c(),p(n.isImageFile(e)?1:n.isFileMessage(e)?2:3),c(3),p(e.is_edited?4:-1),c(2),P(" ",n.formatMessageTime(e.createdAt)," ")}}function ln(i,t){if(i&1&&(h(0,Kt,3,1,"div",53),o(1,"div",54)(2,"div",55),h(3,Yt,3,2,"div",56),o(4,"div",57),h(5,Qt,4,1,"div",58)(6,Jt,18,8,"div",59)(7,Zt,14,6,"div",60)(8,cn,7,7,"div",61),r()()()),i&2){let e=t.$implicit,n=t.$index,a=l(3);p(a.shouldShowDateDivider(n)?0:-1),c(),W("my-message",a.isMyMessage(e)),c(2),p(a.isMyMessage(e)?-1:3),c(2),p(e.message_type==="project_update"?5:a.isPaymentRequest(e)?6:a.isCompletionRequest(e)?7:8)}}function dn(i,t){if(i&1&&(o(0,"div",51),X(1,ln,9,5,null,null,kt),r()),i&2){let e=l(2);c(),Z(e.messages())}}function mn(i,t){if(i&1&&(o(0,"div",52)(1,"div",91),T(),o(2,"svg",92),x(3,"path",93),r()(),Y(),o(4,"h3",94),s(5,"Start the conversation"),r(),o(6,"p",95),s(7," No messages yet. Send the first message to start discussing your project "),o(8,"span",96),s(9),r()()()),i&2){let e,n=l(2);c(9),P('"',(e=n.chat())==null?null:e.title,'"')}}function pn(i,t){if(i&1&&(o(0,"div",16,0)(2,"div",50),h(3,dn,3,0,"div",51)(4,mn,10,1,"div",52),r()()),i&2){let e=l();c(3),p(e.hasMessages()?3:4)}}function un(i,t){if(i&1&&(o(0,"div",97)(1,"div",98)(2,"div",99)(3,"mat-icon",100),s(4,"lock"),r(),o(5,"div",101)(6,"h4"),s(7),r(),o(8,"p"),s(9,"This conversation has been archived and is now read-only."),r()()()()()),i&2){let e=l(2);c(7),y(e.chatDisabledMessage())}}function _n(i,t){if(i&1&&(o(0,"div",102)(1,"div",114),x(2,"div",115)(3,"div",115)(4,"div",115),r(),o(5,"span",116),s(6),r()()),i&2){let e=l(3);c(6),y(e.getTypingText())}}function gn(i,t){i&1&&(o(0,"div",103),x(1,"div",117),o(2,"span",118),s(3,"Uploading files..."),r()())}function hn(i,t){if(i&1){let e=b();o(0,"div",119)(1,"mat-icon",86),s(2),r(),o(3,"div",85)(4,"span",88),s(5),r(),o(6,"span",89),s(7),r()(),o(8,"button",123),m("click",function(){let a=_(e).$index,d=l(4);return g(d.removeSelectedFile(a))}),o(9,"mat-icon"),s(10,"close"),r()()()}if(i&2){let e=t.$implicit,n=l(4);c(2),y(n.getFileIcon(e)),c(3),y(e.name),c(2),y(n.formatFileSize(e.size))}}function fn(i,t){if(i&1){let e=b();o(0,"div",104),X(1,hn,11,3,"div",119,Se),o(3,"div",120)(4,"button",121),m("click",function(){_(e);let a=l(3);return g(a.uploadFiles(a.selectedFiles()))}),o(5,"mat-icon"),s(6,"cloud_upload"),r(),s(7," Upload Files "),r(),o(8,"button",122),m("click",function(){_(e);let a=l(3);return g(a.selectedFiles.set([]))}),s(9," Cancel "),r()()()}if(i&2){let e=l(3);c(),Z(e.selectedFiles())}}function Cn(i,t){i&1&&x(0,"div",112)}function xn(i,t){i&1&&(T(),o(0,"svg",113),x(1,"path",124),r())}function bn(i,t){if(i&1){let e=b();o(0,"div",97),h(1,_n,7,1,"div",102)(2,gn,4,0,"div",103)(3,fn,10,0,"div",104),o(4,"div",105)(5,"input",106),m("change",function(a){_(e);let d=l(2);return g(d.onFileSelect(a))}),r(),o(6,"form",107),m("ngSubmit",function(){_(e);let a=l(2);return g(a.sendMessage())}),o(7,"button",108),m("click",function(){_(e);let a=l(2);return g(a.triggerFileInput())}),o(8,"mat-icon"),s(9,"attach_file"),r()(),o(10,"div",109)(11,"textarea",110),m("input",function(){_(e);let a=l(2);return g(a.onTextareaInput())})("keydown",function(a){_(e);let d=l(2);return g(d.onTextareaKeydown(a))}),r()(),o(12,"button",111),h(13,Cn,1,0,"div",112)(14,xn,2,0,":svg:svg",113),r()()()()}if(i&2){let e=l(2);c(),p(e.typingUsers().length>0?1:-1),c(),p(e.uploadingFiles()?2:-1),c(),p(e.selectedFiles().length>0&&!e.uploadingFiles()?3:-1),c(3),M("formGroup",e.messageForm),c(),M("disabled",e.uploadingFiles()),c(5),W("sending",e.sendingMessage()),M("disabled",!e.messageForm.valid||e.sendingMessage()||e.uploadingFiles()),c(),p(e.sendingMessage()?13:14)}}function vn(i,t){if(i&1&&h(0,un,10,1,"div",97)(1,bn,15,9,"div",97),i&2){let e=l();p(e.isChatDisabled()?0:1)}}var Me=class i{messagesContainer;chatService=v(he);authService=v(oe);projectService=v(le);reviewService=v(Ke);socketService=v($e);router=v(ie);route=v(ne);formBuilder=v(L);breakpointObserver=v(Ae);dialog=v(Ye);reportsService=v(Qe);loading=w(!1);messagesLoading=w(!1);sendingMessage=w(!1);uploadingFiles=w(!1);error=w(null);chat=w(null);messages=w([]);typingUsers=w([]);isConnected=w(!1);isMobile=w(!1);selectedFiles=w([]);canLeaveReview=w(!1);existingReview=w(null);reviewButtonText=j(()=>this.existingReview()?`View Review (${this.existingReview().rating}\u2B50)`:this.canLeaveReview()?"Leave Review":"");showReviewButton=j(()=>!!(this.canLeaveReview()||this.existingReview()));isChatDisabled=j(()=>{let t=this.chat();if(!t||!t.project_id)return!1;let e=t.project_id.status;return e==="completed"||e==="settled"});chatDisabledMessage=j(()=>{let t=this.chat();if(!t||!t.project_id)return"";let e=t.project_id.status;return e==="completed"?"Project completed - Chat will be disabled after payment processing":e==="settled"?"Project completed and payment processed - Chat is now disabled":""});messageForm;user=this.authService.user;hasMessages=j(()=>this.messages().length>0);otherParticipant=j(()=>{let t=this.chat(),e=this.user()?._id;return!t||!e||!t.project_id?null:t.project_id.client_id._id===e?t.project_id.business_owner_id:t.project_id.client_id});chatId=null;shouldScrollToBottom=!1;refreshInterval;subscriptions=[];typingTimeout;constructor(){this.messageForm=this.formBuilder.group({content:["",[k.required,k.maxLength(1e3)]]})}ngOnInit(){if(!this.user()){this.router.navigate(["/auth"]);return}this.requestNotificationPermission(),this.setupMobileDetection(),this.setupSocketSubscriptions(),this.route.params.subscribe(t=>{this.chatId=t.chatId,this.chatId&&(this.loadChat(),this.checkReviewEligibility(),this.loadMessages(),this.markMessagesAsRead(),this.joinSocketRoom())})}ngOnDestroy(){this.refreshInterval&&clearInterval(this.refreshInterval),this.typingTimeout&&clearTimeout(this.typingTimeout),this.chatId&&this.socketService.leaveChat(this.chatId),this.subscriptions.forEach(t=>t.unsubscribe())}requestNotificationPermission(){"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission().then(t=>{console.log("Notification permission:",t)})}ngAfterViewChecked(){this.shouldScrollToBottom&&(this.scrollToBottom(),this.shouldScrollToBottom=!1)}setupMobileDetection(){let t=this.breakpointObserver.observe([Pe.Handset,Pe.Small]).subscribe(e=>{this.isMobile.set(e.matches)});this.subscriptions.push(t)}setupSocketSubscriptions(){let t=this.socketService.isConnected$.subscribe(u=>{this.isConnected.set(u)}),e=this.socketService.onNewMessage().subscribe(u=>{if(u.success&&u.data){let q=this.messages();if(q.find(we=>we._id===u.data._id)){console.log("Message already exists, skipping duplicate:",u.data._id);return}this.messages.set([...q,u.data]),this.shouldScrollToBottom=!0,u.data.message_type==="payment_request"&&this.handlePaymentRequestNotification(u.data)}}),n=this.socketService.onMessageError().subscribe(u=>{console.error("Socket message error:",u),this.error.set(u.error||"Message failed to send")}),a=this.socketService.getTypingUsersForChat().subscribe(u=>{let q=this.user()?._id,Oe=u.filter(we=>we.userId!==q);this.typingUsers.set(Oe)}),d=this.socketService.onEvent("files-uploaded").subscribe(u=>{u.chatId===this.chatId&&(console.log("Files uploaded in this chat, refreshing messages"),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),f=this.socketService.onEvent("payment-request-created").subscribe(u=>{u.chatId===this.chatId&&(console.log("Payment request created in this chat, refreshing messages"),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),R=this.socketService.onEvent("payment-approved").subscribe(u=>{u.chatId===this.chatId&&(console.log("Payment approved in this chat, refreshing messages"),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),ee=this.socketService.onEvent("payment-rejected").subscribe(u=>{u.chatId===this.chatId&&(console.log("Payment rejected in this chat, refreshing messages"),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),it=this.socketService.onEvent("completion-request-created").subscribe(u=>{u.chatId===this.chatId&&(console.log("Completion request created in this chat, refreshing messages"),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),ot=this.socketService.onEvent("completion-approved").subscribe(u=>{u.chatId===this.chatId&&(console.log("Completion approved in this chat, refreshing messages"),this.loadChat(),this.loadMessages(!1),this.checkReviewEligibility(),this.shouldScrollToBottom=!0)}),at=this.socketService.onEvent("completion-rejected").subscribe(u=>{u.chatId===this.chatId&&(console.log("Completion rejected in this chat, refreshing messages"),this.loadChat(),this.loadMessages(!1),this.shouldScrollToBottom=!0)}),rt=this.socketService.onEvent("project-status-updated").subscribe(u=>{console.log("Project status updated:",u);let q=this.chat();q&&q.project_id?._id===u.projectId&&(console.log("Project status updated for current chat, refreshing chat data"),this.loadChat(),this.loadMessages(!1),this.checkReviewEligibility(),this.shouldScrollToBottom=!0)}),st=this.socketService.onEvent("system-message").subscribe(u=>{console.log("System message received:",u),u.chatId===this.chatId&&(console.log("System message for current chat, refreshing messages"),this.loadMessages(!1),this.shouldScrollToBottom=!0)});this.subscriptions.push(t,e,n,a,d,f,R,ee,it,ot,at,rt,st)}joinSocketRoom(){return C(this,null,function*(){if(this.chatId)try{yield this.socketService.joinChat(this.chatId),console.log("Joined socket room for chat:",this.chatId)}catch(t){console.error("Failed to join socket room:",t)}})}loadChat(){return C(this,null,function*(){if(this.chatId){this.loading.set(!0),this.error.set(null);try{let t=yield this.chatService.getChatByIdAsync(this.chatId);this.chat.set(t)}catch(t){console.error("Error loading chat:",t),this.error.set("Failed to load chat")}finally{this.loading.set(!1)}}})}loadMessages(t=!0){return C(this,null,function*(){if(this.chatId){t&&this.messagesLoading.set(!0);try{let e=yield this.chatService.getChatMessagesAsync(this.chatId);this.messages.set(e.reverse()),this.shouldScrollToBottom=!0}catch(e){console.error("Error loading messages:",e),t&&this.error.set("Failed to load messages")}finally{t&&this.messagesLoading.set(!1)}}})}sendMessage(){return C(this,null,function*(){let t=this.messageForm.get("content")?.value?.trim();if(!t||!this.chatId||this.sendingMessage()){console.log("Cannot send message:",{content:t,chatId:this.chatId,sending:this.sendingMessage()});return}this.sendingMessage.set(!0),this.error.set(null);try{console.log("Sending message via socket:",{chatId:this.chatId,content:t}),this.socketService.stopTyping(this.chatId);let e=yield this.socketService.sendMessage(this.chatId,t);if(e.success&&e.data){let n=this.messages();n.find(d=>d._id===e.data._id)||(this.messages.set([...n,e.data]),this.shouldScrollToBottom=!0),this.messageForm.reset(),console.log("Message sent successfully via socket")}else throw new Error(e.error||"Failed to send message")}catch(e){console.error("Error sending message via socket:",e);try{console.log("Falling back to HTTP message sending"),yield this.chatService.sendMessageAsync(this.chatId,{content:t,message_type:"text"}),this.messageForm.reset(),yield this.loadMessages(!1),this.shouldScrollToBottom=!0,console.log("Message sent successfully via HTTP fallback")}catch(n){console.error("HTTP fallback also failed:",n),this.error.set("Failed to send message. Please try again.")}}finally{this.sendingMessage.set(!1)}})}onFileSelect(t){let e=t.target;if(e.files&&e.files.length>0){let n=Array.from(e.files);this.selectedFiles.set(n),this.uploadFiles(n)}}uploadFiles(t){return C(this,null,function*(){if(!(!this.chatId||t.length===0)){this.uploadingFiles.set(!0),this.error.set(null);try{let e=yield this.chatService.uploadChatFilesAsync(this.chatId,t);try{this.socketService.emit("files-uploaded",{chatId:this.chatId,fileCount:t.length,userId:this.user()?._id})}catch(n){console.warn("Failed to send real-time file upload notification:",n)}yield this.loadMessages(!1),this.shouldScrollToBottom=!0,this.selectedFiles.set([]),console.log("Files uploaded successfully:",e)}catch(e){console.error("Error uploading files:",e),this.error.set("Failed to upload files. Please try again.")}finally{this.uploadingFiles.set(!1)}}})}triggerFileInput(){let t=document.getElementById("fileInput");t&&t.click()}removeSelectedFile(t){let n=this.selectedFiles().filter((a,d)=>d!==t);this.selectedFiles.set(n)}getFileIcon(t){let e=t.type;return e.startsWith("image/")?"image":e.startsWith("video/")?"videocam":e.startsWith("audio/")?"audiotrack":e.includes("pdf")?"picture_as_pdf":e.includes("word")||e.includes("document")?"description":e.includes("excel")||e.includes("spreadsheet")?"table_chart":e.includes("powerpoint")||e.includes("presentation")?"slideshow":"attach_file"}formatFileSize(t){if(!t||t===0)return"0 Bytes";let e=1024,n=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,a)).toFixed(2))+" "+n[a]}isImageFile(t){return t.message_type==="image"&&!!t.file_url}isFileMessage(t){return t.message_type==="file"&&!!t.file_url}downloadFile(t,e){let n=document.createElement("a");n.href=t,n.download=e,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)}markMessagesAsRead(){return C(this,null,function*(){if(this.chatId)try{yield this.chatService.markMessagesAsReadAsync(this.chatId)}catch(t){console.error("Error marking messages as read:",t)}})}isMyMessage(t){return t.sender_id._id===this.user()?._id}formatMessageTime(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}formatMessageDate(t){let e=new Date(t),n=new Date,a=new Date(n);return a.setDate(a.getDate()-1),e.toDateString()===n.toDateString()?"Today":e.toDateString()===a.toDateString()?"Yesterday":e.toLocaleDateString()}shouldShowDateDivider(t){if(t===0)return!0;let e=this.messages()[t],n=this.messages()[t-1],a=new Date(e.createdAt).toDateString(),d=new Date(n.createdAt).toDateString();return a!==d}onTextareaInput(){this.chatId&&(this.socketService.startTyping(this.chatId),this.typingTimeout&&clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(()=>{this.socketService.stopTyping(this.chatId)},3e3))}onTextareaKeydown(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}getTypingText(){let t=this.typingUsers();return t.length===0?"":t.length===1?`${t[0].userName||"Someone"} is typing...`:t.length===2?`${t[0].userName||"Someone"} and ${t[1].userName||"someone else"} are typing...`:"Several people are typing..."}getProjectStatusColor(t){let e={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",accepted:"bg-blue-100 text-blue-800 border-blue-200",in_progress:"bg-purple-100 text-purple-800 border-purple-200",awaiting_client_approval:"bg-orange-100 text-orange-800 border-orange-200",completed:"bg-green-100 text-green-800 border-green-200",rejected:"bg-red-100 text-red-800 border-red-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200"};return e[t]||e.pending}goToProjectDetails(){let t=this.chat();t&&t.project_id&&this.router.navigate(["/dashboard/projects",t.project_id._id])}handleProjectAction(t){return C(this,null,function*(){let e=this.chat();if(!(!e||!e.project_id))try{let n=e.project_id._id;switch(t){case"accept":yield this.projectService.updateProjectAsync(n,{status:"accepted"});break;case"reject":let a=prompt("Please provide a reason for rejection:");if(!a)return;yield this.projectService.updateProjectAsync(n,{status:"rejected",rejection_reason:a});break;case"start":yield this.projectService.updateProjectAsync(n,{status:"in_progress"});break;case"complete":yield this.requestCompletion();return;case"request_completion":yield this.requestCompletion();return;case"approve_completion":yield this.approveCompletion();return}yield this.loadChat(),yield this.chatService.sendMessageAsync(this.chatId,{content:`Project status updated to: ${t==="start"?"in progress":t}d`,message_type:"project_update"}),yield this.loadMessages(!1)}catch(n){console.error(`Error ${t}ing project:`,n),this.error.set(`Failed to ${t} project`)}})}canPerformAction(t){let e=this.chat(),n=this.user();if(!e||!n||!e.project_id||this.isChatDisabled())return!1;let a=e.project_id.business_owner_id._id===n._id,d=e.project_id.client_id._id===n._id,f=e.project_id.status;switch(t){case"accept":case"reject":return a&&f==="pending";case"start":return a&&f==="accepted";case"complete":case"request_completion":return a&&f==="in_progress";case"approve_completion":return d&&f==="awaiting_client_approval";default:return!1}}scrollToBottom(){try{let t=this.messagesContainer?.nativeElement;t&&(t.scrollTop=t.scrollHeight)}catch(t){console.error("Error scrolling to bottom:",t)}}handlePaymentRequestNotification(t){let e=this.user(),n=this.chat();e&&n&&n.project_id?.client_id._id===e._id&&(Notification.permission==="granted"&&new Notification("Payment Request Received",{body:`New payment request of $${t.payment_amount||"N/A"} from ${this.getOtherParticipantName()}`,icon:"/favicon.ico",tag:"payment-request"}),console.log("Payment request notification:",t))}getOtherParticipantName(){let t=this.otherParticipant();if(!t)return"Business Owner";let e=t.first_name||"",n=t.last_name||"";return`${e} ${n}`.trim()||"Business Owner"}requestAdditionalPayment(){return C(this,null,function*(){this.dialog.open(ve,{width:"500px",disableClose:!0}).afterClosed().subscribe(e=>C(this,null,function*(){if(e)try{yield this.chatService.requestAdditionalPaymentAsync(this.chatId,e)}catch(n){console.error("Error requesting payment:",n),this.error.set("Failed to request additional payment")}}))})}approvePaymentRequest(t){return C(this,null,function*(){try{let e=this.messages().find(f=>f._id===t);if(!e){this.error.set("Payment request not found");return}let n=this.chat();if(!n){this.error.set("Chat information not available");return}let a=typeof n.project_id?.business_id=="string"?"Business Owner":n.project_id?.business_id?.name||"Business Owner";this.dialog.open(Xe,{width:"500px",disableClose:!0,data:{amount:e.payment_amount||"0",description:e.payment_description||"Additional payment",businessName:a,chatId:this.chatId,messageId:t}}).afterClosed().subscribe(f=>C(this,null,function*(){if(f&&f.paymentIntentId)try{this.loadMessages(!1),this.shouldScrollToBottom=!0,console.log("Payment approved successfully with method:",f.paymentMethod),console.log("Payment completed for amount:",f.amount)}catch(R){console.error("Error processing payment approval:",R),this.error.set("Failed to process payment approval")}}))}catch(e){console.error("Error approving payment:",e),this.error.set("Failed to approve payment request")}})}rejectPaymentRequest(t){return C(this,null,function*(){let e=prompt("Please provide a reason for rejecting this payment request:");if(e)try{yield this.chatService.respondToPaymentRequestAsync(this.chatId,t,{status:"rejected",rejection_reason:e}),console.log("Payment request rejected with reason:",e)}catch(n){console.error("Error rejecting payment:",n),this.error.set("Failed to reject payment request")}})}requestCompletion(){return C(this,null,function*(){this.dialog.open(ye,{width:"500px",disableClose:!0}).afterClosed().subscribe(e=>C(this,null,function*(){if(e)try{yield this.chatService.requestCompletionAsync(this.chatId,e);try{this.socketService.emit("completion-request-created",{chatId:this.chatId,content:e.content,userId:this.user()?._id})}catch(n){console.warn("Failed to send real-time completion request notification:",n)}yield this.loadChat(),yield this.loadMessages(!1)}catch(n){console.error("Error requesting completion:",n),this.error.set("Failed to request completion approval")}}))})}approveCompletion(){return C(this,null,function*(){try{yield this.loadMessages(!1);let t=this.messages();console.log("All messages:",t.length),console.log("Completion messages:",t.filter(n=>n.message_type==="completion_request"));let e=t.filter(n=>{let a=n.message_type==="completion_request",d=!n.completion_status||n.completion_status==="pending";return console.log(`Message ${n._id}: type=${n.message_type}, status=${n.completion_status}, isPending=${d}`),a&&d}).sort((n,a)=>new Date(a.createdAt).getTime()-new Date(n.createdAt).getTime())[0];if(!e){console.log("No pending completion request found"),console.log("Available completion messages:",t.filter(n=>n.message_type==="completion_request").map(n=>({id:n._id,type:n.message_type,status:n.completion_status,createdAt:n.createdAt}))),this.error.set("No pending completion request found. Please ensure a completion request has been sent first.");return}console.log("Found pending completion message:",e._id),yield this.chatService.respondToCompletionRequestAsync(this.chatId,e._id,{status:"approved"});try{this.socketService.emit("completion-approved",{chatId:this.chatId,messageId:e._id,userId:this.user()?._id})}catch(n){console.warn("Failed to send real-time completion approval notification:",n)}yield this.loadChat(),yield this.loadMessages(!1),yield this.checkReviewEligibility()}catch(t){console.error("Error approving completion:",t),this.error.set("Failed to approve completion")}})}rejectCompletion(){return C(this,null,function*(){let t=prompt("Please provide a reason for rejecting the completion:");if(t)try{yield this.loadMessages(!1);let e=this.messages(),n=e.filter(a=>{let d=a.message_type==="completion_request",f=!a.completion_status||a.completion_status==="pending";return d&&f}).sort((a,d)=>new Date(d.createdAt).getTime()-new Date(a.createdAt).getTime())[0];if(!n){console.log("Available completion messages:",e.filter(a=>a.message_type==="completion_request").map(a=>({id:a._id,type:a.message_type,status:a.completion_status,createdAt:a.createdAt}))),this.error.set("No pending completion request found. Please ensure a completion request has been sent first.");return}yield this.chatService.respondToCompletionRequestAsync(this.chatId,n._id,{status:"rejected",rejection_reason:t});try{this.socketService.emit("completion-rejected",{chatId:this.chatId,messageId:n._id,reason:t,userId:this.user()?._id})}catch(a){console.warn("Failed to send real-time completion rejection notification:",a)}yield this.loadChat(),yield this.loadMessages(!1)}catch(e){console.error("Error rejecting completion:",e),this.error.set("Failed to reject completion")}})}isPaymentRequest(t){return t.message_type==="payment_request"}isCompletionRequest(t){return t.message_type==="completion_request"}canRespondToPayment(t){let e=this.user(),n=this.chat();return!e||!n?!1:t.message_type==="payment_request"&&t.payment_status==="pending"&&n.project_id?.client_id._id===e._id}canRespondToCompletion(t){let e=this.user(),n=this.chat();return!e||!n?!1:t.message_type==="completion_request"&&t.completion_status==="pending"&&n.project_id?.client_id._id===e._id}canRequestPayment(){let t=this.user(),e=this.chat();return!t||!e||!e.project_id||this.isChatDisabled()?!1:e.project_id.business_owner_id._id===t._id&&(e.project_id.status==="in_progress"||e.project_id.status==="awaiting_client_approval")}checkReviewEligibility(){return C(this,null,function*(){let t=this.user(),e=this.chat();if(!t||!e||!e.project_id){this.canLeaveReview.set(!1),this.existingReview.set(null);return}let n=typeof e.project_id.client_id=="string"?e.project_id.client_id:e.project_id.client_id._id,a=t._id===n,d=e.project_id.status==="completed";if(!a||!d){this.canLeaveReview.set(!1),this.existingReview.set(null);return}try{let R=(yield this.reviewService.getBusinessReviewsAsync(e.project_id.business_id._id)).find(ee=>ee.project_id._id===e.project_id._id&&ee.user_id._id===t._id);R?(this.canLeaveReview.set(!1),this.existingReview.set(R)):(this.canLeaveReview.set(!0),this.existingReview.set(null))}catch(f){console.error("Chat: Error checking review eligibility:",f),this.canLeaveReview.set(!1),this.existingReview.set(null)}})}handleReviewAction(){this.existingReview()?this.viewExistingReview():this.canLeaveReview()&&this.openReviewDialog()}openReviewDialog(){return C(this,null,function*(){let t=this.chat();if(!t||!t.project_id)return;this.dialog.open(Ze,{width:"600px",data:{businessId:t.project_id.business_id._id,projectId:t.project_id._id,businessName:t.project_id.business_id.name,projectTitle:t.project_id.title}}).afterClosed().subscribe(n=>C(this,null,function*(){n&&(console.log("Review submitted successfully"),yield this.checkReviewEligibility())}))})}viewExistingReview(){let t=this.existingReview();if(!t)return;let e=["Your Review for this Project","",`Overall Rating: ${t.rating}/5 \u2B50`,"","Detailed Ratings:",`\u2022 Service Quality: ${t.service_quality||"N/A"}/5`,`\u2022 Communication: ${t.communication||"N/A"}/5`,`\u2022 Timeliness: ${t.timeliness||"N/A"}/5`,`\u2022 Value for Money: ${t.value_for_money||"N/A"}/5`,"",`Comment: ${t.comment||"No comment provided"}`,"",`Submitted: ${new Date(t.createdAt).toLocaleDateString()}`].join(`
`);alert(e)}openReportDialog(){return C(this,null,function*(){let t=this.chat();if(!t)return;let e=this.otherParticipant();if(!e)return;let n=this.getOtherParticipantName();this.dialog.open(We,{width:"500px",data:{reportType:"user",targetId:e._id,targetName:n,contextInfo:`Chat conversation in project: ${t.project_id?.title||"Unknown Project"}`}}).afterClosed().subscribe(d=>C(this,null,function*(){if(d)try{let f={reported_user_id:e._id,report_type:"user",reason:d.reason,custom_reason:d.customReason,description:d.description,is_anonymous:d.isAnonymous};yield this.reportsService.submitReportAsync(f),this.dialog.open(Je,{width:"400px",data:{entityType:"user",entityName:n}})}catch(f){console.error("Failed to submit report:",f)}}))})}onKeyPress(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}navigateBack(){this.router.navigate(["dashboard","messages","chats"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-chat-room"]],viewQuery:function(e,n){if(e&1&&Re(Pt,5),e&2){let a;je(a=Te())&&(n.messagesContainer=a.first)}},decls:18,vars:6,consts:[["messagesContainer",""],[1,"chat-window"],[1,"chat-header"],[1,"chat-header-content"],[1,"header-left"],[1,"back-button",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"participant-info"],[1,"header-actions"],[1,"details-btn",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"],[1,"messages-container"],[1,"loading-state"],[1,"error-state"],[1,"messages-scroll"],[1,"participant-avatar",3,"src","alt"],[1,"participant-avatar-placeholder"],[1,"participant-details"],[1,"participant-name"],[1,"participant-status"],[1,"participant-username"],[1,"connection-status"],[1,"status-dot"],[1,"status-text"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"mobile-action"],[1,"action-btn","accept"],[1,"action-btn","start"],[1,"action-btn","complete"],[1,"action-btn","review"],["title","Report User",1,"action-btn","report"],[1,"desktop-actions"],[1,"action-btn","reject"],[1,"action-btn",2,"background","#f59e0b","color","white"],[1,"action-btn","accept",3,"click"],[1,"action-btn","start",3,"click"],[1,"action-btn","complete",3,"click"],[1,"action-btn","review",3,"click"],["title","Report User",1,"action-btn","report",3,"click"],[1,"action-btn","reject",3,"click"],[1,"action-btn",2,"background","#f59e0b","color","white",3,"click"],[1,"loading-spinner"],[1,"loading-text"],[1,"error-content"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"error-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"error-message"],[1,"messages-content"],[1,"messages-list"],[1,"empty-state"],[1,"date-divider"],[1,"message-wrapper"],[1,"message-container"],[1,"message-avatar"],[1,"message-bubble-container"],[1,"system-message"],[1,"payment-request-message"],[1,"completion-request-message"],[1,"message-bubble",3,"my-bubble","other-bubble"],[1,"date-label"],[1,"avatar-initials"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"system-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"payment-header"],[1,"payment-status"],[1,"payment-details"],[1,"payment-amount"],[1,"payment-description"],[1,"payment-content"],[1,"payment-actions"],[1,"message-time"],[1,"action-btn","approve",3,"click"],[1,"completion-header"],[1,"completion-status"],[1,"completion-content"],[1,"completion-actions"],[1,"message-bubble"],[1,"image-attachment"],[1,"file-attachment"],[1,"message-text"],[1,"edited-indicator"],[1,"attachment-image",3,"click","src","alt"],[1,"file-info"],[1,"file-icon"],[1,"file-details"],[1,"file-name"],[1,"file-size"],[1,"download-btn",3,"click"],[1,"empty-icon"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],[1,"empty-title"],[1,"empty-description"],[1,"project-name"],[1,"input-container"],[1,"chat-disabled-container"],[1,"chat-disabled-content"],[1,"disabled-icon"],[1,"disabled-text"],[1,"typing-indicator"],[1,"upload-progress"],[1,"selected-files"],[1,"input-form-container"],["type","file","id","fileInput","multiple","","accept","image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.rar",2,"display","none",3,"change"],[1,"message-form",3,"ngSubmit","formGroup"],["type","button",1,"attachment-button",3,"click","disabled"],[1,"input-wrapper"],["formControlName","content","placeholder","Type your message...","rows","1",1,"message-input",3,"input","keydown"],["type","submit",1,"send-button",3,"disabled"],[1,"send-spinner"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"send-icon"],[1,"typing-dots"],[1,"typing-dot"],[1,"typing-text"],[1,"upload-spinner"],[1,"upload-text"],[1,"file-preview"],[1,"file-actions"],["type","button",1,"upload-btn",3,"click"],["type","button",1,"cancel-btn",3,"click"],["type","button",1,"remove-file-btn",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 19l9 2-9-18-9 18 9-2zm0 0v-8"]],template:function(e,n){if(e&1&&(o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"button",5),m("click",function(){return n.navigateBack()}),T(),o(5,"svg",6),x(6,"path",7),r()(),h(7,Rt,13,6,"div",8),r(),Y(),o(8,"div",9),h(9,Ut,16,10),o(10,"button",10),m("click",function(){return n.goToProjectDetails()}),T(),o(11,"svg",11),x(12,"path",12),r()()()()(),Y(),o(13,"div",13),h(14,Gt,4,0,"div",14)(15,Ht,6,1,"div",15)(16,pn,5,1,"div",16),r(),h(17,vn,2,1),r()),e&2){let a,d;c(7),p((a=n.chat())?7:-1,a),c(2),p((d=n.chat())?9:-1,d),c(5),p(n.loading()||n.messagesLoading()?14:-1),c(),p(n.error()&&!n.loading()?15:-1),c(),p(!n.loading()&&!n.messagesLoading()&&!n.error()?16:-1),c(),p(!n.loading()&&!n.error()?17:-1)}},dependencies:[S,U,z,D,A,B,N,$,me,F,I,E,de,G,H,ze,K],styles:["[_nghost-%COMP%]{display:block;height:100vh;overflow:hidden}.chat-window[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;background:#f8fafc}@media (min-width: 768px){.chat-window[_ngcontent-%COMP%]{max-width:600px;max-height:600px;border-radius:12px;box-shadow:0 20px 25px -5px #0000001a,0 10px 10px -5px #0000000a;border:1px solid #e2e8f0;background:#fff;position:relative;margin:20px auto}}@media (max-width: 767px){.chat-window[_ngcontent-%COMP%]{width:100vw;height:100vh;position:fixed;top:0;left:0;z-index:1000;background:#fff}}.chat-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid #e2e8f0;position:sticky;top:0;z-index:10}@media (min-width: 768px){.chat-header[_ngcontent-%COMP%]{border-top-left-radius:12px;border-top-right-radius:12px;padding:12px 16px}}@media (max-width: 767px){.chat-header[_ngcontent-%COMP%]{padding:16px 20px;box-shadow:0 1px 3px #0000001a}}.chat-header-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;flex:1;min-width:0}.back-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:8px;border:none;background:#f1f5f9;color:#64748b;cursor:pointer;transition:all .2s ease;flex-shrink:0}.back-button[_ngcontent-%COMP%]:hover{background:#e2e8f0;color:#475569}@media (max-width: 767px){.back-button[_ngcontent-%COMP%]{width:36px;height:36px}}.participant-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex:1;min-width:0}.participant-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover;border:2px solid #e2e8f0;flex-shrink:0}@media (max-width: 767px){.participant-avatar[_ngcontent-%COMP%]{width:36px;height:36px}}.participant-avatar-placeholder[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#3b82f6,#8b5cf6);display:flex;align-items:center;justify-content:center;flex-shrink:0}@media (max-width: 767px){.participant-avatar-placeholder[_ngcontent-%COMP%]{width:36px;height:36px}}.participant-details[_ngcontent-%COMP%]{flex:1;min-width:0}.participant-name[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#1e293b;margin:0;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media (max-width: 767px){.participant-name[_ngcontent-%COMP%]{font-size:16px}}.participant-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:2px}.participant-username[_ngcontent-%COMP%]{font-size:12px;color:#64748b;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media (max-width: 767px){.participant-username[_ngcontent-%COMP%]{font-size:13px}}.connection-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.status-dot[_ngcontent-%COMP%]{width:6px;height:6px;border-radius:50%;background:#ef4444}.status-dot.online[_ngcontent-%COMP%]{background:#10b981}.status-text[_ngcontent-%COMP%]{font-size:11px;color:#64748b}@media (max-width: 767px){.status-text[_ngcontent-%COMP%]{font-size:12px}}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-shrink:0}.mobile-action[_ngcontent-%COMP%]{display:block}@media (min-width: 768px){.mobile-action[_ngcontent-%COMP%]{display:none}}.desktop-actions[_ngcontent-%COMP%]{display:none;gap:8px}@media (min-width: 768px){.desktop-actions[_ngcontent-%COMP%]{display:flex}}.action-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;border:none;font-size:11px;font-weight:500;cursor:pointer;transition:all .2s ease}.action-btn.accept[_ngcontent-%COMP%]{background:#10b981;color:#fff}.action-btn.accept[_ngcontent-%COMP%]:hover{background:#059669}.action-btn.start[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.action-btn.start[_ngcontent-%COMP%]:hover{background:#2563eb}.action-btn.complete[_ngcontent-%COMP%]{background:#8b5cf6;color:#fff}.action-btn.complete[_ngcontent-%COMP%]:hover{background:#7c3aed}.action-btn.reject[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.action-btn.reject[_ngcontent-%COMP%]:hover{background:#dc2626}.action-btn.review[_ngcontent-%COMP%]{background:#f59e0b;color:#fff}.action-btn.review[_ngcontent-%COMP%]:hover{background:#d97706}.action-btn.report[_ngcontent-%COMP%]{background:#6b7280;color:#fff;display:flex;align-items:center;gap:4px}.action-btn.report[_ngcontent-%COMP%]:hover{background:#4b5563}.action-btn.report[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}@media (max-width: 767px){.action-btn[_ngcontent-%COMP%]{font-size:12px;padding:8px 14px}}.details-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:6px;border:none;background:#f1f5f9;color:#64748b;cursor:pointer;transition:all .2s ease}.details-btn[_ngcontent-%COMP%]:hover{background:#e2e8f0;color:#475569}@media (max-width: 767px){.details-btn[_ngcontent-%COMP%]{width:32px;height:32px}}.messages-container[_ngcontent-%COMP%]{flex:1;overflow:hidden;display:flex;flex-direction:column}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%;padding:20px}.loading-spinner[_ngcontent-%COMP%]{width:32px;height:32px;border:2px solid #e2e8f0;border-top:2px solid #3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.loading-text[_ngcontent-%COMP%]{margin-top:12px;font-size:14px;color:#64748b;text-align:center}.error-content[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px;background:#fef2f2;border:1px solid #fecaca;border-radius:8px;max-width:300px}.error-icon[_ngcontent-%COMP%]{width:20px;height:20px;color:#dc2626;margin-right:8px;flex-shrink:0}.error-message[_ngcontent-%COMP%]{font-size:14px;color:#b91c1c;font-weight:500}.messages-scroll[_ngcontent-%COMP%]{flex:1;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:thin;scrollbar-color:rgba(148,163,184,.3) transparent}.messages-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.messages-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.messages-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#94a3b84d;border-radius:2px}.messages-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b880}.messages-content[_ngcontent-%COMP%]{padding:16px}@media (max-width: 767px){.messages-content[_ngcontent-%COMP%]{padding:20px}}.messages-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.date-divider[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:16px 0}.date-label[_ngcontent-%COMP%]{background:#fff;color:#64748b;font-size:12px;padding:4px 12px;border-radius:12px;box-shadow:0 1px 3px #0000001a;border:1px solid #e2e8f0}.message-wrapper[_ngcontent-%COMP%]{display:flex}.message-wrapper.my-message[_ngcontent-%COMP%]{justify-content:flex-end}.message-container[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:8px;max-width:75%}.my-message[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]{flex-direction:row-reverse}.message-avatar[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background:linear-gradient(135deg,#64748b,#94a3b8);display:flex;align-items:center;justify-content:center;flex-shrink:0}.avatar-initials[_ngcontent-%COMP%]{font-size:10px;font-weight:600;color:#fff}.system-message[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fed7aa);border:1px solid #f59e0b;color:#92400e;padding:8px 12px;border-radius:12px;text-align:center;font-size:12px;display:flex;align-items:center;justify-content:center;gap:6px;max-width:250px;margin:0 auto}.system-icon[_ngcontent-%COMP%]{width:14px;height:14px;color:#d97706;flex-shrink:0}.payment-request-message[_ngcontent-%COMP%], .completion-request-message[_ngcontent-%COMP%]{background:#fff;border:2px solid #e2e8f0;border-radius:12px;padding:16px;margin:8px 0;max-width:400px;box-shadow:0 2px 8px #0000001a}@media (max-width: 767px){.payment-request-message[_ngcontent-%COMP%], .completion-request-message[_ngcontent-%COMP%]{max-width:100%;margin:12px 0}}.payment-header[_ngcontent-%COMP%], .completion-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #e2e8f0}.payment-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .completion-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#3b82f6;font-size:20px}.payment-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .completion-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:600;color:#1e293b;flex:1}.payment-status[_ngcontent-%COMP%], .completion-status[_ngcontent-%COMP%]{font-size:11px;font-weight:500;padding:2px 8px;border-radius:12px;text-transform:uppercase}.payment-status.status-pending[_ngcontent-%COMP%], .completion-status.status-pending[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.payment-status.status-approved[_ngcontent-%COMP%], .completion-status.status-approved[_ngcontent-%COMP%]{background:#d1fae5;color:#065f46}.payment-status.status-payment_pending[_ngcontent-%COMP%], .completion-status.status-payment_pending[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.payment-status.status-rejected[_ngcontent-%COMP%], .completion-status.status-rejected[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.payment-status.status-paid[_ngcontent-%COMP%], .completion-status.status-paid[_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.payment-details[_ngcontent-%COMP%]{margin-bottom:12px}.payment-details[_ngcontent-%COMP%]   .payment-amount[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#10b981;margin-bottom:4px}.payment-details[_ngcontent-%COMP%]   .payment-description[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#374151;margin-bottom:8px}.payment-details[_ngcontent-%COMP%]   .payment-content[_ngcontent-%COMP%]{font-size:13px;color:#6b7280;margin:0;line-height:1.4}.completion-content[_ngcontent-%COMP%]{margin-bottom:12px}.completion-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#374151;line-height:1.5}.payment-actions[_ngcontent-%COMP%], .completion-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:8px}.payment-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%], .completion-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;border:none;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s ease;flex:1}.payment-actions[_ngcontent-%COMP%]   .action-btn.approve[_ngcontent-%COMP%], .completion-actions[_ngcontent-%COMP%]   .action-btn.approve[_ngcontent-%COMP%]{background:#10b981;color:#fff}.payment-actions[_ngcontent-%COMP%]   .action-btn.approve[_ngcontent-%COMP%]:hover, .completion-actions[_ngcontent-%COMP%]   .action-btn.approve[_ngcontent-%COMP%]:hover{background:#059669}.payment-actions[_ngcontent-%COMP%]   .action-btn.reject[_ngcontent-%COMP%], .completion-actions[_ngcontent-%COMP%]   .action-btn.reject[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.payment-actions[_ngcontent-%COMP%]   .action-btn.reject[_ngcontent-%COMP%]:hover, .completion-actions[_ngcontent-%COMP%]   .action-btn.reject[_ngcontent-%COMP%]:hover{background:#dc2626}@media (max-width: 767px){.payment-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%], .completion-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{padding:10px 18px;font-size:13px}}.message-bubble-container[_ngcontent-%COMP%]{flex:1}.message-bubble[_ngcontent-%COMP%]{padding:8px 12px;border-radius:16px;font-size:14px;line-height:1.4;word-wrap:break-word;position:relative}.message-bubble.my-bubble[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;border-bottom-right-radius:4px}.message-bubble.other-bubble[_ngcontent-%COMP%]{background:#fff;color:#1e293b;border:1px solid #e2e8f0;border-bottom-left-radius:4px}@media (max-width: 767px){.message-bubble[_ngcontent-%COMP%]{font-size:15px;padding:10px 14px}}.message-text[_ngcontent-%COMP%]{margin:0;line-height:1.4}.edited-indicator[_ngcontent-%COMP%]{font-size:11px;opacity:.7;font-style:italic;margin-left:6px}.message-time[_ngcontent-%COMP%]{font-size:11px;margin-top:4px;opacity:.7;text-align:right}.my-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#fffc}.other-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#64748b}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:40px 20px;height:100%;min-height:300px}.empty-icon[_ngcontent-%COMP%]{width:48px;height:48px;background:linear-gradient(135deg,#ddd6fe,#c7d2fe);border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:16px;color:#6366f1}.empty-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#1e293b;margin:0 0 8px}.empty-description[_ngcontent-%COMP%]{font-size:14px;color:#64748b;margin:0;max-width:280px;line-height:1.5}.project-name[_ngcontent-%COMP%]{font-weight:500;color:#3b82f6}.input-container[_ngcontent-%COMP%]{background:#fff;border-top:1px solid #e2e8f0;position:sticky;bottom:0}@media (min-width: 768px){.input-container[_ngcontent-%COMP%]{border-bottom-left-radius:12px;border-bottom-right-radius:12px;padding:12px 16px}}@media (max-width: 767px){.input-container[_ngcontent-%COMP%]{padding:16px 20px;box-shadow:0 -1px 3px #0000001a}}.typing-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px;padding:0 4px}.typing-dots[_ngcontent-%COMP%]{display:flex;gap:2px}.typing-dot[_ngcontent-%COMP%]{width:4px;height:4px;background:#94a3b8;border-radius:50%;animation:_ngcontent-%COMP%_pulse 1.4s infinite}.typing-dot[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.typing-dot[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}.typing-text[_ngcontent-%COMP%]{font-size:12px;color:#64748b}.input-form-container[_ngcontent-%COMP%]{width:100%}.message-form[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:8px}.attachment-button[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;border:none;background:#f1f5f9;color:#64748b;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;flex-shrink:0}.attachment-button[_ngcontent-%COMP%]:hover:not(:disabled){background:#e2e8f0;color:#475569}.attachment-button[_ngcontent-%COMP%]:disabled{background:#94a3b8;cursor:not-allowed}@media (max-width: 767px){.attachment-button[_ngcontent-%COMP%]{width:40px;height:40px}}.input-wrapper[_ngcontent-%COMP%]{flex:1}.message-input[_ngcontent-%COMP%]{width:100%;resize:none;border:1px solid #e2e8f0;border-radius:20px;padding:10px 16px;font-size:14px;line-height:1.4;background:#f8fafc;color:#1e293b;min-height:40px;max-height:120px;transition:all .2s ease;outline:none}.message-input[_ngcontent-%COMP%]:focus{border-color:#3b82f6;background:#fff;box-shadow:0 0 0 3px #3b82f61a}.message-input[_ngcontent-%COMP%]::placeholder{color:#94a3b8}@media (max-width: 767px){.message-input[_ngcontent-%COMP%]{font-size:16px;padding:12px 18px;min-height:44px}}.send-button[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;border:none;background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;flex-shrink:0}.send-button[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#2563eb,#1d4ed8);transform:scale(1.05)}.send-button[_ngcontent-%COMP%]:disabled{background:#94a3b8;cursor:not-allowed;transform:none}.send-button.sending[_ngcontent-%COMP%]{background:#94a3b8}@media (max-width: 767px){.send-button[_ngcontent-%COMP%]{width:40px;height:40px}}.send-icon[_ngcontent-%COMP%]{width:16px;height:16px}.send-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top:2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.upload-progress[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px;padding:8px 12px;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0}.upload-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid #e2e8f0;border-top:2px solid #3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.upload-text[_ngcontent-%COMP%]{font-size:12px;color:#64748b}.selected-files[_ngcontent-%COMP%]{margin-bottom:12px;padding:12px;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0}.file-preview[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px;background:#fff;border-radius:6px;margin-bottom:8px;border:1px solid #e2e8f0}.file-preview[_ngcontent-%COMP%]:last-child{margin-bottom:8px}.file-icon[_ngcontent-%COMP%]{color:#64748b;font-size:20px;width:20px;height:20px;flex-shrink:0}.file-info[_ngcontent-%COMP%]{flex:1;min-width:0}.file-name[_ngcontent-%COMP%]{display:block;font-size:13px;font-weight:500;color:#1e293b;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.file-size[_ngcontent-%COMP%]{display:block;font-size:11px;color:#64748b;margin-top:2px}.remove-file-btn[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;border:none;background:#fee2e2;color:#dc2626;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;flex-shrink:0}.remove-file-btn[_ngcontent-%COMP%]:hover{background:#fecaca}.remove-file-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.file-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:8px}.upload-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;border:none;background:#3b82f6;color:#fff;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;gap:4px}.upload-btn[_ngcontent-%COMP%]:hover{background:#2563eb}.upload-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}.cancel-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;border:1px solid #e2e8f0;background:#fff;color:#64748b;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s ease}.cancel-btn[_ngcontent-%COMP%]:hover{background:#f8fafc;border-color:#cbd5e1}.image-attachment[_ngcontent-%COMP%]   .attachment-image[_ngcontent-%COMP%]{max-width:200px;max-height:200px;border-radius:8px;cursor:pointer;transition:opacity .2s ease}.image-attachment[_ngcontent-%COMP%]   .attachment-image[_ngcontent-%COMP%]:hover{opacity:.9}@media (max-width: 767px){.image-attachment[_ngcontent-%COMP%]   .attachment-image[_ngcontent-%COMP%]{max-width:250px;max-height:250px}}.image-attachment[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}.file-attachment[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px;background:#0000000d;border-radius:6px;margin-bottom:8px}.my-bubble[_ngcontent-%COMP%]   .file-attachment[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]{background:#ffffff1a}.file-attachment[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]{flex:1;min-width:0}.file-attachment[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{color:inherit;font-weight:500}.file-attachment[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]   .file-size[_ngcontent-%COMP%]{opacity:.7}.file-attachment[_ngcontent-%COMP%]   .download-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px;border:none;background:#0000001a;color:inherit;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;flex-shrink:0}.file-attachment[_ngcontent-%COMP%]   .download-btn[_ngcontent-%COMP%]:hover{background:#0003}.my-bubble[_ngcontent-%COMP%]   .file-attachment[_ngcontent-%COMP%]   .download-btn[_ngcontent-%COMP%]{background:#fff3}.my-bubble[_ngcontent-%COMP%]   .file-attachment[_ngcontent-%COMP%]   .download-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d}.file-attachment[_ngcontent-%COMP%]   .download-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.file-attachment[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_pulse{0%,70%,to{transform:scale(1);opacity:.5}35%{transform:scale(1.2);opacity:1}}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.message-wrapper[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn .3s ease-out}@media (prefers-reduced-motion: reduce){*[_ngcontent-%COMP%]{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}.chat-disabled-container[_ngcontent-%COMP%]{padding:20px;background:#f8fafc;border-top:1px solid #e2e8f0}@media (max-width: 767px){.chat-disabled-container[_ngcontent-%COMP%]{padding:16px}}.chat-disabled-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;background:#fff;padding:20px;border-radius:12px;border:1px solid #e2e8f0;text-align:center}@media (max-width: 767px){.chat-disabled-content[_ngcontent-%COMP%]{flex-direction:column;gap:8px;padding:16px}}.disabled-icon[_ngcontent-%COMP%]{color:#64748b;font-size:24px;width:24px;height:24px;flex-shrink:0}.disabled-text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 4px;font-size:14px;font-weight:600;color:#374151;line-height:1.4}.disabled-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:12px;color:#6b7280;line-height:1.4}@media (max-width: 767px){.disabled-text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:13px}.disabled-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:11px}}@media (prefers-contrast: high){.message-bubble.my-bubble[_ngcontent-%COMP%]{background:#000;color:#fff}.message-bubble.other-bubble[_ngcontent-%COMP%]{background:#fff;color:#000;border:2px solid #000}}"]})};var io=[{path:"",component:fe,children:[{path:"chats",component:be},{path:"chat/:chatId",component:Me},{path:"",redirectTo:"chats",pathMatch:"full"}]}];export{io as MESSAGES_ROUTES};
