import{a as F}from"./chunk-LIZM4CZI.js";import{A as p}from"./chunk-Z5YYMG7R.js";import{Y as n,aa as l,fa as u,g as d,o,q as g,ua as c}from"./chunk-ME5BD2TS.js";import{e as r}from"./chunk-JKOY2XUY.js";var h=class a{http=u(p);config=u(F);apiUrl=`${this.config.apiBaseUrl}/favorites`;userFavorites=c([]);loading=c(!1);favoritedBusinessIds=new d(new Set);constructor(){this.loadUserFavorites()}addToFavorites(e){return this.loading.set(!0),this.http.post(this.apiUrl,{business_id:e}).pipe(n(s=>{if(s.success){let t=this.userFavorites();this.userFavorites.set([...t,s.data]);let i=new Set(this.favoritedBusinessIds.value);i.add(e),this.favoritedBusinessIds.next(i)}this.loading.set(!1)}))}removeFromFavorites(e){return this.loading.set(!0),this.http.delete(`${this.apiUrl}/${e}`).pipe(n(s=>{if(s.success){let i=this.userFavorites().filter(m=>m.business_id!==e);this.userFavorites.set(i);let v=new Set(this.favoritedBusinessIds.value);v.delete(e),this.favoritedBusinessIds.next(v)}this.loading.set(!1)}))}getUserFavorites(){return this.http.get(this.apiUrl).pipe(n(e=>{if(e.success){this.userFavorites.set(e.data);let s=new Set(e.data.map(t=>typeof t.business_id=="string"?t.business_id:t.business_id._id));this.favoritedBusinessIds.next(s)}}))}getBusinessFavoritesCount(e){return this.http.get(`${this.config.apiBaseUrl}/businesses/${e}/favorites-count`)}isBusinessFavorited(e){return this.favoritedBusinessIds.asObservable().pipe(g(s=>s.has(e)))}getFavoritedBusinessIds(){return this.favoritedBusinessIds.asObservable()}addToFavoritesAsync(e){return r(this,null,function*(){let s=yield o(this.addToFavorites(e));if(!s.success)throw new Error(s.error||"Failed to add to favorites");return s.data})}removeFromFavoritesAsync(e){return r(this,null,function*(){let s=yield o(this.removeFromFavorites(e));if(!s.success)throw new Error(s.error||"Failed to remove from favorites")})}getUserFavoritesAsync(){return r(this,null,function*(){try{let e=yield o(this.getUserFavorites());if(!e.success)throw new Error(e.error||"Failed to load favorites");return e.data}catch(e){throw console.error("Error in getUserFavoritesAsync:",e),e}})}getBusinessFavoritesCountAsync(e){return r(this,null,function*(){let s=yield o(this.getBusinessFavoritesCount(e));if(!s.success)throw new Error(s.error||"Failed to load favorites count");return s.data.count})}loadUserFavorites(){return r(this,null,function*(){try{console.log("Loading user favorites..."),yield this.getUserFavoritesAsync(),console.log("User favorites loaded successfully")}catch(e){console.warn("Failed to load user favorites on initialization:",e)}})}refreshFavorites(){return r(this,null,function*(){yield this.loadUserFavorites()})}toggleFavorite(e){return r(this,null,function*(){return this.favoritedBusinessIds.value.has(e)?(yield this.removeFromFavoritesAsync(e),!1):(yield this.addToFavoritesAsync(e),!0)})}getFavoritesCount(){return this.userFavorites().length}getMultipleBusinessesFavoritesCount(e){return r(this,null,function*(){try{let s={};return yield Promise.all(e.map(t=>r(this,null,function*(){try{let i=yield this.getBusinessFavoritesCountAsync(t);s[t]=i}catch(i){console.warn(`Failed to get favorites count for business ${t}:`,i),s[t]=0}}))),s}catch(s){return console.error("Error getting multiple businesses favorites count:",s),{}}})}static \u0275fac=function(s){return new(s||a)};static \u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})};export{h as a};
