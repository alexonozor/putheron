import{a as ce,c as pe,d as ue,e as _e,f as P}from"./chunk-2246BGGI.js";import{a as Z,b as ee,c as te,d as ie,e as ne,g as oe}from"./chunk-R33Z54KN.js";import{a as W,b as X}from"./chunk-IK6JUFTK.js";import"./chunk-DKE3OTJ7.js";import{d as Q}from"./chunk-KLROSHLT.js";import"./chunk-B7X6HNXL.js";import"./chunk-TE5HKKWZ.js";import{a as se,b as me,c as le,d as de}from"./chunk-SQ5Q2QHJ.js";import{g as ae}from"./chunk-5J5HWN7Y.js";import"./chunk-32WIJ6DZ.js";import"./chunk-7N3ULFJ6.js";import"./chunk-K76RD3AY.js";import"./chunk-LJVLI66S.js";import"./chunk-RNGT6N3O.js";import"./chunk-B3LNG6U5.js";import"./chunk-EWH2HRUY.js";import"./chunk-4LADR266.js";import{c as K,d as y}from"./chunk-AT26KLTR.js";import{a as M}from"./chunk-NZJEVKY3.js";import{a as g}from"./chunk-TL7YA3DG.js";import{a as A}from"./chunk-CGBMKB7Q.js";import{a as re}from"./chunk-WF66C34H.js";import"./chunk-QD7SSFII.js";import{a as J,b as w}from"./chunk-QYFERLBL.js";import{d as G}from"./chunk-VBZ52KF5.js";import{c as q,d as x,e as H,f as Y,h as F}from"./chunk-WBPYOJYK.js";import"./chunk-6N4JLV7X.js";import{t as S}from"./chunk-TZYYMUAL.js";import{Kb as l,Lb as i,Mb as n,Nb as f,Pc as C,Tc as $,Ub as _,W as I,Yb as d,_a as m,_b as v,f as D,fa as c,gb as R,ic as U,ka as p,la as u,lb as N,mc as a,nc as E,oc as z,pb as k,rb as B,ua as b,vb as h,xc as j}from"./chunk-4R5BQBA3.js";import{e as V}from"./chunk-JKOY2XUY.js";var L=class r{authorizationService=c(g);templateRef=c(R);viewContainer=c(N);destroy$=new D;_permission=null;_requireAll=!1;_allowSuperAdmin=!0;_allowAdmin=!1;set hasPermission(e){this._permission=e,this.updateView()}set hasPermissionRequireAll(e){this._requireAll=e,this.updateView()}set hasPermissionAllowSuperAdmin(e){this._allowSuperAdmin=e,this.updateView()}set hasPermissionAllowAdmin(e){this._allowAdmin=e,this.updateView()}ngOnInit(){this.authorizationService.userPermissions$.pipe(I(this.destroy$)).subscribe(()=>{this.updateView()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}updateView(){this.hasRequiredPermissions()?this.showElement():this.hideElement()}hasRequiredPermissions(){if(this._allowSuperAdmin&&this.authorizationService.hasRole(g.ROLES.SUPER_ADMIN)||this._allowAdmin&&this.authorizationService.hasRole(g.ROLES.ADMIN))return!0;if(!this._permission)return!1;if(typeof this._permission=="string")return this.authorizationService.hasPermission(this._permission);if(Array.isArray(this._permission))return this._requireAll?this._permission.every(e=>this.authorizationService.hasPermission(e)):this._permission.some(e=>this.authorizationService.hasPermission(e));if(typeof this._permission=="object"&&this._permission.module&&this._permission.action){let e=`${this._permission.module}.${this._permission.action}`;return this.authorizationService.hasPermission(e)}return!1}showElement(){this.viewContainer.length===0&&this.viewContainer.createEmbeddedView(this.templateRef)}hideElement(){this.viewContainer.clear()}static \u0275fac=function(t){return new(t||r)};static \u0275dir=B({type:r,selectors:[["","hasPermission",""]],inputs:{hasPermission:"hasPermission",hasPermissionRequireAll:"hasPermissionRequireAll",hasPermissionAllowSuperAdmin:"hasPermissionAllowSuperAdmin",hasPermissionAllowAdmin:"hasPermissionAllowAdmin"}})};var ge=()=>({exact:!0});function be(r,e){if(r&1){let t=_();i(0,"mat-list-item",28),d("click",function(){p(t);let o=v();return u(o.navigateAndClose("/admin/dashboard/users"))}),i(1,"mat-icon",13),a(2,"people"),n(),i(3,"span",14),a(4,"Users"),n()()}}function ke(r,e){if(r&1){let t=_();i(0,"mat-list-item",29),d("click",function(){p(t);let o=v();return u(o.navigateAndClose("/admin/dashboard/services"))}),i(1,"mat-icon",13),a(2,"miscellaneous_services"),n(),i(3,"span",14),a(4,"Services"),n()()}}function Ce(r,e){if(r&1){let t=_();i(0,"mat-list-item",30),d("click",function(){p(t);let o=v();return u(o.navigateAndClose("/admin/dashboard/categories"))}),i(1,"mat-icon",13),a(2,"category"),n(),i(3,"span",14),a(4,"Categories"),n()()}}function Se(r,e){if(r&1){let t=_();i(0,"mat-list-item",31),d("click",function(){p(t);let o=v();return u(o.navigateAndClose("/admin/dashboard/projects"))}),i(1,"mat-icon",13),a(2,"work_outline"),n(),i(3,"span",14),a(4,"Projects"),n()()}}function xe(r,e){if(r&1){let t=_();i(0,"mat-list-item",32),d("click",function(){p(t);let o=v();return u(o.navigateAndClose("/admin/dashboard/reviews"))}),i(1,"mat-icon",13),a(2,"star_outline"),n(),i(3,"span",14),a(4,"Reviews"),n()()}}function Ae(r,e){if(r&1){let t=_();i(0,"mat-list-item",33),d("click",function(){p(t);let o=v();return u(o.navigateAndClose("/admin/dashboard/transactions"))}),i(1,"mat-icon",13),a(2,"payments"),n(),i(3,"span",14),a(4,"Transactions"),n()()}}function we(r,e){if(r&1){let t=_();i(0,"mat-list-item",34),d("click",function(){p(t);let o=v();return u(o.navigateAndClose("/admin/dashboard/reports"))}),i(1,"mat-icon",13),a(2,"analytics"),n(),i(3,"span",14),a(4,"Reports & Analytics"),n()()}}function ye(r,e){if(r&1){let t=_();i(0,"mat-list-item",39),d("click",function(){p(t);let o=v(2);return u(o.navigateAndClose("/admin/dashboard/roles-and-permissions"))}),i(1,"mat-icon",13),a(2,"shield"),n(),i(3,"span",14),a(4,"Roles & Permissions"),n()()}}function Me(r,e){r&1&&(i(0,"div",35)(1,"p",36),a(2,"Security"),n(),i(3,"mat-nav-list",37),h(4,ye,5,0,"mat-list-item",38),n()()),r&2&&(m(4),l("hasPermission","roles.read"))}function Pe(r,e){if(r&1){let t=_();i(0,"mat-list-item",42),d("click",function(){p(t);let o=v(2);return u(o.navigateAndClose("/admin/dashboard/settings"))}),i(1,"mat-icon",13),a(2,"settings"),n(),i(3,"span",14),a(4,"System Settings"),n()()}}function Le(r,e){if(r&1){let t=_();i(0,"mat-list-item",43),d("click",function(){p(t);let o=v(2);return u(o.navigateAndClose("/admin/dashboard/audit-logs"))}),i(1,"mat-icon",13),a(2,"description"),n(),i(3,"span",14),a(4,"Audit Logs"),n()()}}function Oe(r,e){r&1&&(i(0,"div",35)(1,"p",36),a(2,"System"),n(),i(3,"mat-nav-list",37),h(4,Pe,5,0,"mat-list-item",40)(5,Le,5,0,"mat-list-item",41),n()()),r&2&&(m(4),l("hasPermission","settings.read"),m(),l("hasPermission","audit.read"))}var O=class r{router=c(x);authService=c(M);navigationClick=$();user=C(()=>this.authService.currentUser);constructor(){}getUserInitials(){let e=this.user();if(!e)return"?";let t=e.first_name||"",s=e.last_name||"";return t&&s?`${t.charAt(0)}${s.charAt(0)}`.toUpperCase():t?t.charAt(0).toUpperCase():e.email?e.email.charAt(0).toUpperCase():"?"}navigateAndClose(e){this.router.navigate([e]),this.navigationClick.emit()}onNavigationClick(){this.navigationClick.emit()}navigateTo(e){this.router.navigate([`/admin/dashboard/${e}`]),this.onNavigationClick()}logout(){this.authService.logout(),this.router.navigate(["/auth/sign-in"])}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=k({type:r,selectors:[["app-admin-sidenav"]],outputs:{navigationClick:"navigationClick"},decls:44,vars:14,consts:[[1,"sidebar-content","bg-white","h-full","flex","flex-col"],[1,"p-4","border-b","border-gray-200","flex-shrink-0"],[1,"flex","items-center","space-x-3","pr-12"],[1,"w-10","h-10","bg-red-500","rounded-full","flex","items-center","justify-center","text-white","font-semibold"],[1,"flex-1"],[1,"font-semibold","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","mt-1"],[1,"admin-chip"],["matChipAvatar",""],[1,"bg-white","flex-1","overflow-y-auto"],[1,"px-4!"],["routerLink","/admin/dashboard/overview","routerLinkActive","active-link",3,"click","routerLinkActiveOptions"],["matListItemIcon",""],["matListItemTitle",""],["routerLink","/admin/dashboard/users","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/businesses","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/services","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/categories","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/projects","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/reviews","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/transactions","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/reports","routerLinkActive","active-link",3,"click",4,"hasPermission"],[1,"my-4"],["class","space-y-3 mb-6 p-4",4,"hasPermission"],[1,"p-4","border-t","border-gray-200","bg-white","flex-shrink-0"],["mat-button","",1,"w-full","text-red-600","hover:bg-red-50",3,"click"],[1,"mr-2"],["routerLink","/admin/dashboard/users","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/services","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/categories","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/projects","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/reviews","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/transactions","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/reports","routerLinkActive","active-link",3,"click"],[1,"space-y-3","mb-6","p-4"],[1,"text-xs","font-semibold","text-gray-500","uppercase","tracking-wider"],[1,"!py-0"],["routerLink","/admin/dashboard/roles-and-permissions","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/roles-and-permissions","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/settings","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/audit-logs","routerLinkActive","active-link",3,"click",4,"hasPermission"],["routerLink","/admin/dashboard/settings","routerLinkActive","active-link",3,"click"],["routerLink","/admin/dashboard/audit-logs","routerLinkActive","active-link",3,"click"]],template:function(t,s){if(t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),a(4),n(),i(5,"div",4)(6,"h3",5),a(7),n(),i(8,"p",6),a(9),n(),i(10,"div",7)(11,"mat-chip-set")(12,"mat-chip",8)(13,"mat-icon",9),a(14,"admin_panel_settings"),n(),a(15," Administrator "),n()()()()()(),i(16,"nav",10)(17,"mat-nav-list",11)(18,"mat-list-item",12),d("click",function(){return s.navigateAndClose("/admin/dashboard/overview")}),i(19,"mat-icon",13),a(20,"dashboard"),n(),i(21,"span",14),a(22,"Overview"),n()(),h(23,be,5,0,"mat-list-item",15),i(24,"mat-list-item",16),d("click",function(){return s.navigateAndClose("/admin/dashboard/businesses")}),i(25,"mat-icon",13),a(26,"business"),n(),i(27,"span",14),a(28,"Businesses"),n()(),h(29,ke,5,0,"mat-list-item",17)(30,Ce,5,0,"mat-list-item",18)(31,Se,5,0,"mat-list-item",19)(32,xe,5,0,"mat-list-item",20)(33,Ae,5,0,"mat-list-item",21)(34,we,5,0,"mat-list-item",22),n(),f(35,"mat-divider",23),h(36,Me,5,1,"div",24),f(37,"mat-divider",23),h(38,Oe,6,2,"div",24),n(),i(39,"div",25)(40,"button",26),d("click",function(){return s.logout()}),i(41,"mat-icon",27),a(42,"logout"),n(),a(43," Sign Out "),n()()()),t&2){let o,T;m(4),z(" ",s.getUserInitials()," "),m(3),E((((o=s.user())==null?null:o.first_name)+" "+(((o=s.user())==null?null:o.last_name)||"")).trim()||((o=s.user())==null?null:o.email)),m(2),E((T=s.user())==null?null:T.email),m(9),l("routerLinkActiveOptions",j(13,ge)),m(5),l("hasPermission","users.read"),m(6),l("hasPermission","services.read"),m(),l("hasPermission","categories.read"),m(),l("hasPermission","projects.read"),m(),l("hasPermission","reviews.read"),m(),l("hasPermission","transactions.read"),m(),l("hasPermission","reports.read"),m(2),l("hasPermission","roles.read"),m(2),l("hasPermission","settings.read")}},dependencies:[S,H,Y,w,J,y,K,P,_e,ue,pe,W,ce,X,de,me,se,le,L],styles:[".sidebar-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.badge[_ngcontent-%COMP%]{background-color:#e5e7eb;color:#374151;padding:2px 8px;border-radius:12px;font-size:12px;font-weight:500}  .mat-mdc-list-item.active-link{background-color:var(--mdc-theme-primary, #20AA62)!important;color:#fff!important;border-radius:8px!important}  .mat-mdc-list-item.active-link .mat-icon{color:#fff!important}  .mat-mdc-list-item.active-link .mdc-list-item__primary-text{color:#fff!important}"]})};var he=class r{authService=c(M);authorizationService=c(g);breakpointObserver=c(G);router=c(x);config=c(re);user=this.authService.user;isMobile=b(!1);sidenavOpened=b(!0);isBootstrapping=b(!1);isHandset=C(()=>this.breakpointObserver.isMatched(A.Handset));constructor(){if(this.breakpointObserver.observe([A.Handset,A.Tablet]).subscribe(e=>{let t=e.matches;this.isMobile.set(t),t?this.sidenavOpened.set(!1):this.sidenavOpened.set(!0)}),!this.hasPermissionsLoaded()){let e=this.authService.user();e?._id&&this.authorizationService.refreshPermissions(e._id).catch(t=>{console.warn("Failed to load user permissions:",t)})}}logout(){this.authService.logout(),this.router.navigate(["/auth"])}navigateTo(e){this.router.navigate(["/admin",e])}toggleSidenav(){this.sidenavOpened.set(!this.sidenavOpened())}onMenuToggle(){this.toggleSidenav()}onNavigationClick(){this.isMobile()&&this.sidenavOpened.set(!1)}getUserInitials(){let e=this.user();if(!e)return"A";if(e.first_name||e.last_name){let t=e.first_name?.charAt(0).toUpperCase()||"",s=e.last_name?.charAt(0).toUpperCase()||"";return t+s}return e.email.charAt(0).toUpperCase()}bootstrapAdminRoles(){return V(this,null,function*(){try{this.isBootstrapping.set(!0);let e=localStorage.getItem("access_token")||sessionStorage.getItem("access_token");if(!e){alert("No authentication token found. Please log in again."),this.router.navigate(["/auth"]);return}console.log("\u{1F680} Starting admin roles bootstrap...");let t=yield fetch(this.config.getApiUrl("/admin/roles/bootstrap"),{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},credentials:"include"});if(!t.ok){let o=yield t.text();throw new Error(`Bootstrap failed: ${t.status} - ${o}`)}let s=yield t.json();console.log("\u2705 Bootstrap completed:",s),alert(`\u{1F389} Success! You are now a Super Admin!

${s.message}

You can now access all role management features. This button will be removed in production.`),window.location.reload()}catch(e){console.error("\u274C Bootstrap failed:",e);let t="Bootstrap failed. ";if(e.message.includes("403"))t+="You may not have permission to bootstrap roles. Contact your system administrator.";else if(e.message.includes("401")){t+="Authentication failed. Please log in again.",this.router.navigate(["/auth"]);return}else t+=e.message||"Unknown error occurred.";alert(t)}finally{this.isBootstrapping.set(!1)}})}isSuperAdmin(){return this.authorizationService.hasRole(g.ROLES.SUPER_ADMIN)}hasPermissionsLoaded(){let e=this.authorizationService.userPermissions();return e!=null&&e.allPermissions.length>0}shouldShowBootstrap(){return this.isSuperAdmin()||!this.hasPermissionsLoaded()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=k({type:r,selectors:[["app-admin-dashboard"]],decls:7,vars:5,consts:[["drawer",""],[3,"drawer"],["autosize","",1,"content-body",3,"hasBackdrop"],["position","start",1,"drawer",3,"opened","disableClose","mode"]],template:function(t,s){if(t&1&&(f(0,"app-header",1),i(1,"mat-drawer-container",2)(2,"mat-drawer",3,0),f(4,"app-admin-sidenav"),n(),i(5,"mat-drawer-content"),f(6,"router-outlet"),n()()),t&2){let o=U(3);l("drawer",o),m(),l("hasBackdrop",s.isMobile()),m(),l("opened",s.sidenavOpened())("disableClose",!s.isMobile())("mode",s.isMobile()?"over":"side")}},dependencies:[S,q,ne,te,ie,ee,P,w,y,Z,ae,Q,oe,O,F],styles:[".drawer[_ngcontent-%COMP%]{height:calc(100vh - 64px);border-radius:0}.content-body[_ngcontent-%COMP%]{height:calc(100vh - 64px);overflow-y:scroll}.dashboard-loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:3rem 0}.dashboard-loading[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite;border-radius:50%;height:3rem;width:3rem;border:2px solid #e5e7eb;border-top:2px solid #2563eb}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.business-item[_ngcontent-%COMP%]:hover{background-color:#f9fafb;transition:background-color .15s ease-in-out}.status-approved[_ngcontent-%COMP%]{background-color:#dcfce7;color:#166534}.status-pending[_ngcontent-%COMP%]{background-color:#fef3c7;color:#92400e}.status-rejected[_ngcontent-%COMP%]{background-color:#fee2e2;color:#991b1b}.status-suspended[_ngcontent-%COMP%]{background-color:#f3f4f6;color:#374151}.create-business-btn[_ngcontent-%COMP%]:hover{background-color:#1d4ed8;transform:translateY(-1px);transition:all .2s ease-in-out}.action-btn[_ngcontent-%COMP%]:hover{background-color:#f9fafb;transform:translateY(-1px);transition:all .15s ease-in-out}.action-btn-danger[_ngcontent-%COMP%]:hover{background-color:#fef2f2;transform:translateY(-1px);transition:all .15s ease-in-out}.stat-card[_ngcontent-%COMP%]:hover{box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -2px #0000000d;transition:box-shadow .2s ease-in-out}.empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:.6}@media (max-width: 640px){.business-content[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.75rem}.action-buttons[_ngcontent-%COMP%]{margin-left:0;width:100%;justify-content:flex-end}.stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.create-business-btn[_ngcontent-%COMP%]:focus, .action-btn[_ngcontent-%COMP%]:focus, .action-btn-danger[_ngcontent-%COMP%]:focus{outline:2px solid transparent;outline-offset:2px;box-shadow:0 0 0 2px #2563eb}@media print{.action-buttons[_ngcontent-%COMP%], .create-business-btn[_ngcontent-%COMP%]{display:none}}"]})};export{he as AdminDashboardComponent};
