import{a as Z,b as ee}from"./chunk-TD3AVWK7.js";import{a as X,b as Y,c as oe}from"./chunk-CC5MIRXO.js";import{a as q,b as K,c as Q,d as W}from"./chunk-EVRT3NTN.js";import{a as ne}from"./chunk-RABWVIIE.js";import{b as z,c as J,e as G}from"./chunk-SUTJIGUH.js";import{a as ie}from"./chunk-5X5YCIDJ.js";import{a as te}from"./chunk-QSI3HFOI.js";import{p as L,q as $}from"./chunk-A72LFUZP.js";import{c as M,d as N,g as T}from"./chunk-MEFNJ5SS.js";import{j,t as k}from"./chunk-REOVWAHI.js";import{Bb as b,Db as D,Ea as V,Eb as O,Gb as p,Jb as H,Kb as R,Lb as i,Mb as r,Nb as g,Oc as C,Pc as S,Rb as _,Vb as u,Wb as c,cb as l,fa as v,fc as P,gc as s,hc as U,ic as h,na as d,oa as m,ob as y,pa as A,qa as B,sc as F,ub as f,ya as I}from"./chunk-BEPULU6C.js";import{e as x}from"./chunk-JKOY2XUY.js";var ce=(o,e)=>e._id;function de(o,e){if(o&1&&(i(0,"span",4),s(1),r()),o&2){let t=c();l(),h(" ",t.unreadCount()>99?"99+":t.unreadCount()," ")}}function me(o,e){if(o&1){let t=_();i(0,"button",16),u("click",function(){d(t);let a=c(2);return m(a.markAllAsRead())}),s(1),r()}if(o&2){let t=c(2);b("disabled",t.isMarkingAllRead),l(),h(" ",t.isMarkingAllRead?"Marking...":"Mark all read"," ")}}function ue(o,e){o&1&&(i(0,"div",14),g(1,"div",17),r())}function pe(o,e){o&1&&(i(0,"div",15),A(),i(1,"svg",18),g(2,"path",3),r(),B(),i(3,"p",19),s(4,"No notifications yet"),r()())}function _e(o,e){o&1&&g(0,"div",31)}function fe(o,e){if(o&1){let t=_();i(0,"div",21),u("click",function(){let a=d(t).$implicit,w=c(3);return m(w.handleNotificationClick(a))})("keydown.enter",function(){let a=d(t).$implicit,w=c(3);return m(w.handleNotificationClick(a))})("keydown.space",function(){let a=d(t).$implicit,w=c(3);return m(w.handleNotificationClick(a))}),i(1,"div",22)(2,"div",23)(3,"span",24),s(4),r()(),i(5,"div",25)(6,"div",26)(7,"div",27)(8,"p",28),s(9),r(),i(10,"p",29),s(11),r(),i(12,"p",30),s(13),r()(),f(14,_e,1,0,"div",31),r()()()()}if(o&2){let t=e.$implicit,n=c(3);O(n.getNotificationStyles(t)),l(4),U(n.getNotificationIcon(t.type)),l(5),h(" ",t.title," "),l(2),h(" ",t.message," "),l(2),h(" ",n.formatTimeAgo(t.createdAt)," "),l(),p(t.is_read?-1:14)}}function xe(o,e){if(o&1&&H(0,fe,15,7,"div",20,ce),o&2){let t=c(2);R(t.recentNotifications())}}function ge(o,e){if(o&1){let t=_();i(0,"div",5)(1,"div",7)(2,"div",8)(3,"h3",9),s(4,"Notifications"),r(),i(5,"div",10),f(6,me,2,2,"button",11),i(7,"a",12),u("click",function(){d(t);let a=c();return m(a.closeDropdown())}),s(8," View all "),r()()()(),i(9,"div",13),f(10,ue,2,0,"div",14)(11,pe,5,0,"div",15)(12,xe,2,0),r()()}if(o&2){let t=c();l(6),p(t.unreadCount()>0?6:-1),l(4),p(t.isLoading()?10:t.recentNotifications().length===0?11:12)}}function he(o,e){if(o&1){let t=_();i(0,"div",32),u("click",function(){d(t);let a=c();return m(a.closeDropdown())}),r()}}var E=class o{notificationService=v(ne);socketService=v(oe);router=v(M);isDropdownOpen=!1;isMarkingAllRead=!1;notifications=this.notificationService.notifications;unreadCount=this.notificationService.unreadCount;isLoading=this.notificationService.isLoading;hasUnreadNotifications=C(()=>this.unreadCount()>0);recentNotifications=C(()=>this.notifications().slice(0,5));constructor(){S(()=>{this.updatePageTitle()})}ngOnInit(){this.loadNotifications(),this.notificationService.requestNotificationPermission()}loadNotifications(){return x(this,null,function*(){try{yield this.notificationService.getNotifications({limit:20,page:1})}catch(e){console.error("Error loading notifications:",e)}})}toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen,this.isDropdownOpen&&this.markUnseenAsSeen()}closeDropdown(){this.isDropdownOpen=!1}markUnseenAsSeen(){return x(this,null,function*(){try{yield this.notificationService.markAllAsSeen()}catch(e){console.error("Error marking notifications as seen:",e)}})}markAllAsRead(){return x(this,null,function*(){this.isMarkingAllRead=!0;try{yield this.notificationService.markAllAsRead()}catch(e){console.error("Error marking all as read:",e)}finally{this.isMarkingAllRead=!1}})}handleNotificationClick(e){return x(this,null,function*(){if(!e.is_read)try{yield this.notificationService.markAsRead(e._id)}catch(t){console.error("Error marking notification as read:",t)}this.navigateFromNotification(e),this.closeDropdown()})}navigateFromNotification(e){switch(e.type){case"project_created":case"project_accepted":case"project_rejected":case"project_started":case"project_completed":e.project_id&&this.router.navigate(["/dashboard/projects",e.project_id._id]);break;case"message_received":e.metadata?.chatId&&this.router.navigate(["/dashboard/messages"],{queryParams:{chat:e.metadata.chatId}});break;default:this.router.navigate(["/dashboard/notifications"]);break}}getNotificationIcon(e){return this.notificationService.getNotificationIcon(e)}getNotificationStyles(e){let t="";return e.priority==="urgent"?t+="bg-red-50 border-l-4 border-red-400 ":e.priority==="high"?t+="bg-orange-50 border-l-4 border-orange-400 ":e.is_read||(t+="bg-blue-50 "),t}formatTimeAgo(e){return this.notificationService.formatTimeAgo(e)}updatePageTitle(){let e=this.unreadCount(),t=document.title.replace(/^\(\d+\)\s/,"");e>0?document.title=`(${e}) ${t}`:document.title=t}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=y({type:o,selectors:[["app-notification-nav"]],decls:7,vars:7,consts:[[1,"relative"],[1,"relative","p-2","text-gray-600","hover:text-gray-900","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","rounded-lg","transition-colors","duration-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 17h5l-5.5-7V7a5 5 0 00-4.5-4.5A5 5 0 005.5 7v3L0 17h5m5 0v1a3 3 0 01-6 0v-1m6 0v1a3 3 0 006 0v-1"],[1,"absolute","-top-1","-right-1","inline-flex","items-center","justify-center","px-2","py-1","text-xs","font-bold","leading-none","text-white","transform","translate-x-1/2","-translate-y-1/2","bg-red-500","rounded-full","min-w-[1.25rem]","h-5"],[1,"absolute","right-0","z-50","mt-2","w-80","bg-white","rounded-lg","shadow-lg","border","border-gray-200","max-h-96","overflow-hidden"],[1,"fixed","inset-0","z-40"],[1,"px-4","py-3","border-b","border-gray-200","bg-gray-50"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-semibold","text-gray-900"],[1,"flex","items-center","space-x-2"],[1,"text-xs","text-blue-600","hover:text-blue-800","font-medium",3,"disabled"],["routerLink","/dashboard/notifications",1,"text-xs","text-gray-600","hover:text-gray-800","font-medium",3,"click"],[1,"max-h-64","overflow-y-auto"],[1,"flex","items-center","justify-center","py-8"],[1,"text-center","py-8","text-gray-500"],[1,"text-xs","text-blue-600","hover:text-blue-800","font-medium",3,"click","disabled"],[1,"animate-spin","rounded-full","h-6","w-6","border-b-2","border-blue-600"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-2","text-gray-300"],[1,"text-sm"],["role","button","tabindex","0",1,"px-4","py-3","border-b","border-gray-100","hover:bg-gray-50","cursor-pointer","transition-colors","duration-200",3,"class"],["role","button","tabindex","0",1,"px-4","py-3","border-b","border-gray-100","hover:bg-gray-50","cursor-pointer","transition-colors","duration-200",3,"click","keydown.enter","keydown.space"],[1,"flex","items-start","space-x-3"],[1,"flex-shrink-0","mt-1"],[1,"text-lg"],[1,"flex-1","min-w-0"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"text-sm","font-medium","text-gray-900","truncate","hover:text-blue-600","transition-colors"],[1,"text-xs","text-gray-600","mt-1","line-clamp-2"],[1,"text-xs","text-gray-400","mt-1"],[1,"w-2","h-2","bg-blue-500","rounded-full","ml-2","mt-1","flex-shrink-0"],[1,"fixed","inset-0","z-40",3,"click"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"button",1),u("click",function(){return n.toggleDropdown()}),A(),i(2,"svg",2),g(3,"path",3),r(),f(4,de,2,1,"span",4),r(),f(5,ge,13,2,"div",5)(6,he,1,0,"div",6),r()),t&2&&(l(),D("text-blue-600",n.hasUnreadNotifications()),l(),D("animate-pulse",n.hasUnreadNotifications()),l(2),p(n.unreadCount()>0?4:-1),l(),p(n.isDropdownOpen?5:-1),l(),p(n.isDropdownOpen?6:-1))},dependencies:[k,T,N],styles:[".line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}"]})};var ve=(o,e)=>({"max-w-12xl":o,"max-w-7xl":e});function Ce(o,e){if(o&1){let t=_();i(0,"button",8),u("click",function(){d(t);let a=c();return m(a.onMenuToggle())}),i(1,"mat-icon"),s(2,"menu"),r()()}}function be(o,e){if(o&1){let t=_();i(0,"button",15),u("click",function(){d(t);let a=c(2);return m(a.navigateToAdmin())}),i(1,"mat-icon"),s(2,"admin_panel_settings"),r(),i(3,"span"),s(4,"Admin Panel"),r()()}}function we(o,e){if(o&1){let t=_();i(0,"button",15),u("click",function(){d(t);let a=c(2);return m(a.switchToBusinessMode())}),i(1,"mat-icon"),s(2,"business"),r(),i(3,"span"),s(4,"Switch to Business Owner"),r()()}}function ye(o,e){if(o&1){let t=_();i(0,"button",15),u("click",function(){d(t);let a=c(2);return m(a.switchToClientMode())}),i(1,"mat-icon"),s(2,"person_outline"),r(),i(3,"span"),s(4,"Switch to Client Mode"),r()()}}function Se(o,e){if(o&1){let t=_();i(0,"div",7)(1,"button",9),u("click",function(){d(t);let a=c();return m(a.navigateToMessages())}),i(2,"mat-icon",10),s(3," mail "),r()(),g(4,"app-notification-nav"),i(5,"div",11)(6,"button",12)(7,"div",13),s(8),r(),i(9,"mat-icon"),s(10,"expand_more"),r()(),i(11,"mat-menu",null,0)(13,"div",14),s(14),r(),i(15,"button",15),u("click",function(){d(t);let a=c();return m(a.navigateToDashboard())}),i(16,"mat-icon"),s(17,"dashboard"),r(),i(18,"span"),s(19,"Dashboard"),r()(),i(20,"button",15),u("click",function(){d(t);let a=c();return m(a.navigateToProfile())}),i(21,"mat-icon"),s(22,"person"),r(),i(23,"span"),s(24,"Profile"),r()(),f(25,be,5,0,"button",16)(26,we,5,0,"button",16)(27,ye,5,0,"button",16),g(28,"mat-divider"),i(29,"button",15),u("click",function(){d(t);let a=c();return m(a.navigateToSettings())}),i(30,"mat-icon"),s(31,"settings"),r(),i(32,"span"),s(33,"Settings"),r()(),g(34,"mat-divider"),i(35,"button",17),u("click",function(){d(t);let a=c();return m(a.signOut())}),i(36,"mat-icon"),s(37,"logout"),r(),i(38,"span"),s(39,"Sign Out"),r()()()()()}if(o&2){let t=P(12),n=c();l(2),b("matBadge",n.messageCount())("matBadgeHidden",n.messageCount()===0),l(4),b("matMenuTriggerFor",t),l(2),h(" ",n.getUserInitials()," "),l(6),h(" Mode: ",n.isBusinessOwner()?"Business Owner":"Client"," "),l(11),p(n.hasAdminAccess()?25:-1),l(),p(n.isBusinessOwner()?27:26)}}function ke(o,e){o&1&&(i(0,"a",18),s(1," Sign In "),r(),i(2,"a",19),s(3," Join "),r())}var re=class o{authService=v(ie);authorizationService=v(te);router=v(M);showMobileMenuButton=!1;isAdminMode=!1;isDashboardMode=!1;menuToggle=new I;user=this.authService.user;isAuthenticated=this.authService.isAuthenticated;showMobileMenu=V(!1);messageCount=V(3);userMode=C(()=>this.user()?.user_mode||"client");isBusinessOwner=C(()=>this.userMode()==="business_owner");hasAdminAccess=C(()=>this.authorizationService.hasAdminAccess());constructor(){S(()=>{let e=this.user(),t=this.userMode(),n=this.isBusinessOwner();console.log("Header signals updated:",{user:e?.email,mode:t,isBusiness:n})})}getUserInitials(){let e=this.user();if(!e)return"";let t=e.first_name||"",n=e.last_name||"";return t&&n?t.charAt(0).toUpperCase()+n.charAt(0).toUpperCase():t?t.charAt(0).toUpperCase()+(e.email.charAt(0).toUpperCase()||""):n?e.email.charAt(0).toUpperCase()+n.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase()}getUserFullName(){let e=this.user();if(!e)return"";let t=e.first_name||"",n=e.last_name||"";return t&&n?`${t} ${n}`:t||n||e.email}navigateToDashboard(){this.router.navigate(["/dashboard"])}navigateToProfile(){this.router.navigate(["/dashboard/profile"])}navigateToSettings(){this.router.navigate(["/dashboard/settings"])}navigateToMessages(){this.router.navigate(["/dashboard/messages"])}navigateToAdmin(){this.router.navigate(["/admin"])}navigateToCreateBusiness(){this.router.navigate(["/dashboard/businesses/create-business"])}navigateToOwnBusiness(){this.router.navigate(["/own-business"])}navigateToBecomeBusiness(){this.router.navigate(["/auth"],{queryParams:{mode:"business"}})}switchToBusinessMode(){return x(this,null,function*(){try{let e=yield this.authService.switchMode("business_owner");e.data?(console.log("Switched to business owner mode successfully"),console.log("Updated user mode:",this.userMode()),this.navigateToDashboard()):console.error("Failed to switch to business mode:",e.error)}catch(e){console.error("Error switching to business mode:",e)}})}switchToClientMode(){return x(this,null,function*(){try{let e=yield this.authService.switchMode("client");e.data?(console.log("Switched to client mode successfully"),console.log("Updated user mode:",this.userMode()),this.router.navigate(["/search"])):console.error("Failed to switch to client mode:",e.error)}catch(e){console.error("Error switching to client mode:",e)}})}toggleMobileMenu(){this.showMobileMenu.update(e=>!e)}onMenuToggle(){this.menuToggle.emit()}signOut(){return x(this,null,function*(){yield this.authService.signOut()})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=y({type:o,selectors:[["app-header"]],inputs:{showMobileMenuButton:"showMobileMenuButton",isAdminMode:"isAdminMode",isDashboardMode:"isDashboardMode"},outputs:{menuToggle:"menuToggle"},decls:10,vars:6,consts:[["userMenu","matMenu"],[1,"relative","z-50","bg-white","shadow-sm"],[1,"mx-auto","px-4","sm:px-6","lg:px-8",3,"ngClass"],[1,"flex","justify-between","items-center","py-4"],[1,"flex","items-center"],["mat-icon-button","",1,"mr-3","text-gray-700","hover:text-blue-600","transition-colors"],["routerLink","/",1,"text-2xl","font-bold","text-blue-600","hover:text-blue-700","transition-colors"],[1,"flex","items-center","space-x-4"],["mat-icon-button","",1,"mr-3","text-gray-700","hover:text-blue-600","transition-colors",3,"click"],["mat-icon-button","",1,"relative","text-gray-700","hover:text-blue-600","transition-colors",3,"click"],["matBadgeColor","warn","matBadgeSize","small",3,"matBadge","matBadgeHidden"],[1,"relative"],["mat-button","",1,"flex","items-center","space-x-2","text-gray-700","hover:text-blue-600","transition-colors",3,"matMenuTriggerFor"],[1,"w-8","h-8","bg-blue-600","text-white","rounded-full","flex","items-center","justify-center","text-sm","font-medium"],[1,"px-4","py-2","text-sm","text-gray-500","border-b"],["mat-menu-item","",3,"click"],["mat-menu-item",""],["mat-menu-item","",1,"text-red-600",3,"click"],["routerLink","/auth",1,"text-gray-700","hover:text-blue-600","transition-colors"],["routerLink","/auth",1,"bg-blue-600","text-white","px-4","py-2","rounded-lg","hover:bg-blue-700","transition-colors"]],template:function(t,n){if(t&1&&(i(0,"header",1)(1,"nav",2)(2,"div",3)(3,"div",4),f(4,Ce,3,0,"button",5),i(5,"a",6),s(6," VouchHer "),r()(),i(7,"div",7),f(8,Se,40,7,"div",7)(9,ke,4,0),r()()()()),t&2){let a;l(),b("ngClass",F(3,ve,n.isAuthenticated(),!n.isAuthenticated())),l(3),p(n.showMobileMenuButton?4:-1),l(4),p((a=n.isAuthenticated())?8:9,a)}},dependencies:[k,j,T,N,$,L,G,J,z,W,K,q,Q,Y,X,ee,Z,E],encapsulation:2})};export{re as a};
