import{a as de,b as me}from"./chunk-GM5Q6FEH.js";import{a as ye,b as Se,c as Be,d as we,e as Me,f as Ee,g as Ae,h as ke,i as Fe,j as Te,k as Le}from"./chunk-E73XHDFF.js";import{a as be,b as ve}from"./chunk-UD3PIWHR.js";import{a as he,b as xe,c as ge,d as Ce}from"./chunk-HRZHOBQF.js";import"./chunk-RCB5IBRW.js";import{a as _e}from"./chunk-GOJTL5ME.js";import{a as ee,b as se,c as le,d as ae,f as oe,g as re}from"./chunk-WGXBBWM3.js";import{b as te,f as ie,i as ne}from"./chunk-ZNICEN73.js";import{a as X,b as Y}from"./chunk-UY4YEVVR.js";import{a as G,b as J,c as K,d as W}from"./chunk-AL4SBIAL.js";import"./chunk-XHLYN5Z3.js";import"./chunk-X55ML2VI.js";import{v as Z}from"./chunk-DI6PPV4W.js";import{a as ce,b as ue}from"./chunk-F5SVYNC5.js";import{b as Q,d as U,e as q}from"./chunk-Y52DJSVM.js";import{G as H,H as z,X as fe,aa as pe}from"./chunk-DDU4UDPS.js";import"./chunk-YCEFGLUP.js";import{$a as u,Aa as L,Ab as O,Fa as _,Ja as f,Oa as C,Ra as E,Rb as R,S as M,Sa as A,Ta as n,Ua as s,Ub as N,Va as b,Wa as v,X as p,Xa as y,Xb as P,Y as h,Za as S,ab as m,gc as j,ha as g,jb as D,kb as a,lb as x,mb as B,nb as V,qa as T,ra as d,wb as I,zb as $}from"./chunk-OUYPDPRE.js";import{d as F}from"./chunk-QEZ3K4DX.js";var Ie=(i,t,e)=>({"bg-green-100 text-green-800":i,"bg-yellow-100 text-yellow-800":t,"bg-red-100 text-red-800":e}),De=(i,t)=>t.value;function $e(i,t){if(i&1&&(n(0,"mat-option",14),a(1),s()),i&2){let e=t.$implicit;f("value",e.value),d(),x(e.label)}}function Oe(i,t){if(i&1&&(n(0,"mat-option",14),a(1),s()),i&2){let e=t.$implicit;f("value",e.value),d(),x(e.label)}}function Re(i,t){if(i&1){let e=S();n(0,"div",15)(1,"div",3)(2,"div",19)(3,"span",20),a(4),s(),n(5,"mat-chip-set")(6,"mat-chip",21),u("click",function(){p(e);let o=m();return h(o.clearSelection())}),n(7,"mat-icon",22),a(8,"cancel"),s(),a(9," Clear selection "),s()()(),n(10,"div",23)(11,"button",24),u("click",function(){p(e);let o=m();return h(o.bulkVerifyBusinesses())}),n(12,"mat-icon"),a(13,"verified"),s(),a(14," Verify Selected "),s(),n(15,"button",25),u("click",function(){p(e);let o=m();return h(o.bulkToggleFeatured(!0))}),n(16,"mat-icon"),a(17,"star"),s(),a(18," Feature Selected "),s(),n(19,"button",26),u("click",function(){p(e);let o=m();return h(o.bulkDeleteBusinesses())}),n(20,"mat-icon"),a(21,"delete"),s(),a(22," Delete Selected "),s()()()()}if(i&2){let e=m();d(4),B(" ",e.selectedBusinesses().size," business(es) selected ")}}function Ne(i,t){i&1&&(n(0,"mat-card",17),b(1,"mat-spinner"),s())}function Pe(i,t){if(i&1){let e=S();n(0,"th",42)(1,"mat-checkbox",43),u("change",function(){p(e);let o=m(2);return h(o.toggleAllSelection())}),s()()}if(i&2){let e=m(2);d(),f("checked",e.isAllSelected())("indeterminate",e.isIndeterminate())}}function je(i,t){if(i&1){let e=S();n(0,"td",44)(1,"mat-checkbox",45),u("change",function(){let o=p(e).$implicit,r=m(2);return h(r.toggleBusinessSelection(o._id))}),s()()}if(i&2){let e=t.$implicit,l=m(2);d(),f("checked",l.isBusinessSelected(e._id))}}function He(i,t){i&1&&(n(0,"th",46),a(1,"Business Name"),s())}function ze(i,t){if(i&1&&b(0,"img",48),i&2){let e=m().$implicit;f("src",e.logo_url,T)("alt",e.name)}}function Qe(i,t){i&1&&(n(0,"div",49)(1,"mat-icon",52),a(2,"business"),s()())}function Ue(i,t){if(i&1&&(n(0,"td",47)(1,"div",19),_(2,ze,1,2,"img",48)(3,Qe,3,0,"div",49),n(4,"div")(5,"div",50),a(6),s(),n(7,"div",51),a(8),s()()()()),i&2){let e=t.$implicit;d(2),C(e.logo_url?2:3),d(4),x(e.name),d(2),V("",e.city,", ",e.state,"")}}function qe(i,t){i&1&&(n(0,"th",46),a(1,"Owner"),s())}function Ge(i,t){if(i&1&&(n(0,"td",47)(1,"div",53)(2,"div",54),a(3),s(),n(4,"div",55),a(5),s()()()),i&2){let e=t.$implicit,l=m(2);d(3),x(l.getOwnerName(e.owner_id)),d(2),x(e.contact_email||"No email")}}function Je(i,t){i&1&&(n(0,"th",46),a(1,"Status"),s())}function Ke(i,t){i&1&&(n(0,"span",58)(1,"mat-icon",59),a(2,"star"),s(),a(3," Featured "),s())}function We(i,t){if(i&1&&(n(0,"td",47)(1,"div",56)(2,"span",57),a(3),$(4,"titlecase"),s(),_(5,Ke,4,0,"span",58),s()()),i&2){let e=t.$implicit;d(2),f("ngClass",I(5,Ie,e.status==="approved",e.status==="pending",e.status==="rejected")),d(),B(" ",O(4,3,e.status)," "),d(2),C(e.is_featured?5:-1)}}function Xe(i,t){i&1&&(n(0,"th",46),a(1,"Rating"),s())}function Ye(i,t){if(i&1&&(n(0,"td",47)(1,"div",53)(2,"div",60)(3,"mat-icon",61),a(4,"star"),s(),n(5,"span",54),a(6),s()(),n(7,"div",55),a(8),s()()()),i&2){let e=t.$implicit;d(6),x(e.rating||0),d(2),B("",e.review_count||0," reviews")}}function Ze(i,t){i&1&&(n(0,"th",46),a(1,"Actions"),s())}function et(i,t){if(i&1){let e=S();n(0,"button",63),u("click",function(){p(e);let o=m().$implicit,r=m(2);return h(r.verifyBusiness(o))}),n(1,"mat-icon",67),a(2,"verified"),s(),n(3,"span"),a(4,"Verify Business"),s()()}}function tt(i,t){if(i&1){let e=S();n(0,"td",47)(1,"button",62)(2,"mat-icon"),a(3,"more_vert"),s()(),n(4,"mat-menu",null,0)(6,"button",63),u("click",function(){let o=p(e).$implicit,r=m(2);return h(r.viewBusinessDetails(o._id))}),n(7,"mat-icon"),a(8,"visibility"),s(),n(9,"span"),a(10,"View Details"),s()(),b(11,"mat-divider"),n(12,"button",63),u("click",function(){let o=p(e).$implicit,r=m(2);return h(r.toggleFeatured(o))}),n(13,"mat-icon"),a(14),s(),n(15,"span"),a(16),s()(),_(17,et,5,0,"button",64),b(18,"mat-divider"),n(19,"button",65),u("click",function(){let o=p(e).$implicit,r=m(2);return h(r.deleteBusiness(o))}),n(20,"mat-icon",66),a(21,"delete"),s(),n(22,"span"),a(23,"Delete Business"),s()()()()}if(i&2){let e=t.$implicit,l=D(5);d(),f("matMenuTriggerFor",l),d(13),x(e.is_featured?"star_border":"star"),d(2),x(e.is_featured?"Remove from Featured":"Add to Featured"),d(),C(e.status==="pending"?17:-1)}}function it(i,t){i&1&&b(0,"tr",68)}function nt(i,t){i&1&&b(0,"tr",69)}function st(i,t){i&1&&(n(0,"mat-icon",70),a(1,"business"),s(),n(2,"h3",71),a(3,"No businesses found"),s(),n(4,"p",55),a(5,"There are no businesses to display at the moment."),s())}function lt(i,t){if(i&1){let e=S();n(0,"mat-icon",70),a(1,"search_off"),s(),n(2,"h3",71),a(3,"No results found"),s(),n(4,"p",55),a(5,"Try adjusting your search or filter criteria."),s(),n(6,"button",72),u("click",function(){p(e);let o=m(3);return o.searchQuery.set(""),o.statusFilter.set("all"),o.featuredFilter.set("all"),h(o.setupFilters())}),a(7," Clear all filters "),s()}}function at(i,t){if(i&1&&(n(0,"div",41),_(1,st,6,0)(2,lt,8,0),s()),i&2){let e=m(2);d(),C(e.businesses().length===0?1:2)}}function ot(i,t){if(i&1&&(n(0,"mat-card",18)(1,"div",27)(2,"table",28),v(3,29),_(4,Pe,2,2,"th",30)(5,je,2,1,"td",31),y(),v(6,32),_(7,He,2,0,"th",33)(8,Ue,9,4,"td",34),y(),v(9,35),_(10,qe,2,0,"th",33)(11,Ge,6,2,"td",34),y(),v(12,36),_(13,Je,2,0,"th",33)(14,We,6,9,"td",34),y(),v(15,37),_(16,Xe,2,0,"th",33)(17,Ye,9,2,"td",34),y(),v(18,38),_(19,Ze,2,0,"th",33)(20,tt,24,4,"td",34),y(),_(21,it,1,0,"tr",39)(22,nt,1,0,"tr",40),s()(),_(23,at,3,1,"div",41),s()),i&2){let e=m();d(2),f("dataSource",e.filteredBusinesses()),d(19),f("matHeaderRowDef",e.displayedColumns),d(),f("matRowDefColumns",e.displayedColumns),d(),C(e.filteredBusinesses().length===0&&!e.loading()?23:-1)}}var Ve=class i{businessService=M(_e);router=M(j);loading=g(!1);businesses=g([]);filteredBusinesses=g([]);selectedBusinesses=g(new Set);searchQuery=g("");statusFilter=g("all");featuredFilter=g("all");displayedColumns=["select","name","owner","status","rating","actions"];statusOptions=[{value:"all",label:"All Status"},{value:"pending",label:"Pending"},{value:"approved",label:"Approved"},{value:"rejected",label:"Rejected"}];featuredOptions=[{value:"all",label:"All"},{value:"featured",label:"Featured Only"},{value:"not-featured",label:"Not Featured"}];ngOnInit(){this.loadBusinesses(),this.setupFilters()}setupFilters(){(()=>{let e=this.searchQuery().toLowerCase(),l=this.statusFilter(),o=this.featuredFilter(),r=this.businesses();e&&(r=r.filter(c=>c.name.toLowerCase().includes(e)||c.city?.toLowerCase().includes(e)||c.state?.toLowerCase().includes(e)||c.contact_email?.toLowerCase().includes(e))),l!=="all"&&(r=r.filter(c=>c.status===l)),o==="featured"?r=r.filter(c=>c.is_featured):o==="not-featured"&&(r=r.filter(c=>!c.is_featured)),this.filteredBusinesses.set(r)})()}onSearchChange(t){this.searchQuery.set(t),this.setupFilters()}onStatusFilterChange(t){this.statusFilter.set(t),this.setupFilters()}onFeaturedFilterChange(t){this.featuredFilter.set(t),this.setupFilters()}loadBusinesses(){return F(this,null,function*(){this.loading.set(!0);try{let t=yield this.businessService.getMyBusinessesAsync();this.businesses.set(t),this.filteredBusinesses.set(t)}catch(t){console.error("Error loading businesses:",t)}finally{this.loading.set(!1)}})}toggleBusinessSelection(t){let e=new Set(this.selectedBusinesses());e.has(t)?e.delete(t):e.add(t),this.selectedBusinesses.set(e)}toggleAllSelection(){if(this.selectedBusinesses().size===this.filteredBusinesses().length)this.selectedBusinesses.set(new Set);else{let e=new Set(this.filteredBusinesses().map(l=>l._id));this.selectedBusinesses.set(e)}}isBusinessSelected(t){return this.selectedBusinesses().has(t)}isAllSelected(){return this.selectedBusinesses().size===this.filteredBusinesses().length&&this.filteredBusinesses().length>0}isIndeterminate(){let t=this.selectedBusinesses().size;return t>0&&t<this.filteredBusinesses().length}bulkVerifyBusinesses(){let t=Array.from(this.selectedBusinesses());t.length!==0&&(this.loading.set(!0),this.businessService.adminBulkVerifyBusinessesAsync(t).then(e=>{if(e.verified.length>0){let l=this.businesses();l.forEach(c=>{e.verified.includes(c._id)&&(c.status="approved")}),this.businesses.set([...l]),this.setupFilters(),this.clearSelection();let o=`${e.verified.length} business(es) verified successfully.`,r=e.failed.length>0?` ${e.failed.length} failed.`:"";alert(o+r)}}).catch(e=>{console.error("Error bulk verifying businesses:",e),alert("Failed to verify selected businesses")}).finally(()=>{this.loading.set(!1)}))}bulkToggleFeatured(t){let e=Array.from(this.selectedBusinesses());e.length!==0&&(this.loading.set(!0),this.businessService.adminBulkToggleFeaturedAsync(e,t).then(l=>{if(l.updated.length>0){let o=this.businesses();o.forEach(k=>{l.updated.includes(k._id)&&(k.is_featured=t)}),this.businesses.set([...o]),this.setupFilters(),this.clearSelection();let r=t?"featured":"unfeatured",c=`${l.updated.length} business(es) ${r} successfully.`,w=l.failed.length>0?` ${l.failed.length} failed.`:"";alert(c+w)}}).catch(l=>{console.error("Error bulk updating featured status:",l),alert("Failed to update featured status for selected businesses")}).finally(()=>{this.loading.set(!1)}))}bulkDeleteBusinesses(){let t=Array.from(this.selectedBusinesses());t.length!==0&&confirm(`Are you sure you want to delete ${t.length} selected businesses?`)&&(this.loading.set(!0),this.businessService.adminBulkDeleteBusinessesAsync(t).then(e=>{if(e.deleted.length>0){let o=this.businesses().filter(w=>!e.deleted.includes(w._id));this.businesses.set(o),this.setupFilters(),this.clearSelection();let r=`${e.deleted.length} business(es) deleted successfully.`,c=e.failed.length>0?` ${e.failed.length} failed.`:"";alert(r+c)}}).catch(e=>{console.error("Error bulk deleting businesses:",e),alert("Failed to delete selected businesses")}).finally(()=>{this.loading.set(!1)}))}clearSelection(){this.selectedBusinesses.set(new Set)}viewBusinessDetails(t){this.router.navigate(["/admin/dashboard/businesses/details",t])}toggleFeatured(t){this.loading.set(!0),this.businessService.adminToggleFeaturedAsync(t._id,!t.is_featured).then(e=>{let l=this.businesses(),o=l.findIndex(r=>r._id===t._id);o!==-1&&(l[o]=e,this.businesses.set([...l]),this.setupFilters())}).catch(e=>{console.error("Error toggling featured status:",e),alert("Failed to update featured status")}).finally(()=>{this.loading.set(!1)})}verifyBusiness(t){this.loading.set(!0),this.businessService.adminVerifyBusinessAsync(t._id).then(e=>{let l=this.businesses(),o=l.findIndex(r=>r._id===t._id);o!==-1&&(l[o]=e,this.businesses.set([...l]),this.setupFilters()),alert("Business verified successfully")}).catch(e=>{console.error("Error verifying business:",e),alert("Failed to verify business")}).finally(()=>{this.loading.set(!1)})}deleteBusiness(t){confirm(`Are you sure you want to delete "${t.name}"?`)&&(this.loading.set(!0),this.businessService.adminDeleteBusinessAsync(t._id).then(()=>{let l=this.businesses().filter(o=>o._id!==t._id);this.businesses.set(l),this.setupFilters(),alert("Business deleted successfully")}).catch(e=>{console.error("Error deleting business:",e),alert("Failed to delete business")}).finally(()=>{this.loading.set(!1)}))}formatDate(t){return new Date(t).toLocaleDateString()}getOwnerName(t){return t?typeof t=="string"?"Owner ID: "+t:`${t.first_name||""} ${t.last_name||""}`.trim()||t.email||"Unknown":"Unknown"}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=L({type:i,selectors:[["app-admin-business-list"]],decls:36,vars:6,consts:[["actionsMenu","matMenu"],[1,"h-full","bg-gray-50","flex","flex-col"],[1,"bg-white","border-b","border-gray-200","px-6","py-6","flex-shrink-0"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600","mt-1"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"bg-white","border-b","border-gray-200","px-6","py-4","flex-shrink-0"],[1,"flex","flex-col","lg:flex-row","gap-4"],["appearance","outline",1,"flex-1"],["matInput","","placeholder","Search by name, city, state, or email",3,"input","value"],["matSuffix",""],["appearance","outline",1,"min-w-48"],[3,"selectionChange","value"],[3,"value"],[1,"bg-blue-50","border-b","border-blue-200","px-6","py-3","flex-shrink-0"],[1,"flex-1","bg-white","overflow-hidden"],[1,"h-full","flex","items-center","justify-center"],[1,"h-full","flex","!bg-white","flex-col"],[1,"flex","items-center","space-x-4"],[1,"text-sm","font-medium","text-blue-900"],[3,"click"],["matChipRemove",""],[1,"flex","items-center","space-x-2"],["mat-stroked-button","","color","primary",3,"click"],["mat-stroked-button","","color","accent",3,"click"],["mat-stroked-button","","color","warn",3,"click"],[1,"flex-1","overflow-auto"],["mat-table","",1,"w-full","!bg-white",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","w-12",4,"matHeaderCellDef"],["mat-cell","","class","w-12",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","class","font-semibold text-gray-900",4,"matHeaderCellDef"],["mat-cell","","class","py-6",4,"matCellDef"],["matColumnDef","owner"],["matColumnDef","status"],["matColumnDef","rating"],["matColumnDef","actions"],["mat-header-row","","class","bg-gray-50",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50 border-b border-gray-100 transition-colors",4,"matRowDef","matRowDefColumns"],[1,"text-center","py-16"],["mat-header-cell","",1,"w-12"],[3,"change","checked","indeterminate"],["mat-cell","",1,"w-12"],[3,"change","checked"],["mat-header-cell","",1,"font-semibold","text-gray-900"],["mat-cell","",1,"py-6"],[1,"w-12","h-12","rounded-lg","object-cover","border","border-gray-200",3,"src","alt"],[1,"w-12","h-12","bg-gray-100","rounded-lg","flex","items-center","justify-center","border","border-gray-200"],[1,"font-medium","text-gray-900","text-sm"],[1,"text-sm","text-gray-500"],[1,"text-gray-400"],[1,"text-sm"],[1,"font-medium","text-gray-900"],[1,"text-gray-500"],[1,"flex","flex-col","space-y-2"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","w-fit",3,"ngClass"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-blue-100","text-blue-800","w-fit"],[1,"w-3","h-3","mr-1","!text-xs"],[1,"flex","items-center"],[1,"text-yellow-400","text-base","mr-1"],["mat-icon-button","","matTooltip","More actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item",""],["mat-menu-item","",1,"text-red-600",3,"click"],["color","warn"],["color","primary"],["mat-header-row","",1,"bg-gray-50"],["mat-row","",1,"hover:bg-gray-50","border-b","border-gray-100","transition-colors"],[1,"text-gray-400","text-6xl","mb-4"],[1,"text-lg","font-medium","text-gray-900","mb-2"],["mat-stroked-button","","color","primary",1,"mt-4",3,"click"]],template:function(e,l){e&1&&(n(0,"div",1)(1,"div",2)(2,"div",3)(3,"div")(4,"h1",4),a(5,"Business Management"),s(),n(6,"p",5),a(7,"Manage all businesses in the platform"),s()(),n(8,"button",6),u("click",function(){return l.loadBusinesses()}),n(9,"mat-icon"),a(10,"refresh"),s(),a(11," Refresh "),s()()(),n(12,"div",7)(13,"div",8)(14,"mat-form-field",9)(15,"mat-label"),a(16,"Search businesses"),s(),n(17,"input",10),u("input",function(r){return l.onSearchChange(r.target.value||"")}),s(),n(18,"mat-icon",11),a(19,"search"),s()(),n(20,"mat-form-field",12)(21,"mat-label"),a(22,"Status"),s(),n(23,"mat-select",13),u("selectionChange",function(r){return l.onStatusFilterChange(r.value)}),E(24,$e,2,2,"mat-option",14,De),s()(),n(26,"mat-form-field",12)(27,"mat-label"),a(28,"Featured"),s(),n(29,"mat-select",13),u("selectionChange",function(r){return l.onFeaturedFilterChange(r.value)}),E(30,Oe,2,2,"mat-option",14,De),s()()()(),_(32,Re,23,1,"div",15),n(33,"div",16),_(34,Ne,2,0,"mat-card",17)(35,ot,24,4,"mat-card",18),s()()),e&2&&(d(8),f("disabled",l.loading()),d(9),f("value",l.searchQuery()),d(6),f("value",l.statusFilter()),d(),A(l.statusOptions),d(5),f("value",l.featuredFilter()),d(),A(l.featuredOptions),d(2),C(l.selectedBusinesses().size>0?32:-1),d(2),C(l.loading()?34:35))},dependencies:[P,R,N,Z,pe,fe,q,U,Q,z,H,ue,ce,Le,ye,Be,Ae,we,Se,ke,Me,Ee,Fe,Te,ve,be,me,de,W,J,G,K,se,ne,te,ie,re,oe,ae,le,ee,Ce,xe,he,ge,Y,X],styles:[".mat-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f;border-radius:8px}.mat-table[_ngcontent-%COMP%]{width:100%}.mat-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151;border-bottom:1px solid #e5e7eb}.mat-cell[_ngcontent-%COMP%]{border-bottom:1px solid #f3f4f6}.mat-row[_ngcontent-%COMP%]:hover{background-color:#f9fafb}"]})};export{Ve as AdminBusinessListComponent};
