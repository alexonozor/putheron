import{y as Q}from"./chunk-IEUHBRXL.js";import{$ as U,Ba as $,Ca as F,Ga as B,Gb as P,Ia as u,Ja as _,Ka as b,La as L,Ma as W,P as m,Pb as X,Q as M,R as T,T as c,Ta as p,Ua as g,Va as E,Vb as j,Ya as y,_ as A,a as k,ab as N,b as I,d as n,eb as V,fb as q,fc as J,ga as D,gb as G,gc as S,jb as z,ma as O,n as o,sa as l,zb as H}from"./chunk-JLMSUZVL.js";var K=class s{http=c(j);configService=c(S);get apiUrl(){return this.configService.getApiUrl("/projects")}createProject(e){return this.http.post(this.apiUrl,e)}createProjectAsync(e){return n(this,null,function*(){return(yield o(this.createProject(e))).data})}getMyProjects(e="client"){return this.http.get(`${this.apiUrl}?role=${e}`)}getMyProjectsAsync(e="client"){return n(this,null,function*(){return(yield o(this.getMyProjects(e))).data})}getAllMyProjectsAsync(){return n(this,null,function*(){try{let[e,r]=yield Promise.all([this.getMyProjectsAsync("client"),this.getMyProjectsAsync("business_owner")]);return[...e,...r].filter((a,d,v)=>d===v.findIndex(w=>w._id===a._id))}catch(e){return console.error("Error loading all projects:",e),[]}})}getBusinessProjects(e){return this.http.get(`${this.apiUrl}/business/${e}`)}getBusinessProjectsAsync(e){return n(this,null,function*(){return(yield o(this.getBusinessProjects(e))).data})}getBusinessPortfolio(e){return this.http.get(`${this.apiUrl}/business/${e}/portfolio`)}getBusinessPortfolioAsync(e){return n(this,null,function*(){return(yield o(this.getBusinessPortfolio(e))).data})}getProjectsByStatus(e,r="client"){return this.http.get(`${this.apiUrl}/status/${e}?role=${r}`)}getProjectsByStatusAsync(e,r="client"){return n(this,null,function*(){return(yield o(this.getProjectsByStatus(e,r))).data})}getProject(e){return this.http.get(`${this.apiUrl}/${e}?populate=selected_services,business_id,client_id,business_owner_id`)}getProjectAsync(e){return n(this,null,function*(){return(yield o(this.getProject(e))).data})}updateProject(e,r){return this.http.patch(`${this.apiUrl}/${e}`,r)}updateProjectAsync(e,r){return n(this,null,function*(){return(yield o(this.updateProject(e,r))).data})}deleteProject(e){return this.http.delete(`${this.apiUrl}/${e}`)}deleteProjectAsync(e){return n(this,null,function*(){yield o(this.deleteProject(e))})}calculatePaymentIntent(e){return this.http.post(`${this.apiUrl}/calculate-payment-intent`,{serviceIds:e})}calculatePaymentIntentAsync(e){return n(this,null,function*(){return(yield o(this.calculatePaymentIntent(e))).data})}createProjectAfterPayment(e,r){return this.http.post(`${this.apiUrl}/create-after-payment`,I(k({},e),{paymentIntentId:r}))}createProjectAfterPaymentAsync(e,r){return n(this,null,function*(){try{console.log("ProjectService: Creating project after payment"),console.log("Project Data:",e),console.log("Payment Intent ID:",r);let t=yield o(this.createProjectAfterPayment(e,r));if(console.log("ProjectService: Project creation response:",t),!t.success)throw new Error(t.message||"Failed to create project");return t.data}catch(t){throw console.error("ProjectService: Error creating project after payment:",t),t.error&&console.error("ProjectService: Server error details:",t.error),t}})}uploadProjectImage(e,r){let t=new FormData;return t.append("image",r),this.http.post(`${this.apiUrl}/${e}/upload-image`,t)}uploadProjectImageAsync(e,r){return n(this,null,function*(){let t=yield o(this.uploadProjectImage(e,r));if(!t.success)throw new Error(t.message||"Failed to upload project image");return t.data})}uploadProjectAttachments(e,r){let t=new FormData;return r.forEach(i=>{t.append("attachments",i)}),this.http.post(`${this.apiUrl}/${e}/upload-attachments`,t)}uploadProjectAttachmentsAsync(e,r){return n(this,null,function*(){let t=yield o(this.uploadProjectAttachments(e,r));if(!t.success)throw new Error(t.message||"Failed to upload project attachments");return t.data})}static \u0275fac=function(r){return new(r||s)};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};var Ue={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};var ce=["determinateSpinner"];function le(s,e){if(s&1&&(A(),p(0,"svg",11),E(1,"circle",12),g()),s&2){let r=N();u("viewBox",r._viewBox()),l(),b("stroke-dasharray",r._strokeCircumference(),"px")("stroke-dashoffset",r._strokeCircumference()/2,"px")("stroke-width",r._circleStrokeWidth(),"%"),u("r",r._circleRadius())}}var pe=new T("mat-progress-spinner-default-options",{providedIn:"root",factory:de});function de(){return{diameter:Y}}var Y=100,me=10,ze=(()=>{class s{_elementRef=c(D);_noopAnimations;get color(){return this._color||this._defaultColor}set color(r){this._color=r}_color;_defaultColor="primary";_determinateCircle;constructor(){let r=c(O,{optional:!0}),t=c(pe);this._noopAnimations=r==="NoopAnimations"&&!!t&&!t._forceAnimations,this.mode=this._elementRef.nativeElement.nodeName.toLowerCase()==="mat-spinner"?"indeterminate":"determinate",t&&(t.color&&(this.color=this._defaultColor=t.color),t.diameter&&(this.diameter=t.diameter),t.strokeWidth&&(this.strokeWidth=t.strokeWidth))}mode;get value(){return this.mode==="determinate"?this._value:0}set value(r){this._value=Math.max(0,Math.min(100,r||0))}_value=0;get diameter(){return this._diameter}set diameter(r){this._diameter=r||0}_diameter=Y;get strokeWidth(){return this._strokeWidth??this.diameter/10}set strokeWidth(r){this._strokeWidth=r||0}_strokeWidth;_circleRadius(){return(this.diameter-me)/2}_viewBox(){let r=this._circleRadius()*2+this.strokeWidth;return`0 0 ${r} ${r}`}_strokeCircumference(){return 2*Math.PI*this._circleRadius()}_strokeDashOffset(){return this.mode==="determinate"?this._strokeCircumference()*(100-this._value)/100:null}_circleStrokeWidth(){return this.strokeWidth/this.diameter*100}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=$({type:s,selectors:[["mat-progress-spinner"],["mat-spinner"]],viewQuery:function(t,i){if(t&1&&V(ce,5),t&2){let a;q(a=G())&&(i._determinateCircle=a.first)}},hostAttrs:["role","progressbar","tabindex","-1",1,"mat-mdc-progress-spinner","mdc-circular-progress"],hostVars:18,hostBindings:function(t,i){t&2&&(u("aria-valuemin",0)("aria-valuemax",100)("aria-valuenow",i.mode==="determinate"?i.value:null)("mode",i.mode),W("mat-"+i.color),b("width",i.diameter,"px")("height",i.diameter,"px")("--mdc-circular-progress-size",i.diameter+"px")("--mdc-circular-progress-active-indicator-width",i.diameter+"px"),L("_mat-animation-noopable",i._noopAnimations)("mdc-circular-progress--indeterminate",i.mode==="indeterminate"))},inputs:{color:"color",mode:"mode",value:[2,"value","value",P],diameter:[2,"diameter","diameter",P],strokeWidth:[2,"strokeWidth","strokeWidth",P]},exportAs:["matProgressSpinner"],decls:14,vars:11,consts:[["circle",""],["determinateSpinner",""],["aria-hidden","true",1,"mdc-circular-progress__determinate-container"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__determinate-circle-graphic"],["cx","50%","cy","50%",1,"mdc-circular-progress__determinate-circle"],["aria-hidden","true",1,"mdc-circular-progress__indeterminate-container"],[1,"mdc-circular-progress__spinner-layer"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-left"],[3,"ngTemplateOutlet"],[1,"mdc-circular-progress__gap-patch"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-right"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__indeterminate-circle-graphic"],["cx","50%","cy","50%"]],template:function(t,i){if(t&1&&(B(0,le,2,8,"ng-template",null,0,H),p(2,"div",2,1),A(),p(4,"svg",3),E(5,"circle",4),g()(),U(),p(6,"div",5)(7,"div",6)(8,"div",7),y(9,8),g(),p(10,"div",9),y(11,8),g(),p(12,"div",10),y(13,8),g()()()),t&2){let a=z(1);l(4),u("viewBox",i._viewBox()),l(),b("stroke-dasharray",i._strokeCircumference(),"px")("stroke-dashoffset",i._strokeDashOffset(),"px")("stroke-width",i._circleStrokeWidth(),"%"),u("r",i._circleRadius()),l(4),_("ngTemplateOutlet",a),l(2),_("ngTemplateOutlet",a),l(2),_("ngTemplateOutlet",a)}},dependencies:[X],styles:[`.mat-mdc-progress-spinner{display:block;overflow:hidden;line-height:0;position:relative;direction:ltr;transition:opacity 250ms cubic-bezier(0.4, 0, 0.6, 1)}.mat-mdc-progress-spinner circle{stroke-width:var(--mdc-circular-progress-active-indicator-width, 4px)}.mat-mdc-progress-spinner._mat-animation-noopable,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__determinate-circle{transition:none !important}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-circle-graphic,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__spinner-layer,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container{animation:none !important}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container circle{stroke-dasharray:0 !important}@media(forced-colors: active){.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic,.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle{stroke:currentColor;stroke:CanvasText}}.mdc-circular-progress__determinate-container,.mdc-circular-progress__indeterminate-circle-graphic,.mdc-circular-progress__indeterminate-container,.mdc-circular-progress__spinner-layer{position:absolute;width:100%;height:100%}.mdc-circular-progress__determinate-container{transform:rotate(-90deg)}.mdc-circular-progress--indeterminate .mdc-circular-progress__determinate-container{opacity:0}.mdc-circular-progress__indeterminate-container{font-size:0;letter-spacing:0;white-space:nowrap;opacity:0}.mdc-circular-progress--indeterminate .mdc-circular-progress__indeterminate-container{opacity:1;animation:mdc-circular-progress-container-rotate 1568.2352941176ms linear infinite}.mdc-circular-progress__determinate-circle-graphic,.mdc-circular-progress__indeterminate-circle-graphic{fill:rgba(0,0,0,0)}.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:var(--mdc-circular-progress-active-indicator-color, var(--mat-sys-primary))}@media(forced-colors: active){.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}.mdc-circular-progress__determinate-circle{transition:stroke-dashoffset 500ms cubic-bezier(0, 0, 0.2, 1)}.mdc-circular-progress__gap-patch{position:absolute;top:0;left:47.5%;box-sizing:border-box;width:5%;height:100%;overflow:hidden}.mdc-circular-progress__gap-patch .mdc-circular-progress__indeterminate-circle-graphic{left:-900%;width:2000%;transform:rotate(180deg)}.mdc-circular-progress__circle-clipper .mdc-circular-progress__indeterminate-circle-graphic{width:200%}.mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{left:-100%}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-left .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-left-spin 1333ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-right-spin 1333ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress__circle-clipper{display:inline-flex;position:relative;width:50%;height:100%;overflow:hidden}.mdc-circular-progress--indeterminate .mdc-circular-progress__spinner-layer{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}@keyframes mdc-circular-progress-container-rotate{to{transform:rotate(360deg)}}@keyframes mdc-circular-progress-spinner-layer-rotate{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}100%{transform:rotate(1080deg)}}@keyframes mdc-circular-progress-left-spin{from{transform:rotate(265deg)}50%{transform:rotate(130deg)}to{transform:rotate(265deg)}}@keyframes mdc-circular-progress-right-spin{from{transform:rotate(-265deg)}50%{transform:rotate(-130deg)}to{transform:rotate(-265deg)}}
`],encapsulation:2,changeDetection:0})}return s})();var He=(()=>{class s{static \u0275fac=function(t){return new(t||s)};static \u0275mod=F({type:s});static \u0275inj=M({imports:[Q]})}return s})();var Z=class s{http=c(j);configService=c(S);apiUrl=this.configService.apiBaseUrl;createReview(e){return this.http.post(`${this.apiUrl}/reviews`,e)}createReviewAsync(e){return n(this,null,function*(){return(yield o(this.createReview(e))).data})}getBusinessReviews(e){return this.http.get(`${this.apiUrl}/reviews/business/${e}`)}getBusinessReviewsAsync(e){return n(this,null,function*(){try{return(yield o(this.getBusinessReviews(e))).data}catch(r){return console.error("Error fetching business reviews:",{businessId:e,error:r.message,status:r.status,url:r.url}),[]}})}getBusinessRatingStats(e){return this.http.get(`${this.apiUrl}/reviews/business/${e}/stats`)}getBusinessRatingStatsAsync(e){return n(this,null,function*(){return(yield o(this.getBusinessRatingStats(e))).data})}getUserReviews(){return this.http.get(`${this.apiUrl}/reviews/user/reviews`)}getUserReviewsAsync(){return n(this,null,function*(){return(yield o(this.getUserReviews())).data})}getCompletedProjectsForReview(){return this.http.get(`${this.apiUrl}/reviews/user/projects-for-review`)}getCompletedProjectsForReviewAsync(){return n(this,null,function*(){try{console.log("Fetching completed projects for review...");let e=yield o(this.getCompletedProjectsForReview());return console.log("Completed projects response:",e),e.data}catch(e){return console.error("Error fetching completed projects for review:",{error:e.message,status:e.status,url:e.url}),[]}})}canUserReviewProject(e){return this.http.get(`${this.apiUrl}/reviews/project/${e}/can-review`)}canUserReviewProjectAsync(e){return n(this,null,function*(){return(yield o(this.canUserReviewProject(e))).data.can_review})}updateReview(e,r){return this.http.patch(`${this.apiUrl}/reviews/${e}`,r)}updateReviewAsync(e,r){return n(this,null,function*(){return(yield o(this.updateReview(e,r))).data})}deleteReview(e){return this.http.delete(`${this.apiUrl}/reviews/${e}`)}deleteReviewAsync(e){return n(this,null,function*(){yield o(this.deleteReview(e))})}formatRating(e){return e.toFixed(1)}getStarArray(e){let r=[];for(let t=1;t<=5;t++)r.push(t<=Math.round(e));return r}getRatingLabel(e){return e>=4.5?"Excellent":e>=4?"Very Good":e>=3.5?"Good":e>=3?"Fair":e>=2.5?"Poor":"Very Poor"}formatReviewDate(e){if(!e)return"Date not specified";let r=new Date(e),i=new Date().getTime()-r.getTime(),a=Math.floor(i/(1e3*60*60*24));return a===0?"Today":a===1?"Yesterday":a<7?`${a} days ago`:a<30?`${Math.floor(a/7)} weeks ago`:a<365?`${Math.floor(a/30)} months ago`:r.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}static \u0275fac=function(r){return new(r||s)};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};var te="basil",ue=function(e){return e===3?"v3":e},ie="https://js.stripe.com",ge="".concat(ie,"/").concat(te,"/stripe.js"),he=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,fe=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,ee="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",ve=function(e){return he.test(e)||fe.test(e)},we=function(){for(var e=document.querySelectorAll('script[src^="'.concat(ie,'"]')),r=0;r<e.length;r++){var t=e[r];if(ve(t.src))return t}return null},re=function(e){var r=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",t=document.createElement("script");t.src="".concat(ge).concat(r);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(t),t},_e=function(e,r){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"7.7.0",startTime:r})},h=null,R=null,x=null,be=function(e){return function(r){e(new Error("Failed to load Stripe.js",{cause:r}))}},ye=function(e,r){return function(){window.Stripe?e(window.Stripe):r(new Error("Stripe.js not available"))}},Pe=function(e){return h!==null?h:(h=new Promise(function(r,t){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe&&e&&console.warn(ee),window.Stripe){r(window.Stripe);return}try{var i=we();if(i&&e)console.warn(ee);else if(!i)i=re(e);else if(i&&x!==null&&R!==null){var a;i.removeEventListener("load",x),i.removeEventListener("error",R),(a=i.parentNode)===null||a===void 0||a.removeChild(i),i=re(e)}x=ye(r,t),R=be(t),i.addEventListener("load",x),i.addEventListener("error",R)}catch(d){t(d);return}}),h.catch(function(r){return h=null,Promise.reject(r)}))},je=function(e,r,t){if(e===null)return null;var i=r[0],a=i.match(/^pk_test/),d=ue(e.version),v=te;a&&d!==v&&console.warn("Stripe.js@".concat(d," was loaded on the page, but @stripe/stripe-js@").concat("7.7.0"," expected Stripe.js@").concat(v,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var w=e.apply(void 0,r);return _e(w,t),w},f,se=!1,ne=function(){return f||(f=Pe(null).catch(function(e){return f=null,Promise.reject(e)}),f)};Promise.resolve().then(function(){return ne()}).catch(function(s){se||console.warn(s)});var ae=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];se=!0;var i=Date.now();return ne().then(function(a){return je(a,r,i)})};var oe=class s{stripePromise;stripe=null;constructor(){this.stripePromise=ae(J.stripe.publishableKey)}getStripe(){return n(this,null,function*(){return this.stripe||(this.stripe=yield this.stripePromise),this.stripe})}createElement(e){return n(this,null,function*(){let r=yield this.getStripe();if(!r)throw new Error("Stripe failed to load");let t=r.elements({clientSecret:e,appearance:{theme:"stripe",variables:{colorPrimary:"#3b82f6",colorBackground:"#ffffff",colorText:"#1f2937",colorDanger:"#ef4444",fontFamily:'"Inter", "Segoe UI", sans-serif',spacingUnit:"4px",borderRadius:"8px"},rules:{".Tab":{border:"1px solid #e5e7eb",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},".Tab:hover":{color:"#1f2937",backgroundColor:"#f9fafb"},".Tab--selected":{backgroundColor:"#3b82f6",color:"#ffffff"}}}}),i=t.create("payment",{layout:"tabs"});return{elements:t,paymentElement:i}})}confirmPayment(e,r,t){return n(this,null,function*(){let i=yield this.getStripe();if(!i)throw new Error("Stripe failed to load");return yield i.confirmPayment({elements:r,confirmParams:{return_url:t}})})}confirmPaymentWithoutRedirect(e,r){return n(this,null,function*(){let t=yield this.getStripe();if(!t)throw new Error("Stripe failed to load");let{error:i}=yield r.submit();if(i)throw i;return yield t.confirmPayment({elements:r,confirmParams:{},redirect:"if_required"})})}retrievePaymentIntent(e){return n(this,null,function*(){let r=yield this.getStripe();if(!r)throw new Error("Stripe failed to load");return yield r.retrievePaymentIntent(e)})}static \u0275fac=function(r){return new(r||s)};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};export{K as a,Ue as b,ze as c,He as d,oe as e,Z as f};
