import{a as ee,b as te}from"./chunk-I5NYEOQ7.js";import{h as U,l as X,m as Y}from"./chunk-RXAK7GQU.js";import{d as H,e as J,h as K,k as Q}from"./chunk-SQHEFKI2.js";import"./chunk-7RWCIHFI.js";import"./chunk-VRCQRP53.js";import{B as W,c as q,e as f,h as z,i as O,l as A,p as D,r as G,z as j}from"./chunk-MOPYAMLF.js";import"./chunk-RNGT6N3O.js";import"./chunk-TOWFRAUA.js";import{a as Z,b as $}from"./chunk-ZH2LY4H3.js";import"./chunk-QVSCKNGL.js";import"./chunk-FX5J5MOS.js";import{b as I,c as T,d as V,e as R}from"./chunk-SUTJIGUH.js";import{a as N}from"./chunk-VJC62ZZJ.js";import"./chunk-WZKZJ5DF.js";import{p as F,q as B}from"./chunk-A72LFUZP.js";import"./chunk-IGUJQH2A.js";import"./chunk-GS6LNAK5.js";import"./chunk-QD7SSFII.js";import{a as E,c as M,d as L}from"./chunk-MEFNJ5SS.js";import"./chunk-GUCRBWY4.js";import{t as P}from"./chunk-REOVWAHI.js";import{Ab as x,Bb as s,Ea as p,Gb as d,Lb as n,Mb as l,Nb as g,Rb as S,Vb as h,Wb as u,cb as a,fa as c,gc as r,hc as k,na as y,oa as _,ob as w,qc as b,ub as m}from"./chunk-BEPULU6C.js";import{e as v}from"./chunk-JKOY2XUY.js";var oe=()=>["/auth/forgot-password"],ne=()=>["/auth/signup"];function re(i,e){i&1&&r(0," Email is required ")}function ae(i,e){i&1&&r(0," Invalid email format ")}function le(i,e){if(i&1&&(n(0,"mat-error"),m(1,re,1,0)(2,ae,1,0),l()),i&2){let o=u();a(),d(o.emailControl!=null&&o.emailControl.hasError("required")?1:o.emailControl!=null&&o.emailControl.hasError("email")?2:-1)}}function se(i,e){i&1&&r(0," Password is required ")}function me(i,e){i&1&&r(0," Minimum 6 characters ")}function de(i,e){if(i&1&&(n(0,"mat-error"),m(1,se,1,0)(2,me,1,0),l()),i&2){let o=u();a(),d(o.passwordControl!=null&&o.passwordControl.hasError("required")?1:o.passwordControl!=null&&o.passwordControl.hasError("minlength")?2:-1)}}function ce(i,e){if(i&1){let o=S();n(0,"div",10)(1,"button",18),h("click",function(){y(o);let C=u();return _(C.resendVerification())}),r(2," Resend Verification Email "),l()()}if(i&2){let o=u();a(),s("disabled",o.loading())}}function pe(i,e){i&1&&r(0," Sign In ")}function ue(i,e){i&1&&(n(0,"span",12),g(1,"mat-spinner",19),r(2," Signing In... "),l())}var ie=class i{authService=c(N);router=c(M);route=c(E);fb=c(j);snackBar=c(ee);loading=p(!1);showPassword=p(!1);showResendOption=p(!1);unverifiedEmail=p("");loginForm;constructor(){this.loginForm=this.fb.group({email:["",[f.required,f.email]],password:["",[f.required,f.minLength(6)]]})}ngOnInit(){this.route.queryParams.subscribe(e=>{e.message&&this.snackBar.open(e.message,"Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-info"]}),e.email&&this.loginForm.patchValue({email:e.email})})}onSubmit(){return v(this,null,function*(){if(!this.loginForm.valid){this.snackBar.open("Please fill in all required fields correctly","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]});return}let{email:e,password:o}=this.loginForm.value;this.loading.set(!0);try{let t=yield this.authService.signIn(e,o);t.data?(this.snackBar.open("Login successful! Redirecting...","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-success"]}),setTimeout(()=>{this.router.navigate(["/dashboard"])},1e3)):this.handleLoginError(t.error?.message||"Login failed. Please try again.")}catch(t){this.handleLoginError(t?.message||"An unexpected error occurred. Please try again.")}finally{this.loading.set(!1)}})}handleLoginError(e){if(e.includes("verify your email")||e.includes("email address before logging")){this.snackBar.open(e+" Click below to resend verification email.","Close",{duration:8e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]});let o=this.loginForm.get("email")?.value;o&&(this.unverifiedEmail.set(o),this.showResendOption.set(!0))}else this.snackBar.open(e,"Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}resendVerification(){return v(this,null,function*(){if(this.unverifiedEmail()){this.loading.set(!0);try{let e=yield this.authService.resendEmailVerification(this.unverifiedEmail());e.success?(this.snackBar.open("Verification email sent! Please check your inbox.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-success"]}),this.showResendOption.set(!1)):this.snackBar.open(e.message||"Failed to resend verification email.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}catch(e){this.snackBar.open(e?.message||"Failed to resend verification email.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.loading.set(!1)}}})}togglePasswordVisibility(){this.showPassword.update(e=>!e)}get emailControl(){return this.loginForm.get("email")}get passwordControl(){return this.loginForm.get("password")}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=w({type:i,selectors:[["app-login"]],decls:34,vars:16,consts:[[1,"login-container"],[1,"text-center","mb-8"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"space-y-6",3,"ngSubmit","formGroup"],["appearance","outline",1,"w-full"],["matInput","","type","email","formControlName","email","placeholder","your@email.com",3,"disabled"],["matSuffix",""],["matInput","","formControlName","password","placeholder","Enter password",3,"type","disabled"],["mat-icon-button","","matSuffix","","type","button",3,"click"],[1,"mb-4"],["mat-raised-button","","color","primary","type","submit",1,"w-full","py-3","text-base","font-medium","mb-4",3,"disabled"],[1,"flex","items-center","justify-center","gap-2"],[1,"space-y-3","text-center"],["mat-button","","color","primary",1,"text-sm",3,"routerLink"],[1,"mt-4","pt-4","border-t","border-gray-200"],[1,"text-sm","text-gray-600"],["mat-button","","color","primary",1,"text-sm","font-medium","ml-1",3,"routerLink"],["mat-stroked-button","","color","primary",1,"w-full",3,"click","disabled"],["diameter","16"]],template:function(o,t){o&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),r(3,"Welcome Back"),l(),n(4,"p",3),r(5,"Sign in to your account"),l()(),n(6,"form",4),h("ngSubmit",function(){return t.onSubmit()}),n(7,"mat-form-field",5)(8,"mat-label"),r(9,"Email Address"),l(),g(10,"input",6),n(11,"mat-icon",7),r(12,"email"),l(),m(13,le,3,1,"mat-error"),l(),n(14,"mat-form-field",5)(15,"mat-label"),r(16,"Password"),l(),g(17,"input",8),n(18,"button",9),h("click",function(){return t.togglePasswordVisibility()}),n(19,"mat-icon"),r(20),l()(),m(21,de,3,1,"mat-error"),l(),m(22,ce,3,1,"div",10),n(23,"button",11),m(24,pe,1,0)(25,ue,3,0,"span",12),l(),n(26,"div",13)(27,"a",14),r(28," Forgot your password? "),l(),n(29,"div",15)(30,"p",16),r(31," Don't have an account? "),n(32,"a",17),r(33," Sign up "),l()()()()()()),o&2&&(a(6),s("formGroup",t.loginForm),a(4),s("disabled",t.loading()),a(3),d(t.emailControl!=null&&t.emailControl.invalid&&(t.emailControl!=null&&t.emailControl.touched)?13:-1),a(4),s("type",t.showPassword()?"text":"password")("disabled",t.loading()),a(),x("aria-label","Toggle password visibility")("aria-pressed",t.showPassword()),a(2),k(t.showPassword()?"visibility_off":"visibility"),a(),d(t.passwordControl!=null&&t.passwordControl.invalid&&(t.passwordControl!=null&&t.passwordControl.touched)?21:-1),a(),d(t.showResendOption()?22:-1),a(),s("disabled",t.loading()||!t.loginForm.valid),a(),d(t.loading()?25:24),a(3),s("routerLink",b(14,oe)),a(5),s("routerLink",b(15,ne)))},dependencies:[P,W,A,q,z,O,D,G,L,U,Q,H,J,K,Y,X,R,V,T,I,B,F,$,Z,te],styles:["[_nghost-%COMP%]{display:block}"]})};export{ie as LoginComponent};
