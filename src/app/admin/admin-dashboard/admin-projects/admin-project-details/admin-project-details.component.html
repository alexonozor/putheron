<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
  <div class="p-6 max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <button 
            (click)="goBack()"
            class="p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors">
            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
          </button>
          <div>
            <h1 class="text-3xl font-bold bg-gradient-to-r from-slate-900 to-slate-700 bg-clip-text text-transparent">
              Project Details
            </h1>
            @if (project()) {
              <p class="text-slate-600 mt-2">Managing "{{ project()!.title }}"</p>
            }
          </div>
        </div>
        @if (project()) {
          <div class="flex items-center gap-3">
            @if (!isEditing()) {
              <button 
                (click)="isEditing.set(true)"
                class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200">
                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                Edit Project
              </button>
            }
          </div>
        }
      </div>
    </div>

    <!-- Loading State -->
    @if (loading()) {
      <div class="flex items-center justify-center py-12">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <span class="ml-3 text-gray-600">Loading project details...</span>
      </div>
    }

    <!-- Error Message -->
    @if (error()) {
      <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-6">
        <div class="flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
          </svg>
          {{ error() }}
        </div>
      </div>
    }

    @if (project() && !loading()) {
      <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
        <!-- Main Content -->
        <div class="xl:col-span-2 space-y-8">
          <!-- Project Information Card -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            <!-- Header with Status -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-8 py-6 relative">
              <div class="absolute top-6 right-6">
                <span [class]="'inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-white bg-opacity-20 text-white border border-white border-opacity-30'">
                  {{ getStatusLabel(project()!.status) }}
                </span>
              </div>
              <h2 class="text-2xl font-bold text-white pr-32">{{ project()!.title }}</h2>
              @if (project()!.description) {
                <p class="text-blue-100 mt-2 text-lg">{{ project()!.description }}</p>
              }
            </div>

            <!-- Project Details -->
            <div class="p-8">
              @if (!isEditing()) {
                <!-- View Mode -->
                <div class="space-y-8">
                  <!-- Basic Information -->
                  <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Project Information</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <label class="block text-sm font-medium text-gray-500 mb-1">Project Value</label>
                        <p class="text-3xl font-bold text-gray-900">{{ formatCurrency(projectValue()) }}</p>
                        @if (project()!.additional_payments_total && project()!.additional_payments_total! > 0) {
                          <p class="text-sm text-gray-600">Base: {{ formatCurrency(project()!.offered_price) }} + Additional: {{ formatCurrency(project()!.additional_payments_total!) }}</p>
                        }
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-500 mb-1">Payment Status</label>
                        <p [class]="'text-lg font-semibold ' + getPaymentStatus(project()!).color">
                          {{ getPaymentStatus(project()!).text }}
                        </p>
                      </div>
                      @if (project()!.deadline) {
                        <div>
                          <label class="block text-sm font-medium text-gray-500 mb-1">Deadline</label>
                          <p [class]="'text-lg font-semibold ' + getDeadlineStatus().color">
                            {{ getDeadlineStatus().text }}
                          </p>
                          <p class="text-sm text-gray-600">{{ formatDate(project()!.deadline) }}</p>
                        </div>
                      }
                      @if (projectDuration()) {
                        <div>
                          <label class="block text-sm font-medium text-gray-500 mb-1">Duration</label>
                          <p class="text-lg font-semibold text-gray-900">{{ projectDuration() }} days</p>
                        </div>
                      }
                    </div>
                  </div>

                  <!-- Client & Business Information -->
                  <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Participants</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                        <h4 class="text-lg font-semibold text-blue-900 mb-3">Client</h4>
                        <div class="space-y-2">
                          <p class="text-blue-800 font-medium">{{ getClientName(project()!) }}</p>
                          @if (getClientEmail(project()!)) {
                            <p class="text-blue-600 text-sm">{{ getClientEmail(project()!) }}</p>
                          }
                        </div>
                      </div>
                      <div class="bg-purple-50 border border-purple-200 rounded-xl p-6">
                        <h4 class="text-lg font-semibold text-purple-900 mb-3">Business</h4>
                        <div class="space-y-2">
                          <p class="text-purple-800 font-medium">{{ getBusinessName(project()!) }}</p>
                          <p class="text-purple-600 text-sm">Owner: {{ getBusinessOwnerName(project()!) }}</p>
                          @if (getBusinessOwnerEmail(project()!)) {
                            <p class="text-purple-600 text-sm">{{ getBusinessOwnerEmail(project()!) }}</p>
                          }
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Services -->
                  @if (getServicesDetails(project()!).length > 0) {
                    <div>
                      <h3 class="text-lg font-semibold text-gray-900 mb-4">Selected Services</h3>
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        @for (service of getServicesDetails(project()!); track service._id) {
                          <div class="bg-green-50 border border-green-200 rounded-xl p-4">
                            <h4 class="font-semibold text-green-900">{{ service.name }}</h4>
                            @if (service.description) {
                              <p class="text-green-700 text-sm mt-1">{{ service.description }}</p>
                            }
                            @if (service.price) {
                              <p class="text-green-800 font-semibold mt-2">{{ formatCurrency(service.price) }}</p>
                            }
                          </div>
                        }
                      </div>
                    </div>
                  }

                  <!-- Additional Notes -->
                  @if (project()!.additional_notes) {
                    <div>
                      <h3 class="text-lg font-semibold text-gray-900 mb-4">Additional Notes</h3>
                      <div class="bg-gray-50 border border-gray-200 rounded-xl p-6">
                        <p class="text-gray-700 whitespace-pre-wrap">{{ project()!.additional_notes }}</p>
                      </div>
                    </div>
                  }

                  <!-- Rejection Reason -->
                  @if (project()!.rejection_reason) {
                    <div>
                      <h3 class="text-lg font-semibold text-gray-900 mb-4">Rejection Reason</h3>
                      <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                        <p class="text-red-700">{{ project()!.rejection_reason }}</p>
                      </div>
                    </div>
                  }

                  <!-- Admin Notes -->
                  @if (project()!.admin_notes) {
                    <div>
                      <h3 class="text-lg font-semibold text-gray-900 mb-4">Admin Notes</h3>
                      <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6">
                        <p class="text-yellow-800 whitespace-pre-wrap">{{ project()!.admin_notes }}</p>
                      </div>
                    </div>
                  }

                  <!-- Selected Services -->
                  @if (project()!.selected_services && project()!.selected_services.length > 0) {
                    <div>
                      <h3 class="text-lg font-semibold text-gray-900 mb-4">Selected Services</h3>
                      <div class="grid grid-cols-1 gap-4">
                        @for (service of getServices(); track $index) {
                          <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                            <div class="flex items-start justify-between">
                              <div class="flex-1">
                                <h4 class="text-sm font-semibold text-blue-900">{{ getServiceName(service) }}</h4>
                                @if (getServiceDescription(service)) {
                                  <p class="text-sm text-blue-700 mt-1">{{ getServiceDescription(service) }}</p>
                                }
                                @if (getServiceFeatures(service) && getServiceFeatures(service).length > 0) {
                                  <div class="mt-2">
                                    <p class="text-xs text-blue-600 mb-1">Features included:</p>
                                    <div class="flex flex-wrap gap-1">
                                      @for (feature of getServiceFeatures(service); track feature) {
                                        <span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
                                          {{ feature }}
                                        </span>
                                      }
                                    </div>
                                  </div>
                                }
                              </div>
                              @if (getServicePrice(service)) {
                                <div class="ml-4 text-right">
                                  @if (getServicePrice(service) !== null) {
                                    <p class="text-sm font-semibold text-blue-900">{{ formatCurrency(getServicePrice(service)!) }}</p>
                                  }
                                  @if (getServicePricingType(service)) {
                                    <p class="text-xs text-blue-600">{{ getServicePricingType(service) }}</p>
                                  }
                                  @if (getServiceDuration(service)) {
                                    <p class="text-xs text-blue-600">{{ getServiceDuration(service) }}</p>
                                  }
                                </div>
                              }
                            </div>
                          </div>
                        }
                      </div>
                    </div>
                  }

                  <!-- Project Attachments -->
                  @if (project()?.attachments?.length) {
                    <div>
                      <h3 class="text-lg font-semibold text-gray-900 mb-4">Project Attachments</h3>
                      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        @for (attachment of project()!.attachments; track attachment.public_id) {
                          <div class="bg-gray-50 border border-gray-200 rounded-xl p-4 hover:border-gray-300 transition-colors">
                            <div class="flex items-start justify-between mb-3">
                              <div class="flex items-center gap-2">
                                @if (isImageFile(attachment.type)) {
                                  <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                    <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                  </div>
                                } @else if (isPdfFile(attachment.type)) {
                                  <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">
                                    <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                  </div>
                                } @else {
                                  <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                  </div>
                                }
                                <div class="flex-1 min-w-0">
                                  <p class="text-sm font-medium text-gray-900 truncate">{{ attachment.name }}</p>
                                  <p class="text-xs text-gray-500">{{ formatFileSize(attachment.size) }}</p>
                                </div>
                              </div>
                            </div>
                            
                            @if (isImageFile(attachment.type)) {
                              <div class="mb-3">
                                <img 
                                  [src]="attachment.url" 
                                  [alt]="attachment.name"
                                  class="w-full h-32 object-cover rounded-lg border border-gray-200"
                                  (click)="openImageModal(attachment.url, attachment.name)">
                              </div>
                            }
                            
                            <div class="flex items-center justify-between">
                              <span class="text-xs text-gray-500">{{ attachment.type }}</span>
                              <div class="flex gap-2">
                                <button 
                                  (click)="viewAttachment(attachment.url)"
                                  class="p-1 text-gray-400 hover:text-blue-600 transition-colors"
                                  title="View">
                                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                  </svg>
                                </button>
                                <button 
                                  (click)="downloadAttachment(attachment.url, attachment.name)"
                                  class="p-1 text-gray-400 hover:text-green-600 transition-colors"
                                  title="Download">
                                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                  </svg>
                                </button>
                              </div>
                            </div>
                          </div>
                        }
                      </div>
                    </div>
                  }
                </div>
              } @else {
                <!-- Edit Mode -->
                <form [formGroup]="projectForm" (ngSubmit)="saveProject()">
                  <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <label for="status" class="block text-sm font-medium text-gray-700 mb-2">Status *</label>
                        <select 
                          id="status"
                          formControlName="status"
                          (change)="onStatusChange()"
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                          <option value="pending">Pending</option>
                          <option value="accepted">Accepted</option>
                          <option value="rejected">Rejected</option>
                          <option value="in_progress">In Progress</option>
                          <option value="awaiting_client_approval">Awaiting Client Approval</option>
                          <option value="completed">Completed</option>
                          <option value="cancelled">Cancelled</option>
                          <option value="settled">Settled</option>
                        </select>
                        @if (getFieldError('status')) {
                          <p class="mt-1 text-sm text-red-600">{{ getFieldError('status') }}</p>
                        }
                      </div>
                      <div>
                        <label for="offered_price" class="block text-sm font-medium text-gray-700 mb-2">Project Value ($) *</label>
                        <input 
                          type="number" 
                          id="offered_price"
                          formControlName="offered_price"
                          min="0"
                          step="0.01"
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                          placeholder="0.00">
                        @if (getFieldError('offered_price')) {
                          <p class="mt-1 text-sm text-red-600">{{ getFieldError('offered_price') }}</p>
                        }
                      </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <label for="deadline" class="block text-sm font-medium text-gray-700 mb-2">Deadline</label>
                        <input 
                          type="date" 
                          id="deadline"
                          formControlName="deadline"
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Archive Status</label>
                        <div class="flex items-center">
                          <input 
                            type="checkbox"
                            id="is_archived"
                            formControlName="is_archived"
                            class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                          <label for="is_archived" class="ml-3 text-sm text-gray-700">Archive this project</label>
                        </div>
                      </div>
                    </div>

                    @if (projectForm.get('status')?.value === 'rejected') {
                      <div>
                        <label for="rejection_reason" class="block text-sm font-medium text-gray-700 mb-2">Rejection Reason *</label>
                        <textarea 
                          id="rejection_reason"
                          formControlName="rejection_reason"
                          rows="3"
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                          placeholder="Please provide a reason for rejection..."></textarea>
                        @if (getFieldError('rejection_reason')) {
                          <p class="mt-1 text-sm text-red-600">{{ getFieldError('rejection_reason') }}</p>
                        }
                      </div>
                    }

                    <div>
                      <label for="admin_notes" class="block text-sm font-medium text-gray-700 mb-2">Admin Notes</label>
                      <textarea 
                        id="admin_notes"
                        formControlName="admin_notes"
                        rows="4"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                        placeholder="Internal notes for admin reference..."></textarea>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex items-center justify-end gap-4 pt-6 border-t border-gray-200">
                      <button 
                        type="button"
                        (click)="cancelEdit()"
                        class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                        Cancel
                      </button>
                      <button 
                        type="submit"
                        [disabled]="projectForm.invalid || loading()"
                        class="px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:shadow-lg transition-all duration-200 font-semibold disabled:opacity-50 disabled:cursor-not-allowed">
                        @if (loading()) {
                          <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white inline-block mr-2"></div>
                        }
                        Save Changes
                      </button>
                    </div>
                  </div>
                </form>
              }
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
          <!-- Quick Stats -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Project Summary</h3>
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <span class="text-gray-600">Created</span>
                <span class="text-sm font-medium text-gray-900">{{ formatDate(project()!.createdAt) }}</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-600">Last Updated</span>
                <span class="text-sm font-medium text-gray-900">{{ formatDate(project()!.updatedAt) }}</span>
              </div>
              @if (project()!.accepted_at) {
                <div class="flex items-center justify-between">
                  <span class="text-gray-600">Accepted</span>
                  <span class="text-sm font-medium text-gray-900">{{ formatDate(project()!.accepted_at) }}</span>
                </div>
              }
              @if (project()!.completed_at) {
                <div class="flex items-center justify-between">
                  <span class="text-gray-600">Completed</span>
                  <span class="text-sm font-medium text-gray-900">{{ formatDate(project()!.completed_at) }}</span>
                </div>
              }
              <div class="flex items-center justify-between">
                <span class="text-gray-600">Services</span>
                <span class="text-sm font-medium text-gray-900">{{ getServicesCount(project()!) }}</span>
              </div>
              @if (project()!.is_archived) {
                <div class="flex items-center justify-between">
                  <span class="text-gray-600">Status</span>
                  <span class="text-sm font-medium text-orange-600">Archived</span>
                </div>
              }
            </div>
          </div>

          <!-- Actions Card -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Actions</h3>
            <div class="space-y-3">
              <button 
                (click)="toggleArchiveStatus()"
                [class]="project()!.is_archived ? 'w-full px-4 py-3 bg-green-50 text-green-700 border border-green-200 rounded-lg hover:bg-green-100 transition-colors text-left' : 'w-full px-4 py-3 bg-orange-50 text-orange-700 border border-orange-200 rounded-lg hover:bg-orange-100 transition-colors text-left'">
                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
                </svg>
                {{ project()!.is_archived ? 'Restore Project' : 'Archive Project' }}
              </button>
              
              <button 
                (click)="deleteProject()"
                class="w-full px-4 py-3 bg-red-50 text-red-700 border border-red-200 rounded-lg hover:bg-red-100 transition-colors text-left">
                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Delete Project
              </button>
            </div>
          </div>

          <!-- Activity Timeline -->
          @if (projectActivity() && projectActivity().length > 0) {
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-6">Project Activity Timeline</h3>
              <div class="space-y-6">
                @for (activity of projectActivity() || []; track activity.id) {
                  <div class="flex items-start gap-4">
                    <!-- Activity Icon -->
                    <div class="flex-shrink-0">
                      @switch (activity.type) {
                        @case ('created') {
                          <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                          </div>
                        }
                        @case ('payment') {
                          <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                          </div>
                        }
                        @case ('status_change') {
                          <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                          </div>
                        }
                        @case ('approval') {
                          <div class="w-8 h-8 bg-emerald-100 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                          </div>
                        }
                        @case ('settlement') {
                          <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                          </div>
                        }
                        @case ('additional_payment') {
                          <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12s-1.536-.219-2.121-.659c-1.172-.879-1.172-2.303 0-3.182C10.464 7.69 11.232 7.471 12 7.471s1.536.219 2.121.659"></path>
                            </svg>
                          </div>
                        }
                        @default {
                          <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                          </div>
                        }
                      }
                    </div>
                    
                    <!-- Activity Details -->
                    <div class="flex-1 min-w-0">
                      <div class="flex items-center justify-between">
                        <h4 class="text-sm font-medium text-gray-900">{{ activity.title }}</h4>
                        <time class="text-xs text-gray-500">{{ formatDate(activity.timestamp) }}</time>
                      </div>
                      <p class="text-sm text-gray-600 mt-1">{{ activity.description }}</p>
                      @if (activity.user) {
                        <p class="text-xs text-gray-400 mt-1">
                          by {{ activity.user.first_name }} {{ activity.user.last_name }}
                        </p>
                      } @else if (activity.user === null && activity.type === 'settlement') {
                        <p class="text-xs text-gray-400 mt-1">System Action</p>
                      }
                    </div>
                    
                    <!-- Activity Status -->
                    <div class="flex-shrink-0">
                      @switch (activity.status) {
                        @case ('completed') {
                          <span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">
                            Completed
                          </span>
                        }
                        @case ('pending') {
                          <span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">
                            Pending
                          </span>
                        }
                        @case ('rejected') {
                          <span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded-full">
                            Rejected
                          </span>
                        }
                        @default {
                          <span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full">
                            {{ activity.status }}
                          </span>
                        }
                      }
                    </div>
                  </div>
                }
              </div>
            </div>
          } @else {
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">Project Activity Timeline</h3>
              <div class="text-center py-8">
                <svg class="w-12 h-12 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <p class="text-gray-500">No activity recorded yet</p>
              </div>
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>
