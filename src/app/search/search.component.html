<app-header [drawer]="drawer" [maxWidth]="'max-w-7xl'" />
<mat-drawer-container class="content-body" [hasBackdrop]="true" autosize>
  <mat-drawer #drawer [mode]="'over'" class="drawer">
    @if (currentUser()) {
    <app-user-sidenav />
    } @else {
    <app-guest-sidenav />
    }
  </mat-drawer>
  <mat-drawer-content class="bg-[#F4F2EE]!" #drawerContent>
    <div class="min-h-screen bg-[#F4F2EE]">
  <!-- Filters Section - Desktop Only (Below Header) -->
  <div class="hidden lg:block">
    <app-search-filters
      [countries]="countries"
      [totalResults]="total()"
      [initialSearchQuery]="searchQuery()"
      [initialCategories]="selectedCategories()"
      [initialBusinessType]="selectedBusinessTypes()[0] || ''"
      [initialCountries]="selectedCountries()"
      [initialRating]="selectedRating()"
      [initialSortBy]="selectedSortBy()"
      (filtersChange)="onFiltersChange($event)">
    </app-search-filters>
  </div>

  <!-- Search Section - Mobile Only -->
  <div class="lg:hidden">
    <app-search-filters
      [countries]="countries"
      [showSearchInput]="true"
      [totalResults]="total()"
      [initialSearchQuery]="searchQuery()"
      [initialCategories]="selectedCategories()"
      [initialBusinessType]="selectedBusinessTypes()[0] || ''"
      [initialCountries]="selectedCountries()"
      [initialRating]="selectedRating()"
      [initialSortBy]="selectedSortBy()"
      (filtersChange)="onFiltersChange($event)">
    </app-search-filters>
  </div>

  <!-- Results Section -->
  <!-- Mobile: header(64px) + py-4(32px) + search(40px) + mt-3(12px) + buttons(48px) + offset(16px) = 212px -->
  <!-- Desktop: header(64px) + py-4(32px) + filters(40px) + results(20px) + offset(16px) = 172px -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-[212px] lg:pt-[172px]">
    
    <!-- Loading State -->
    @if (loading()) {
      <div class="flex justify-center items-center py-12">
        <mat-spinner diameter="50"></mat-spinner>
        <span class="ml-4 text-gray-600">Finding services...</span>
      </div>
    }

    <!-- Error State -->
    @if (error()) {
      <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
        <div class="flex items-center">
          <mat-icon class="text-red-500 mr-2">error</mat-icon>
          <span class="text-red-700">{{ error() }}</span>
        </div>
      </div>
    }

    <!-- No Results -->
    @if (!loading() && hasSearched() && !hasResults()) {
      <div class="text-center py-12">
        <mat-icon class="text-6xl text-gray-400 mb-4">search_off</mat-icon>
        <h3 class="text-lg font-medium text-gray-900 mb-2">No services found</h3>
        <p class="text-gray-600 mb-4">Try adjusting your search terms or filters</p>
        <button mat-raised-button 
                color="primary"
                (click)="clearFilters()">
          Clear filters
        </button>
      </div>
    }

    <!-- Results Grid -->
    @if (!loading() && hasResults()) {
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
        @for (business of businesses(); track business._id) {
          <app-business-card
            [business]="business"
            [ownerName]="getOwnerName(business)"
            [ownerAvatar]="getOwnerAvatar(business)"
            [ownerCountry]="getOwnerCountry(business)"
            [categoryName]="getCategoryName(business)"
            (businessClick)="onBusinessClick($event)">
          </app-business-card>
        }
      </div>

      <!-- Pagination -->
      @if (totalPages() > 1) {
        <div class="flex justify-left">
          <mat-paginator 
            [length]="total()"
            [pageSize]="12"
            [pageIndex]="currentPage() - 1"
            [pageSizeOptions]="[12, 24, 48]"
            (page)="onPageChange($event.pageIndex + 1)"
            showFirstLastButtons>
          </mat-paginator>
        </div>
      }
    }
  </div>

  <!-- Footer -->
  <footer-component />
</div>
  </mat-drawer-content>
  
</mat-drawer-container>


