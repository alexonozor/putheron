<div class="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
      <div class="flex items-center space-x-4">
        <button 
          mat-icon-button 
          (click)="goBack()"
          class="flex items-center justify-center w-10 h-10 rounded-full bg-white shadow-sm border border-gray-200 hover:bg-gray-50 transition-colors">
          <mat-icon class="text-gray-600">arrow_back</mat-icon>
        </button>
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Project Details</h1>
          <p class="text-gray-600 mt-1">View complete project information</p>
        </div>
      </div>
      
      <!-- Action Buttons in Header -->
      <div class="flex items-center space-x-3">
        <!-- Chat Button -->
     
        
        <!-- Business Owner Actions -->
        @if (project() && isBusinessOwner()) {
          <!-- Chat Button - Always Available for Business Owner -->
          @if (['requested', 'under_review', 'accepted', 'started', 'payment_requested', 'payment_completed', 'in_progress'].includes(project()!.status)) {
            <button 
              (click)="navigateToChat()"
              class="flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
              <mat-icon class="mr-2 w-5 h-5">chat</mat-icon>
              Chat with Client
              @if (chatUnreadCount() > 0) {
                <span class="ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] h-5 flex items-center justify-center">
                  {{ chatUnreadCount() }}
                </span>
              }
            </button>
          }

          <!-- Status-Specific Actions -->
          @switch (project()!.status) {
            @case ('requested') {
              <button 
                (click)="acceptProject()"
                class="flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
                <mat-icon class="mr-2 w-5 h-5">check_circle</mat-icon>
                Accept Project
              </button>
              
              <button 
                (click)="rejectProject()"
                class="flex items-center px-6 py-3 bg-red-600 hover:bg-red-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
                <mat-icon class="mr-2 w-5 h-5">cancel</mat-icon>
                Reject Project
              </button>
            }
            
            @case ('under_review') {
              <button 
                (click)="acceptProject()"
                class="flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
                <mat-icon class="mr-2 w-5 h-5">check_circle</mat-icon>
                Accept Project
              </button>
              
              <button 
                (click)="rejectProject()"
                class="flex items-center px-6 py-3 bg-red-600 hover:bg-red-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
                <mat-icon class="mr-2 w-5 h-5">cancel</mat-icon>
                Reject Project
              </button>
            }
            
            @case ('accepted') {
              <button 
                (click)="startProject()"
                class="flex items-center px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
                <mat-icon class="mr-2 w-5 h-5">play_arrow</mat-icon>
                Start Project & Request Payment
              </button>
            }
            
            @case ('started') {
              <button 
                (click)="markInProgress()"
                class="flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
                <mat-icon class="mr-2 w-5 h-5">work</mat-icon>
                Mark In Progress
              </button>
            }
            
            @case ('payment_requested') {
              <button 
                (click)="markInProgress()"
                class="flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
                <mat-icon class="mr-2 w-5 h-5">work</mat-icon>
                Mark In Progress
              </button>
            }
            
            @case ('payment_completed') {
              <button 
                (click)="markInProgress()"
                class="flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
                <mat-icon class="mr-2 w-5 h-5">work</mat-icon>
                Mark In Progress
              </button>
            }
            
            @case ('in_progress') {
              <button 
                (click)="requestAdditionalPayment()"
                class="flex items-center px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
                <mat-icon class="mr-2 w-5 h-5">payment</mat-icon>
                Request Additional Payment
              </button>

              <button 
                (click)="requestCompletion()"
                class="flex items-center px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
                <mat-icon class="mr-2 w-5 h-5">check_circle</mat-icon>
                Request Completion
              </button>
            }
          }
        }
      </div>

      <!-- Client Actions -->
      @if (project() && isClient() && ['requested', 'under_review', 'accepted', 'started', 'payment_requested', 'payment_completed', 'in_progress'].includes(project()!.status)) {
        <div class="p-6 bg-gray-50 border-b border-gray-200">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Client Actions</h3>
          <div class="flex flex-wrap gap-3">
            <button 
              (click)="navigateToChat()"
              class="flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
              <mat-icon class="mr-2 w-5 h-5">chat</mat-icon>
              @if (project()!.status === 'requested' || project()!.status === 'under_review') {
                Chat with Business
              } @else {
                Chat with Business Owner
              }
              @if (chatUnreadCount() > 0) {
                <span class="ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] h-5 flex items-center justify-center">
                  {{ chatUnreadCount() }}
                </span>
              }
            </button>
          </div>
        </div>
      }

      <!-- Completion Approval Actions for Client -->
      @if (project() && canApproveCompletion()) {
        <div class="p-6 bg-orange-50 border-b border-orange-200">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Project Completion Review</h3>
          <p class="text-gray-700 mb-4">The business owner has marked this project as completed. Please review the work and approve or reject the completion.</p>
          <div class="flex flex-wrap gap-3">
            <button 
              (click)="approveCompletion()"
              class="flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
              <mat-icon class="mr-2 w-5 h-5">check_circle</mat-icon>
              Approve Completion
            </button>
            
            <button 
              (click)="rejectCompletion()"
              class="flex items-center px-6 py-3 bg-red-600 hover:bg-red-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
              <mat-icon class="mr-2 w-5 h-5">cancel</mat-icon>
              Request Changes
            </button>
            
            <button 
              (click)="navigateToChat()"
              class="flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
              <mat-icon class="mr-2 w-5 h-5">chat</mat-icon>
              Discuss with Business Owner
              @if (chatUnreadCount() > 0) {
                <span class="ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] h-5 flex items-center justify-center">
                  {{ chatUnreadCount() }}
                </span>
              }
            </button>
          </div>
        </div>
      }

      <!-- Review Section for Completed Projects -->
    
      
      @if (project() && isClient() && showReviewButton()) {
        <div class="p-6 bg-yellow-50 border-b border-yellow-200">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Project Review</h3>
          @if (existingReview()) {
            <p class="text-gray-700 mb-4">You have already reviewed this project. Click below to view your review.</p>
          } @else {
            <p class="text-gray-700 mb-4">Share your experience with this business to help other clients make informed decisions.</p>
          }
          <div class="flex flex-wrap gap-3">
            <button 
              (click)="handleReviewAction()"
              class="flex items-center px-6 py-3 bg-yellow-600 hover:bg-yellow-700 text-white text-base font-semibold rounded-lg transition-colors shadow-sm">
              <mat-icon class="mr-2 w-5 h-5">{{ existingReview() ? 'visibility' : 'star' }}</mat-icon>
              {{ reviewButtonText() }}
            </button>
          </div>
        </div>
      }
    </div>

    <!-- Error Display -->
    @if (error()) {
      <div class="mb-8 bg-red-50 border-l-4 border-red-400 p-6 rounded-r-lg shadow-sm">
        <div class="flex items-start">
          <div class="flex-shrink-0">
            <mat-icon class="text-red-400 w-6 h-6">error</mat-icon>
          </div>
          <div class="ml-3">
            <h3 class="text-lg font-medium text-red-800">Error</h3>
            <p class="mt-2 text-red-700">{{ error() }}</p>
          </div>
        </div>
      </div>
    }

    <!-- Loading State -->
    @if (loading()) {
      <div class="flex flex-col items-center justify-center py-20">
        <mat-spinner diameter="48"></mat-spinner>
        <p class="mt-4 text-lg text-gray-600">Loading project details...</p>
      </div>
    } @else if (project()) {
      <!-- Project Content -->
      <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
        <!-- Main Content -->
        <div class="xl:col-span-2 space-y-8">
          <!-- Project Overview Card -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-8 py-6 border-b border-gray-200">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <h2 class="text-2xl font-bold text-gray-900 mb-2">{{ project()!.title }}</h2>
                  <p class="text-gray-600">
                    @if (isClient()) {
                      Project with {{ getBusinessName(project()!) }}
                    } @else if (isBusinessOwner()) {
                      Project from {{ getClientName(project()!) }}
                    }
                  </p>
                </div>
                <div class="flex-shrink-0 ml-4">
                  <span [class]="'inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold ' + getStatusColor(project()!.status)">
                    {{ getStatusText(project()!.status) }}
                  </span>
                </div>
              </div>
            </div>
            
            <div class="px-8 py-6 space-y-6">
              @if (project()!.description) {
                <div>
                  <h3 class="text-lg font-semibold text-gray-900 mb-3">Description</h3>
                  <p class="text-gray-700 leading-relaxed text-base">{{ project()!.description }}</p>
                </div>
              }

              @if (project()!.additional_notes) {
                <div>
                  <h3 class="text-lg font-semibold text-gray-900 mb-3">Additional Notes</h3>
                  <p class="text-gray-700 leading-relaxed text-base">{{ project()!.additional_notes }}</p>
                </div>
              }

              <!-- Project Image -->
              @if (project()!.image_url) {
                <div>
                  <h3 class="text-lg font-semibold text-gray-900 mb-3">Project Image</h3>
                  <div class="rounded-lg overflow-hidden border border-gray-200 max-w-md">
                    <img 
                      [src]="project()!.image_url" 
                      [alt]="project()!.title" 
                      class="w-full h-auto object-cover">
                  </div>
                </div>
              }

              <!-- Project Attachments -->
              @if (project()!.attachments && project()!.attachments!.length > 0) {
                <div>
                  <h3 class="text-lg font-semibold text-gray-900 mb-4">Project Documents</h3>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    @for (attachment of project()!.attachments!; track attachment.url) {
                      <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-all duration-200">
                        <div class="flex items-center space-x-3 flex-1 min-w-0">
                          <div class="p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                            <mat-icon class="text-blue-600 w-6 h-6">{{ getFileIcon(attachment.type) }}</mat-icon>
                          </div>
                          <div class="flex-1 min-w-0">
                            <p class="text-sm font-semibold text-gray-900 truncate">{{ attachment.name }}</p>
                            <p class="text-xs text-gray-500">{{ formatFileSize(attachment.size) }}</p>
                            <p class="text-xs text-gray-400 capitalize">{{ attachment.type.split('/')[1] || 'file' }}</p>
                          </div>
                        </div>
                        <a 
                          [href]="attachment.url" 
                          target="_blank" 
                          rel="noopener noreferrer"
                          class="flex items-center px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm ml-3 flex-shrink-0">
                          <mat-icon class="w-4 h-4 mr-1">download</mat-icon>
                          Download
                        </a>
                      </div>
                    }
                  </div>
                  <p class="text-xs text-gray-500 mt-3">{{ project()!.attachments!.length }} document(s) attached to this project</p>
                </div>
              }

              <!-- Services -->
              @if (getServiceDetails(project()!).length > 0) {
                <div>
                  <h3 class="text-lg font-semibold text-gray-900 mb-4">Selected Services</h3>
                  <div class="space-y-4">
                    @for (service of getServiceDetails(project()!); track service.name) {
                      <div class="bg-blue-50 border border-blue-200 rounded-xl p-5 hover:bg-blue-100 transition-colors">
                        <div class="flex items-start justify-between">
                          <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                              <mat-icon class="w-5 h-5 text-blue-600">star</mat-icon>
                              <h4 class="text-lg font-semibold text-blue-900">{{ service.name }}</h4>
                            </div>
                            @if (service.description) {
                              <p class="text-sm text-blue-700 mb-3 leading-relaxed">{{ service.description }}</p>
                            }
                            @if (service.price) {
                              <div class="inline-flex items-center px-3 py-1.5 bg-blue-200 text-blue-800 rounded-lg text-sm font-semibold">
                                <mat-icon class="w-4 h-4 mr-1">attach_money</mat-icon>
                                {{ formatServicePrice(service.price, service.pricing_type) }}
                              </div>
                            } @else {
                              <div class="inline-flex items-center px-3 py-1.5 bg-gray-200 text-gray-600 rounded-lg text-sm">
                                <mat-icon class="w-4 h-4 mr-1">help_outline</mat-icon>
                                Price not specified
                              </div>
                            }
                          </div>
                        </div>
                      </div>
                    }
                  </div>
                  <p class="text-xs text-gray-500 mt-3">{{ getServiceDetails(project()!).length }} service(s) selected for this project</p>
                </div>
              } @else {
                <div>
                  <h3 class="text-lg font-semibold text-gray-900 mb-3">Selected Services</h3>
                  <div class="p-4 bg-gray-50 rounded-xl border border-gray-200">
                    <div class="flex items-center space-x-2">
                      <mat-icon class="w-5 h-5 text-gray-400">info</mat-icon>
                      <p class="text-sm text-gray-600">No specific services selected for this project</p>
                    </div>
                  </div>
                </div>
              }

              @if (project()!.rejection_reason) {
                <div class="p-6 bg-red-50 border border-red-200 rounded-xl">
                  <h3 class="text-lg font-semibold text-red-800 mb-2 flex items-center">
                    <mat-icon class="w-5 h-5 mr-2 text-red-600">error_outline</mat-icon>
                    Rejection Reason
                  </h3>
                  <p class="text-red-700 leading-relaxed">{{ project()!.rejection_reason }}</p>
                </div>
              }
            </div>
          </div>

          <!-- Business/Client Info Card -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-8 py-6 border-b border-gray-200">
              <h2 class="text-xl font-semibold text-gray-900">
                @if (isClient()) {
                  Business Information
                } @else if (isBusinessOwner()) {
                  Client Information
                }
              </h2>
            </div>
            
            <div class="px-8 py-6">
              @if (isClient() && getBusinessInfo(project()!); as businessInfo) {
                <div class="flex items-center space-x-6">
                  @if (businessInfo.logo_url) {
                    <img [src]="businessInfo.logo_url!" 
                         [alt]="businessInfo.name!" 
                         class="w-20 h-20 rounded-xl object-cover border border-gray-200 shadow-sm">
                  } @else {
                    <div class="w-20 h-20 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center border border-gray-200 shadow-sm">
                      <mat-icon class="text-white w-10 h-10">business</mat-icon>
                    </div>
                  }
                  <div class="flex-1">
                    <button 
                      (click)="navigateToBusinessProfile(businessInfo.id)"
                      class="text-2xl font-bold text-blue-600 hover:text-blue-800 transition-colors mb-1 text-left cursor-pointer underline-offset-4 hover:underline">
                      {{ businessInfo.name }}
                    </button>
                    <p class="text-gray-600">Click to view business profile</p>
                    @if (businessInfo.id) {
                      <div class="mt-2 flex items-center space-x-2">
                        <mat-icon class="w-4 h-4 text-gray-400">link</mat-icon>
                        <span class="text-sm text-gray-500">/business/{{ businessInfo.id }}</span>
                      </div>
                    }
                  </div>
                </div>
              }
              
              @if (isBusinessOwner() && getClientInfo(project()!); as clientInfo) {
                <div class="flex items-center space-x-6">
                  <div class="w-20 h-20 rounded-full bg-gradient-to-br from-indigo-400 to-indigo-600 flex items-center justify-center shadow-sm">
                    <mat-icon class="text-white w-10 h-10">person</mat-icon>
                  </div>
                  <div class="flex-1">
                    <h3 class="text-2xl font-bold text-gray-900 mb-1">
                      {{ clientInfo.first_name }} {{ clientInfo.last_name }}
                    </h3>
                    @if (clientInfo.email) {
                      <p class="text-gray-600">{{ clientInfo.email }}</p>
                    }
                    <p class="text-sm text-gray-500 mt-1">Project Client</p>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-8">
          <!-- Project Details Card -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-6 py-5 border-b border-gray-200">
              <h3 class="text-lg font-semibold text-gray-900">Project Details</h3>
            </div>
            
            <div class="px-6 py-6 space-y-6">
              <!-- Budget -->
              <div class="text-center">
                <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Budget</p>
                <p class="text-3xl font-bold text-green-600">{{ formatPrice(project()!.offered_price) }}</p>
              </div>

              <!-- Deadline -->
              @if (project()!.deadline) {
                <div class="pt-6 border-t border-gray-200">
                  <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Deadline</p>
                  <p class="text-lg font-semibold text-gray-900">{{ formatDate(project()!.deadline) }}</p>
                </div>
              }

              <!-- Created -->
              <div class="pt-6 border-t border-gray-200">
                <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Created</p>
                <p class="text-lg font-semibold text-gray-900">{{ formatDate(project()!.createdAt) }}</p>
              </div>

              <!-- Status Dates -->
              @if (project()!.accepted_at) {
                <div class="pt-6 border-t border-gray-200">
                  <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Accepted</p>
                  <p class="text-lg font-semibold text-gray-900">{{ formatDate(project()!.accepted_at) }}</p>
                </div>
              }

              @if (project()!.completed_at) {
                <div class="pt-6 border-t border-gray-200">
                  <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Completed</p>
                  <p class="text-lg font-semibold text-gray-900">{{ formatDate(project()!.completed_at) }}</p>
                </div>
              }

              @if (project()!.rejected_at) {
                <div class="pt-6 border-t border-gray-200">
                  <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Rejected</p>
                  <p class="text-lg font-semibold text-gray-900">{{ formatDate(project()!.rejected_at) }}</p>
                </div>
              }
            </div>
          </div>

          <!-- Payment Requests Card -->
          @if (isClient() && hasPendingPaymentRequests()) {
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
              <div class="px-6 py-5 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                  <mat-icon class="mr-2 text-orange-600">payment</mat-icon>
                  Payment Requests
                </h3>
              </div>
              
              <div class="px-6 py-6 space-y-4">
                @if (loadingPaymentRequests()) {
                  <div class="flex items-center justify-center py-4">
                    <mat-spinner diameter="24"></mat-spinner>
                    <span class="ml-2 text-sm text-gray-600">Loading payment requests...</span>
                  </div>
                } @else {
                  @for (request of pendingPaymentRequests(); track request._id) {
                    <div class="border border-orange-200 rounded-lg p-4 bg-orange-50">
                      <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                          <div class="flex items-center space-x-2 mb-2">
                            <span [class]="'inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ' + getPaymentStatusColor(request.payment_status || 'pending')">
                              {{ request.payment_status || 'pending' | titlecase }}
                            </span>
                            <span class="text-xs text-gray-500">{{ formatPaymentTime(request.createdAt) }}</span>
                          </div>
                          <h4 class="font-semibold text-lg text-orange-900">
                            {{ request.payment_amount | currency:'USD':'symbol':'1.0-0' }}
                          </h4>
                          @if (request.payment_description) {
                            <p class="text-sm text-orange-700 mb-2">{{ request.payment_description }}</p>
                          }
                          @if (request.content) {
                            <p class="text-sm text-gray-600">{{ request.content }}</p>
                          }
                        </div>
                      </div>
                      
                      @if (request.payment_status === 'pending') {
                        <div class="flex gap-2 mt-4">
                          <button 
                            (click)="approvePaymentRequest(request)"
                            class="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors">
                            <mat-icon class="w-4 h-4 mr-1">check</mat-icon>
                            Approve & Pay
                          </button>
                          <button 
                            (click)="rejectPaymentRequest(request)"
                            class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors">
                            <mat-icon class="w-4 h-4 mr-1">close</mat-icon>
                            Reject
                          </button>
                        </div>
                      }
                    </div>
                  }
                }
                
                @if (!loadingPaymentRequests() && pendingPaymentRequests().length === 0) {
                  <div class="text-center py-4">
                    <mat-icon class="text-gray-400 mb-2">payment</mat-icon>
                    <p class="text-sm text-gray-600">No pending payment requests</p>
                  </div>
                }
              </div>
            </div>
          }

          <!-- Payment History Card -->
          @if (paymentRequests().length > 0) {
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
              <div class="px-6 py-5 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                  <mat-icon class="mr-2 text-blue-600">history</mat-icon>
                  Payment Request History
                </h3>
              </div>
              
              <div class="px-6 py-6">
                @if (loadingPaymentRequests()) {
                  <div class="flex items-center justify-center py-4">
                    <mat-spinner diameter="24"></mat-spinner>
                    <span class="ml-2 text-sm text-gray-600">Loading payment history...</span>
                  </div>
                } @else {
                  <div class="space-y-4">
                    @for (request of paymentRequests(); track request._id) {
                      <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex items-start justify-between mb-3">
                          <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                              <span [class]="'inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ' + getPaymentStatusColor(request.payment_status || 'pending')">
                                {{ request.payment_status || 'pending' | titlecase }}
                              </span>
                              <span class="text-xs text-gray-500">{{ formatPaymentTime(request.createdAt) }}</span>
                            </div>
                            <h4 class="font-semibold text-lg text-gray-900">
                              {{ request.payment_amount | currency:'USD':'symbol':'1.0-0' }}
                            </h4>
                            @if (request.payment_description) {
                              <p class="text-sm text-gray-600 mb-2">{{ request.payment_description }}</p>
                            }
                            @if (request.content) {
                              <p class="text-sm text-gray-500">{{ request.content }}</p>
                            }
                          </div>
                          <div class="text-right">
                            @if (request.payment_status === 'approved') {
                              <mat-icon class="text-green-600">check_circle</mat-icon>
                            } @else if (request.payment_status === 'rejected') {
                              <mat-icon class="text-red-600">cancel</mat-icon>
                            } @else {
                              <mat-icon class="text-yellow-600">schedule</mat-icon>
                            }
                          </div>
                        </div>
                        
                        @if (request.payment_status === 'pending' && isClient()) {
                          <div class="flex gap-2 mt-4">
                            <button 
                              (click)="approvePaymentRequest(request)"
                              class="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors">
                              <mat-icon class="w-4 h-4 mr-1">check</mat-icon>
                              Approve & Pay
                            </button>
                            <button 
                              (click)="rejectPaymentRequest(request)"
                              class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors">
                              <mat-icon class="w-4 h-4 mr-1">close</mat-icon>
                              Reject
                            </button>
                          </div>
                        }
                      </div>
                    }
                  </div>
                }
                
                @if (!loadingPaymentRequests() && paymentRequests().length === 0) {
                  <div class="text-center py-8">
                    <mat-icon class="text-gray-400 mb-2" style="font-size: 48px; width: 48px; height: 48px;">payment</mat-icon>
                    <p class="text-sm text-gray-600">No payment requests have been made for this project</p>
                  </div>
                }
              </div>
            </div>
          }

          <!-- Actions Card -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-6 py-5 border-b border-gray-200">
              <h3 class="text-lg font-semibold text-gray-900">Actions</h3>
            </div>
            
            <div class="px-6 py-6 space-y-4">
              <!-- Go Back Button -->
              <button 
                mat-stroked-button 
                class="w-full h-12 text-base font-semibold rounded-lg border-2 border-gray-300 text-gray-700 hover:bg-gray-50"
                (click)="goBack()">
                <mat-icon class="mr-2">arrow_back</mat-icon>
                Back to Projects
              </button>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
