<div class="max-w-4xl mx-auto p-6">
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Profile Settings</h1>
    <p class="text-gray-600">Manage your account information and settings</p>
  </div>

  <mat-tab-group class="profile-tabs">
    <!-- Profile Information Tab -->
    <mat-tab label="Profile Information">
      <div class="tab-content">
        <mat-card class="profile-card">
          <mat-card-header>
            <div class="flex items-center space-x-4 mb-6">
              <div class="w-16 h-16 bg-blue-600 text-white rounded-full flex items-center justify-center text-xl font-bold">
                {{ getUserInitials() }}
              </div>
              <div>
                <h2 class="text-xl font-semibold">{{ (user()?.first_name + ' ' + (user()?.last_name || '')).trim() || user()?.email }}</h2>
                <p class="text-gray-600">{{ user()?.email }}</p>
              </div>
            </div>
          </mat-card-header>

          <mat-card-content>
            <form [formGroup]="profileForm" (ngSubmit)="updateProfile()" class="space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>First Name *</mat-label>
                  <input matInput formControlName="first_name" placeholder="Enter your first name">
                  <mat-icon matSuffix>person</mat-icon>
                  @if (profileForm.get('first_name')?.hasError('required') && profileForm.get('first_name')?.touched) {
                    <mat-error>First name is required</mat-error>
                  }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>Last Name *</mat-label>
                  <input matInput formControlName="last_name" placeholder="Enter your last name">
                  <mat-icon matSuffix>person</mat-icon>
                  @if (profileForm.get('last_name')?.hasError('required') && profileForm.get('last_name')?.touched) {
                    <mat-error>Last name is required</mat-error>
                  }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>Email</mat-label>
                  <input matInput formControlName="email" type="email" placeholder="Enter your email">
                  <mat-icon matSuffix>email</mat-icon>
                  @if (profileForm.get('email')?.hasError('required') && profileForm.get('email')?.touched) {
                    <mat-error>Email is required</mat-error>
                  }
                  @if (profileForm.get('email')?.hasError('email') && profileForm.get('email')?.touched) {
                    <mat-error>Please enter a valid email</mat-error>
                  }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>Phone *</mat-label>
                  <input matInput formControlName="phone" placeholder="(555) 123-4567" type="tel" appPhoneFormat>
                  <mat-icon matSuffix>phone</mat-icon>
                  @if (phone?.hasError('required') && phone?.touched) {
                    <mat-error>Phone number is required</mat-error>
                  }
                  @if (phone?.hasError('usaPhone') && phone?.touched) {
                    <mat-error>{{ phone?.errors?.['usaPhone']?.message }}</mat-error>
                  }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>State *</mat-label>
                  <mat-select formControlName="state" (selectionChange)="onStateSelected($event.value)">
                    @for (state of usStates; track state.code) {
                      <mat-option [value]="state.code">{{ state.name }}</mat-option>
                    }
                  </mat-select>
                  <mat-icon matSuffix>map</mat-icon>
                  @if (profileForm.get('state')?.hasError('required') && profileForm.get('state')?.touched) {
                    <mat-error>State is required</mat-error>
                  }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>City *</mat-label>
                  <mat-select formControlName="city" [disabled]="availableCities().length === 0">
                    @if (availableCities().length === 0) {
                      <mat-option disabled>Please select a state first</mat-option>
                    }
                    @for (city of availableCities(); track city.name) {
                      <mat-option [value]="city.name">{{ city.name }}</mat-option>
                    }
                  </mat-select>
                  <mat-icon matSuffix>location_city</mat-icon>
                  @if (profileForm.get('city')?.hasError('required') && profileForm.get('city')?.touched) {
                    <mat-error>City is required</mat-error>
                  }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>Country</mat-label>
                  <input matInput formControlName="country" readonly>
                  <mat-icon matSuffix>flag</mat-icon>
                  <mat-hint>Country is set to USA by default</mat-hint>
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>Country of Origin</mat-label>
                  <mat-select formControlName="country_of_origin">
                    @for (country of countries; track country.code) {
                      <mat-option [value]="country.code">{{ country.name }}</mat-option>
                    }
                  </mat-select>
                  <mat-icon matSuffix>home</mat-icon>
                  @if (profileForm.get('country_of_origin')?.hasError('required') && profileForm.get('country_of_origin')?.touched) {
                    <mat-error>Country of origin is required</mat-error>
                  }
                </mat-form-field>
              </div>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Bio</mat-label>
                <textarea matInput formControlName="bio" rows="4" placeholder="Tell us about yourself"></textarea>
                <mat-icon matSuffix>description</mat-icon>
              </mat-form-field>

              <div class="flex justify-end pt-4">
                <button 
                  mat-raised-button 
                  color="primary" 
                  type="submit"
                  [disabled]="isLoading() || profileForm.invalid"
                  class="px-8"
                >
                  @if (isLoading()) {
                    <mat-icon class="animate-spin mr-2">refresh</mat-icon>
                  }
                  Update Profile
                </button>
              </div>
            </form>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Change Password Tab -->
    <mat-tab label="Change Password">
      <div class="tab-content">
        <mat-card class="password-card">
          <mat-card-header>
            <mat-card-title>Change Password</mat-card-title>
            <mat-card-subtitle>Update your account password</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <form [formGroup]="passwordForm" (ngSubmit)="updatePassword()" class="space-y-4">
              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Current Password</mat-label>
                <input matInput formControlName="currentPassword" type="password" placeholder="Enter current password">
                <mat-icon matSuffix>lock</mat-icon>
                @if (passwordForm.get('currentPassword')?.hasError('required') && passwordForm.get('currentPassword')?.touched) {
                  <mat-error>Current password is required</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>New Password</mat-label>
                <input matInput formControlName="newPassword" type="password" placeholder="Enter new password">
                <mat-icon matSuffix>lock_outline</mat-icon>
                @if (passwordForm.get('newPassword')?.hasError('required') && passwordForm.get('newPassword')?.touched) {
                  <mat-error>New password is required</mat-error>
                }
                @if (passwordForm.get('newPassword')?.hasError('minlength') && passwordForm.get('newPassword')?.touched) {
                  <mat-error>Password must be at least 6 characters</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Confirm New Password</mat-label>
                <input matInput formControlName="confirmPassword" type="password" placeholder="Confirm new password">
                <mat-icon matSuffix>lock_outline</mat-icon>
                @if (passwordForm.get('confirmPassword')?.hasError('required') && passwordForm.get('confirmPassword')?.touched) {
                  <mat-error>Please confirm your password</mat-error>
                }
                @if (passwordForm.get('confirmPassword')?.hasError('mismatch') && passwordForm.get('confirmPassword')?.touched) {
                  <mat-error>Passwords do not match</mat-error>
                }
              </mat-form-field>

              <div class="flex justify-end pt-4">
                <button 
                  mat-raised-button 
                  color="primary" 
                  type="submit"
                  [disabled]="isLoading() || passwordForm.invalid"
                  class="px-8"
                >
                  @if (isLoading()) {
                    <mat-icon class="animate-spin mr-2">refresh</mat-icon>
                  }
                  Update Password
                </button>
              </div>
            </form>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
