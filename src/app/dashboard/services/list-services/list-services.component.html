<div class="min-h-screen bg-gray-50">
  <!-- Header Section -->
  <div class="mb-8">
    <div class="lg:max-w-7xl max-w-12xl">
      <div class="px-6 pt-6">
        <app-dashboard-subheader title="My Services" subtitle="Manage services across all your businesses"
          (backClicked)="navigateToCreateService()">
          <button matButton="filled" color="primary" (click)="navigateToCreateService()" [disabled]="userBusinesses().length === 0" class="flex items-center">
            <mat-icon class="mr-2">add</mat-icon>
            New Service
          </button>
        </app-dashboard-subheader>
      </div>

      <!-- Search and Filter Controls -->
      <div class="px-0 sm:px-6 pt-4">
        <app-business-search-filter [searchTerm]="searchTerm()" [viewMode]="viewMode()"
          (searchChange)="searchTerm.set($event)" (viewModeChange)="setViewMode($event)" (clearSearch)="clearSearch()">
          <!-- Business Filter via Content Projection -->
          <div class="w-full sm:w-48">
            <mat-form-field appearance="outline" subscriptSizing="dynamic" class="w-full">
              <mat-label>Business</mat-label>
              <mat-select [value]="selectedBusiness()" (selectionChange)="selectedBusiness.set($event.value)">
                <mat-option value="all">All Businesses</mat-option>
                @for (business of userBusinesses(); track business._id) {
                <mat-option [value]="business._id">{{ business.name }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix>business</mat-icon>
            </mat-form-field>
          </div>
        </app-business-search-filter>
      </div>

    </div>

    <!-- Warning: No Businesses -->
    @if (userBusinesses().length === 0) {
    <div class="mx-6 mb-6 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg">
      <div class="flex">
        <svg class="w-5 h-5 text-yellow-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
        </svg>
        <div>
          <h3 class="text-sm font-medium text-yellow-800">No businesses found</h3>
          <p class="mt-1 text-sm text-yellow-700">You need to create a business before you can add services.</p>
        </div>
      </div>
    </div>
    }

    <!-- Error Display -->
    @if (error()) {
    <div class="mb-6 bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg">
      <div class="flex">
        <svg class="w-5 h-5 text-red-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd"
            d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
            clip-rule="evenodd"></path>
        </svg>
        <div>
          <h3 class="text-sm font-medium text-red-800">Error</h3>
          <p class="mt-1 text-sm text-red-700">{{ error() }}</p>
        </div>
      </div>
    </div>
    }

    <!-- Loading State -->

    @if (loading()) {
    <div class="flex items-center justify-center min-h-screen">
      <mat-spinner [diameter]="isMobile() ? 40 : 60" [strokeWidth]="4"></mat-spinner>
    </div>
    } @else {
      <!-- Content -->
      @if (filteredServices().length === 0) {
      <!-- Empty State -->
      <div class="lg:max-w-7xl max-w-12xl px-6 pb-12">
        @if (searchTerm() || selectedBusiness() !== 'all') {
        <app-empty-state 
          icon="search_off"
          title="No services found"
          description="Try adjusting your search term or filter to find what you're looking for."
          [buttons]="[{ label: 'Clear Filters', callback: handleClearFilters }]">
        </app-empty-state>
        } @else if (userBusinesses().length === 0) {
        <app-empty-state 
          icon="business"
          title="Create a business first"
          description="You need to have at least one business before you can create services."
          [buttons]="[{ label: 'Create Business', callback: handleCreateBusiness, icon: 'add' }]">
        </app-empty-state>
        } @else {
        <app-empty-state 
          icon="handshake"
          title="No services yet"
          description="Get started by creating your first service for your business."
          [buttons]="[{ label: 'Create Your First Service', callback: handleCreateService, icon: 'add' }]">
        </app-empty-state>
        }
      </div>
      } @else {
      
        <!-- Grid View -->
        @if (viewMode() === 'grid') {
          <div class="lg:max-w-7xl max-w-12xl px-6 pb-12">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            @for (service of filteredServices(); track service._id) {
              <app-service-card
                [service]="service"
                [businessName]="getBusinessName(service)"
                [statusColorClass]="getStatusColor(service.is_active!)"
                [statusText]="getStatusText(service.is_active!)"
                (view)="viewService($event)"
                (edit)="editService($event)"
                (delete)="deleteService($event)">
              </app-service-card>
            }
          </div>
          </div>
        }
      

     
        <!-- List View -->
        @if (viewMode() === 'list') {
           <div class="lg:max-w-7xl max-w-12xl lg:px-6 px-0 pb-12">
          <app-service-list-card
            [services]="filteredServices()"
            [businessNameMap]="getBusinessNameMap()"
            [displayedColumns]="['image', 'name', 'business', 'description', 'status', 'price', 'date', 'actions']"
            (view)="viewService($event)"
            (edit)="editService($event)"
            (delete)="deleteService($event)">
          </app-service-list-card>
          </div>
        }
      
      }
    }
  </div>
</div>
