<div class="min-h-screen bg-gray-50">
  <!-- Header Section -->
  <div class="mb-8">
    <div class="lg:max-w-7xl max-w-12xl">
      <div class="px-6 pt-6">
        <app-dashboard-subheader title="My Businesses" subtitle="Manage all your business listings"
          (backClicked)="navigateToCreateBusiness()">
          <button matButton="filled" color="primary" (click)="navigateToCreateBusiness()" class="flex items-center">
            <mat-icon class="mr-2">add</mat-icon>
            New Business
          </button>
        </app-dashboard-subheader>
      </div>

      <!-- Search and Filter Controls -->
      <div class="px-0 sm:px-6 pt-4">
        <app-business-search-filter [searchTerm]="searchTerm()" [viewMode]="viewMode()"
          (searchChange)="searchTerm.set($event)" (viewModeChange)="setViewMode($event)" (clearSearch)="clearSearch()">
          <!-- Category Filter via Content Projection -->
          <div class="w-full sm:w-48">
            <mat-form-field appearance="outline" class="w-full" subscriptSizing="dynamic">
              <mat-label>Category</mat-label>
              <mat-select [value]="selectedCategory()" (selectionChange)="selectedCategory.set($event.value)">
                <mat-option value="all">All Categories</mat-option>
                @for (category of getUniqueCategories(); track category.id) {
                <mat-option [value]="category.id">{{ category.name }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix>category</mat-icon>
            </mat-form-field>
          </div>

          <!-- Status Filter via Content Projection -->
          <div class="w-full sm:w-48">
            <mat-form-field appearance="outline" subscriptSizing="dynamic" class="w-full">
              <mat-label>Status</mat-label>
              <mat-select [value]="selectedStatus()" (selectionChange)="selectedStatus.set($event.value)">
                <mat-option value="all">All Status</mat-option>
                <mat-option value="approved">Approved</mat-option>
                <mat-option value="pending">Pending</mat-option>
                <mat-option value="rejected">Rejected</mat-option>
                <mat-option value="suspended">Suspended</mat-option>
              </mat-select>
              <mat-icon matPrefix>info</mat-icon>
            </mat-form-field>
          </div>
        </app-business-search-filter>
      </div>

    </div>

    <!-- Error Display -->
    @if (error()) {
    <div class="mb-6 bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg">
      <div class="flex">
        <svg class="w-5 h-5 text-red-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd"
            d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
            clip-rule="evenodd"></path>
        </svg>
        <div>
          <h3 class="text-sm font-medium text-red-800">Error</h3>
          <p class="mt-1 text-sm text-red-700">{{ error() }}</p>
        </div>
      </div>
    </div>
    }

    <!-- Loading State -->

    @if (loading()) {
    <div class="flex items-center justify-center min-h-screen">
      <mat-spinner [diameter]="isMobile() ? 40 : 60" [strokeWidth]="4"></mat-spinner>
    </div>
    } @else {
    <!-- Content -->
    @if (filteredBusinesses().length === 0) {
    <!-- Empty State -->
    <div class="lg:max-w-7xl max-w-12xl px-6 pb-12">
      @if (searchTerm() || selectedCategory() !== 'all') {
      <app-empty-state 
        icon="search_off"
        title="No businesses found"
        description="Try adjusting your search term or filter to find what you're looking for."
        [buttons]="[{ label: 'Clear Filters', callback: handleClearFilters }]">
      </app-empty-state>
      } @else {
      <app-empty-state 
        icon="business"
        title="No businesses yet"
        description="Get started by creating your first business listing."
        [buttons]="[{ label: 'Create Your First Business', callback: handleCreateBusiness, icon: 'add' }]">
      </app-empty-state>
      }
    </div>
    } @else {
    <!-- Grid View -->
    @if (viewMode() === 'grid') {
    <div class="lg:max-w-7xl max-w-12xl px-6 pb-12">


      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (business of filteredBusinesses(); track business._id) {
        <app-business-card [business]="business" [statusColorClass]="getStatusColor(business)"
          [statusText]="getStatusText(business)" [categoryName]="getCategoryName(business)"
          [businessTypeColor]="getBusinessTypeColor(business.business_type)"
          [businessTypeText]="getBusinessTypeText(business.business_type)" (view)="viewBusiness($event)"
          (edit)="editBusiness($event)" (delete)="deleteBusiness($event)">
        </app-business-card>
        }
      </div>

    </div>
    }

    <!-- List View -->
    @if (viewMode() === 'list') {
    <div class="lg:max-w-7xl max-w-12xl lg:px-6 px-0">
      <app-business-list-card 
        [businesses]="filteredBusinesses()" 
        [displayedColumns]="['logo', 'name', 'category', 'description', 'status', 'business_type', 'date', 'actions']"
        (view)="viewBusiness($event)"
        (edit)="editBusiness($event)" 
        (delete)="deleteBusiness($event)">
      </app-business-list-card>
    </div>
    }
    }
    }
  </div>
</div>