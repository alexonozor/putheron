<header class="relative z-50 bg-white shadow-sm">
    <nav class="mx-auto px-4 sm:px-6 lg:px-8" [ngClass]="{ 'max-w-12xl': isAuthenticated(), 'max-w-7xl': !isAuthenticated() }">
        <div class="flex justify-between items-center py-4">
            <div class="flex items-center">
                <!-- Mobile Menu Button (only show when specified) -->
                @if (showMobileMenuButton) {
                    <button 
                        mat-icon-button 
                        (click)="onMenuToggle()"
                        class="mr-3 text-gray-700 hover:text-blue-600 transition-colors"
                    >
                        <mat-icon>menu</mat-icon>
                    </button>
                }
                
                <a routerLink="/" class="text-2xl font-bold text-blue-600 hover:text-blue-700 transition-colors">
                    VouchHer
                </a>
            </div>
            
            <!-- Authentication State -->
            <div class="flex items-center space-x-4">
                @if (isAuthenticated(); as authenticated) {
                    <!-- Authenticated User -->
                    <div class="flex items-center space-x-4">
                        <!-- Messages Icon -->
                        <button 
                            mat-icon-button 
                            (click)="navigateToMessages()"
                            class="relative text-gray-700 hover:text-blue-600 transition-colors"
                        >
                            <mat-icon 
                                [matBadge]="messageCount()"
                                [matBadgeHidden]="messageCount() === 0"
                                matBadgeColor="warn"
                                matBadgeSize="small"
                            >
                                mail
                            </mat-icon>
                        </button>

                        <!-- Notifications Component -->
                        <app-notification-nav></app-notification-nav>

                        <!-- User Dropdown -->
                        <div class="relative">
                            <button 
                                mat-button
                                [matMenuTriggerFor]="userMenu"
                                class="flex items-center space-x-2 text-gray-700 hover:text-blue-600 transition-colors"
                            >
                                <!-- User Avatar/Initials -->
                                <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">
                                    {{ getUserInitials() }}
                                </div>
                                <mat-icon>expand_more</mat-icon>
                            </button>
                            
                            <!-- Dropdown Menu -->
                            <mat-menu #userMenu="matMenu">
                                <!-- Mode Display -->
                                <div class="px-4 py-2 text-sm text-gray-500 border-b">
                                    Mode: {{ isBusinessOwner() ? 'Business Owner' : 'Client' }}
                                </div>
                                
                                <!-- Dashboard/Profile Actions -->
                                <button mat-menu-item (click)="navigateToDashboard()">
                                    <mat-icon>dashboard</mat-icon>
                                    <span>Dashboard</span>
                                </button>
                                <button mat-menu-item (click)="navigateToProfile()">
                                    <mat-icon>person</mat-icon>
                                    <span>Profile</span>
                                </button>

                                <!-- Admin Access (only for authorized users) -->
                                @if (hasAdminAccess()) {
                                    <button mat-menu-item (click)="navigateToAdmin()">
                                        <mat-icon>admin_panel_settings</mat-icon>
                                        <span>Admin Panel</span>
                                    </button>
                                }
                                
                                <!-- Mode Switching -->
                                @if (!isBusinessOwner()) {
                                    <button mat-menu-item (click)="switchToBusinessMode()">
                                        <mat-icon>business</mat-icon>
                                        <span>Switch to Business Owner</span>
                                    </button>
                                } @else {
                                    <button mat-menu-item (click)="switchToClientMode()">
                                        <mat-icon>person_outline</mat-icon>
                                        <span>Switch to Client Mode</span>
                                    </button>
                                }
                                
                                <mat-divider></mat-divider>
                                <button mat-menu-item (click)="navigateToSettings()">
                                    <mat-icon>settings</mat-icon>
                                    <span>Settings</span>
                                </button>
                                <mat-divider></mat-divider>
                                <button mat-menu-item (click)="signOut()" class="text-red-600">
                                    <mat-icon>logout</mat-icon>
                                    <span>Sign Out</span>
                                </button>
                            </mat-menu>
                        </div>
                    </div>
                } @else {
                    <!-- Guest User -->
                
                    <a routerLink="/auth" class="text-gray-700 hover:text-blue-600 transition-colors">
                        Sign In
                    </a>
                    <a routerLink="/auth" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Join
                    </a>
                }
            </div>
        </div>
    </nav>
</header>