<header class="sticky top-0 z-50 bg-white!" style="--header-height:64px">
    <!-- Desktop Navigation -->
    <mat-toolbar class="desktop-toolbar bg-white shadow-sm border-b border-gray-200">
        <div class="w-full mx-auto px-4 sm:px-6 lg:px-8"
            [ngClass]="{ 'max-w-12xl': isAuthenticated(), 'max-w-7xl': !isAuthenticated() }">
            <div class="flex justify-between items-center w-full">
                <!-- Logo -->
                <div class="flex items-center gap-4">
                    <a routerLink="/"
                        class="text-2xl font-bold text-primary-600 hover:text-primary-700 transition-colors">
                        <img src="/assets/logos/colored-logo.svg" alt="VouchHer" class="h-10 w-auto">
                    </a>
                    <!-- navbar search: hidden on home until user scrolls past hero -->
                    @if(showHeaderSearch()) {
                    <app-search width="600px" backgroundColor="#efefef" class="mx-4" />
                    }


                </div>

                <!-- Desktop Auth Actions -->
                <div class="flex items-center gap-4">
                    @if (isAuthenticated(); as authenticated) {
                    <!-- Authenticated User -->
                    <!-- Messages Icon -->
                    <button mat-icon-button (click)="navigateToMessages()" class="text-gray-600 hover:text-primary-600">
                        <mat-icon [matBadge]="messageCount()" [matBadgeHidden]="messageCount() === 0"
                            matBadgeColor="warn" matBadgeSize="small">
                            mail_outline
                        </mat-icon>
                    </button>

                    <!-- Notifications -->
                    <app-notification-nav></app-notification-nav>

                    <!-- User Menu -->



                    <div [matMenuTriggerFor]="userMenu"
                        class="w-9 h-9 m-0 p-0 bg-primary-600 cursor-pointer text-white rounded-full flex items-center justify-center text-sm font-medium">
                        {{ getUserInitials() }}
                    </div>
                    <!-- </button> -->

                    } @else {
                    <a matButton routerLink="/auth" class="text-[#484848]!">How It Works</a>

                    <a matButton routerLink="/auth" class="text-[#484848]!">Why Choose VouchHer</a>
                    <!-- Guest User -->
                    <button matButton routerLink="/auth/login" class="text-[#484848]!">
                        Sign In
                    </button>
                    <button mat-flat-button color="primary" routerLink="/auth/signup" class="bg-primary-600 text-white">
                        Join
                    </button>
                    }
                </div>
            </div>
        </div>
    </mat-toolbar>

    <!-- User Menu - Shared between Desktop and Mobile -->
    <mat-menu #userMenu="matMenu">
        <div class="px-4 py-2 text-sm text-gray-500 border-b">
            Mode: {{ isBusinessOwner() ? 'Business Owner' : 'Client' }}
        </div>

        <button mat-menu-item (click)="navigateToDashboard()">
            <mat-icon>dashboard</mat-icon>
            <span>Dashboard</span>
        </button>
        <button mat-menu-item (click)="navigateToProfile()">
            <mat-icon>person</mat-icon>
            <span>Profile</span>
        </button>

        @if (hasAdminAccess()) {
        <button mat-menu-item (click)="navigateToAdmin()">
            <mat-icon>admin_panel_settings</mat-icon>
            <span>Admin Panel</span>
        </button>
        }

        @if (!isBusinessOwner()) {
        @if (!hasBusinesses()) {
        <button mat-menu-item (click)="navigateToCreateBusiness()">
            <mat-icon>add_business</mat-icon>
            <span>Add a Business</span>
        </button>
        } @else {
        <button mat-menu-item (click)="switchToBusinessMode()">
            <mat-icon>business</mat-icon>
            <span>Switch to Business Owner</span>
        </button>
        }
        } @else {
        <button mat-menu-item (click)="switchToClientMode()">
            <mat-icon>person_outline</mat-icon>
            <span>Switch to Client Mode</span>
        </button>
        }

        <mat-divider></mat-divider>
        <button mat-menu-item (click)="navigateToSettings()">
            <mat-icon>settings</mat-icon>
            <span>Settings</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="signOut()" class="text-red-600">
            <mat-icon>logout</mat-icon>
            <span>Sign Out</span>
        </button>
    </mat-menu>

    <!-- Mobile Navigation -->
    <mat-toolbar class="mobile-toolbar bg-white shadow-sm border-b border-gray-200 h-16">
        <div class="w-full flex items-center justify-between px-3">
            @if (isAuthenticated()) {
            <!-- Logged In Mobile Header -->
            <!-- Menu Button -->
            <button mat-icon-button (click)="toggleMobileMenu()" class="text-gray-700 -ml-2">
                <mat-icon>menu</mat-icon>
            </button>

            <!-- Logo Center -->
            <a routerLink="/" class="flex items-center absolute left-1/2 transform -translate-x-1/2">
                <img src="/assets/logos/logo-icon-md.png" alt="VouchHer" class="h-8 w-auto">
            </a>

            <!-- Right Actions -->
            <div class="flex items-center gap-1">
                <!-- Messages -->
                <button mat-icon-button (click)="navigateToMessages()" class="text-gray-600">
                    <mat-icon [matBadge]="messageCount()" [matBadgeHidden]="messageCount() === 0" matBadgeColor="warn"
                        matBadgeSize="small">
                        mail_outline
                    </mat-icon>
                </button>

                <!-- Notifications -->
                <app-notification-nav></app-notification-nav>

                <div
                    [matMenuTriggerFor]="userMenu"
                    class="w-9 h-9 m-0 p-0 bg-primary-600 cursor-pointer text-white rounded-full flex items-center justify-center text-sm font-medium">
                    {{ getUserInitials() }}
                </div>
            </div>
            } @else {
            <!-- Logged Out Mobile Header -->
            <!-- Menu Button Left -->
            <button mat-icon-button (click)="toggleMobileMenu()" class="text-gray-700 -ml-2">
                <mat-icon>menu</mat-icon>
            </button>

            <!-- Logo Center -->
            <a routerLink="/" class="flex items-center absolute left-1/2 transform -translate-x-1/2">
                <img src="/assets/logos/logo-icon-md.png" alt="VouchHer" class="h-8 w-auto">
            </a>

            <!-- Sign Up Button Right -->
            <button mat-flat-button color="primary" routerLink="/auth/signup">
                Sign up
            </button>


            }
        </div>
    </mat-toolbar>

  

</header>