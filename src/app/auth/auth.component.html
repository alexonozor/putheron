<!-- Navigation Header -->
<app-header></app-header>

<div class="auth-container min-h-screen flex">
  <!-- Left Side - Authentication Form -->
  <div class="w-full lg:w-1/2 flex items-center justify-center p-8 bg-white">
    <div class="w-full max-w-lg">
      <div class="p-8">
        <div class="text-center mb-8 p-0">
          <h2 class="text-2xl font-bold text-gray-900 mb-2">
            {{ isSignUp() ? 'Join Our Community' : 'Welcome Back' }}
          </h2>
          <p class="text-gray-600">
            {{ isSignUp() ? 'Create your account to get started' : 'Sign in to your account' }}
          </p>
        </div>

        <div class="p-0">
          <form [formGroup]="authForm" (ngSubmit)="onSubmit()">
            <!-- Sign Up Fields - Organized Layout -->
            @if (isSignUp()) {
              <div class="space-y-4 mb-6">
                <!-- Name Fields Row -->
                <div class="grid grid-cols-2 gap-4">
                  <mat-form-field appearance="outline">
                    <mat-label>First Name</mat-label>
                    <input
                      matInput
                      formControlName="firstName"
                      placeholder="First name"
                      [disabled]="loading()"
                    />
                    <mat-icon matSuffix>person</mat-icon>
                    @if (firstNameControl?.invalid && firstNameControl?.touched) {
                      <mat-error>Required</mat-error>
                    }
                  </mat-form-field>

                  <mat-form-field appearance="outline">
                    <mat-label>Last Name</mat-label>
                    <input
                      matInput
                      formControlName="lastName"
                      placeholder="Last name"
                      [disabled]="loading()"
                    />
                    @if (lastNameControl?.invalid && lastNameControl?.touched) {
                      <mat-error>Required</mat-error>
                    }
                  </mat-form-field>
                </div>

                <!-- Contact & Location -->
                <mat-form-field appearance="outline">
                  <mat-label>Phone Number</mat-label>
                  <input
                    matInput
                    type="tel"
                    appPhoneFormat
                    formControlName="phone"
                    placeholder="(555) 123-4567"
                    [disabled]="loading()"
                  />
                  <mat-icon matSuffix>phone</mat-icon>
                  @if (phoneControl?.hasError('required') && phoneControl?.touched) {
                    <mat-error>Phone number is required</mat-error>
                  }
                  @if (phoneControl?.hasError('usaPhone') && phoneControl?.touched) {
                    <mat-error>{{ phoneControl?.errors?.['usaPhone']?.message }}</mat-error>
                  }
                </mat-form-field>

                <div class="grid grid-cols-2 gap-4">
                  <mat-form-field appearance="outline">
                    <mat-label>State</mat-label>
                    <mat-select
                      formControlName="state"
                      [disabled]="loading()"
                      (selectionChange)="onStateSelected($event.value)"
                    >
                      <mat-option value="">Select state</mat-option>
                      @for (state of usStates; track state.code) {
                        <mat-option [value]="state.code">{{ state.name }}</mat-option>
                      }
                    </mat-select>
                    <mat-icon matSuffix>location_on</mat-icon>
                    @if (stateControl?.invalid && stateControl?.touched) {
                      <mat-error>Required</mat-error>
                    }
                  </mat-form-field>

                  <mat-form-field appearance="outline">
                    <mat-label>City</mat-label>
                    <mat-select
                      formControlName="city"
                      [disabled]="loading() || availableCities().length === 0"
                    >
                      @if (availableCities().length === 0) {
                        <mat-option value="">Select state first</mat-option>
                      } @else {
                        <mat-option value="">Select city</mat-option>
                        @for (city of availableCities(); track city.name) {
                          <mat-option [value]="city.name">{{ city.name }}</mat-option>
                        }
                      }
                    </mat-select>
                    <mat-icon matSuffix>location_city</mat-icon>
                    @if (cityControl?.invalid && cityControl?.touched) {
                      <mat-error>Required</mat-error>
                    }
                  </mat-form-field>
                </div>

                <!-- User Type Selection -->
                <div class="space-y-3 p-4 bg-gray-50 rounded-lg">
                  <h4 class="text-sm font-medium text-gray-700 mb-3">I want to:</h4>
                  <mat-radio-group 
                    formControlName="userType" 
                    class="radio-group-inline"
                    [disabled]="loading()"
                  >
                    <div class="radio-options">
                      <mat-radio-button value="buyer" class="radio-option">
                        Find women-owned businesses
                      </mat-radio-button>
                      <mat-radio-button value="seller" class="radio-option">
                        Offer services through my business
                      </mat-radio-button>
                    </div>
                  </mat-radio-group>
                </div>
              </div>
            }

            <!-- Email and Password -->
            <div class="space-y-4 mb-6">
              @if (isSignUp()) {
                <div class="grid grid-cols-2 gap-4">
                  <mat-form-field appearance="outline">
                    <mat-label>Email Address</mat-label>
                    <input
                      matInput
                      type="email"
                      formControlName="email"
                      placeholder="your@email.com"
                      [disabled]="loading()"
                    />
                    <mat-icon matSuffix>email</mat-icon>
                    @if (emailControl?.invalid && emailControl?.touched) {
                      <mat-error>
                        @if (emailControl?.hasError('required')) {
                          Email is required
                        } @else if (emailControl?.hasError('email')) {
                          Invalid email format
                        }
                      </mat-error>
                    }
                  </mat-form-field>

                  <mat-form-field appearance="outline">
                    <mat-label>Heritage</mat-label>
                    <mat-select
                      formControlName="countryOfOrigin"
                      [disabled]="loading()"
                    >
                      <mat-option value="">Select country</mat-option>
                      @for (country of countries; track country.code) {
                        <mat-option [value]="country.name">{{ country.name }}</mat-option>
                      }
                    </mat-select>
                    <mat-icon matSuffix>public</mat-icon>
                    @if (countryOfOriginControl?.invalid && countryOfOriginControl?.touched) {
                      <mat-error>Required</mat-error>
                    }
                  </mat-form-field>
                </div>
              } @else {
                <mat-form-field appearance="outline">
                  <mat-label>Email Address</mat-label>
                  <input
                    matInput
                    type="email"
                    formControlName="email"
                    placeholder="your@email.com"
                    [disabled]="loading()"
                  />
                  <mat-icon matSuffix>email</mat-icon>
                  @if (emailControl?.invalid && emailControl?.touched) {
                    <mat-error>
                      @if (emailControl?.hasError('required')) {
                        Email is required
                      } @else if (emailControl?.hasError('email')) {
                        Invalid email format
                      }
                    </mat-error>
                  }
                </mat-form-field>
              }

              <mat-form-field appearance="outline">
                <mat-label>Password</mat-label>
                <input
                  matInput
                  [type]="showPassword() ? 'text' : 'password'"
                  formControlName="password"
                  placeholder="Enter password"
                  [disabled]="loading()"
                />
                <button 
                  mat-icon-button 
                  matSuffix 
                  type="button"
                  (click)="togglePasswordVisibility()"
                  [attr.aria-label]="'Toggle password visibility'"
                  [attr.aria-pressed]="showPassword()"
                >
                  <mat-icon>{{ showPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
                @if (passwordControl?.invalid && passwordControl?.touched) {
                  <mat-error>
                    @if (passwordControl?.hasError('required')) {
                      Password is required
                    } @else if (passwordControl?.hasError('minlength')) {
                      Minimum 6 characters
                    }
                  </mat-error>
                }
              </mat-form-field>
            </div>

            <!-- Messages -->
            @if (authMessage()) {
              <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-center text-blue-700">
                  <mat-icon class="mr-2 text-sm">info</mat-icon>
                  <span class="text-sm">{{ authMessage() }}</span>
                </div>
              </div>
            }

            @if (error()) {
              <div class="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                <div class="flex items-center text-red-700">
                  <mat-icon class="mr-2 text-sm">error</mat-icon>
                  <span class="text-sm">{{ error() }}</span>
                </div>
              </div>
            }

            @if (successMessage()) {
              <div class="mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                <div class="flex items-center text-green-700">
                  <mat-icon class="mr-2 text-sm">check_circle</mat-icon>
                  <span class="text-sm">{{ successMessage() }}</span>
                </div>
              </div>
            }

            <!-- Submit Button -->
            <button
              mat-raised-button
              color="primary"
              type="submit"
              class="w-full py-3 text-base font-medium mb-4"
              [disabled]="loading() || !authForm.valid"
            >
              @if (!(loading())) {
                {{ isSignUp() ? 'Create Account' : 'Sign In' }}
              } @else {
                <span class="flex items-center justify-center gap-2">
                  <mat-spinner diameter="16"></mat-spinner>
                  {{ isSignUp() ? 'Creating...' : 'Signing In...' }}
                </span>
              }
            </button>

            <!-- Additional Actions -->
            <div class="space-y-3 text-center">
              @if (!isSignUp()) {
                <button 
                  mat-button 
                  type="button" 
                  color="primary"
                  (click)="resetPassword()"
                  class="text-sm"
                >
                  Forgot your password?
                </button>
                
                <!-- Navigation to Sign Up (only show on Sign In page) -->
                <div class="mt-4 pt-4 border-t border-gray-200">
                  <p class="text-sm text-gray-600">
                    Don't have an account? 
                    <button 
                      mat-button 
                      type="button" 
                      color="primary"
                      (click)="toggleMode()"
                      class="text-sm font-medium ml-1"
                    >
                      Sign up
                    </button>
                  </p>
                </div>
              }
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Right Side - Image with Text Overlay -->
  <div class="w-full lg:w-1/2 relative overflow-hidden">
    <!-- Background Image -->
    <div class="absolute inset-0 bg-cover bg-center bg-no-repeat" 
         style="background-image: url('https://images.pexels.com/photos/3184339/pexels-photo-3184339.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');">
    </div>
    
    <!-- Dark overlay for better text readability -->
    <div class="absolute inset-0 bg-gradient-to-br from-purple-600/90 via-pink-600/90 to-indigo-700/90"></div>

    <!-- Text Overlay -->
    <div class="relative z-10 h-full flex flex-col justify-center items-center p-12 text-white text-center">
      <div class="max-w-lg">
        <h2 class="text-4xl font-bold mb-6">Turn Connections Into Opportunities</h2>
        <h3 class="text-3xl font-semibold mb-8 text-yellow-300">For Women-Owned Businesses</h3>
        
        <div class="space-y-6 text-lg">
          <div class="flex items-center justify-center space-x-3">
            <mat-icon class="text-2xl text-green-400">search</mat-icon>
            <span>List your business for free</span>
          </div>
          <div class="flex items-center justify-center space-x-3">
            <mat-icon class="text-2xl text-blue-400">business_center</mat-icon>
            <span>Earn extra income</span>
          </div>
          <div class="flex items-center justify-center space-x-3">
            <mat-icon class="text-2xl text-pink-400">favorite</mat-icon>
            <span>Collaborate and grow</span>
          </div>
          <div class="flex items-center justify-center space-x-3">
            <mat-icon class="text-2xl text-pink-400">favorite</mat-icon>
            <span>Get Support from peers</span>
          </div>
        </div>
        
        <div class="mt-8 p-4 backdrop-blur-sm rounded-lg">
          <p class="text-base opacity-90">
            Join VouchHer today - where every listing builds a stronger future.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
