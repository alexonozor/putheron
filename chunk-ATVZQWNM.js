import{a as oe,b as ie}from"./chunk-I5NYEOQ7.js";import{h as W,l as X,m as Y}from"./chunk-RXAK7GQU.js";import{d as H,e as J,h as K,k as Q}from"./chunk-SQHEFKI2.js";import"./chunk-7RWCIHFI.js";import"./chunk-VRCQRP53.js";import{B as j,c as q,e as v,h as O,i as D,l as G,p as U,r as $,z as Z}from"./chunk-MOPYAMLF.js";import"./chunk-RNGT6N3O.js";import"./chunk-TOWFRAUA.js";import{a as ee,b as te}from"./chunk-ZH2LY4H3.js";import"./chunk-QVSCKNGL.js";import"./chunk-FX5J5MOS.js";import{b as L,c as N,d as B,e as z}from"./chunk-SUTJIGUH.js";import{a as A}from"./chunk-VJC62ZZJ.js";import"./chunk-WZKZJ5DF.js";import{p as V,q as I}from"./chunk-A72LFUZP.js";import"./chunk-IGUJQH2A.js";import"./chunk-GS6LNAK5.js";import"./chunk-QD7SSFII.js";import{a as T,c as R,d as F}from"./chunk-MEFNJ5SS.js";import"./chunk-GUCRBWY4.js";import{t as M}from"./chunk-REOVWAHI.js";import{Ab as k,Bb as c,Db as f,Ea as d,Gb as l,Lb as n,Mb as r,Nb as x,Oc as w,Rb as E,Vb as b,Wb as u,cb as a,fa as h,gc as o,hc as m,na as y,oa as g,ob as S,qc as _,ub as p}from"./chunk-BEPULU6C.js";import{e as C}from"./chunk-JKOY2XUY.js";var ae=()=>["/auth/forgot-password"],re=()=>["/auth/login"],se=()=>["/auth/signup"];function le(i,t){i&1&&(n(0,"div",1),x(1,"mat-spinner",4),n(2,"p",5),o(3,"Verifying reset token..."),r()())}function de(i,t){i&1&&(n(0,"div",2)(1,"div",6)(2,"mat-icon",7),o(3,"error_outline"),r(),n(4,"h2",8),o(5,"Invalid Reset Link"),r(),n(6,"p",5),o(7,"This password reset link is invalid or has expired."),r()(),n(8,"button",9),o(9," Request New Reset Link "),r(),n(10,"div",10)(11,"p",11),o(12," Remember your password? "),n(13,"a",12),o(14," Back to Login "),r()()()()),i&2&&(a(8),c("routerLink",_(2,ae)),a(5),c("routerLink",_(3,re)))}function ce(i,t){if(i&1&&(n(0,"p",14),o(1,"Resetting password for: "),n(2,"strong"),o(3),r()()),i&2){let e=u(2);a(3),m(e.userEmail())}}function me(i,t){i&1&&o(0," New password is required ")}function pe(i,t){i&1&&o(0," Password must be at least 8 characters long ")}function ue(i,t){i&1&&o(0," Password must contain uppercase, lowercase, number, and special character ")}function we(i,t){if(i&1&&(n(0,"mat-error"),p(1,me,1,0)(2,pe,1,0)(3,ue,1,0),r()),i&2){let e=u(2);a(),l(e.newPasswordControl!=null&&e.newPasswordControl.hasError("required")?1:e.newPasswordControl!=null&&e.newPasswordControl.hasError("minlength")?2:e.newPasswordControl!=null&&e.newPasswordControl.hasError("pattern")?3:-1)}}function he(i,t){i&1&&o(0," Please confirm your password ")}function fe(i,t){if(i&1&&(n(0,"mat-error"),p(1,he,1,0),r()),i&2){let e=u(2);a(),l(e.confirmPasswordControl!=null&&e.confirmPasswordControl.hasError("required")?1:-1)}}function Pe(i,t){i&1&&(n(0,"mat-error"),o(1," Passwords do not match "),r())}function Ce(i,t){i&1&&o(0," Reset Password ")}function xe(i,t){i&1&&(n(0,"span",26),x(1,"mat-spinner",29),o(2," Resetting Password... "),r())}function _e(i,t){if(i&1){let e=E();n(0,"div",3)(1,"div",13)(2,"h2",8),o(3,"Set New Password"),r(),p(4,ce,4,1,"p",14),n(5,"p",5),o(6,"Please enter your new password below."),r()(),n(7,"form",15),b("ngSubmit",function(){y(e);let P=u();return g(P.onSubmit())}),n(8,"mat-form-field",16)(9,"mat-label"),o(10,"New Password"),r(),x(11,"input",17),n(12,"button",18),b("click",function(){y(e);let P=u();return g(P.togglePasswordVisibility())}),n(13,"mat-icon"),o(14),r()(),p(15,we,4,1,"mat-error"),r(),n(16,"mat-form-field",16)(17,"mat-label"),o(18,"Confirm New Password"),r(),x(19,"input",19),n(20,"button",18),b("click",function(){y(e);let P=u();return g(P.toggleConfirmPasswordVisibility())}),n(21,"mat-icon"),o(22),r()(),p(23,fe,2,1,"mat-error")(24,Pe,2,0,"mat-error"),r(),n(25,"div",20)(26,"h4",21),o(27,"Password Requirements:"),r(),n(28,"div",22)(29,"div",23)(30,"mat-icon",24),o(31),r(),o(32," At least 8 characters long "),r(),n(33,"div",23)(34,"mat-icon",24),o(35),r(),o(36," One uppercase letter "),r(),n(37,"div",23)(38,"mat-icon",24),o(39),r(),o(40," One lowercase letter "),r(),n(41,"div",23)(42,"mat-icon",24),o(43),r(),o(44," One number "),r(),n(45,"div",23)(46,"mat-icon",24),o(47),r(),o(48," One special character (@$!%*?&) "),r()()(),n(49,"button",25),p(50,Ce,1,0)(51,xe,3,0,"span",26),r(),n(52,"div",27)(53,"a",28),o(54," Remember your password? Back to Login "),r(),n(55,"div",10)(56,"p",11),o(57," Don't have an account? "),n(58,"a",12),o(59," Sign up "),r()()()()()()}if(i&2){let e=u();a(4),l(e.userEmail()?4:-1),a(3),c("formGroup",e.resetPasswordForm),a(4),c("type",e.showPassword()?"text":"password")("disabled",e.loading()),a(),k("aria-label","Toggle password visibility")("aria-pressed",e.showPassword()),a(2),m(e.showPassword()?"visibility_off":"visibility"),a(),l(e.newPasswordControl!=null&&e.newPasswordControl.invalid&&(e.newPasswordControl!=null&&e.newPasswordControl.touched)?15:-1),a(4),c("type",e.showConfirmPassword()?"text":"password")("disabled",e.loading()),a(),k("aria-label","Toggle confirm password visibility")("aria-pressed",e.showConfirmPassword()),a(2),m(e.showConfirmPassword()?"visibility_off":"visibility"),a(),l(e.confirmPasswordControl!=null&&e.confirmPasswordControl.invalid&&(e.confirmPasswordControl!=null&&e.confirmPasswordControl.touched)?23:-1),a(),l(e.resetPasswordForm.hasError("passwordMismatch")&&(e.confirmPasswordControl!=null&&e.confirmPasswordControl.touched)?24:-1),a(5),f("text-green-600",e.hasMinLength())("text-gray-500",!e.hasMinLength()),a(2),m(e.hasMinLength()?"check_circle":"radio_button_unchecked"),a(2),f("text-green-600",e.hasUppercase())("text-gray-500",!e.hasUppercase()),a(2),m(e.hasUppercase()?"check_circle":"radio_button_unchecked"),a(2),f("text-green-600",e.hasLowercase())("text-gray-500",!e.hasLowercase()),a(2),m(e.hasLowercase()?"check_circle":"radio_button_unchecked"),a(2),f("text-green-600",e.hasNumber())("text-gray-500",!e.hasNumber()),a(2),m(e.hasNumber()?"check_circle":"radio_button_unchecked"),a(2),f("text-green-600",e.hasSpecialChar())("text-gray-500",!e.hasSpecialChar()),a(2),m(e.hasSpecialChar()?"check_circle":"radio_button_unchecked"),a(2),c("disabled",!e.isFormValid()||e.loading()),a(),l(e.loading()?51:50),a(3),c("routerLink",_(44,re)),a(5),c("routerLink",_(45,se))}}function ve(i){let t=i.get("newPassword"),e=i.get("confirmPassword");return!t||!e||t.value===e.value?null:{passwordMismatch:!0}}var ne=class i{authService=h(A);router=h(R);route=h(T);fb=h(Z);snackBar=h(oe);loading=d(!1);verifyingToken=d(!1);tokenValid=d(!1);userEmail=d("");showPassword=d(!1);showConfirmPassword=d(!1);currentPassword=d("");formValid=d(!1);resetToken="";resetPasswordForm;isFormValid=w(()=>this.formValid());hasMinLength=w(()=>this.currentPassword().length>=8);hasUppercase=w(()=>{let t=this.currentPassword();return/[A-Z]/.test(t)});hasLowercase=w(()=>{let t=this.currentPassword();return/[a-z]/.test(t)});hasNumber=w(()=>{let t=this.currentPassword();return/\d/.test(t)});hasSpecialChar=w(()=>{let t=this.currentPassword();return/[@$!%*?&]/.test(t)});constructor(){this.resetPasswordForm=this.fb.group({newPassword:["",[v.required,v.minLength(8),v.pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/)]],confirmPassword:["",[v.required]]},{validators:ve}),this.resetPasswordForm.get("newPassword")?.valueChanges.subscribe(t=>{this.currentPassword.set(t||"")}),this.resetPasswordForm.statusChanges.subscribe(()=>{this.formValid.set(this.resetPasswordForm.valid)}),this.formValid.set(this.resetPasswordForm.valid)}ngOnInit(){return C(this,null,function*(){this.route.queryParams.subscribe(t=>C(this,null,function*(){this.resetToken=t.token,this.resetToken?yield this.verifyToken():this.snackBar.open("Invalid reset link. Please request a new password reset.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}))})}verifyToken(){return C(this,null,function*(){this.verifyingToken.set(!0);try{let t=yield this.authService.verifyResetToken(this.resetToken);t.success?(this.tokenValid.set(!0),this.userEmail.set(t?.data?.email||"")):(this.snackBar.open(t.message||"Invalid or expired reset token.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]}),this.tokenValid.set(!1))}catch(t){this.snackBar.open(t?.message||"Invalid or expired reset token.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]}),this.tokenValid.set(!1)}finally{this.verifyingToken.set(!1)}})}onSubmit(){return C(this,null,function*(){if(!this.resetPasswordForm.valid){this.resetPasswordForm.hasError("passwordMismatch")?this.snackBar.open("Passwords do not match","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]}):this.snackBar.open("Please check all fields and try again","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]});return}let{newPassword:t,confirmPassword:e}=this.resetPasswordForm.value;this.loading.set(!0);try{let s=yield this.authService.resetPassword(this.resetToken,t,e);s.success?(this.snackBar.open(s.message||"Password has been reset successfully!","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-success"]}),setTimeout(()=>{this.router.navigate(["/auth/login"],{queryParams:{message:"Password reset successful. Please log in with your new password."}})},2e3)):this.snackBar.open(s.message||"Failed to reset password. Please try again.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}catch(s){this.snackBar.open(s?.message||"An unexpected error occurred. Please try again.","Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.loading.set(!1)}})}togglePasswordVisibility(){this.showPassword.set(!this.showPassword())}toggleConfirmPasswordVisibility(){this.showConfirmPassword.set(!this.showConfirmPassword())}get newPasswordControl(){return this.resetPasswordForm.get("newPassword")}get confirmPasswordControl(){return this.resetPasswordForm.get("confirmPassword")}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-reset-password"]],decls:4,vars:3,consts:[[1,"reset-password-container"],[1,"text-center","space-y-4"],[1,"text-center","space-y-6"],[1,"reset-form-container"],["diameter","40"],[1,"text-gray-600"],[1,"mb-6"],[1,"text-6xl","text-red-500","mb-4"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],["mat-raised-button","","color","primary",1,"w-full","py-3","text-base","font-medium",3,"routerLink"],[1,"mt-4","pt-4","border-t","border-gray-200"],[1,"text-sm","text-gray-600"],["mat-button","","color","primary",1,"text-sm","font-medium","ml-1",3,"routerLink"],[1,"text-center","mb-8"],[1,"text-gray-600","mb-2"],[1,"space-y-6",3,"ngSubmit","formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","newPassword","placeholder","Enter your new password",3,"type","disabled"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["matInput","","formControlName","confirmPassword","placeholder","Confirm your new password",3,"type","disabled"],[1,"mb-4","p-4","bg-gray-50","border","border-gray-200","rounded-lg"],[1,"text-sm","font-medium","text-gray-700","mb-3"],[1,"space-y-2"],[1,"flex","items-center","text-sm"],[1,"text-sm","mr-2"],["mat-raised-button","","color","primary","type","submit",1,"w-full","py-3","text-base","font-medium","mb-4",3,"disabled"],[1,"flex","items-center","justify-center","gap-2"],[1,"space-y-3","text-center"],["mat-button","","color","primary",1,"text-sm",3,"routerLink"],["diameter","16"]],template:function(e,s){e&1&&(n(0,"div",0),p(1,le,4,0,"div",1)(2,de,15,4,"div",2)(3,_e,60,46,"div",3),r()),e&2&&(a(),l(s.verifyingToken()?1:-1),a(),l(!s.verifyingToken()&&!s.tokenValid()?2:-1),a(),l(!s.verifyingToken()&&s.tokenValid()?3:-1))},dependencies:[M,j,G,q,O,D,U,$,F,W,Q,H,J,K,Y,X,z,B,N,L,I,V,te,ee,ie],encapsulation:2})};export{ne as ResetPasswordComponent};
