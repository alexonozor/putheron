import{a as J,b as K}from"./chunk-S52F56PD.js";import"./chunk-N5ED3CHT.js";import"./chunk-DI7FIG2Y.js";import"./chunk-3UNUIKCF.js";import{a as U,b as Y,c as q}from"./chunk-DVJGIJEZ.js";import"./chunk-YHNXJRU4.js";import{a as H}from"./chunk-MAUTWKH5.js";import"./chunk-URZBJTPH.js";import"./chunk-GLDHM7BE.js";import"./chunk-PVDG46DZ.js";import"./chunk-BQAOSCDJ.js";import"./chunk-M23MWY4A.js";import"./chunk-HQCAXNXF.js";import"./chunk-RTVUWSKV.js";import"./chunk-LPGP55NA.js";import"./chunk-OVLPSQNG.js";import{h as R}from"./chunk-7UZH7J7I.js";import"./chunk-2CAQAZ7V.js";import{h as W,m as G}from"./chunk-ZEPG7XYP.js";import"./chunk-667ILHIJ.js";import"./chunk-ZLE5IO2O.js";import"./chunk-WUPIU6OB.js";import"./chunk-3JRZMC5D.js";import{a as j}from"./chunk-DVEYH5MF.js";import"./chunk-C3KG2QNL.js";import{a as P,b as z}from"./chunk-2WQD2DAV.js";import{a as L,t as A,u as O}from"./chunk-IZGM5G4Z.js";import"./chunk-OXNSH2WS.js";import"./chunk-QD7SSFII.js";import{a as I,b as $}from"./chunk-EPCK2AMG.js";import{d as N}from"./chunk-WF7V7INI.js";import{g as V}from"./chunk-HNHRL3LT.js";import"./chunk-S4SH23H7.js";import{w as D}from"./chunk-5TL7AFVW.js";import{Bc as k,Cc as x,Hb as m,Jb as p,Mb as M,Nb as S,Ob as c,Pb as a,Qb as l,Rb as f,Vc as w,Yb as y,ab as d,ac as g,cc as r,ga as v,la as u,ma as _,na as F,oa as T,qc as h,rb as B,rc as E,va as C}from"./chunk-VCYZZ2B3.js";import{e as b}from"./chunk-JKOY2XUY.js";var Z=i=>({label:"Clear Search",callback:i}),X=i=>[i],ee=i=>({label:"Explore Businesses",callback:i,icon:"search"}),te=()=>["logo","name","category","description","status","business_type","actions"],ie=(i,e)=>e._id;function ne(i,e){if(i&1&&(a(0,"div",9)(1,"div",11),F(),a(2,"svg",12),f(3,"path",13),l(),T(),a(4,"div")(5,"h3",14),h(6,"Error"),l(),a(7,"p",15),h(8),l()()()()),i&2){let t=r();d(8),E(t.error())}}function oe(i,e){i&1&&(a(0,"div",10),f(1,"mat-spinner",16),l()),i&2&&(d(),c("diameter",60)("strokeWidth",4))}function se(i,e){if(i&1&&f(0,"app-empty-state",18),i&2){let t=r(3);c("buttons",x(3,X,x(1,Z,t.clearSearch)))}}function re(i,e){if(i&1&&f(0,"app-empty-state",19),i&2){let t=r(3);c("buttons",x(3,X,x(1,ee,t.searchBusinesses)))}}function ae(i,e){if(i&1&&(a(0,"div",17),m(1,se,1,5,"app-empty-state",18)(2,re,1,5,"app-empty-state",19),l()),i&2){let t=r(2);d(),p(t.searchTerm()?1:2)}}function le(i,e){if(i&1){let t=y();a(0,"app-business-card",22),g("view",function(){u(t);let o=r().$implicit,s=r(4);return _(s.viewBusiness(s.getBusiness(o)))})("edit",function(){u(t);let o=r().$implicit,s=r(4);return _(s.viewBusiness(s.getBusiness(o)))})("delete",function(){u(t);let o=r().$implicit,s=r(4);return _(s.viewBusiness(s.getBusiness(o)))}),l()}if(i&2){let t=r().$implicit,n=r(4);c("business",n.getBusiness(t))("statusColorClass","bg-green-100 text-green-800")("statusText","Active")("categoryName",n.getCategoryName(n.getBusiness(t)))("businessTypeColor","bg-blue-100 text-blue-800")("businessTypeText","Service")("showFavoriteButton",!0)("showEditDelete",!1)}}function de(i,e){if(i&1&&m(0,le,1,8,"app-business-card",21),i&2){let t=e.$implicit,n=r(4);p(n.getBusiness(t)?0:-1)}}function ce(i,e){if(i&1&&(a(0,"div",17)(1,"div",20),M(2,de,1,1,null,null,ie),l()()),i&2){let t=r(3);d(2),S(t.validFavorites())}}function ue(i,e){if(i&1){let t=y();a(0,"div",17)(1,"app-business-list-card",23),g("view",function(o){u(t);let s=r(3);return _(s.viewBusiness(o))})("edit",function(o){u(t);let s=r(3);return _(s.editBusiness(o))})("delete",function(o){u(t);let s=r(3);return _(s.deleteBusiness(o))}),l()()}if(i&2){let t=r(3);d(),c("businesses",t.favoritesBusinesses())("displayedColumns",k(5,te))("showEditDelete",!1)("deleteLabel","Remove from Favorites")("deleteIcon","favorite")}}function _e(i,e){if(i&1&&m(0,ce,4,0,"div",17)(1,ue,2,6,"div",17),i&2){let t=r(2);p(t.viewMode()==="grid"?0:1)}}function me(i,e){if(i&1&&m(0,ae,3,1,"div",17)(1,_e,2,1),i&2){let t=r();p(t.validFavorites().length===0?0:1)}}var Q=class i{favoritesService=v(H);authService=v(j);router=v(V);breakpointObserver=v(N);loading=C(!1);error=C("");searchTerm=C("");viewMode=C("grid");favorites=this.favoritesService.userFavorites;isAuthenticated=this.authService.isAuthenticated;currentUser=this.authService.user;validFavorites=w(()=>this.favorites().filter(e=>typeof e.business_id=="object"&&e.business_id._id?!0:e.business&&e.business._id).filter(e=>{let t=this.getBusiness(e);if(!t)return!1;let n=this.searchTerm().toLowerCase().trim();return n?t.name.toLowerCase().includes(n)||t.description?.toLowerCase().includes(n)||t.city?.toLowerCase().includes(n)||t.state?.toLowerCase().includes(n):!0}));favoritesBusinesses=w(()=>this.validFavorites().map(e=>this.getBusiness(e)).filter(e=>!!e));getBusiness(e){return typeof e.business_id=="object"?e.business_id:e.business}ngOnInit(){if(!this.isAuthenticated()){this.error.set("You must be logged in to view favorites");return}this.breakpointObserver.observe([L.Tablet]).subscribe(e=>{this.viewMode.set(e.matches?"list":"grid")}),this.loadFavorites()}loadFavorites(){return b(this,null,function*(){this.loading.set(!0),this.error.set("");try{yield this.favoritesService.refreshFavorites()}catch(e){console.error("Error loading favorites:",e),this.error.set(e.message||"Failed to load favorites")}finally{this.loading.set(!1)}})}viewBusiness(e){this.router.navigate(["/business/profile",e._id])}searchBusinesses(){this.router.navigate(["/search"])}formatDate(e){let t=new Date(e),o=Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60*24));if(o===0)return"today";if(o===1)return"yesterday";if(o<7)return`${o} days ago`;if(o<30){let s=Math.floor(o/7);return`${s} ${s===1?"week":"weeks"} ago`}else return t.toLocaleDateString()}getStatusColor(e){return"bg-green-100 text-green-800"}getStatusText(e){return"Active"}getCategoryName(e){return e.category_id?.name||"Business"}getBusinessTypeColor(e){return"bg-blue-100 text-blue-800"}getBusinessTypeText(e){return"Service"}clearSearch(){this.searchTerm.set("")}setViewMode(e){this.viewMode.set(e)}getBusinessNameMap(){let e={};return this.validFavorites().forEach(t=>{let n=this.getBusiness(t);n&&(e[n._id]=n.name)}),e}editBusiness(e){this.router.navigate(["/dashboard/edit",e])}deleteBusiness(e){return b(this,null,function*(){try{yield this.favoritesService.removeFromFavoritesAsync(e)}catch(t){console.error("Error removing from favorites:",t)}})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=B({type:i,selectors:[["app-favorites"]],decls:14,vars:6,consts:[[1,"min-h-screen","bg-gray-50"],[1,"mb-8"],[1,"lg:max-w-7xl","max-w-12xl"],[1,"px-6","pt-6"],["title","My Favorite Businesses","subtitle","Businesses you've saved for easy access",3,"showBackButton"],["matButton","filled","color","primary",1,"flex","items-center",3,"click"],[1,"mr-2"],[1,"px-0","sm:px-6","pt-4"],[3,"searchChange","viewModeChange","clearSearch","searchTerm","viewMode","hideViewModeToggle"],[1,"mb-6","bg-red-50","border-l-4","border-red-400","p-4","rounded-r-lg"],[1,"flex","items-center","justify-center","min-h-screen"],[1,"flex"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-red-400","mr-3"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"text-sm","font-medium","text-red-800"],[1,"mt-1","text-sm","text-red-700"],[3,"diameter","strokeWidth"],[1,"lg:max-w-7xl","max-w-12xl","px-6","pb-12"],["icon","search_off","title","No favorites found","description","Try adjusting your search term to find what you're looking for.",3,"buttons"],["icon","favorite_border","title","No favorites yet","description","Start exploring and save businesses you're interested in for easy access later.",3,"buttons"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[3,"business","statusColorClass","statusText","categoryName","businessTypeColor","businessTypeText","showFavoriteButton","showEditDelete"],[3,"view","edit","delete","business","statusColorClass","statusText","categoryName","businessTypeColor","businessTypeText","showFavoriteButton","showEditDelete"],[3,"view","edit","delete","businesses","displayedColumns","showEditDelete","deleteLabel","deleteIcon"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"app-dashboard-subheader",4)(5,"button",5),g("click",function(){return n.searchBusinesses()}),a(6,"mat-icon",6),h(7,"search"),l(),h(8," Find More Businesses "),l()()(),a(9,"div",7)(10,"app-business-search-filter",8),g("searchChange",function(s){return n.searchTerm.set(s)})("viewModeChange",function(s){return n.setViewMode(s)})("clearSearch",function(){return n.clearSearch()}),l()()(),m(11,ne,9,1,"div",9),m(12,oe,2,2,"div",10)(13,me,2,1),l()()),t&2&&(d(4),c("showBackButton",!1),d(6),c("searchTerm",n.searchTerm())("viewMode",n.viewMode())("hideViewModeToggle",!1),d(),p(n.error()?11:-1),d(),p(n.loading()?12:13))},dependencies:[D,$,I,O,A,R,z,P,W,G,U,Y,J,K,q],encapsulation:2})};export{Q as FavoritesComponent};
